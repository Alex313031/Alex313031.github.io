var THREE={REVISION:"70"};"object"===typeof module&&(module.exports=THREE);void 0===Math.sign&&(Math.sign=function(b){return 0>b?-1:0<b?1:0});THREE.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};THREE.CullFaceNone=0;THREE.CullFaceBack=1;THREE.CullFaceFront=2;THREE.CullFaceFrontBack=3;THREE.FrontFaceDirectionCW=0;THREE.FrontFaceDirectionCCW=1;THREE.BasicShadowMap=0;THREE.PCFShadowMap=1;THREE.PCFSoftShadowMap=2;THREE.FrontSide=0;THREE.BackSide=1;THREE.DoubleSide=2;THREE.NoShading=0;THREE.FlatShading=1;
THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NoBlending=0;THREE.NormalBlending=1;THREE.AdditiveBlending=2;THREE.SubtractiveBlending=3;THREE.MultiplyBlending=4;THREE.CustomBlending=5;THREE.AddEquation=100;THREE.SubtractEquation=101;THREE.ReverseSubtractEquation=102;THREE.MinEquation=103;THREE.MaxEquation=104;THREE.ZeroFactor=200;THREE.OneFactor=201;THREE.SrcColorFactor=202;THREE.OneMinusSrcColorFactor=203;THREE.SrcAlphaFactor=204;
THREE.OneMinusSrcAlphaFactor=205;THREE.DstAlphaFactor=206;THREE.OneMinusDstAlphaFactor=207;THREE.DstColorFactor=208;THREE.OneMinusDstColorFactor=209;THREE.SrcAlphaSaturateFactor=210;THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.AddOperation=2;THREE.UVMapping=300;THREE.CubeReflectionMapping=301;THREE.CubeRefractionMapping=302;THREE.EquirectangularReflectionMapping=303;THREE.EquirectangularRefractionMapping=304;THREE.SphericalReflectionMapping=305;THREE.RepeatWrapping=1E3;
THREE.ClampToEdgeWrapping=1001;THREE.MirroredRepeatWrapping=1002;THREE.NearestFilter=1003;THREE.NearestMipMapNearestFilter=1004;THREE.NearestMipMapLinearFilter=1005;THREE.LinearFilter=1006;THREE.LinearMipMapNearestFilter=1007;THREE.LinearMipMapLinearFilter=1008;THREE.UnsignedByteType=1009;THREE.ByteType=1010;THREE.ShortType=1011;THREE.UnsignedShortType=1012;THREE.IntType=1013;THREE.UnsignedIntType=1014;THREE.FloatType=1015;THREE.UnsignedShort4444Type=1016;THREE.UnsignedShort5551Type=1017;
THREE.UnsignedShort565Type=1018;THREE.AlphaFormat=1019;THREE.RGBFormat=1020;THREE.RGBAFormat=1021;THREE.LuminanceFormat=1022;THREE.LuminanceAlphaFormat=1023;THREE.RGBEFormat=THREE.RGBAFormat;THREE.RGB_S3TC_DXT1_Format=2001;THREE.RGBA_S3TC_DXT1_Format=2002;THREE.RGBA_S3TC_DXT3_Format=2003;THREE.RGBA_S3TC_DXT5_Format=2004;THREE.RGB_PVRTC_4BPPV1_Format=2100;THREE.RGB_PVRTC_2BPPV1_Format=2101;THREE.RGBA_PVRTC_4BPPV1_Format=2102;THREE.RGBA_PVRTC_2BPPV1_Format=2103;
THREE.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js.");this.projectVector=function(b,a){console.warn("THREE.Projector: .projectVector() is now vector.project().");b.project(a)};this.unprojectVector=function(b,a){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");b.unproject(a)};this.pickingRay=function(b,a){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}};
THREE.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js");this.domElement=document.createElement("canvas");this.clear=function(){};this.render=function(){};this.setClearColor=function(){};this.setSize=function(){}};THREE.Color=function(b){return 3===arguments.length?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(b)};
THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(b){b instanceof THREE.Color?this.copy(b):"number"===typeof b?this.setHex(b):"string"===typeof b&&this.setStyle(b);return this},setHex:function(b){b=Math.floor(b);this.r=(b>>16&255)/255;this.g=(b>>8&255)/255;this.b=(b&255)/255;return this},setRGB:function(b,a,c){this.r=b;this.g=a;this.b=c;return this},setHSL:function(b,a,c){if(0===a)this.r=this.g=this.b=c;else{var d=function(a,b,c){0>c&&(c+=1);1<c&&--c;return c<1/6?a+6*(b-a)*c:
.5>c?b:c<2/3?a+6*(b-a)*(2/3-c):a};a=.5>=c?c*(1+a):c+a-c*a;c=2*c-a;this.r=d(c,a,b+1/3);this.g=d(c,a,b);this.b=d(c,a,b-1/3)}return this},setStyle:function(b){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(b))return b=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(b),this.r=Math.min(255,parseInt(b[1],10))/255,this.g=Math.min(255,parseInt(b[2],10))/255,this.b=Math.min(255,parseInt(b[3],10))/255,this;if(/^rgb\((\d+)%, ?(\d+)%, ?(\d+)%\)$/i.test(b))return b=/^rgb\((\d+)%, ?(\d+)%, ?(\d+)%\)$/i.exec(b),this.r=Math.min(100,
parseInt(b[1],10))/100,this.g=Math.min(100,parseInt(b[2],10))/100,this.b=Math.min(100,parseInt(b[3],10))/100,this;if(/^#([0-9a-f]{6})$/i.test(b))return b=/^#([0-9a-f]{6})$/i.exec(b),this.setHex(parseInt(b[1],16)),this;if(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(b))return b=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(b),this.setHex(parseInt(b[1]+b[1]+b[2]+b[2]+b[3]+b[3],16)),this;if(/^(\w+)$/i.test(b))return this.setHex(THREE.ColorKeywords[b]),this},copy:function(b){this.r=b.r;this.g=b.g;this.b=b.b;
return this},copyGammaToLinear:function(b){this.r=b.r*b.r;this.g=b.g*b.g;this.b=b.b*b.b;return this},copyLinearToGamma:function(b){this.r=Math.sqrt(b.r);this.g=Math.sqrt(b.g);this.b=Math.sqrt(b.b);return this},convertGammaToLinear:function(){var b=this.r,a=this.g,c=this.b;this.r=b*b;this.g=a*a;this.b=c*c;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<
0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(b){b=b||{h:0,s:0,l:0};var a=this.r,c=this.g,d=this.b,e=Math.max(a,c,d),f=Math.min(a,c,d),g,h=(f+e)/2;if(f===e)f=g=0;else{var k=e-f;f=.5>=h?k/(e+f):k/(2-e-f);switch(e){case a:g=(c-d)/k+(c<d?6:0);break;case c:g=(d-a)/k+2;break;case d:g=(a-c)/k+4}g/=6}b.h=g;b.s=f;b.l=h;return b},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(b,a,c){var d=this.getHSL();
d.h+=b;d.s+=a;d.l+=c;this.setHSL(d.h,d.s,d.l);return this},add:function(b){this.r+=b.r;this.g+=b.g;this.b+=b.b;return this},addColors:function(b,a){this.r=b.r+a.r;this.g=b.g+a.g;this.b=b.b+a.b;return this},addScalar:function(b){this.r+=b;this.g+=b;this.b+=b;return this},multiply:function(b){this.r*=b.r;this.g*=b.g;this.b*=b.b;return this},multiplyScalar:function(b){this.r*=b;this.g*=b;this.b*=b;return this},lerp:function(b,a){this.r+=(b.r-this.r)*a;this.g+=(b.g-this.g)*a;this.b+=(b.b-this.b)*a;return this},
equals:function(b){return b.r===this.r&&b.g===this.g&&b.b===this.b},fromArray:function(b){this.r=b[0];this.g=b[1];this.b=b[2];return this},toArray:function(){return[this.r,this.g,this.b]},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}};
THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,
darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,
grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,
lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,
palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,
tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};THREE.Quaternion=function(b,a,c,d){this._x=b||0;this._y=a||0;this._z=c||0;this._w=void 0!==d?d:1};
THREE.Quaternion.prototype={constructor:THREE.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(b){this._x=b;this.onChangeCallback()},get y(){return this._y},set y(b){this._y=b;this.onChangeCallback()},get z(){return this._z},set z(b){this._z=b;this.onChangeCallback()},get w(){return this._w},set w(b){this._w=b;this.onChangeCallback()},set:function(b,a,c,d){this._x=b;this._y=a;this._z=c;this._w=d;this.onChangeCallback();return this},copy:function(b){this._x=b.x;this._y=b.y;this._z=b.z;
this._w=b.w;this.onChangeCallback();return this},setFromEuler:function(b,a){if(!1===b instanceof THREE.Euler)throw Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var c=Math.cos(b._x/2),d=Math.cos(b._y/2),e=Math.cos(b._z/2),f=Math.sin(b._x/2),g=Math.sin(b._y/2),h=Math.sin(b._z/2);"XYZ"===b.order?(this._x=f*d*e+c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e-f*g*h):"YXZ"===b.order?(this._x=f*d*e+c*g*h,this._y=c*g*e-f*d*h,this._z=
c*d*h-f*g*e,this._w=c*d*e+f*g*h):"ZXY"===b.order?(this._x=f*d*e-c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e-f*g*h):"ZYX"===b.order?(this._x=f*d*e-c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e+f*g*h):"YZX"===b.order?(this._x=f*d*e+c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e-f*g*h):"XZY"===b.order&&(this._x=f*d*e-c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e+f*g*h);if(!1!==a)this.onChangeCallback();return this},setFromAxisAngle:function(b,
a){var c=a/2,d=Math.sin(c);this._x=b.x*d;this._y=b.y*d;this._z=b.z*d;this._w=Math.cos(c);this.onChangeCallback();return this},setFromRotationMatrix:function(b){var a=b.elements,c=a[0];b=a[4];var d=a[8],e=a[1],f=a[5],g=a[9],h=a[2],k=a[6];a=a[10];var l=c+f+a;0<l?(c=.5/Math.sqrt(l+1),this._w=.25/c,this._x=(k-g)*c,this._y=(d-h)*c,this._z=(e-b)*c):c>f&&c>a?(c=2*Math.sqrt(1+c-f-a),this._w=(k-g)/c,this._x=.25*c,this._y=(b+e)/c,this._z=(d+h)/c):f>a?(c=2*Math.sqrt(1+f-c-a),this._w=(d-h)/c,this._x=(b+e)/c,
this._y=.25*c,this._z=(g+k)/c):(c=2*Math.sqrt(1+a-c-f),this._w=(e-b)/c,this._x=(d+h)/c,this._y=(g+k)/c,this._z=.25*c);this.onChangeCallback();return this},setFromUnitVectors:function(){var b,a;return function(c,d){void 0===b&&(b=new THREE.Vector3);a=c.dot(d)+1;1E-6>a?(a=0,Math.abs(c.x)>Math.abs(c.z)?b.set(-c.y,c.x,0):b.set(0,-c.z,c.y)):b.crossVectors(c,d);this._x=b.x;this._y=b.y;this._z=b.z;this._w=a;this.normalize();return this}}(),inverse:function(){this.conjugate().normalize();return this},conjugate:function(){this._x*=
-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(b){return this._x*b._x+this._y*b._y+this._z*b._z+this._w*b._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var b=this.length();0===b?(this._z=this._y=this._x=0,this._w=1):(b=1/b,this._x*=b,this._y*=b,this._z*=b,this._w*=b);this.onChangeCallback();return this},
multiply:function(b,a){return void 0!==a?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(b,a)):this.multiplyQuaternions(this,b)},multiplyQuaternions:function(b,a){var c=b._x,d=b._y,e=b._z,f=b._w,g=a._x,h=a._y,k=a._z,l=a._w;this._x=c*l+f*g+d*k-e*h;this._y=d*l+f*h+e*g-c*k;this._z=e*l+f*k+c*h-d*g;this._w=f*l-c*g-d*h-e*k;this.onChangeCallback();return this},multiplyVector3:function(b){console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");
return b.applyQuaternion(this)},slerp:function(b,a){if(0===a)return this;if(1===a)return this.copy(b);var c=this._x,d=this._y,e=this._z,f=this._w,g=f*b._w+c*b._x+d*b._y+e*b._z;0>g?(this._w=-b._w,this._x=-b._x,this._y=-b._y,this._z=-b._z,g=-g):this.copy(b);if(1<=g)return this._w=f,this._x=c,this._y=d,this._z=e,this;var h=Math.acos(g),k=Math.sqrt(1-g*g);if(.001>Math.abs(k))return this._w=.5*(f+this._w),this._x=.5*(c+this._x),this._y=.5*(d+this._y),this._z=.5*(e+this._z),this;g=Math.sin((1-a)*h)/k;h=
Math.sin(a*h)/k;this._w=f*g+this._w*h;this._x=c*g+this._x*h;this._y=d*g+this._y*h;this._z=e*g+this._z*h;this.onChangeCallback();return this},equals:function(b){return b._x===this._x&&b._y===this._y&&b._z===this._z&&b._w===this._w},fromArray:function(b,a){void 0===a&&(a=0);this._x=b[a];this._y=b[a+1];this._z=b[a+2];this._w=b[a+3];this.onChangeCallback();return this},toArray:function(b,a){void 0===b&&(b=[]);void 0===a&&(a=0);b[a]=this._x;b[a+1]=this._y;b[a+2]=this._z;b[a+3]=this._w;return b},onChange:function(b){this.onChangeCallback=
b;return this},onChangeCallback:function(){},clone:function(){return new THREE.Quaternion(this._x,this._y,this._z,this._w)}};THREE.Quaternion.slerp=function(b,a,c,d){return c.copy(b).slerp(a,d)};THREE.Vector2=function(b,a){this.x=b||0;this.y=a||0};
THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(b,a){this.x=b;this.y=a;return this},setX:function(b){this.x=b;return this},setY:function(b){this.y=b;return this},setComponent:function(b,a){switch(b){case 0:this.x=a;break;case 1:this.y=a;break;default:throw Error("index is out of range: "+b);}},getComponent:function(b){switch(b){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+b);}},copy:function(b){this.x=b.x;this.y=b.y;return this},add:function(b,
a){if(void 0!==a)return console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(b,a);this.x+=b.x;this.y+=b.y;return this},addVectors:function(b,a){this.x=b.x+a.x;this.y=b.y+a.y;return this},addScalar:function(b){this.x+=b;this.y+=b;return this},sub:function(b,a){if(void 0!==a)return console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(b,a);this.x-=b.x;this.y-=b.y;return this},
subVectors:function(b,a){this.x=b.x-a.x;this.y=b.y-a.y;return this},multiply:function(b){this.x*=b.x;this.y*=b.y;return this},multiplyScalar:function(b){this.x*=b;this.y*=b;return this},divide:function(b){this.x/=b.x;this.y/=b.y;return this},divideScalar:function(b){0!==b?(b=1/b,this.x*=b,this.y*=b):this.y=this.x=0;return this},min:function(b){this.x>b.x&&(this.x=b.x);this.y>b.y&&(this.y=b.y);return this},max:function(b){this.x<b.x&&(this.x=b.x);this.y<b.y&&(this.y=b.y);return this},clamp:function(b,
a){this.x<b.x?this.x=b.x:this.x>a.x&&(this.x=a.x);this.y<b.y?this.y=b.y:this.y>a.y&&(this.y=a.y);return this},clampScalar:function(){var b,a;return function(c,d){void 0===b&&(b=new THREE.Vector2,a=new THREE.Vector2);b.set(c,c);a.set(d,d);return this.clamp(b,a)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},
roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(b){return this.x*b.x+this.y*b.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(b){return Math.sqrt(this.distanceToSquared(b))},distanceToSquared:function(b){var a=
this.x-b.x;b=this.y-b.y;return a*a+b*b},setLength:function(b){var a=this.length();0!==a&&b!==a&&this.multiplyScalar(b/a);return this},lerp:function(b,a){this.x+=(b.x-this.x)*a;this.y+=(b.y-this.y)*a;return this},equals:function(b){return b.x===this.x&&b.y===this.y},fromArray:function(b,a){void 0===a&&(a=0);this.x=b[a];this.y=b[a+1];return this},toArray:function(b,a){void 0===b&&(b=[]);void 0===a&&(a=0);b[a]=this.x;b[a+1]=this.y;return b},fromAttribute:function(b,a,c){void 0===c&&(c=0);a=a*b.itemSize+
c;this.x=b.array[a];this.y=b.array[a+1];return this},clone:function(){return new THREE.Vector2(this.x,this.y)}};THREE.Vector3=function(b,a,c){this.x=b||0;this.y=a||0;this.z=c||0};
THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(b,a,c){this.x=b;this.y=a;this.z=c;return this},setX:function(b){this.x=b;return this},setY:function(b){this.y=b;return this},setZ:function(b){this.z=b;return this},setComponent:function(b,a){switch(b){case 0:this.x=a;break;case 1:this.y=a;break;case 2:this.z=a;break;default:throw Error("index is out of range: "+b);}},getComponent:function(b){switch(b){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+
b);}},copy:function(b){this.x=b.x;this.y=b.y;this.z=b.z;return this},add:function(b,a){if(void 0!==a)return console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(b,a);this.x+=b.x;this.y+=b.y;this.z+=b.z;return this},addScalar:function(b){this.x+=b;this.y+=b;this.z+=b;return this},addVectors:function(b,a){this.x=b.x+a.x;this.y=b.y+a.y;this.z=b.z+a.z;return this},sub:function(b,a){if(void 0!==a)return console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),
this.subVectors(b,a);this.x-=b.x;this.y-=b.y;this.z-=b.z;return this},subVectors:function(b,a){this.x=b.x-a.x;this.y=b.y-a.y;this.z=b.z-a.z;return this},multiply:function(b,a){if(void 0!==a)return console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(b,a);this.x*=b.x;this.y*=b.y;this.z*=b.z;return this},multiplyScalar:function(b){this.x*=b;this.y*=b;this.z*=b;return this},multiplyVectors:function(b,a){this.x=b.x*a.x;this.y=
b.y*a.y;this.z=b.z*a.z;return this},applyEuler:function(){var b;return function(a){!1===a instanceof THREE.Euler&&console.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order.");void 0===b&&(b=new THREE.Quaternion);this.applyQuaternion(b.setFromEuler(a));return this}}(),applyAxisAngle:function(){var b;return function(a,c){void 0===b&&(b=new THREE.Quaternion);this.applyQuaternion(b.setFromAxisAngle(a,c));return this}}(),applyMatrix3:function(b){var a=this.x,
c=this.y,d=this.z;b=b.elements;this.x=b[0]*a+b[3]*c+b[6]*d;this.y=b[1]*a+b[4]*c+b[7]*d;this.z=b[2]*a+b[5]*c+b[8]*d;return this},applyMatrix4:function(b){var a=this.x,c=this.y,d=this.z;b=b.elements;this.x=b[0]*a+b[4]*c+b[8]*d+b[12];this.y=b[1]*a+b[5]*c+b[9]*d+b[13];this.z=b[2]*a+b[6]*c+b[10]*d+b[14];return this},applyProjection:function(b){var a=this.x,c=this.y,d=this.z;b=b.elements;var e=1/(b[3]*a+b[7]*c+b[11]*d+b[15]);this.x=(b[0]*a+b[4]*c+b[8]*d+b[12])*e;this.y=(b[1]*a+b[5]*c+b[9]*d+b[13])*e;this.z=
(b[2]*a+b[6]*c+b[10]*d+b[14])*e;return this},applyQuaternion:function(b){var a=this.x,c=this.y,d=this.z,e=b.x,f=b.y,g=b.z;b=b.w;var h=b*a+f*d-g*c,k=b*c+g*a-e*d,l=b*d+e*c-f*a;a=-e*a-f*c-g*d;this.x=h*b+a*-e+k*-g-l*-f;this.y=k*b+a*-f+l*-e-h*-g;this.z=l*b+a*-g+h*-f-k*-e;return this},project:function(){var b;return function(a){void 0===b&&(b=new THREE.Matrix4);b.multiplyMatrices(a.projectionMatrix,b.getInverse(a.matrixWorld));return this.applyProjection(b)}}(),unproject:function(){var b;return function(a){void 0===
b&&(b=new THREE.Matrix4);b.multiplyMatrices(a.matrixWorld,b.getInverse(a.projectionMatrix));return this.applyProjection(b)}}(),transformDirection:function(b){var a=this.x,c=this.y,d=this.z;b=b.elements;this.x=b[0]*a+b[4]*c+b[8]*d;this.y=b[1]*a+b[5]*c+b[9]*d;this.z=b[2]*a+b[6]*c+b[10]*d;this.normalize();return this},divide:function(b){this.x/=b.x;this.y/=b.y;this.z/=b.z;return this},divideScalar:function(b){0!==b?(b=1/b,this.x*=b,this.y*=b,this.z*=b):this.z=this.y=this.x=0;return this},min:function(b){this.x>
b.x&&(this.x=b.x);this.y>b.y&&(this.y=b.y);this.z>b.z&&(this.z=b.z);return this},max:function(b){this.x<b.x&&(this.x=b.x);this.y<b.y&&(this.y=b.y);this.z<b.z&&(this.z=b.z);return this},clamp:function(b,a){this.x<b.x?this.x=b.x:this.x>a.x&&(this.x=a.x);this.y<b.y?this.y=b.y:this.y>a.y&&(this.y=a.y);this.z<b.z?this.z=b.z:this.z>a.z&&(this.z=a.z);return this},clampScalar:function(){var b,a;return function(c,d){void 0===b&&(b=new THREE.Vector3,a=new THREE.Vector3);b.set(c,c,c);a.set(d,d,d);return this.clamp(b,
a)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);
return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(b){return this.x*b.x+this.y*b.y+this.z*b.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(b){var a=this.length();0!==a&&b!==a&&this.multiplyScalar(b/
a);return this},lerp:function(b,a){this.x+=(b.x-this.x)*a;this.y+=(b.y-this.y)*a;this.z+=(b.z-this.z)*a;return this},cross:function(b,a){if(void 0!==a)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(b,a);var c=this.x,d=this.y,e=this.z;this.x=d*b.z-e*b.y;this.y=e*b.x-c*b.z;this.z=c*b.y-d*b.x;return this},crossVectors:function(b,a){var c=b.x,d=b.y,e=b.z,f=a.x,g=a.y,h=a.z;this.x=d*h-e*g;this.y=e*f-c*h;this.z=c*g-d*f;return this},
projectOnVector:function(){var b,a;return function(c){void 0===b&&(b=new THREE.Vector3);b.copy(c).normalize();a=this.dot(b);return this.copy(b).multiplyScalar(a)}}(),projectOnPlane:function(){var b;return function(a){void 0===b&&(b=new THREE.Vector3);b.copy(this).projectOnVector(a);return this.sub(b)}}(),reflect:function(){var b;return function(a){void 0===b&&(b=new THREE.Vector3);return this.sub(b.copy(a).multiplyScalar(2*this.dot(a)))}}(),angleTo:function(b){b=this.dot(b)/(this.length()*b.length());
return Math.acos(THREE.Math.clamp(b,-1,1))},distanceTo:function(b){return Math.sqrt(this.distanceToSquared(b))},distanceToSquared:function(b){var a=this.x-b.x,c=this.y-b.y;b=this.z-b.z;return a*a+c*c+b*b},setEulerFromRotationMatrix:function(b,a){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(b,a){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},
getPositionFromMatrix:function(b){console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(b)},getScaleFromMatrix:function(b){console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(b)},getColumnFromMatrix:function(b,a){console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(b,
a)},setFromMatrixPosition:function(b){this.x=b.elements[12];this.y=b.elements[13];this.z=b.elements[14];return this},setFromMatrixScale:function(b){var a=this.set(b.elements[0],b.elements[1],b.elements[2]).length(),c=this.set(b.elements[4],b.elements[5],b.elements[6]).length();b=this.set(b.elements[8],b.elements[9],b.elements[10]).length();this.x=a;this.y=c;this.z=b;return this},setFromMatrixColumn:function(b,a){var c=4*b,d=a.elements;this.x=d[c];this.y=d[c+1];this.z=d[c+2];return this},equals:function(b){return b.x===
this.x&&b.y===this.y&&b.z===this.z},fromArray:function(b,a){void 0===a&&(a=0);this.x=b[a];this.y=b[a+1];this.z=b[a+2];return this},toArray:function(b,a){void 0===b&&(b=[]);void 0===a&&(a=0);b[a]=this.x;b[a+1]=this.y;b[a+2]=this.z;return b},fromAttribute:function(b,a,c){void 0===c&&(c=0);a=a*b.itemSize+c;this.x=b.array[a];this.y=b.array[a+1];this.z=b.array[a+2];return this},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}};
THREE.Vector4=function(b,a,c,d){this.x=b||0;this.y=a||0;this.z=c||0;this.w=void 0!==d?d:1};
THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(b,a,c,d){this.x=b;this.y=a;this.z=c;this.w=d;return this},setX:function(b){this.x=b;return this},setY:function(b){this.y=b;return this},setZ:function(b){this.z=b;return this},setW:function(b){this.w=b;return this},setComponent:function(b,a){switch(b){case 0:this.x=a;break;case 1:this.y=a;break;case 2:this.z=a;break;case 3:this.w=a;break;default:throw Error("index is out of range: "+b);}},getComponent:function(b){switch(b){case 0:return this.x;
case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+b);}},copy:function(b){this.x=b.x;this.y=b.y;this.z=b.z;this.w=void 0!==b.w?b.w:1;return this},add:function(b,a){if(void 0!==a)return console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(b,a);this.x+=b.x;this.y+=b.y;this.z+=b.z;this.w+=b.w;return this},addScalar:function(b){this.x+=b;this.y+=b;this.z+=b;this.w+=b;return this},
addVectors:function(b,a){this.x=b.x+a.x;this.y=b.y+a.y;this.z=b.z+a.z;this.w=b.w+a.w;return this},sub:function(b,a){if(void 0!==a)return console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(b,a);this.x-=b.x;this.y-=b.y;this.z-=b.z;this.w-=b.w;return this},subVectors:function(b,a){this.x=b.x-a.x;this.y=b.y-a.y;this.z=b.z-a.z;this.w=b.w-a.w;return this},multiplyScalar:function(b){this.x*=b;this.y*=b;this.z*=b;this.w*=b;return this},applyMatrix4:function(b){var a=
this.x,c=this.y,d=this.z,e=this.w;b=b.elements;this.x=b[0]*a+b[4]*c+b[8]*d+b[12]*e;this.y=b[1]*a+b[5]*c+b[9]*d+b[13]*e;this.z=b[2]*a+b[6]*c+b[10]*d+b[14]*e;this.w=b[3]*a+b[7]*c+b[11]*d+b[15]*e;return this},divideScalar:function(b){0!==b?(b=1/b,this.x*=b,this.y*=b,this.z*=b,this.w*=b):(this.z=this.y=this.x=0,this.w=1);return this},setAxisAngleFromQuaternion:function(b){this.w=2*Math.acos(b.w);var a=Math.sqrt(1-b.w*b.w);1E-4>a?(this.x=1,this.z=this.y=0):(this.x=b.x/a,this.y=b.y/a,this.z=b.z/a);return this},
setAxisAngleFromRotationMatrix:function(b){b=b.elements;var a=b[0];var c=b[4];var d=b[8],e=b[1],f=b[5],g=b[9];var h=b[2];var k=b[6];var l=b[10];if(.01>Math.abs(c-e)&&.01>Math.abs(d-h)&&.01>Math.abs(g-k)){if(.1>Math.abs(c+e)&&.1>Math.abs(d+h)&&.1>Math.abs(g+k)&&.1>Math.abs(a+f+l-3))return this.set(1,0,0,0),this;b=Math.PI;a=(a+1)/2;f=(f+1)/2;l=(l+1)/2;c=(c+e)/4;d=(d+h)/4;g=(g+k)/4;a>f&&a>l?.01>a?(k=0,c=h=.707106781):(k=Math.sqrt(a),h=c/k,c=d/k):f>l?.01>f?(k=.707106781,h=0,c=.707106781):(h=Math.sqrt(f),
k=c/h,c=g/h):.01>l?(h=k=.707106781,c=0):(c=Math.sqrt(l),k=d/c,h=g/c);this.set(k,h,c,b);return this}b=Math.sqrt((k-g)*(k-g)+(d-h)*(d-h)+(e-c)*(e-c));.001>Math.abs(b)&&(b=1);this.x=(k-g)/b;this.y=(d-h)/b;this.z=(e-c)/b;this.w=Math.acos((a+f+l-1)/2);return this},min:function(b){this.x>b.x&&(this.x=b.x);this.y>b.y&&(this.y=b.y);this.z>b.z&&(this.z=b.z);this.w>b.w&&(this.w=b.w);return this},max:function(b){this.x<b.x&&(this.x=b.x);this.y<b.y&&(this.y=b.y);this.z<b.z&&(this.z=b.z);this.w<b.w&&(this.w=b.w);
return this},clamp:function(b,a){this.x<b.x?this.x=b.x:this.x>a.x&&(this.x=a.x);this.y<b.y?this.y=b.y:this.y>a.y&&(this.y=a.y);this.z<b.z?this.z=b.z:this.z>a.z&&(this.z=a.z);this.w<b.w?this.w=b.w:this.w>a.w&&(this.w=a.w);return this},clampScalar:function(){var b,a;return function(c,d){void 0===b&&(b=new THREE.Vector4,a=new THREE.Vector4);b.set(c,c,c,c);a.set(d,d,d,d);return this.clamp(b,a)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);
return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);
return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(b){return this.x*b.x+this.y*b.y+this.z*b.z+this.w*b.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},
setLength:function(b){var a=this.length();0!==a&&b!==a&&this.multiplyScalar(b/a);return this},lerp:function(b,a){this.x+=(b.x-this.x)*a;this.y+=(b.y-this.y)*a;this.z+=(b.z-this.z)*a;this.w+=(b.w-this.w)*a;return this},equals:function(b){return b.x===this.x&&b.y===this.y&&b.z===this.z&&b.w===this.w},fromArray:function(b,a){void 0===a&&(a=0);this.x=b[a];this.y=b[a+1];this.z=b[a+2];this.w=b[a+3];return this},toArray:function(b,a){void 0===b&&(b=[]);void 0===a&&(a=0);b[a]=this.x;b[a+1]=this.y;b[a+2]=
this.z;b[a+3]=this.w;return b},fromAttribute:function(b,a,c){void 0===c&&(c=0);a=a*b.itemSize+c;this.x=b.array[a];this.y=b.array[a+1];this.z=b.array[a+2];this.w=b.array[a+3];return this},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}};THREE.Euler=function(b,a,c,d){this._x=b||0;this._y=a||0;this._z=c||0;this._order=d||THREE.Euler.DefaultOrder};THREE.Euler.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" ");THREE.Euler.DefaultOrder="XYZ";
THREE.Euler.prototype={constructor:THREE.Euler,_x:0,_y:0,_z:0,_order:THREE.Euler.DefaultOrder,get x(){return this._x},set x(b){this._x=b;this.onChangeCallback()},get y(){return this._y},set y(b){this._y=b;this.onChangeCallback()},get z(){return this._z},set z(b){this._z=b;this.onChangeCallback()},get order(){return this._order},set order(b){this._order=b;this.onChangeCallback()},set:function(b,a,c,d){this._x=b;this._y=a;this._z=c;this._order=d||this._order;this.onChangeCallback();return this},copy:function(b){this._x=
b._x;this._y=b._y;this._z=b._z;this._order=b._order;this.onChangeCallback();return this},setFromRotationMatrix:function(b,a,c){var d=THREE.Math.clamp,e=b.elements;b=e[0];var f=e[4],g=e[8],h=e[1],k=e[5],l=e[9],p=e[2],q=e[6];e=e[10];a=a||this._order;"XYZ"===a?(this._y=Math.asin(d(g,-1,1)),.99999>Math.abs(g)?(this._x=Math.atan2(-l,e),this._z=Math.atan2(-f,b)):(this._x=Math.atan2(q,k),this._z=0)):"YXZ"===a?(this._x=Math.asin(-d(l,-1,1)),.99999>Math.abs(l)?(this._y=Math.atan2(g,e),this._z=Math.atan2(h,
k)):(this._y=Math.atan2(-p,b),this._z=0)):"ZXY"===a?(this._x=Math.asin(d(q,-1,1)),.99999>Math.abs(q)?(this._y=Math.atan2(-p,e),this._z=Math.atan2(-f,k)):(this._y=0,this._z=Math.atan2(h,b))):"ZYX"===a?(this._y=Math.asin(-d(p,-1,1)),.99999>Math.abs(p)?(this._x=Math.atan2(q,e),this._z=Math.atan2(h,b)):(this._x=0,this._z=Math.atan2(-f,k))):"YZX"===a?(this._z=Math.asin(d(h,-1,1)),.99999>Math.abs(h)?(this._x=Math.atan2(-l,k),this._y=Math.atan2(-p,b)):(this._x=0,this._y=Math.atan2(g,e))):"XZY"===a?(this._z=
Math.asin(-d(f,-1,1)),.99999>Math.abs(f)?(this._x=Math.atan2(q,k),this._y=Math.atan2(g,b)):(this._x=Math.atan2(-l,e),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+a);this._order=a;if(!1!==c)this.onChangeCallback();return this},setFromQuaternion:function(){var b;return function(a,c,d){void 0===b&&(b=new THREE.Matrix4);b.makeRotationFromQuaternion(a);this.setFromRotationMatrix(b,c,d);return this}}(),setFromVector3:function(b,a){return this.set(b.x,b.y,b.z,
a||this._order)},reorder:function(){var b=new THREE.Quaternion;return function(a){b.setFromEuler(this);this.setFromQuaternion(b,a)}}(),equals:function(b){return b._x===this._x&&b._y===this._y&&b._z===this._z&&b._order===this._order},fromArray:function(b){this._x=b[0];this._y=b[1];this._z=b[2];void 0!==b[3]&&(this._order=b[3]);this.onChangeCallback();return this},toArray:function(){return[this._x,this._y,this._z,this._order]},toVector3:function(b){return b?b.set(this._x,this._y,this._z):new THREE.Vector3(this._x,
this._y,this._z)},onChange:function(b){this.onChangeCallback=b;return this},onChangeCallback:function(){},clone:function(){return new THREE.Euler(this._x,this._y,this._z,this._order)}};THREE.Line3=function(b,a){this.start=void 0!==b?b:new THREE.Vector3;this.end=void 0!==a?a:new THREE.Vector3};
THREE.Line3.prototype={constructor:THREE.Line3,set:function(b,a){this.start.copy(b);this.end.copy(a);return this},copy:function(b){this.start.copy(b.start);this.end.copy(b.end);return this},center:function(b){return(b||new THREE.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(b){return(b||new THREE.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(b,
a){var c=a||new THREE.Vector3;return this.delta(c).multiplyScalar(b).add(this.start)},closestPointToPointParameter:function(){var b=new THREE.Vector3,a=new THREE.Vector3;return function(c,d){b.subVectors(c,this.start);a.subVectors(this.end,this.start);var e=a.dot(a);e=a.dot(b)/e;d&&(e=THREE.Math.clamp(e,0,1));return e}}(),closestPointToPoint:function(b,a,c){b=this.closestPointToPointParameter(b,a);c=c||new THREE.Vector3;return this.delta(c).multiplyScalar(b).add(this.start)},applyMatrix4:function(b){this.start.applyMatrix4(b);
this.end.applyMatrix4(b);return this},equals:function(b){return b.start.equals(this.start)&&b.end.equals(this.end)},clone:function(){return(new THREE.Line3).copy(this)}};THREE.Box2=function(b,a){this.min=void 0!==b?b:new THREE.Vector2(Infinity,Infinity);this.max=void 0!==a?a:new THREE.Vector2(-Infinity,-Infinity)};
THREE.Box2.prototype={constructor:THREE.Box2,set:function(b,a){this.min.copy(b);this.max.copy(a);return this},setFromPoints:function(b){this.makeEmpty();for(var a=0,c=b.length;a<c;a++)this.expandByPoint(b[a]);return this},setFromCenterAndSize:function(){var b=new THREE.Vector2;return function(a,c){var d=b.copy(c).multiplyScalar(.5);this.min.copy(a).sub(d);this.max.copy(a).add(d);return this}}(),copy:function(b){this.min.copy(b.min);this.max.copy(b.max);return this},makeEmpty:function(){this.min.x=
this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(b){return(b||new THREE.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(b){return(b||new THREE.Vector2).subVectors(this.max,this.min)},expandByPoint:function(b){this.min.min(b);this.max.max(b);return this},expandByVector:function(b){this.min.sub(b);this.max.add(b);return this},expandByScalar:function(b){this.min.addScalar(-b);
this.max.addScalar(b);return this},containsPoint:function(b){return b.x<this.min.x||b.x>this.max.x||b.y<this.min.y||b.y>this.max.y?!1:!0},containsBox:function(b){return this.min.x<=b.min.x&&b.max.x<=this.max.x&&this.min.y<=b.min.y&&b.max.y<=this.max.y?!0:!1},getParameter:function(b,a){return(a||new THREE.Vector2).set((b.x-this.min.x)/(this.max.x-this.min.x),(b.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(b){return b.max.x<this.min.x||b.min.x>this.max.x||b.max.y<this.min.y||b.min.y>
this.max.y?!1:!0},clampPoint:function(b,a){return(a||new THREE.Vector2).copy(b).clamp(this.min,this.max)},distanceToPoint:function(){var b=new THREE.Vector2;return function(a){return b.copy(a).clamp(this.min,this.max).sub(a).length()}}(),intersect:function(b){this.min.max(b.min);this.max.min(b.max);return this},union:function(b){this.min.min(b.min);this.max.max(b.max);return this},translate:function(b){this.min.add(b);this.max.add(b);return this},equals:function(b){return b.min.equals(this.min)&&
b.max.equals(this.max)},clone:function(){return(new THREE.Box2).copy(this)}};THREE.Box3=function(b,a){this.min=void 0!==b?b:new THREE.Vector3(Infinity,Infinity,Infinity);this.max=void 0!==a?a:new THREE.Vector3(-Infinity,-Infinity,-Infinity)};
THREE.Box3.prototype={constructor:THREE.Box3,set:function(b,a){this.min.copy(b);this.max.copy(a);return this},setFromPoints:function(b){this.makeEmpty();for(var a=0,c=b.length;a<c;a++)this.expandByPoint(b[a]);return this},setFromCenterAndSize:function(){var b=new THREE.Vector3;return function(a,c){var d=b.copy(c).multiplyScalar(.5);this.min.copy(a).sub(d);this.max.copy(a).add(d);return this}}(),setFromObject:function(){var b=new THREE.Vector3;return function(a){var c=this;a.updateMatrixWorld(!0);
this.makeEmpty();a.traverse(function(a){var d=a.geometry;if(void 0!==d)if(d instanceof THREE.Geometry){var f=d.vertices;d=0;for(var g=f.length;d<g;d++)b.copy(f[d]),b.applyMatrix4(a.matrixWorld),c.expandByPoint(b)}else if(d instanceof THREE.BufferGeometry&&void 0!==d.attributes.position)for(f=d.attributes.position.array,d=0,g=f.length;d<g;d+=3)b.set(f[d],f[d+1],f[d+2]),b.applyMatrix4(a.matrixWorld),c.expandByPoint(b)});return this}}(),copy:function(b){this.min.copy(b.min);this.max.copy(b.max);return this},
makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(b){return(b||new THREE.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(b){return(b||new THREE.Vector3).subVectors(this.max,this.min)},expandByPoint:function(b){this.min.min(b);this.max.max(b);return this},expandByVector:function(b){this.min.sub(b);
this.max.add(b);return this},expandByScalar:function(b){this.min.addScalar(-b);this.max.addScalar(b);return this},containsPoint:function(b){return b.x<this.min.x||b.x>this.max.x||b.y<this.min.y||b.y>this.max.y||b.z<this.min.z||b.z>this.max.z?!1:!0},containsBox:function(b){return this.min.x<=b.min.x&&b.max.x<=this.max.x&&this.min.y<=b.min.y&&b.max.y<=this.max.y&&this.min.z<=b.min.z&&b.max.z<=this.max.z?!0:!1},getParameter:function(b,a){return(a||new THREE.Vector3).set((b.x-this.min.x)/(this.max.x-
this.min.x),(b.y-this.min.y)/(this.max.y-this.min.y),(b.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(b){return b.max.x<this.min.x||b.min.x>this.max.x||b.max.y<this.min.y||b.min.y>this.max.y||b.max.z<this.min.z||b.min.z>this.max.z?!1:!0},clampPoint:function(b,a){return(a||new THREE.Vector3).copy(b).clamp(this.min,this.max)},distanceToPoint:function(){var b=new THREE.Vector3;return function(a){return b.copy(a).clamp(this.min,this.max).sub(a).length()}}(),getBoundingSphere:function(){var b=
new THREE.Vector3;return function(a){a=a||new THREE.Sphere;a.center=this.center();a.radius=.5*this.size(b).length();return a}}(),intersect:function(b){this.min.max(b.min);this.max.min(b.max);return this},union:function(b){this.min.min(b.min);this.max.max(b.max);return this},applyMatrix4:function(){var b=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(a){b[0].set(this.min.x,this.min.y,
this.min.z).applyMatrix4(a);b[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(a);b[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(a);b[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(a);b[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(a);b[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(a);b[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(a);b[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(a);this.makeEmpty();this.setFromPoints(b);return this}}(),translate:function(b){this.min.add(b);
this.max.add(b);return this},equals:function(b){return b.min.equals(this.min)&&b.max.equals(this.max)},clone:function(){return(new THREE.Box3).copy(this)}};THREE.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")};
THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(b,a,c,d,e,f,g,h,k){var l=this.elements;l[0]=b;l[3]=a;l[6]=c;l[1]=d;l[4]=e;l[7]=f;l[2]=g;l[5]=h;l[8]=k;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},copy:function(b){b=b.elements;this.set(b[0],b[3],b[6],b[1],b[4],b[7],b[2],b[5],b[8]);return this},multiplyVector3:function(b){console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return b.applyMatrix3(this)},
multiplyVector3Array:function(b){console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(b)},applyToVector3Array:function(){var b=new THREE.Vector3;return function(a,c,d){void 0===c&&(c=0);void 0===d&&(d=a.length);for(var e=0;e<d;e+=3,c+=3)b.x=a[c],b.y=a[c+1],b.z=a[c+2],b.applyMatrix3(this),a[c]=b.x,a[c+1]=b.y,a[c+2]=b.z;return a}}(),multiplyScalar:function(b){var a=this.elements;a[0]*=b;a[3]*=b;a[6]*=
b;a[1]*=b;a[4]*=b;a[7]*=b;a[2]*=b;a[5]*=b;a[8]*=b;return this},determinant:function(){var b=this.elements,a=b[0],c=b[1],d=b[2],e=b[3],f=b[4],g=b[5],h=b[6],k=b[7];b=b[8];return a*f*b-a*g*k-c*e*b+c*g*h+d*e*k-d*f*h},getInverse:function(b,a){var c=b.elements,d=this.elements;d[0]=c[10]*c[5]-c[6]*c[9];d[1]=-c[10]*c[1]+c[2]*c[9];d[2]=c[6]*c[1]-c[2]*c[5];d[3]=-c[10]*c[4]+c[6]*c[8];d[4]=c[10]*c[0]-c[2]*c[8];d[5]=-c[6]*c[0]+c[2]*c[4];d[6]=c[9]*c[4]-c[5]*c[8];d[7]=-c[9]*c[0]+c[1]*c[8];d[8]=c[5]*c[0]-c[1]*c[4];
c=c[0]*d[0]+c[1]*d[3]+c[2]*d[6];if(0===c){if(a)throw Error("Matrix3.getInverse(): can't invert matrix, determinant is 0");console.warn("Matrix3.getInverse(): can't invert matrix, determinant is 0");this.identity();return this}this.multiplyScalar(1/c);return this},transpose:function(){var b=this.elements;var a=b[1];b[1]=b[3];b[3]=a;a=b[2];b[2]=b[6];b[6]=a;a=b[5];b[5]=b[7];b[7]=a;return this},flattenToArrayOffset:function(b,a){var c=this.elements;b[a]=c[0];b[a+1]=c[1];b[a+2]=c[2];b[a+3]=c[3];b[a+4]=
c[4];b[a+5]=c[5];b[a+6]=c[6];b[a+7]=c[7];b[a+8]=c[8];return b},getNormalMatrix:function(b){this.getInverse(b).transpose();return this},transposeIntoArray:function(b){var a=this.elements;b[0]=a[0];b[1]=a[3];b[2]=a[6];b[3]=a[1];b[4]=a[4];b[5]=a[7];b[6]=a[2];b[7]=a[5];b[8]=a[8];return this},fromArray:function(b){this.elements.set(b);return this},toArray:function(){var b=this.elements;return[b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8]]},clone:function(){return(new THREE.Matrix3).fromArray(this.elements)}};
THREE.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")};
THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(b,a,c,d,e,f,g,h,k,l,p,q,m,r,t,u){var v=this.elements;v[0]=b;v[4]=a;v[8]=c;v[12]=d;v[1]=e;v[5]=f;v[9]=g;v[13]=h;v[2]=k;v[6]=l;v[10]=p;v[14]=q;v[3]=m;v[7]=r;v[11]=t;v[15]=u;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(b){this.elements.set(b.elements);return this},extractPosition:function(b){console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(b)},
copyPosition:function(b){var a=this.elements;b=b.elements;a[12]=b[12];a[13]=b[13];a[14]=b[14];return this},extractBasis:function(b,a,c){var d=this.elements;b.set(d[0],d[1],d[2]);a.set(d[4],d[5],d[6]);c.set(d[8],d[9],d[10]);return this},makeBasis:function(b,a,c){this.set(b.x,a.x,c.x,0,b.y,a.y,c.y,0,b.z,a.z,c.z,0,0,0,0,1);return this},extractRotation:function(){var b=new THREE.Vector3;return function(a){var c=this.elements;a=a.elements;var d=1/b.set(a[0],a[1],a[2]).length(),e=1/b.set(a[4],a[5],a[6]).length(),
f=1/b.set(a[8],a[9],a[10]).length();c[0]=a[0]*d;c[1]=a[1]*d;c[2]=a[2]*d;c[4]=a[4]*e;c[5]=a[5]*e;c[6]=a[6]*e;c[8]=a[8]*f;c[9]=a[9]*f;c[10]=a[10]*f;return this}}(),makeRotationFromEuler:function(b){!1===b instanceof THREE.Euler&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var a=this.elements,c=b.x,d=b.y,e=b.z,f=Math.cos(c);c=Math.sin(c);var g=Math.cos(d);d=Math.sin(d);var h=Math.cos(e);e=Math.sin(e);if("XYZ"===b.order){b=f*h;
var k=f*e,l=c*h,p=c*e;a[0]=g*h;a[4]=-g*e;a[8]=d;a[1]=k+l*d;a[5]=b-p*d;a[9]=-c*g;a[2]=p-b*d;a[6]=l+k*d;a[10]=f*g}else"YXZ"===b.order?(b=g*h,k=g*e,l=d*h,p=d*e,a[0]=b+p*c,a[4]=l*c-k,a[8]=f*d,a[1]=f*e,a[5]=f*h,a[9]=-c,a[2]=k*c-l,a[6]=p+b*c,a[10]=f*g):"ZXY"===b.order?(b=g*h,k=g*e,l=d*h,p=d*e,a[0]=b-p*c,a[4]=-f*e,a[8]=l+k*c,a[1]=k+l*c,a[5]=f*h,a[9]=p-b*c,a[2]=-f*d,a[6]=c,a[10]=f*g):"ZYX"===b.order?(b=f*h,k=f*e,l=c*h,p=c*e,a[0]=g*h,a[4]=l*d-k,a[8]=b*d+p,a[1]=g*e,a[5]=p*d+b,a[9]=k*d-l,a[2]=-d,a[6]=c*g,a[10]=
f*g):"YZX"===b.order?(b=f*g,k=f*d,l=c*g,p=c*d,a[0]=g*h,a[4]=p-b*e,a[8]=l*e+k,a[1]=e,a[5]=f*h,a[9]=-c*h,a[2]=-d*h,a[6]=k*e+l,a[10]=b-p*e):"XZY"===b.order&&(b=f*g,k=f*d,l=c*g,p=c*d,a[0]=g*h,a[4]=-e,a[8]=d*h,a[1]=b*e+p,a[5]=f*h,a[9]=k*e-l,a[2]=l*e-k,a[6]=c*h,a[10]=p*e+b);a[3]=0;a[7]=0;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return this},setRotationFromQuaternion:function(b){console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(b)},
makeRotationFromQuaternion:function(b){var a=this.elements,c=b.x,d=b.y,e=b.z,f=b.w,g=c+c,h=d+d,k=e+e;b=c*g;var l=c*h;c*=k;var p=d*h;d*=k;e*=k;g*=f;h*=f;f*=k;a[0]=1-(p+e);a[4]=l-f;a[8]=c+h;a[1]=l+f;a[5]=1-(b+e);a[9]=d-g;a[2]=c-h;a[6]=d+g;a[10]=1-(b+p);a[3]=0;a[7]=0;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return this},lookAt:function(){var b=new THREE.Vector3,a=new THREE.Vector3,c=new THREE.Vector3;return function(d,e,f){var g=this.elements;c.subVectors(d,e).normalize();0===c.length()&&(c.z=1);b.crossVectors(f,
c).normalize();0===b.length()&&(c.x+=1E-4,b.crossVectors(f,c).normalize());a.crossVectors(c,b);g[0]=b.x;g[4]=a.x;g[8]=c.x;g[1]=b.y;g[5]=a.y;g[9]=c.y;g[2]=b.z;g[6]=a.z;g[10]=c.z;return this}}(),multiply:function(b,a){return void 0!==a?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(b,a)):this.multiplyMatrices(this,b)},multiplyMatrices:function(b,a){var c=b.elements,d=a.elements,e=this.elements,f=c[0],g=c[4],h=c[8],
k=c[12],l=c[1],p=c[5],q=c[9],m=c[13],r=c[2],t=c[6],u=c[10],v=c[14],w=c[3],x=c[7],C=c[11];c=c[15];var y=d[0],R=d[4],P=d[8],A=d[12],M=d[1],Q=d[5],K=d[9],B=d[13],D=d[2],I=d[6],G=d[10],H=d[14],N=d[3],L=d[7],T=d[11];d=d[15];e[0]=f*y+g*M+h*D+k*N;e[4]=f*R+g*Q+h*I+k*L;e[8]=f*P+g*K+h*G+k*T;e[12]=f*A+g*B+h*H+k*d;e[1]=l*y+p*M+q*D+m*N;e[5]=l*R+p*Q+q*I+m*L;e[9]=l*P+p*K+q*G+m*T;e[13]=l*A+p*B+q*H+m*d;e[2]=r*y+t*M+u*D+v*N;e[6]=r*R+t*Q+u*I+v*L;e[10]=r*P+t*K+u*G+v*T;e[14]=r*A+t*B+u*H+v*d;e[3]=w*y+x*M+C*D+c*N;e[7]=
w*R+x*Q+C*I+c*L;e[11]=w*P+x*K+C*G+c*T;e[15]=w*A+x*B+C*H+c*d;return this},multiplyToArray:function(b,a,c){var d=this.elements;this.multiplyMatrices(b,a);c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];c[4]=d[4];c[5]=d[5];c[6]=d[6];c[7]=d[7];c[8]=d[8];c[9]=d[9];c[10]=d[10];c[11]=d[11];c[12]=d[12];c[13]=d[13];c[14]=d[14];c[15]=d[15];return this},multiplyScalar:function(b){var a=this.elements;a[0]*=b;a[4]*=b;a[8]*=b;a[12]*=b;a[1]*=b;a[5]*=b;a[9]*=b;a[13]*=b;a[2]*=b;a[6]*=b;a[10]*=b;a[14]*=b;a[3]*=b;a[7]*=b;a[11]*=
b;a[15]*=b;return this},multiplyVector3:function(b){console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");return b.applyProjection(this)},multiplyVector4:function(b){console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return b.applyMatrix4(this)},multiplyVector3Array:function(b){console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");
return this.applyToVector3Array(b)},applyToVector3Array:function(){var b=new THREE.Vector3;return function(a,c,d){void 0===c&&(c=0);void 0===d&&(d=a.length);for(var e=0;e<d;e+=3,c+=3)b.x=a[c],b.y=a[c+1],b.z=a[c+2],b.applyMatrix4(this),a[c]=b.x,a[c+1]=b.y,a[c+2]=b.z;return a}}(),rotateAxis:function(b){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");b.transformDirection(this)},crossVector:function(b){console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");
return b.applyMatrix4(this)},determinant:function(){var b=this.elements,a=b[0],c=b[4],d=b[8],e=b[12],f=b[1],g=b[5],h=b[9],k=b[13],l=b[2],p=b[6],q=b[10],m=b[14];return b[3]*(+e*h*p-d*k*p-e*g*q+c*k*q+d*g*m-c*h*m)+b[7]*(+a*h*m-a*k*q+e*f*q-d*f*m+d*k*l-e*h*l)+b[11]*(+a*k*p-a*g*m-e*f*p+c*f*m+e*g*l-c*k*l)+b[15]*(-d*g*l-a*h*p+a*g*q+d*f*p-c*f*q+c*h*l)},transpose:function(){var b=this.elements;var a=b[1];b[1]=b[4];b[4]=a;a=b[2];b[2]=b[8];b[8]=a;a=b[6];b[6]=b[9];b[9]=a;a=b[3];b[3]=b[12];b[12]=a;a=b[7];b[7]=
b[13];b[13]=a;a=b[11];b[11]=b[14];b[14]=a;return this},flattenToArrayOffset:function(b,a){var c=this.elements;b[a]=c[0];b[a+1]=c[1];b[a+2]=c[2];b[a+3]=c[3];b[a+4]=c[4];b[a+5]=c[5];b[a+6]=c[6];b[a+7]=c[7];b[a+8]=c[8];b[a+9]=c[9];b[a+10]=c[10];b[a+11]=c[11];b[a+12]=c[12];b[a+13]=c[13];b[a+14]=c[14];b[a+15]=c[15];return b},getPosition:function(){var b=new THREE.Vector3;return function(){console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");
var a=this.elements;return b.set(a[12],a[13],a[14])}}(),setPosition:function(b){var a=this.elements;a[12]=b.x;a[13]=b.y;a[14]=b.z;return this},getInverse:function(b,a){var c=this.elements,d=b.elements,e=d[0],f=d[4],g=d[8],h=d[12],k=d[1],l=d[5],p=d[9],q=d[13],m=d[2],r=d[6],t=d[10],u=d[14],v=d[3],w=d[7],x=d[11];d=d[15];c[0]=p*u*w-q*t*w+q*r*x-l*u*x-p*r*d+l*t*d;c[4]=h*t*w-g*u*w-h*r*x+f*u*x+g*r*d-f*t*d;c[8]=g*q*w-h*p*w+h*l*x-f*q*x-g*l*d+f*p*d;c[12]=h*p*r-g*q*r-h*l*t+f*q*t+g*l*u-f*p*u;c[1]=q*t*v-p*u*v-
q*m*x+k*u*x+p*m*d-k*t*d;c[5]=g*u*v-h*t*v+h*m*x-e*u*x-g*m*d+e*t*d;c[9]=h*p*v-g*q*v-h*k*x+e*q*x+g*k*d-e*p*d;c[13]=g*q*m-h*p*m+h*k*t-e*q*t-g*k*u+e*p*u;c[2]=l*u*v-q*r*v+q*m*w-k*u*w-l*m*d+k*r*d;c[6]=h*r*v-f*u*v-h*m*w+e*u*w+f*m*d-e*r*d;c[10]=f*q*v-h*l*v+h*k*w-e*q*w-f*k*d+e*l*d;c[14]=h*l*m-f*q*m-h*k*r+e*q*r+f*k*u-e*l*u;c[3]=p*r*v-l*t*v-p*m*w+k*t*w+l*m*x-k*r*x;c[7]=f*t*v-g*r*v+g*m*w-e*t*w-f*m*x+e*r*x;c[11]=g*l*v-f*p*v-g*k*w+e*p*w+f*k*x-e*l*x;c[15]=f*p*m-g*l*m+g*k*r-e*p*r-f*k*t+e*l*t;c=e*c[0]+k*c[4]+m*c[8]+
v*c[12];if(0==c){if(a)throw Error("Matrix4.getInverse(): can't invert matrix, determinant is 0");console.warn("Matrix4.getInverse(): can't invert matrix, determinant is 0");this.identity();return this}this.multiplyScalar(1/c);return this},translate:function(b){console.warn("THREE.Matrix4: .translate() has been removed.")},rotateX:function(b){console.warn("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(b){console.warn("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(b){console.warn("THREE.Matrix4: .rotateZ() has been removed.")},
rotateByAxis:function(b,a){console.warn("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(b){var a=this.elements,c=b.x,d=b.y;b=b.z;a[0]*=c;a[4]*=d;a[8]*=b;a[1]*=c;a[5]*=d;a[9]*=b;a[2]*=c;a[6]*=d;a[10]*=b;a[3]*=c;a[7]*=d;a[11]*=b;return this},getMaxScaleOnAxis:function(){var b=this.elements;return Math.sqrt(Math.max(b[0]*b[0]+b[1]*b[1]+b[2]*b[2],Math.max(b[4]*b[4]+b[5]*b[5]+b[6]*b[6],b[8]*b[8]+b[9]*b[9]+b[10]*b[10])))},makeTranslation:function(b,a,c){this.set(1,0,0,b,0,1,0,a,0,0,
1,c,0,0,0,1);return this},makeRotationX:function(b){var a=Math.cos(b);b=Math.sin(b);this.set(1,0,0,0,0,a,-b,0,0,b,a,0,0,0,0,1);return this},makeRotationY:function(b){var a=Math.cos(b);b=Math.sin(b);this.set(a,0,b,0,0,1,0,0,-b,0,a,0,0,0,0,1);return this},makeRotationZ:function(b){var a=Math.cos(b);b=Math.sin(b);this.set(a,-b,0,0,b,a,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(b,a){var c=Math.cos(a),d=Math.sin(a),e=1-c,f=b.x,g=b.y,h=b.z,k=e*f,l=e*g;this.set(k*f+c,k*g-d*h,k*h+d*g,0,k*
g+d*h,l*g+c,l*h-d*f,0,k*h-d*g,l*h+d*f,e*h*h+c,0,0,0,0,1);return this},makeScale:function(b,a,c){this.set(b,0,0,0,0,a,0,0,0,0,c,0,0,0,0,1);return this},compose:function(b,a,c){this.makeRotationFromQuaternion(a);this.scale(c);this.setPosition(b);return this},decompose:function(){var b=new THREE.Vector3,a=new THREE.Matrix4;return function(c,d,e){var f=this.elements,g=b.set(f[0],f[1],f[2]).length(),h=b.set(f[4],f[5],f[6]).length(),k=b.set(f[8],f[9],f[10]).length();0>this.determinant()&&(g=-g);c.x=f[12];
c.y=f[13];c.z=f[14];a.elements.set(this.elements);c=1/g;f=1/h;var l=1/k;a.elements[0]*=c;a.elements[1]*=c;a.elements[2]*=c;a.elements[4]*=f;a.elements[5]*=f;a.elements[6]*=f;a.elements[8]*=l;a.elements[9]*=l;a.elements[10]*=l;d.setFromRotationMatrix(a);e.x=g;e.y=h;e.z=k;return this}}(),makeFrustum:function(b,a,c,d,e,f){var g=this.elements;g[0]=2*e/(a-b);g[4]=0;g[8]=(a+b)/(a-b);g[12]=0;g[1]=0;g[5]=2*e/(d-c);g[9]=(d+c)/(d-c);g[13]=0;g[2]=0;g[6]=0;g[10]=-(f+e)/(f-e);g[14]=-2*f*e/(f-e);g[3]=0;g[7]=0;
g[11]=-1;g[15]=0;return this},makePerspective:function(b,a,c,d){b=c*Math.tan(THREE.Math.degToRad(.5*b));var e=-b;return this.makeFrustum(e*a,b*a,e,b,c,d)},makeOrthographic:function(b,a,c,d,e,f){var g=this.elements,h=a-b,k=c-d,l=f-e;g[0]=2/h;g[4]=0;g[8]=0;g[12]=-((a+b)/h);g[1]=0;g[5]=2/k;g[9]=0;g[13]=-((c+d)/k);g[2]=0;g[6]=0;g[10]=-2/l;g[14]=-((f+e)/l);g[3]=0;g[7]=0;g[11]=0;g[15]=1;return this},fromArray:function(b){this.elements.set(b);return this},toArray:function(){var b=this.elements;return[b[0],
b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8],b[9],b[10],b[11],b[12],b[13],b[14],b[15]]},clone:function(){return(new THREE.Matrix4).fromArray(this.elements)}};THREE.Ray=function(b,a){this.origin=void 0!==b?b:new THREE.Vector3;this.direction=void 0!==a?a:new THREE.Vector3};
THREE.Ray.prototype={constructor:THREE.Ray,set:function(b,a){this.origin.copy(b);this.direction.copy(a);return this},copy:function(b){this.origin.copy(b.origin);this.direction.copy(b.direction);return this},at:function(b,a){return(a||new THREE.Vector3).copy(this.direction).multiplyScalar(b).add(this.origin)},recast:function(){var b=new THREE.Vector3;return function(a){this.origin.copy(this.at(a,b));return this}}(),closestPointToPoint:function(b,a){var c=a||new THREE.Vector3;c.subVectors(b,this.origin);
var d=c.dot(this.direction);return 0>d?c.copy(this.origin):c.copy(this.direction).multiplyScalar(d).add(this.origin)},distanceToPoint:function(){var b=new THREE.Vector3;return function(a){var c=b.subVectors(a,this.origin).dot(this.direction);if(0>c)return this.origin.distanceTo(a);b.copy(this.direction).multiplyScalar(c).add(this.origin);return b.distanceTo(a)}}(),distanceSqToSegment:function(){var b=new THREE.Vector3,a=new THREE.Vector3,c=new THREE.Vector3;return function(d,e,f,g){b.copy(d).add(e).multiplyScalar(.5);
a.copy(e).sub(d).normalize();c.copy(this.origin).sub(b);var h=.5*d.distanceTo(e),k=-this.direction.dot(a),l=c.dot(this.direction),p=-c.dot(a),q=c.lengthSq(),m=Math.abs(1-k*k),r;0<m?(d=k*p-l,e=k*l-p,r=h*m,0<=d?e>=-r?e<=r?(h=1/m,d*=h,e*=h,k=d*(d+k*e+2*l)+e*(k*d+e+2*p)+q):(e=h,d=Math.max(0,-(k*e+l)),k=-d*d+e*(e+2*p)+q):(e=-h,d=Math.max(0,-(k*e+l)),k=-d*d+e*(e+2*p)+q):e<=-r?(d=Math.max(0,-(-k*h+l)),e=0<d?-h:Math.min(Math.max(-h,-p),h),k=-d*d+e*(e+2*p)+q):e<=r?(d=0,e=Math.min(Math.max(-h,-p),h),k=e*(e+
2*p)+q):(d=Math.max(0,-(k*h+l)),e=0<d?h:Math.min(Math.max(-h,-p),h),k=-d*d+e*(e+2*p)+q)):(e=0<k?-h:h,d=Math.max(0,-(k*e+l)),k=-d*d+e*(e+2*p)+q);f&&f.copy(this.direction).multiplyScalar(d).add(this.origin);g&&g.copy(a).multiplyScalar(e).add(b);return k}}(),isIntersectionSphere:function(b){return this.distanceToPoint(b.center)<=b.radius},intersectSphere:function(){var b=new THREE.Vector3;return function(a,c){b.subVectors(a.center,this.origin);var d=b.dot(this.direction),e=b.dot(b)-d*d,f=a.radius*a.radius;
if(e>f)return null;f=Math.sqrt(f-e);e=d-f;d+=f;return 0>e&&0>d?null:0>e?this.at(d,c):this.at(e,c)}}(),isIntersectionPlane:function(b){var a=b.distanceToPoint(this.origin);return 0===a||0>b.normal.dot(this.direction)*a?!0:!1},distanceToPlane:function(b){var a=b.normal.dot(this.direction);if(0==a)return 0==b.distanceToPoint(this.origin)?0:null;b=-(this.origin.dot(b.normal)+b.constant)/a;return 0<=b?b:null},intersectPlane:function(b,a){var c=this.distanceToPlane(b);return null===c?null:this.at(c,a)},
isIntersectionBox:function(){var b=new THREE.Vector3;return function(a){return null!==this.intersectBox(a,b)}}(),intersectBox:function(b,a){var c,d;var e=1/this.direction.x;var f=1/this.direction.y;var g=1/this.direction.z;var h=this.origin;0<=e?(c=(b.min.x-h.x)*e,e*=b.max.x-h.x):(c=(b.max.x-h.x)*e,e*=b.min.x-h.x);0<=f?(d=(b.min.y-h.y)*f,f*=b.max.y-h.y):(d=(b.max.y-h.y)*f,f*=b.min.y-h.y);if(c>f||d>e)return null;if(d>c||c!==c)c=d;if(f<e||e!==e)e=f;0<=g?(d=(b.min.z-h.z)*g,g*=b.max.z-h.z):(d=(b.max.z-
h.z)*g,g*=b.min.z-h.z);if(c>g||d>e)return null;if(d>c||c!==c)c=d;if(g<e||e!==e)e=g;return 0>e?null:this.at(0<=c?c:e,a)},intersectTriangle:function(){var b=new THREE.Vector3,a=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Vector3;return function(e,f,g,h,k){a.subVectors(f,e);c.subVectors(g,e);d.crossVectors(a,c);f=this.direction.dot(d);if(0<f){if(h)return null;h=1}else if(0>f)h=-1,f=-f;else return null;b.subVectors(this.origin,e);e=h*this.direction.dot(c.crossVectors(b,c));if(0>e)return null;g=
h*this.direction.dot(a.cross(b));if(0>g||e+g>f)return null;e=-h*b.dot(d);return 0>e?null:this.at(e/f,k)}}(),applyMatrix4:function(b){this.direction.add(this.origin).applyMatrix4(b);this.origin.applyMatrix4(b);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(b){return b.origin.equals(this.origin)&&b.direction.equals(this.direction)},clone:function(){return(new THREE.Ray).copy(this)}};
THREE.Sphere=function(b,a){this.center=void 0!==b?b:new THREE.Vector3;this.radius=void 0!==a?a:0};
THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(b,a){this.center.copy(b);this.radius=a;return this},setFromPoints:function(){var b=new THREE.Box3;return function(a,c){var d=this.center;void 0!==c?d.copy(c):b.setFromPoints(a).center(d);for(var e=0,f=0,g=a.length;f<g;f++)e=Math.max(e,d.distanceToSquared(a[f]));this.radius=Math.sqrt(e);return this}}(),copy:function(b){this.center.copy(b.center);this.radius=b.radius;return this},empty:function(){return 0>=this.radius},containsPoint:function(b){return b.distanceToSquared(this.center)<=
this.radius*this.radius},distanceToPoint:function(b){return b.distanceTo(this.center)-this.radius},intersectsSphere:function(b){var a=this.radius+b.radius;return b.center.distanceToSquared(this.center)<=a*a},clampPoint:function(b,a){var c=this.center.distanceToSquared(b),d=a||new THREE.Vector3;d.copy(b);c>this.radius*this.radius&&(d.sub(this.center).normalize(),d.multiplyScalar(this.radius).add(this.center));return d},getBoundingBox:function(b){b=b||new THREE.Box3;b.set(this.center,this.center);b.expandByScalar(this.radius);
return b},applyMatrix4:function(b){this.center.applyMatrix4(b);this.radius*=b.getMaxScaleOnAxis();return this},translate:function(b){this.center.add(b);return this},equals:function(b){return b.center.equals(this.center)&&b.radius===this.radius},clone:function(){return(new THREE.Sphere).copy(this)}};
THREE.Frustum=function(b,a,c,d,e,f){this.planes=[void 0!==b?b:new THREE.Plane,void 0!==a?a:new THREE.Plane,void 0!==c?c:new THREE.Plane,void 0!==d?d:new THREE.Plane,void 0!==e?e:new THREE.Plane,void 0!==f?f:new THREE.Plane]};
THREE.Frustum.prototype={constructor:THREE.Frustum,set:function(b,a,c,d,e,f){var g=this.planes;g[0].copy(b);g[1].copy(a);g[2].copy(c);g[3].copy(d);g[4].copy(e);g[5].copy(f);return this},copy:function(b){for(var a=this.planes,c=0;6>c;c++)a[c].copy(b.planes[c]);return this},setFromMatrix:function(b){var a=this.planes,c=b.elements;b=c[0];var d=c[1],e=c[2],f=c[3],g=c[4],h=c[5],k=c[6],l=c[7],p=c[8],q=c[9],m=c[10],r=c[11],t=c[12],u=c[13],v=c[14];c=c[15];a[0].setComponents(f-b,l-g,r-p,c-t).normalize();a[1].setComponents(f+
b,l+g,r+p,c+t).normalize();a[2].setComponents(f+d,l+h,r+q,c+u).normalize();a[3].setComponents(f-d,l-h,r-q,c-u).normalize();a[4].setComponents(f-e,l-k,r-m,c-v).normalize();a[5].setComponents(f+e,l+k,r+m,c+v).normalize();return this},intersectsObject:function(){var b=new THREE.Sphere;return function(a){var c=a.geometry;null===c.boundingSphere&&c.computeBoundingSphere();b.copy(c.boundingSphere);b.applyMatrix4(a.matrixWorld);return this.intersectsSphere(b)}}(),intersectsSphere:function(b){var a=this.planes,
c=b.center;b=-b.radius;for(var d=0;6>d;d++)if(a[d].distanceToPoint(c)<b)return!1;return!0},intersectsBox:function(){var b=new THREE.Vector3,a=new THREE.Vector3;return function(c){for(var d=this.planes,e=0;6>e;e++){var f=d[e];b.x=0<f.normal.x?c.min.x:c.max.x;a.x=0<f.normal.x?c.max.x:c.min.x;b.y=0<f.normal.y?c.min.y:c.max.y;a.y=0<f.normal.y?c.max.y:c.min.y;b.z=0<f.normal.z?c.min.z:c.max.z;a.z=0<f.normal.z?c.max.z:c.min.z;var g=f.distanceToPoint(b);f=f.distanceToPoint(a);if(0>g&&0>f)return!1}return!0}}(),
containsPoint:function(b){for(var a=this.planes,c=0;6>c;c++)if(0>a[c].distanceToPoint(b))return!1;return!0},clone:function(){return(new THREE.Frustum).copy(this)}};THREE.Plane=function(b,a){this.normal=void 0!==b?b:new THREE.Vector3(1,0,0);this.constant=void 0!==a?a:0};
THREE.Plane.prototype={constructor:THREE.Plane,set:function(b,a){this.normal.copy(b);this.constant=a;return this},setComponents:function(b,a,c,d){this.normal.set(b,a,c);this.constant=d;return this},setFromNormalAndCoplanarPoint:function(b,a){this.normal.copy(b);this.constant=-a.dot(this.normal);return this},setFromCoplanarPoints:function(){var b=new THREE.Vector3,a=new THREE.Vector3;return function(c,d,e){d=b.subVectors(e,d).cross(a.subVectors(c,d)).normalize();this.setFromNormalAndCoplanarPoint(d,
c);return this}}(),copy:function(b){this.normal.copy(b.normal);this.constant=b.constant;return this},normalize:function(){var b=1/this.normal.length();this.normal.multiplyScalar(b);this.constant*=b;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(b){return this.normal.dot(b)+this.constant},distanceToSphere:function(b){return this.distanceToPoint(b.center)-b.radius},projectPoint:function(b,a){return this.orthoPoint(b,a).sub(b).negate()},orthoPoint:function(b,
a){var c=this.distanceToPoint(b);return(a||new THREE.Vector3).copy(this.normal).multiplyScalar(c)},isIntersectionLine:function(b){var a=this.distanceToPoint(b.start);b=this.distanceToPoint(b.end);return 0>a&&0<b||0>b&&0<a},intersectLine:function(){var b=new THREE.Vector3;return function(a,c){var d=c||new THREE.Vector3,e=a.delta(b),f=this.normal.dot(e);if(0==f){if(0==this.distanceToPoint(a.start))return d.copy(a.start)}else return f=-(a.start.dot(this.normal)+this.constant)/f,0>f||1<f?void 0:d.copy(e).multiplyScalar(f).add(a.start)}}(),
coplanarPoint:function(b){return(b||new THREE.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var b=new THREE.Vector3,a=new THREE.Vector3,c=new THREE.Matrix3;return function(d,e){var f=e||c.getNormalMatrix(d);f=b.copy(this.normal).applyMatrix3(f);var g=this.coplanarPoint(a);g.applyMatrix4(d);this.setFromNormalAndCoplanarPoint(f,g);return this}}(),translate:function(b){this.constant-=b.dot(this.normal);return this},equals:function(b){return b.normal.equals(this.normal)&&
b.constant==this.constant},clone:function(){return(new THREE.Plane).copy(this)}};
THREE.Math={generateUUID:function(){var b="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),a=Array(36),c=0,d;return function(){for(var e=0;36>e;e++)8==e||13==e||18==e||23==e?a[e]="-":14==e?a[e]="4":(2>=c&&(c=33554432+16777216*Math.random()|0),d=c&15,c>>=4,a[e]=b[19==e?d&3|8:d]);return a.join("")}}(),clamp:function(b,a,c){return b<a?a:b>c?c:b},clampBottom:function(b,a){return b<a?a:b},mapLinear:function(b,a,c,d,e){return d+(b-a)*(e-d)/(c-a)},smoothstep:function(b,a,c){if(b<=
a)return 0;if(b>=c)return 1;b=(b-a)/(c-a);return b*b*(3-2*b)},smootherstep:function(b,a,c){if(b<=a)return 0;if(b>=c)return 1;b=(b-a)/(c-a);return b*b*b*(b*(6*b-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(b,a){return Math.floor(this.randFloat(b,a))},randFloat:function(b,a){return b+Math.random()*(a-b)},randFloatSpread:function(b){return b*(.5-Math.random())},degToRad:function(){var b=Math.PI/180;return function(a){return a*b}}(),radToDeg:function(){var b=
180/Math.PI;return function(a){return a*b}}(),isPowerOfTwo:function(b){return 0===(b&b-1)&&0!==b}};
THREE.Spline=function(b){function a(a,b,c,d,e,f,g){a=.5*(c-a);d=.5*(d-b);return(2*(b-c)+a+d)*g+(-3*(b-c)-2*a-d)*f+a*e+b}this.points=b;var c=[],d={x:0,y:0,z:0},e,f,g,h,k,l,p,q,m;this.initFromArray=function(a){this.points=[];for(var b=0;b<a.length;b++)this.points[b]={x:a[b][0],y:a[b][1],z:a[b][2]}};this.getPoint=function(b){e=(this.points.length-1)*b;f=Math.floor(e);g=e-f;c[0]=0===f?f:f-1;c[1]=f;c[2]=f>this.points.length-2?this.points.length-1:f+1;c[3]=f>this.points.length-3?this.points.length-1:f+
2;l=this.points[c[0]];p=this.points[c[1]];q=this.points[c[2]];m=this.points[c[3]];h=g*g;k=g*h;d.x=a(l.x,p.x,q.x,m.x,g,h,k);d.y=a(l.y,p.y,q.y,m.y,g,h,k);d.z=a(l.z,p.z,q.z,m.z,g,h,k);return d};this.getControlPointsArray=function(){var a,b=this.points.length,c=[];for(a=0;a<b;a++){var d=this.points[a];c[a]=[d.x,d.y,d.z]}return c};this.getLength=function(a){var b=0,c=new THREE.Vector3,d=new THREE.Vector3,e=[],f=0;e[0]=0;a||(a=100);var g=this.points.length*a;c.copy(this.points[0]);for(a=1;a<g;a++){var h=
a/g;var k=this.getPoint(h);d.copy(k);f+=d.distanceTo(c);c.copy(k);h*=this.points.length-1;h=Math.floor(h);h!=b&&(e[h]=f,b=h)}e[e.length]=f;return{chunks:e,total:f}};this.reparametrizeByArcLength=function(a){var b,c=[],d=new THREE.Vector3,e=this.getLength();c.push(d.copy(this.points[0]).clone());for(b=1;b<this.points.length;b++){var f=e.chunks[b]-e.chunks[b-1];var g=Math.ceil(a*f/e.total);var h=(b-1)/(this.points.length-1);var k=b/(this.points.length-1);for(f=1;f<g-1;f++){var l=h+1/g*f*(k-h);l=this.getPoint(l);
c.push(d.copy(l).clone())}c.push(d.copy(this.points[b]).clone())}this.points=c}};THREE.Triangle=function(b,a,c){this.a=void 0!==b?b:new THREE.Vector3;this.b=void 0!==a?a:new THREE.Vector3;this.c=void 0!==c?c:new THREE.Vector3};THREE.Triangle.normal=function(){var b=new THREE.Vector3;return function(a,c,d,e){e=e||new THREE.Vector3;e.subVectors(d,c);b.subVectors(a,c);e.cross(b);a=e.lengthSq();return 0<a?e.multiplyScalar(1/Math.sqrt(a)):e.set(0,0,0)}}();
THREE.Triangle.barycoordFromPoint=function(){var b=new THREE.Vector3,a=new THREE.Vector3,c=new THREE.Vector3;return function(d,e,f,g,h){b.subVectors(g,e);a.subVectors(f,e);c.subVectors(d,e);d=b.dot(b);e=b.dot(a);f=b.dot(c);var k=a.dot(a);g=a.dot(c);var l=d*k-e*e;h=h||new THREE.Vector3;if(0==l)return h.set(-2,-1,-1);l=1/l;k=(k*f-e*g)*l;d=(d*g-e*f)*l;return h.set(1-k-d,d,k)}}();
THREE.Triangle.containsPoint=function(){var b=new THREE.Vector3;return function(a,c,d,e){a=THREE.Triangle.barycoordFromPoint(a,c,d,e,b);return 0<=a.x&&0<=a.y&&1>=a.x+a.y}}();
THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(b,a,c){this.a.copy(b);this.b.copy(a);this.c.copy(c);return this},setFromPointsAndIndices:function(b,a,c,d){this.a.copy(b[a]);this.b.copy(b[c]);this.c.copy(b[d]);return this},copy:function(b){this.a.copy(b.a);this.b.copy(b.b);this.c.copy(b.c);return this},area:function(){var b=new THREE.Vector3,a=new THREE.Vector3;return function(){b.subVectors(this.c,this.b);a.subVectors(this.a,this.b);return.5*b.cross(a).length()}}(),midpoint:function(b){return(b||
new THREE.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(b){return THREE.Triangle.normal(this.a,this.b,this.c,b)},plane:function(b){return(b||new THREE.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(b,a){return THREE.Triangle.barycoordFromPoint(b,this.a,this.b,this.c,a)},containsPoint:function(b){return THREE.Triangle.containsPoint(b,this.a,this.b,this.c)},equals:function(b){return b.a.equals(this.a)&&b.b.equals(this.b)&&b.c.equals(this.c)},
clone:function(){return(new THREE.Triangle).copy(this)}};THREE.Clock=function(b){this.autoStart=void 0!==b?b:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1};
THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.oldTime=this.startTime=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();this.running=!0},stop:function(){this.getElapsedTime();this.running=!1},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var b=0;this.autoStart&&!this.running&&this.start();if(this.running){var a=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();
b=.001*(a-this.oldTime);this.oldTime=a;this.elapsedTime+=b}return b}};THREE.EventDispatcher=function(){};
THREE.EventDispatcher.prototype={constructor:THREE.EventDispatcher,apply:function(b){b.addEventListener=THREE.EventDispatcher.prototype.addEventListener;b.hasEventListener=THREE.EventDispatcher.prototype.hasEventListener;b.removeEventListener=THREE.EventDispatcher.prototype.removeEventListener;b.dispatchEvent=THREE.EventDispatcher.prototype.dispatchEvent},addEventListener:function(b,a){void 0===this._listeners&&(this._listeners={});var c=this._listeners;void 0===c[b]&&(c[b]=[]);-1===c[b].indexOf(a)&&
c[b].push(a)},hasEventListener:function(b,a){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[b]&&-1!==c[b].indexOf(a)?!0:!1},removeEventListener:function(b,a){if(void 0!==this._listeners){var c=this._listeners[b];if(void 0!==c){var d=c.indexOf(a);-1!==d&&c.splice(d,1)}}},dispatchEvent:function(b){if(void 0!==this._listeners){var a=this._listeners[b.type];if(void 0!==a){b.target=this;for(var c=[],d=a.length,e=0;e<d;e++)c[e]=a[e];for(e=0;e<d;e++)c[e].call(this,b)}}}};
(function(b){b.Raycaster=function(a,c,f,g){this.ray=new b.Ray(a,c);this.near=f||0;this.far=g||Infinity;this.params={Sprite:{},Mesh:{},PointCloud:{threshold:1},LOD:{},Line:{}}};var a=function(a,b){return a.distance-b.distance},c=function(a,b,f,g){a.raycast(b,f);if(!0===g){a=a.children;g=0;for(var d=a.length;g<d;g++)c(a[g],b,f,!0)}};b.Raycaster.prototype={constructor:b.Raycaster,precision:1E-4,linePrecision:1,set:function(a,b){this.ray.set(a,b)},setFromCamera:function(a,c){c instanceof b.PerspectiveCamera?
(this.ray.origin.copy(c.position),this.ray.direction.set(a.x,a.y,.5).unproject(c).sub(c.position).normalize()):c instanceof b.OrthographicCamera?(this.ray.origin.set(a.x,a.y,-1).unproject(c),this.ray.direction.set(0,0,-1).transformDirection(c.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(b,e){var d=[];c(b,this,d,e);d.sort(a);return d},intersectObjects:function(b,e){var d=[];if(!1===b instanceof Array)return console.log("THREE.Raycaster.intersectObjects: objects is not an Array."),
d;for(var g=0,h=b.length;g<h;g++)c(b[g],this,d,e);d.sort(a);return d}}})(THREE);
THREE.Object3D=function(){Object.defineProperty(this,"id",{value:THREE.Object3DIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Object3D";this.parent=void 0;this.children=[];this.up=THREE.Object3D.DefaultUp.clone();var b=new THREE.Vector3,a=new THREE.Euler,c=new THREE.Quaternion,d=new THREE.Vector3(1,1,1);a.onChange(function(){c.setFromEuler(a,!1)});c.onChange(function(){a.setFromQuaternion(c,void 0,!1)});Object.defineProperties(this,{position:{enumerable:!0,value:b},rotation:{enumerable:!0,
value:a},quaternion:{enumerable:!0,value:c},scale:{enumerable:!0,value:d}});this.rotationAutoUpdate=!0;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixAutoUpdate=!0;this.matrixWorldNeedsUpdate=!1;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.userData={}};THREE.Object3D.DefaultUp=new THREE.Vector3(0,1,0);
THREE.Object3D.prototype={constructor:THREE.Object3D,get eulerOrder(){console.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order.");return this.rotation.order},set eulerOrder(b){console.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order.");this.rotation.order=b},get useQuaternion(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(b){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},
applyMatrix:function(b){this.matrix.multiplyMatrices(b,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(b,a){this.quaternion.setFromAxisAngle(b,a)},setRotationFromEuler:function(b){this.quaternion.setFromEuler(b,!0)},setRotationFromMatrix:function(b){this.quaternion.setFromRotationMatrix(b)},setRotationFromQuaternion:function(b){this.quaternion.copy(b)},rotateOnAxis:function(){var b=new THREE.Quaternion;return function(a,c){b.setFromAxisAngle(a,
c);this.quaternion.multiply(b);return this}}(),rotateX:function(){var b=new THREE.Vector3(1,0,0);return function(a){return this.rotateOnAxis(b,a)}}(),rotateY:function(){var b=new THREE.Vector3(0,1,0);return function(a){return this.rotateOnAxis(b,a)}}(),rotateZ:function(){var b=new THREE.Vector3(0,0,1);return function(a){return this.rotateOnAxis(b,a)}}(),translateOnAxis:function(){var b=new THREE.Vector3;return function(a,c){b.copy(a).applyQuaternion(this.quaternion);this.position.add(b.multiplyScalar(c));
return this}}(),translate:function(b,a){console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(a,b)},translateX:function(){var b=new THREE.Vector3(1,0,0);return function(a){return this.translateOnAxis(b,a)}}(),translateY:function(){var b=new THREE.Vector3(0,1,0);return function(a){return this.translateOnAxis(b,a)}}(),translateZ:function(){var b=new THREE.Vector3(0,0,1);return function(a){return this.translateOnAxis(b,
a)}}(),localToWorld:function(b){return b.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var b=new THREE.Matrix4;return function(a){return a.applyMatrix4(b.getInverse(this.matrixWorld))}}(),lookAt:function(){var b=new THREE.Matrix4;return function(a){b.lookAt(a,this.position,this.up);this.quaternion.setFromRotationMatrix(b)}}(),add:function(b){if(1<arguments.length){for(var a=0;a<arguments.length;a++)this.add(arguments[a]);return this}if(b===this)return console.error("THREE.Object3D.add:",
b,"can't be added as a child of itself."),this;b instanceof THREE.Object3D?(void 0!==b.parent&&b.parent.remove(b),b.parent=this,b.dispatchEvent({type:"added"}),this.children.push(b)):console.error("THREE.Object3D.add:",b,"is not an instance of THREE.Object3D.");return this},remove:function(b){if(1<arguments.length)for(var a=0;a<arguments.length;a++)this.remove(arguments[a]);a=this.children.indexOf(b);-1!==a&&(b.parent=void 0,b.dispatchEvent({type:"removed"}),this.children.splice(a,1))},getChildByName:function(b,
a){console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(b,a)},getObjectById:function(b,a){return this.getObjectByProperty("id",b,a)},getObjectByName:function(b,a){return this.getObjectByProperty("name",b,a)},getObjectByProperty:function(b,a,c){if(this[b]===a)return this;for(var d=0,e=this.children.length;d<e;d++){var f=this.children[d].getObjectByProperty(b,a,c);if(void 0!==f)return f}},getWorldPosition:function(b){b=b||new THREE.Vector3;
this.updateMatrixWorld(!0);return b.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var b=new THREE.Vector3,a=new THREE.Vector3;return function(c){c=c||new THREE.Quaternion;this.updateMatrixWorld(!0);this.matrixWorld.decompose(b,c,a);return c}}(),getWorldRotation:function(){var b=new THREE.Quaternion;return function(a){a=a||new THREE.Euler;this.getWorldQuaternion(b);return a.setFromQuaternion(b,this.rotation.order,!1)}}(),getWorldScale:function(){var b=new THREE.Vector3,a=new THREE.Quaternion;
return function(c){c=c||new THREE.Vector3;this.updateMatrixWorld(!0);this.matrixWorld.decompose(b,a,c);return c}}(),getWorldDirection:function(){var b=new THREE.Quaternion;return function(a){a=a||new THREE.Vector3;this.getWorldQuaternion(b);return a.set(0,0,1).applyQuaternion(b)}}(),raycast:function(){},traverse:function(b){b(this);for(var a=0,c=this.children.length;a<c;a++)this.children[a].traverse(b)},traverseVisible:function(b){if(!1!==this.visible){b(this);for(var a=0,c=this.children.length;a<
c;a++)this.children[a].traverseVisible(b)}},traverseAncestors:function(b){this.parent&&(b(this.parent),this.parent.traverseAncestors(b))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(b){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===b)void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),
this.matrixWorldNeedsUpdate=!1,b=!0;for(var a=0,c=this.children.length;a<c;a++)this.children[a].updateMatrixWorld(b)},toJSON:function(){var b={metadata:{version:4.3,type:"Object",generator:"ObjectExporter"}},a={},c=function(c){void 0===b.geometries&&(b.geometries=[]);if(void 0===a[c.uuid]){var d=c.toJSON();delete d.metadata;a[c.uuid]=d;b.geometries.push(d)}return c.uuid},d={},e=function(a){void 0===b.materials&&(b.materials=[]);if(void 0===d[a.uuid]){var c=a.toJSON();delete c.metadata;d[a.uuid]=c;
b.materials.push(c)}return a.uuid},f=function(a){var b={};b.uuid=a.uuid;b.type=a.type;""!==a.name&&(b.name=a.name);"{}"!==JSON.stringify(a.userData)&&(b.userData=a.userData);!0!==a.visible&&(b.visible=a.visible);a instanceof THREE.PerspectiveCamera?(b.fov=a.fov,b.aspect=a.aspect,b.near=a.near,b.far=a.far):a instanceof THREE.OrthographicCamera?(b.left=a.left,b.right=a.right,b.top=a.top,b.bottom=a.bottom,b.near=a.near,b.far=a.far):a instanceof THREE.AmbientLight?b.color=a.color.getHex():a instanceof
THREE.DirectionalLight?(b.color=a.color.getHex(),b.intensity=a.intensity):a instanceof THREE.PointLight?(b.color=a.color.getHex(),b.intensity=a.intensity,b.distance=a.distance):a instanceof THREE.SpotLight?(b.color=a.color.getHex(),b.intensity=a.intensity,b.distance=a.distance,b.angle=a.angle,b.exponent=a.exponent):a instanceof THREE.HemisphereLight?(b.color=a.color.getHex(),b.groundColor=a.groundColor.getHex()):a instanceof THREE.Mesh?(b.geometry=c(a.geometry),b.material=e(a.material)):a instanceof
THREE.Line?(b.geometry=c(a.geometry),b.material=e(a.material)):a instanceof THREE.Sprite&&(b.material=e(a.material));b.matrix=a.matrix.toArray();if(0<a.children.length){b.children=[];for(var d=0;d<a.children.length;d++)b.children.push(f(a.children[d]))}return b};b.object=f(this);return b},clone:function(b,a){void 0===b&&(b=new THREE.Object3D);void 0===a&&(a=!0);b.name=this.name;b.up.copy(this.up);b.position.copy(this.position);b.quaternion.copy(this.quaternion);b.scale.copy(this.scale);b.rotationAutoUpdate=
this.rotationAutoUpdate;b.matrix.copy(this.matrix);b.matrixWorld.copy(this.matrixWorld);b.matrixAutoUpdate=this.matrixAutoUpdate;b.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate;b.visible=this.visible;b.castShadow=this.castShadow;b.receiveShadow=this.receiveShadow;b.frustumCulled=this.frustumCulled;b.userData=JSON.parse(JSON.stringify(this.userData));if(!0===a)for(var c=0;c<this.children.length;c++)b.add(this.children[c].clone());return b}};THREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype);
THREE.Object3DIdCount=0;THREE.Face3=function(b,a,c,d,e,f){this.a=b;this.b=a;this.c=c;this.normal=d instanceof THREE.Vector3?d:new THREE.Vector3;this.vertexNormals=d instanceof Array?d:[];this.color=e instanceof THREE.Color?e:new THREE.Color;this.vertexColors=e instanceof Array?e:[];this.vertexTangents=[];this.materialIndex=void 0!==f?f:0};
THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var b=new THREE.Face3(this.a,this.b,this.c);b.normal.copy(this.normal);b.color.copy(this.color);b.materialIndex=this.materialIndex;for(var a=0,c=this.vertexNormals.length;a<c;a++)b.vertexNormals[a]=this.vertexNormals[a].clone();a=0;for(c=this.vertexColors.length;a<c;a++)b.vertexColors[a]=this.vertexColors[a].clone();a=0;for(c=this.vertexTangents.length;a<c;a++)b.vertexTangents[a]=this.vertexTangents[a].clone();return b}};
THREE.Face4=function(b,a,c,d,e,f,g){console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");return new THREE.Face3(b,a,c,e,f,g)};THREE.BufferAttribute=function(b,a){this.array=b;this.itemSize=a;this.needsUpdate=!1};
THREE.BufferAttribute.prototype={constructor:THREE.BufferAttribute,get length(){return this.array.length},copyAt:function(b,a,c){b*=this.itemSize;c*=a.itemSize;for(var d=0,e=this.itemSize;d<e;d++)this.array[b+d]=a.array[c+d]},set:function(b){this.array.set(b);return this},setX:function(b,a){this.array[b*this.itemSize]=a;return this},setY:function(b,a){this.array[b*this.itemSize+1]=a;return this},setZ:function(b,a){this.array[b*this.itemSize+2]=a;return this},setXY:function(b,a,c){b*=this.itemSize;
this.array[b]=a;this.array[b+1]=c;return this},setXYZ:function(b,a,c,d){b*=this.itemSize;this.array[b]=a;this.array[b+1]=c;this.array[b+2]=d;return this},setXYZW:function(b,a,c,d,e){b*=this.itemSize;this.array[b]=a;this.array[b+1]=c;this.array[b+2]=d;this.array[b+3]=e;return this},clone:function(){return new THREE.BufferAttribute(new this.array.constructor(this.array),this.itemSize)}};
THREE.Int8Attribute=function(b,a){console.warn("THREE.Int8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(b,a)};THREE.Uint8Attribute=function(b,a){console.warn("THREE.Uint8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(b,a)};
THREE.Uint8ClampedAttribute=function(b,a){console.warn("THREE.Uint8ClampedAttribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(b,a)};THREE.Int16Attribute=function(b,a){console.warn("THREE.Int16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(b,a)};
THREE.Uint16Attribute=function(b,a){console.warn("THREE.Uint16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(b,a)};THREE.Int32Attribute=function(b,a){console.warn("THREE.Int32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(b,a)};
THREE.Uint32Attribute=function(b,a){console.warn("THREE.Uint32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(b,a)};THREE.Float32Attribute=function(b,a){console.warn("THREE.Float32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(b,a)};
THREE.Float64Attribute=function(b,a){console.warn("THREE.Float64Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(b,a)};THREE.BufferGeometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="BufferGeometry";this.attributes={};this.attributesKeys=[];this.offsets=this.drawcalls=[];this.boundingSphere=this.boundingBox=null};
THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,addAttribute:function(b,a,c){!1===a instanceof THREE.BufferAttribute?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.attributes[b]={array:a,itemSize:c}):(this.attributes[b]=a,this.attributesKeys=Object.keys(this.attributes))},getAttribute:function(b){return this.attributes[b]},addDrawCall:function(b,a,c){this.drawcalls.push({start:b,count:a,index:void 0!==c?c:0})},applyMatrix:function(b){var a=
this.attributes.position;void 0!==a&&(b.applyToVector3Array(a.array),a.needsUpdate=!0);a=this.attributes.normal;void 0!==a&&((new THREE.Matrix3).getNormalMatrix(b).applyToVector3Array(a.array),a.needsUpdate=!0)},center:function(){},fromGeometry:function(b,a){a=a||{vertexColors:THREE.NoColors};var c=b.vertices,d=b.faces,e=b.faceVertexUvs,f=a.vertexColors,g=0<e[0].length,h=3==d[0].vertexNormals.length,k=new Float32Array(9*d.length);this.addAttribute("position",new THREE.BufferAttribute(k,3));var l=
new Float32Array(9*d.length);this.addAttribute("normal",new THREE.BufferAttribute(l,3));if(f!==THREE.NoColors){var p=new Float32Array(9*d.length);this.addAttribute("color",new THREE.BufferAttribute(p,3))}if(!0===g){var q=new Float32Array(6*d.length);this.addAttribute("uv",new THREE.BufferAttribute(q,2))}for(var m=0,r=0,t=0;m<d.length;m++,r+=6,t+=9){var u=d[m],v=c[u.a],w=c[u.b],x=c[u.c];k[t]=v.x;k[t+1]=v.y;k[t+2]=v.z;k[t+3]=w.x;k[t+4]=w.y;k[t+5]=w.z;k[t+6]=x.x;k[t+7]=x.y;k[t+8]=x.z;!0===h?(v=u.vertexNormals[0],
w=u.vertexNormals[1],x=u.vertexNormals[2],l[t]=v.x,l[t+1]=v.y,l[t+2]=v.z,l[t+3]=w.x,l[t+4]=w.y,l[t+5]=w.z,l[t+6]=x.x,l[t+7]=x.y,l[t+8]=x.z):(v=u.normal,l[t]=v.x,l[t+1]=v.y,l[t+2]=v.z,l[t+3]=v.x,l[t+4]=v.y,l[t+5]=v.z,l[t+6]=v.x,l[t+7]=v.y,l[t+8]=v.z);f===THREE.FaceColors?(u=u.color,p[t]=u.r,p[t+1]=u.g,p[t+2]=u.b,p[t+3]=u.r,p[t+4]=u.g,p[t+5]=u.b,p[t+6]=u.r,p[t+7]=u.g,p[t+8]=u.b):f===THREE.VertexColors&&(v=u.vertexColors[0],w=u.vertexColors[1],u=u.vertexColors[2],p[t]=v.r,p[t+1]=v.g,p[t+2]=v.b,p[t+3]=
w.r,p[t+4]=w.g,p[t+5]=w.b,p[t+6]=u.r,p[t+7]=u.g,p[t+8]=u.b);!0===g&&(u=e[0][m][0],v=e[0][m][1],w=e[0][m][2],q[r]=u.x,q[r+1]=u.y,q[r+2]=v.x,q[r+3]=v.y,q[r+4]=w.x,q[r+5]=w.y)}this.computeBoundingSphere();return this},computeBoundingBox:function(){var b=new THREE.Vector3;return function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var a=this.attributes.position.array;if(a){var c=this.boundingBox;c.makeEmpty();for(var d=0,e=a.length;d<e;d+=3)b.set(a[d],a[d+1],a[d+2]),c.expandByPoint(b)}if(void 0===
a||0===a.length)this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0);(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.')}}(),computeBoundingSphere:function(){var b=new THREE.Box3,a=new THREE.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);var c=this.attributes.position.array;
if(c){b.makeEmpty();for(var d=this.boundingSphere.center,e=0,f=c.length;e<f;e+=3)a.set(c[e],c[e+1],c[e+2]),b.expandByPoint(a);b.center(d);var g=0;e=0;for(f=c.length;e<f;e+=3)a.set(c[e],c[e+1],c[e+2]),g=Math.max(g,d.distanceToSquared(a));this.boundingSphere.radius=Math.sqrt(g);isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var b=
this.attributes;if(b.position){var a=b.position.array;if(void 0===b.normal)this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(a.length),3));else for(var c=b.normal.array,d=0,e=c.length;d<e;d++)c[d]=0;c=b.normal.array;var f=new THREE.Vector3,g=new THREE.Vector3,h=new THREE.Vector3,k=new THREE.Vector3,l=new THREE.Vector3;if(b.index)for(var p=b.index.array,q=0<this.offsets.length?this.offsets:[{start:0,count:p.length,index:0}],m=0,r=q.length;m<r;++m){e=q[m].start;var t=q[m].count;
var u=q[m].index;d=e;for(e+=t;d<e;d+=3){t=3*(u+p[d]);var v=3*(u+p[d+1]);var w=3*(u+p[d+2]);f.fromArray(a,t);g.fromArray(a,v);h.fromArray(a,w);k.subVectors(h,g);l.subVectors(f,g);k.cross(l);c[t]+=k.x;c[t+1]+=k.y;c[t+2]+=k.z;c[v]+=k.x;c[v+1]+=k.y;c[v+2]+=k.z;c[w]+=k.x;c[w+1]+=k.y;c[w+2]+=k.z}}else for(d=0,e=a.length;d<e;d+=9)f.fromArray(a,d),g.fromArray(a,d+3),h.fromArray(a,d+6),k.subVectors(h,g),l.subVectors(f,g),k.cross(l),c[d]=k.x,c[d+1]=k.y,c[d+2]=k.z,c[d+3]=k.x,c[d+4]=k.y,c[d+5]=k.z,c[d+6]=k.x,
c[d+7]=k.y,c[d+8]=k.z;this.normalizeNormals();b.normal.needsUpdate=!0}},computeTangents:function(){function b(a,b,c){q.fromArray(d,3*a);m.fromArray(d,3*b);r.fromArray(d,3*c);t.fromArray(f,2*a);u.fromArray(f,2*b);v.fromArray(f,2*c);w=m.x-q.x;x=r.x-q.x;C=m.y-q.y;y=r.y-q.y;R=m.z-q.z;P=r.z-q.z;A=u.x-t.x;M=v.x-t.x;Q=u.y-t.y;K=v.y-t.y;B=1/(A*K-M*Q);D.set((K*w-Q*x)*B,(K*C-Q*y)*B,(K*R-Q*P)*B);I.set((A*x-M*w)*B,(A*y-M*C)*B,(A*P-M*R)*B);k[a].add(D);k[b].add(D);k[c].add(D);l[a].add(I);l[b].add(I);l[c].add(I)}
function a(a){Da.fromArray(e,3*a);Ia.copy(Da);ia=k[a];V.copy(ia);V.sub(Da.multiplyScalar(Da.dot(ia))).normalize();da.crossVectors(Ia,ia);Z=da.dot(l[a]);Ea=0>Z?-1:1;h[4*a]=V.x;h[4*a+1]=V.y;h[4*a+2]=V.z;h[4*a+3]=Ea}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");else{var c=this.attributes.index.array,d=this.attributes.position.array,
e=this.attributes.normal.array,f=this.attributes.uv.array,g=d.length/3;void 0===this.attributes.tangent&&this.addAttribute("tangent",new THREE.BufferAttribute(new Float32Array(4*g),4));for(var h=this.attributes.tangent.array,k=[],l=[],p=0;p<g;p++)k[p]=new THREE.Vector3,l[p]=new THREE.Vector3;var q=new THREE.Vector3,m=new THREE.Vector3,r=new THREE.Vector3,t=new THREE.Vector2,u=new THREE.Vector2,v=new THREE.Vector2,w,x,C,y,R,P,A,M,Q,K,B,D=new THREE.Vector3,I=new THREE.Vector3,G;0===this.drawcalls.length&&
this.addDrawCall(0,c.length,0);var H=this.drawcalls;p=0;for(G=H.length;p<G;++p){var N=H[p].start;var L=H[p].count;var T=H[p].index;g=N;for(N+=L;g<N;g+=3){L=T+c[g];var ba=T+c[g+1];var E=T+c[g+2];b(L,ba,E)}}var V=new THREE.Vector3,da=new THREE.Vector3,Da=new THREE.Vector3,Ia=new THREE.Vector3,Ea,ia,Z;p=0;for(G=H.length;p<G;++p)for(N=H[p].start,L=H[p].count,T=H[p].index,g=N,N+=L;g<N;g+=3)L=T+c[g],ba=T+c[g+1],E=T+c[g+2],a(L),a(ba),a(E)}},computeOffsets:function(b){var a=b;void 0===b&&(a=65535);Date.now();
b=this.attributes.index.array;for(var c=this.attributes.position.array,d=b.length/3,e=new Uint16Array(b.length),f=0,g=0,h=[{start:0,count:0,index:0}],k=h[0],l=0,p,q=new Int32Array(6),m=new Int32Array(c.length),r=new Int32Array(c.length),t=0;t<c.length;t++)m[t]=-1,r[t]=-1;for(c=0;c<d;c++){for(var u=p=0;3>u;u++)t=b[3*c+u],-1==m[t]?(q[2*u]=t,q[2*u+1]=-1,p++):m[t]<k.index?(q[2*u]=t,q[2*u+1]=-1,l++):(q[2*u]=t,q[2*u+1]=m[t]);if(g+p>k.index+a)for(k={start:f,count:0,index:g},h.push(k),p=0;6>p;p+=2)u=q[p+
1],-1<u&&u<k.index&&(q[p+1]=-1);for(p=0;6>p;p+=2)t=q[p],u=q[p+1],-1===u&&(u=g++),m[t]=u,r[u]=t,e[f++]=u-k.index,k.count++}this.reorderBuffers(e,r,g);return this.offsets=h},merge:function(b,a){if(!1===b instanceof THREE.BufferGeometry)console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",b);else{void 0===a&&(a=0);var c=this.attributes,d;for(d in c)if(void 0!==b.attributes[d]){var e=c[d].array,f=b.attributes[d],g=f.array,h=0;for(f=f.itemSize*a;h<g.length;h++,
f++)e[f]=g[h]}return this}},normalizeNormals:function(){for(var b=this.attributes.normal.array,a,c,d,e=0,f=b.length;e<f;e+=3)a=b[e],c=b[e+1],d=b[e+2],a=1/Math.sqrt(a*a+c*c+d*d),b[e]*=a,b[e+1]*=a,b[e+2]*=a},reorderBuffers:function(b,a,c){var d={},e;for(e in this.attributes)"index"!=e&&(d[e]=new this.attributes[e].array.constructor(this.attributes[e].itemSize*c));for(var f=0;f<c;f++){var g=a[f];for(e in this.attributes)if("index"!=e)for(var h=this.attributes[e].array,k=this.attributes[e].itemSize,l=
d[e],p=0;p<k;p++)l[f*k+p]=h[g*k+p]}this.attributes.index.array=b;for(e in this.attributes)"index"!=e&&(this.attributes[e].array=d[e],this.attributes[e].numItems=this.attributes[e].itemSize*c)},toJSON:function(){var b={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type,data:{attributes:{}}},a=this.attributes,c=this.offsets,d=this.boundingSphere,e;for(e in a){for(var f=a[e],g=[],h=f.array,k=0,l=h.length;k<l;k++)g[k]=h[k];b.data.attributes[e]=
{itemSize:f.itemSize,type:f.array.constructor.name,array:g}}0<c.length&&(b.data.offsets=JSON.parse(JSON.stringify(c)));null!==d&&(b.data.boundingSphere={center:d.center.toArray(),radius:d.radius});return b},clone:function(){var b=new THREE.BufferGeometry;for(a in this.attributes)b.addAttribute(a,this.attributes[a].clone());var a=0;for(var c=this.offsets.length;a<c;a++){var d=this.offsets[a];b.offsets.push({start:d.start,index:d.index,count:d.count})}return b},dispose:function(){this.dispatchEvent({type:"dispose"})}};
THREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype);
THREE.Geometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Geometry";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingSphere=this.boundingBox=null;this.hasTangents=!1;this.dynamic=!0;this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=
this.tangentsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.elementsNeedUpdate=this.verticesNeedUpdate=!1};
THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(b){for(var a=(new THREE.Matrix3).getNormalMatrix(b),c=0,d=this.vertices.length;c<d;c++)this.vertices[c].applyMatrix4(b);c=0;for(d=this.faces.length;c<d;c++){b=this.faces[c];b.normal.applyMatrix3(a).normalize();for(var e=0,f=b.vertexNormals.length;e<f;e++)b.vertexNormals[e].applyMatrix3(a).normalize()}this.boundingBox instanceof THREE.Box3&&this.computeBoundingBox();this.boundingSphere instanceof THREE.Sphere&&this.computeBoundingSphere()},
fromBufferGeometry:function(b){for(var a=this,c=b.attributes,d=c.position.array,e=void 0!==c.index?c.index.array:void 0,f=void 0!==c.normal?c.normal.array:void 0,g=void 0!==c.color?c.color.array:void 0,h=void 0!==c.uv?c.uv.array:void 0,k=[],l=[],p=c=0;c<d.length;c+=3,p+=2)a.vertices.push(new THREE.Vector3(d[c],d[c+1],d[c+2])),void 0!==f&&k.push(new THREE.Vector3(f[c],f[c+1],f[c+2])),void 0!==g&&a.colors.push(new THREE.Color(g[c],g[c+1],g[c+2])),void 0!==h&&l.push(new THREE.Vector2(h[p],h[p+1]));p=
function(b,c,d){var e=void 0!==f?[k[b].clone(),k[c].clone(),k[d].clone()]:[],m=void 0!==g?[a.colors[b].clone(),a.colors[c].clone(),a.colors[d].clone()]:[];a.faces.push(new THREE.Face3(b,c,d,e,m));void 0!==h&&a.faceVertexUvs[0].push([l[b].clone(),l[c].clone(),l[d].clone()])};if(void 0!==e)for(c=0;c<e.length;c+=3)p(e[c],e[c+1],e[c+2]);else for(c=0;c<d.length/3;c+=3)p(c,c+1,c+2);this.computeFaceNormals();null!==b.boundingBox&&(this.boundingBox=b.boundingBox.clone());null!==b.boundingSphere&&(this.boundingSphere=
b.boundingSphere.clone());return this},center:function(){this.computeBoundingBox();var b=new THREE.Vector3;b.addVectors(this.boundingBox.min,this.boundingBox.max);b.multiplyScalar(-.5);this.applyMatrix((new THREE.Matrix4).makeTranslation(b.x,b.y,b.z));this.computeBoundingBox();return b},computeFaceNormals:function(){for(var b=new THREE.Vector3,a=new THREE.Vector3,c=0,d=this.faces.length;c<d;c++){var e=this.faces[c],f=this.vertices[e.a],g=this.vertices[e.b];b.subVectors(this.vertices[e.c],g);a.subVectors(f,
g);b.cross(a);b.normalize();e.normal.copy(b)}},computeVertexNormals:function(b){var a;var c=Array(this.vertices.length);var d=0;for(a=this.vertices.length;d<a;d++)c[d]=new THREE.Vector3;if(b){var e=new THREE.Vector3,f=new THREE.Vector3;new THREE.Vector3;new THREE.Vector3;new THREE.Vector3;b=0;for(d=this.faces.length;b<d;b++){a=this.faces[b];var g=this.vertices[a.a];var h=this.vertices[a.b];var k=this.vertices[a.c];e.subVectors(k,h);f.subVectors(g,h);e.cross(f);c[a.a].add(e);c[a.b].add(e);c[a.c].add(e)}}else for(b=
0,d=this.faces.length;b<d;b++)a=this.faces[b],c[a.a].add(a.normal),c[a.b].add(a.normal),c[a.c].add(a.normal);d=0;for(a=this.vertices.length;d<a;d++)c[d].normalize();b=0;for(d=this.faces.length;b<d;b++)a=this.faces[b],a.vertexNormals[0]=c[a.a].clone(),a.vertexNormals[1]=c[a.b].clone(),a.vertexNormals[2]=c[a.c].clone()},computeMorphNormals:function(){var b,a;var c=0;for(a=this.faces.length;c<a;c++){var d=this.faces[c];d.__originalFaceNormal?d.__originalFaceNormal.copy(d.normal):d.__originalFaceNormal=
d.normal.clone();d.__originalVertexNormals||(d.__originalVertexNormals=[]);var e=0;for(b=d.vertexNormals.length;e<b;e++)d.__originalVertexNormals[e]?d.__originalVertexNormals[e].copy(d.vertexNormals[e]):d.__originalVertexNormals[e]=d.vertexNormals[e].clone()}var f=new THREE.Geometry;f.faces=this.faces;e=0;for(b=this.morphTargets.length;e<b;e++){if(!this.morphNormals[e]){this.morphNormals[e]={};this.morphNormals[e].faceNormals=[];this.morphNormals[e].vertexNormals=[];d=this.morphNormals[e].faceNormals;
var g=this.morphNormals[e].vertexNormals;c=0;for(a=this.faces.length;c<a;c++){var h=new THREE.Vector3;var k={a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3};d.push(h);g.push(k)}}g=this.morphNormals[e];f.vertices=this.morphTargets[e].vertices;f.computeFaceNormals();f.computeVertexNormals();c=0;for(a=this.faces.length;c<a;c++)d=this.faces[c],h=g.faceNormals[c],k=g.vertexNormals[c],h.copy(d.normal),k.a.copy(d.vertexNormals[0]),k.b.copy(d.vertexNormals[1]),k.c.copy(d.vertexNormals[2])}c=
0;for(a=this.faces.length;c<a;c++)d=this.faces[c],d.normal=d.__originalFaceNormal,d.vertexNormals=d.__originalVertexNormals},computeTangents:function(){var b,a=[],c=[];var d=new THREE.Vector3;var e=new THREE.Vector3,f=new THREE.Vector3,g=new THREE.Vector3,h=new THREE.Vector3;var k=0;for(b=this.vertices.length;k<b;k++)a[k]=new THREE.Vector3,c[k]=new THREE.Vector3;k=0;for(b=this.faces.length;k<b;k++){var l=this.faces[k];var p=this.faceVertexUvs[0][k];var q=l.a;var m=l.b;l=l.c;var r=this.vertices[q];
var t=this.vertices[m];var u=this.vertices[l];var v=p[0];var w=p[1];var x=p[2];p=t.x-r.x;var C=u.x-r.x;var y=t.y-r.y;var R=u.y-r.y;t=t.z-r.z;r=u.z-r.z;u=w.x-v.x;var P=x.x-v.x;w=w.y-v.y;v=x.y-v.y;x=1/(u*v-P*w);d.set((v*p-w*C)*x,(v*y-w*R)*x,(v*t-w*r)*x);e.set((u*C-P*p)*x,(u*R-P*y)*x,(u*r-P*t)*x);a[q].add(d);a[m].add(d);a[l].add(d);c[q].add(e);c[m].add(e);c[l].add(e)}e=["a","b","c","d"];k=0;for(b=this.faces.length;k<b;k++)for(l=this.faces[k],d=0;d<Math.min(l.vertexNormals.length,3);d++)h.copy(l.vertexNormals[d]),
q=l[e[d]],m=a[q],f.copy(m),f.sub(h.multiplyScalar(h.dot(m))).normalize(),g.crossVectors(l.vertexNormals[d],m),q=g.dot(c[q]),q=0>q?-1:1,l.vertexTangents[d]=new THREE.Vector4(f.x,f.y,f.z,q);this.hasTangents=!0},computeLineDistances:function(){for(var b=0,a=this.vertices,c=0,d=a.length;c<d;c++)0<c&&(b+=a[c].distanceTo(a[c-1])),this.lineDistances[c]=b},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===
this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);this.boundingSphere.setFromPoints(this.vertices)},merge:function(b,a,c){if(!1===b instanceof THREE.Geometry)console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",b);else{var d,e=this.vertices.length,f=this.vertices,g=b.vertices,h=this.faces,k=b.faces,l=this.faceVertexUvs[0];b=b.faceVertexUvs[0];void 0===c&&(c=0);void 0!==a&&(d=(new THREE.Matrix3).getNormalMatrix(a));for(var p=0,q=g.length;p<q;p++){var m=g[p].clone();
void 0!==a&&m.applyMatrix4(a);f.push(m)}p=0;for(q=k.length;p<q;p++){g=k[p];var r=g.vertexNormals,t=g.vertexColors;m=new THREE.Face3(g.a+e,g.b+e,g.c+e);m.normal.copy(g.normal);void 0!==d&&m.normal.applyMatrix3(d).normalize();a=0;for(f=r.length;a<f;a++){var u=r[a].clone();void 0!==d&&u.applyMatrix3(d).normalize();m.vertexNormals.push(u)}m.color.copy(g.color);a=0;for(f=t.length;a<f;a++)u=t[a],m.vertexColors.push(u.clone());m.materialIndex=g.materialIndex+c;h.push(m)}p=0;for(q=b.length;p<q;p++)if(c=b[p],
d=[],void 0!==c){a=0;for(f=c.length;a<f;a++)d.push(c[a].clone());l.push(d)}}},mergeMesh:function(b){!1===b instanceof THREE.Mesh?console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",b):(b.matrixAutoUpdate&&b.updateMatrix(),this.merge(b.geometry,b.matrix))},mergeVertices:function(){var b={},a=[],c=[],d=Math.pow(10,4),e;var f=0;for(e=this.vertices.length;f<e;f++){var g=this.vertices[f];g=Math.round(g.x*d)+"_"+Math.round(g.y*d)+"_"+Math.round(g.z*d);void 0===b[g]?(b[g]=f,a.push(this.vertices[f]),
c[f]=a.length-1):c[f]=c[b[g]]}b=[];f=0;for(e=this.faces.length;f<e;f++)for(d=this.faces[f],d.a=c[d.a],d.b=c[d.b],d.c=c[d.c],d=[d.a,d.b,d.c],g=0;3>g;g++)if(d[g]==d[(g+1)%3]){b.push(f);break}for(f=b.length-1;0<=f;f--)for(d=b[f],this.faces.splice(d,1),c=0,e=this.faceVertexUvs.length;c<e;c++)this.faceVertexUvs[c].splice(d,1);f=this.vertices.length-a.length;this.vertices=a;return f},toJSON:function(){function b(a,b,c){return c?a|1<<b:a&~(1<<b)}function a(a){var b=a.x.toString()+a.y.toString()+a.z.toString();
if(void 0!==l[b])return l[b];l[b]=k.length/3;k.push(a.x,a.y,a.z);return l[b]}function c(a){var b=a.r.toString()+a.g.toString()+a.b.toString();if(void 0!==q[b])return q[b];q[b]=p.length;p.push(a.getHex());return q[b]}function d(a){var b=a.x.toString()+a.y.toString();if(void 0!==r[b])return r[b];r[b]=m.length/2;m.push(a.x,a.y);return r[b]}var e={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type};""!==this.name&&(e.name=this.name);if(void 0!==
this.parameters){var f=this.parameters,g;for(g in f)void 0!==f[g]&&(e[g]=f[g]);return e}f=[];for(g=0;g<this.vertices.length;g++){var h=this.vertices[g];f.push(h.x,h.y,h.z)}h=[];var k=[],l={},p=[],q={},m=[],r={};for(g=0;g<this.faces.length;g++){var t=this.faces[g],u=void 0!==this.faceVertexUvs[0][g],v=0<t.normal.length(),w=0<t.vertexNormals.length,x=1!==t.color.r||1!==t.color.g||1!==t.color.b,C=0<t.vertexColors.length,y=0;y=b(y,0,0);y=b(y,1,!1);y=b(y,2,!1);y=b(y,3,u);y=b(y,4,v);y=b(y,5,w);y=b(y,6,
x);y=b(y,7,C);h.push(y);h.push(t.a,t.b,t.c);u&&(u=this.faceVertexUvs[0][g],h.push(d(u[0]),d(u[1]),d(u[2])));v&&h.push(a(t.normal));w&&(v=t.vertexNormals,h.push(a(v[0]),a(v[1]),a(v[2])));x&&h.push(c(t.color));C&&(t=t.vertexColors,h.push(c(t[0]),c(t[1]),c(t[2])))}e.data={};e.data.vertices=f;e.data.normals=k;0<p.length&&(e.data.colors=p);0<m.length&&(e.data.uvs=[m]);e.data.faces=h;return e},clone:function(){for(var b=new THREE.Geometry,a=this.vertices,c=0,d=a.length;c<d;c++)b.vertices.push(a[c].clone());
a=this.faces;c=0;for(d=a.length;c<d;c++)b.faces.push(a[c].clone());c=0;for(d=this.faceVertexUvs.length;c<d;c++){a=this.faceVertexUvs[c];void 0===b.faceVertexUvs[c]&&(b.faceVertexUvs[c]=[]);for(var e=0,f=a.length;e<f;e++){for(var g=a[e],h=[],k=0,l=g.length;k<l;k++)h.push(g[k].clone());b.faceVertexUvs[c].push(h)}}return b},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Geometry.prototype);THREE.GeometryIdCount=0;
THREE.Camera=function(){THREE.Object3D.call(this);this.type="Camera";this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=new THREE.Matrix4};THREE.Camera.prototype=Object.create(THREE.Object3D.prototype);THREE.Camera.prototype.constructor=THREE.Camera;THREE.Camera.prototype.getWorldDirection=function(){var b=new THREE.Quaternion;return function(a){a=a||new THREE.Vector3;this.getWorldQuaternion(b);return a.set(0,0,-1).applyQuaternion(b)}}();
THREE.Camera.prototype.lookAt=function(){var b=new THREE.Matrix4;return function(a){b.lookAt(this.position,a,this.up);this.quaternion.setFromRotationMatrix(b)}}();THREE.Camera.prototype.clone=function(b){void 0===b&&(b=new THREE.Camera);THREE.Object3D.prototype.clone.call(this,b);b.matrixWorldInverse.copy(this.matrixWorldInverse);b.projectionMatrix.copy(this.projectionMatrix);return b};
THREE.CubeCamera=function(b,a,c){THREE.Object3D.call(this);this.type="CubeCamera";var d=new THREE.PerspectiveCamera(90,1,b,a);d.up.set(0,-1,0);d.lookAt(new THREE.Vector3(1,0,0));this.add(d);var e=new THREE.PerspectiveCamera(90,1,b,a);e.up.set(0,-1,0);e.lookAt(new THREE.Vector3(-1,0,0));this.add(e);var f=new THREE.PerspectiveCamera(90,1,b,a);f.up.set(0,0,1);f.lookAt(new THREE.Vector3(0,1,0));this.add(f);var g=new THREE.PerspectiveCamera(90,1,b,a);g.up.set(0,0,-1);g.lookAt(new THREE.Vector3(0,-1,0));
this.add(g);var h=new THREE.PerspectiveCamera(90,1,b,a);h.up.set(0,-1,0);h.lookAt(new THREE.Vector3(0,0,1));this.add(h);var k=new THREE.PerspectiveCamera(90,1,b,a);k.up.set(0,-1,0);k.lookAt(new THREE.Vector3(0,0,-1));this.add(k);this.renderTarget=new THREE.WebGLRenderTargetCube(c,c,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter});this.updateCubeMap=function(a,b){var c=this.renderTarget,l=c.generateMipmaps;c.generateMipmaps=!1;c.activeCubeFace=0;a.render(b,d,c);c.activeCubeFace=
1;a.render(b,e,c);c.activeCubeFace=2;a.render(b,f,c);c.activeCubeFace=3;a.render(b,g,c);c.activeCubeFace=4;a.render(b,h,c);c.generateMipmaps=l;c.activeCubeFace=5;a.render(b,k,c)}};THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype);THREE.CubeCamera.prototype.constructor=THREE.CubeCamera;
THREE.OrthographicCamera=function(b,a,c,d,e,f){THREE.Camera.call(this);this.type="OrthographicCamera";this.zoom=1;this.left=b;this.right=a;this.top=c;this.bottom=d;this.near=void 0!==e?e:.1;this.far=void 0!==f?f:2E3;this.updateProjectionMatrix()};THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype);THREE.OrthographicCamera.prototype.constructor=THREE.OrthographicCamera;
THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){var b=(this.right-this.left)/(2*this.zoom),a=(this.top-this.bottom)/(2*this.zoom),c=(this.right+this.left)/2,d=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(c-b,c+b,d+a,d-a,this.near,this.far)};
THREE.OrthographicCamera.prototype.clone=function(){var b=new THREE.OrthographicCamera;THREE.Camera.prototype.clone.call(this,b);b.zoom=this.zoom;b.left=this.left;b.right=this.right;b.top=this.top;b.bottom=this.bottom;b.near=this.near;b.far=this.far;b.projectionMatrix.copy(this.projectionMatrix);return b};
THREE.PerspectiveCamera=function(b,a,c,d){THREE.Camera.call(this);this.type="PerspectiveCamera";this.zoom=1;this.fov=void 0!==b?b:50;this.aspect=void 0!==a?a:1;this.near=void 0!==c?c:.1;this.far=void 0!==d?d:2E3;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype);THREE.PerspectiveCamera.prototype.constructor=THREE.PerspectiveCamera;
THREE.PerspectiveCamera.prototype.setLens=function(b,a){void 0===a&&(a=24);this.fov=2*THREE.Math.radToDeg(Math.atan(a/(2*b)));this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.setViewOffset=function(b,a,c,d,e,f){this.fullWidth=b;this.fullHeight=a;this.x=c;this.y=d;this.width=e;this.height=f;this.updateProjectionMatrix()};
THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var b=THREE.Math.radToDeg(2*Math.atan(Math.tan(.5*THREE.Math.degToRad(this.fov))/this.zoom));if(this.fullWidth){var a=this.fullWidth/this.fullHeight;b=Math.tan(THREE.Math.degToRad(.5*b))*this.near;var c=-b,d=a*c;a=Math.abs(a*b-d);c=Math.abs(b-c);this.projectionMatrix.makeFrustum(d+this.x*a/this.fullWidth,d+(this.x+this.width)*a/this.fullWidth,b-(this.y+this.height)*c/this.fullHeight,b-this.y*c/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(b,
this.aspect,this.near,this.far)};THREE.PerspectiveCamera.prototype.clone=function(){var b=new THREE.PerspectiveCamera;THREE.Camera.prototype.clone.call(this,b);b.zoom=this.zoom;b.fov=this.fov;b.aspect=this.aspect;b.near=this.near;b.far=this.far;b.projectionMatrix.copy(this.projectionMatrix);return b};THREE.Light=function(b){THREE.Object3D.call(this);this.type="Light";this.color=new THREE.Color(b)};THREE.Light.prototype=Object.create(THREE.Object3D.prototype);THREE.Light.prototype.constructor=THREE.Light;
THREE.Light.prototype.clone=function(b){void 0===b&&(b=new THREE.Light);THREE.Object3D.prototype.clone.call(this,b);b.color.copy(this.color);return b};THREE.AmbientLight=function(b){THREE.Light.call(this,b);this.type="AmbientLight"};THREE.AmbientLight.prototype=Object.create(THREE.Light.prototype);THREE.AmbientLight.prototype.constructor=THREE.AmbientLight;THREE.AmbientLight.prototype.clone=function(){var b=new THREE.AmbientLight;THREE.Light.prototype.clone.call(this,b);return b};
THREE.AreaLight=function(b,a){THREE.Light.call(this,b);this.type="AreaLight";this.normal=new THREE.Vector3(0,-1,0);this.right=new THREE.Vector3(1,0,0);this.intensity=void 0!==a?a:1;this.height=this.width=1;this.constantAttenuation=1.5;this.linearAttenuation=.5;this.quadraticAttenuation=.1};THREE.AreaLight.prototype=Object.create(THREE.Light.prototype);THREE.AreaLight.prototype.constructor=THREE.AreaLight;
THREE.DirectionalLight=function(b,a){THREE.Light.call(this,b);this.type="DirectionalLight";this.position.set(0,1,0);this.target=new THREE.Object3D;this.intensity=void 0!==a?a:1;this.onlyShadow=this.castShadow=!1;this.shadowCameraNear=50;this.shadowCameraFar=5E3;this.shadowCameraLeft=-500;this.shadowCameraTop=this.shadowCameraRight=500;this.shadowCameraBottom=-500;this.shadowCameraVisible=!1;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapHeight=this.shadowMapWidth=512;this.shadowCascade=!1;
this.shadowCascadeOffset=new THREE.Vector3(0,0,-1E3);this.shadowCascadeCount=2;this.shadowCascadeBias=[0,0,0];this.shadowCascadeWidth=[512,512,512];this.shadowCascadeHeight=[512,512,512];this.shadowCascadeNearZ=[-1,.99,.998];this.shadowCascadeFarZ=[.99,.998,1];this.shadowCascadeArray=[];this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null};THREE.DirectionalLight.prototype=Object.create(THREE.Light.prototype);THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight;
THREE.DirectionalLight.prototype.clone=function(){var b=new THREE.DirectionalLight;THREE.Light.prototype.clone.call(this,b);b.target=this.target.clone();b.intensity=this.intensity;b.castShadow=this.castShadow;b.onlyShadow=this.onlyShadow;b.shadowCameraNear=this.shadowCameraNear;b.shadowCameraFar=this.shadowCameraFar;b.shadowCameraLeft=this.shadowCameraLeft;b.shadowCameraRight=this.shadowCameraRight;b.shadowCameraTop=this.shadowCameraTop;b.shadowCameraBottom=this.shadowCameraBottom;b.shadowCameraVisible=
this.shadowCameraVisible;b.shadowBias=this.shadowBias;b.shadowDarkness=this.shadowDarkness;b.shadowMapWidth=this.shadowMapWidth;b.shadowMapHeight=this.shadowMapHeight;b.shadowCascade=this.shadowCascade;b.shadowCascadeOffset.copy(this.shadowCascadeOffset);b.shadowCascadeCount=this.shadowCascadeCount;b.shadowCascadeBias=this.shadowCascadeBias.slice(0);b.shadowCascadeWidth=this.shadowCascadeWidth.slice(0);b.shadowCascadeHeight=this.shadowCascadeHeight.slice(0);b.shadowCascadeNearZ=this.shadowCascadeNearZ.slice(0);
b.shadowCascadeFarZ=this.shadowCascadeFarZ.slice(0);return b};THREE.HemisphereLight=function(b,a,c){THREE.Light.call(this,b);this.type="HemisphereLight";this.position.set(0,100,0);this.groundColor=new THREE.Color(a);this.intensity=void 0!==c?c:1};THREE.HemisphereLight.prototype=Object.create(THREE.Light.prototype);THREE.HemisphereLight.prototype.constructor=THREE.HemisphereLight;
THREE.HemisphereLight.prototype.clone=function(){var b=new THREE.HemisphereLight;THREE.Light.prototype.clone.call(this,b);b.groundColor.copy(this.groundColor);b.intensity=this.intensity;return b};THREE.PointLight=function(b,a,c){THREE.Light.call(this,b);this.type="PointLight";this.intensity=void 0!==a?a:1;this.distance=void 0!==c?c:0};THREE.PointLight.prototype=Object.create(THREE.Light.prototype);THREE.PointLight.prototype.constructor=THREE.PointLight;
THREE.PointLight.prototype.clone=function(){var b=new THREE.PointLight;THREE.Light.prototype.clone.call(this,b);b.intensity=this.intensity;b.distance=this.distance;return b};
THREE.SpotLight=function(b,a,c,d,e){THREE.Light.call(this,b);this.type="SpotLight";this.position.set(0,1,0);this.target=new THREE.Object3D;this.intensity=void 0!==a?a:1;this.distance=void 0!==c?c:0;this.angle=void 0!==d?d:Math.PI/3;this.exponent=void 0!==e?e:10;this.onlyShadow=this.castShadow=!1;this.shadowCameraNear=50;this.shadowCameraFar=5E3;this.shadowCameraFov=50;this.shadowCameraVisible=!1;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapHeight=this.shadowMapWidth=512;this.shadowMatrix=
this.shadowCamera=this.shadowMapSize=this.shadowMap=null};THREE.SpotLight.prototype=Object.create(THREE.Light.prototype);THREE.SpotLight.prototype.constructor=THREE.SpotLight;
THREE.SpotLight.prototype.clone=function(){var b=new THREE.SpotLight;THREE.Light.prototype.clone.call(this,b);b.target=this.target.clone();b.intensity=this.intensity;b.distance=this.distance;b.angle=this.angle;b.exponent=this.exponent;b.castShadow=this.castShadow;b.onlyShadow=this.onlyShadow;b.shadowCameraNear=this.shadowCameraNear;b.shadowCameraFar=this.shadowCameraFar;b.shadowCameraFov=this.shadowCameraFov;b.shadowCameraVisible=this.shadowCameraVisible;b.shadowBias=this.shadowBias;b.shadowDarkness=
this.shadowDarkness;b.shadowMapWidth=this.shadowMapWidth;b.shadowMapHeight=this.shadowMapHeight;return b};THREE.Cache=function(){this.files={}};THREE.Cache.prototype={constructor:THREE.Cache,add:function(b,a){this.files[b]=a},get:function(b){return this.files[b]},remove:function(b){delete this.files[b]},clear:function(){this.files={}}};
THREE.Loader=function(b){this.statusDomElement=(this.showStatus=b)?THREE.Loader.prototype.addStatusElement():null;this.imageLoader=new THREE.ImageLoader;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};
THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:void 0,addStatusElement:function(){var b=document.createElement("div");b.style.position="absolute";b.style.right="0px";b.style.top="0px";b.style.fontSize="0.8em";b.style.textAlign="left";b.style.background="rgba(0,0,0,0.25)";b.style.color="#fff";b.style.width="120px";b.style.padding="0.5em 0.5em 0.5em 0.5em";b.style.zIndex=1E3;b.innerHTML="Loading ...";return b},updateProgress:function(b){var a="Loaded ";a=b.total?a+((100*b.loaded/b.total).toFixed(0)+
"%"):a+((b.loaded/1024).toFixed(2)+" KB");this.statusDomElement.innerHTML=a},extractUrlBase:function(b){b=b.split("/");if(1===b.length)return"./";b.pop();return b.join("/")+"/"},initMaterials:function(b,a){for(var c=[],d=0;d<b.length;++d)c[d]=this.createMaterial(b[d],a);return c},needsTangents:function(b){for(var a=0,c=b.length;a<c;a++)if(b[a]instanceof THREE.ShaderMaterial)return!0;return!1},createMaterial:function(b,a){function c(a){a=Math.log(a)/Math.LN2;return Math.pow(2,Math.round(a))}function d(b,
d,e,g,h,k,u){var l=a+e,m,p=THREE.Loader.Handlers.get(l);null!==p?m=p.load(l):(m=new THREE.Texture,p=f.imageLoader,p.crossOrigin=f.crossOrigin,p.load(l,function(a){if(!1===THREE.Math.isPowerOfTwo(a.width)||!1===THREE.Math.isPowerOfTwo(a.height)){var b=c(a.width),d=c(a.height),e=document.createElement("canvas");e.width=b;e.height=d;e.getContext("2d").drawImage(a,0,0,b,d);m.image=e}else m.image=a;m.needsUpdate=!0}));m.sourceFile=e;g&&(m.repeat.set(g[0],g[1]),1!==g[0]&&(m.wrapS=THREE.RepeatWrapping),
1!==g[1]&&(m.wrapT=THREE.RepeatWrapping));h&&m.offset.set(h[0],h[1]);k&&(e={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping},void 0!==e[k[0]]&&(m.wrapS=e[k[0]]),void 0!==e[k[1]]&&(m.wrapT=e[k[1]]));u&&(m.anisotropy=u);b[d]=m}function e(a){return(255*a[0]<<16)+(255*a[1]<<8)+255*a[2]}var f=this,g="MeshLambertMaterial",h={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(b.shading){var k=b.shading.toLowerCase();"phong"===k?g="MeshPhongMaterial":
"basic"===k&&(g="MeshBasicMaterial")}void 0!==b.blending&&void 0!==THREE[b.blending]&&(h.blending=THREE[b.blending]);if(void 0!==b.transparent||1>b.opacity)h.transparent=b.transparent;void 0!==b.depthTest&&(h.depthTest=b.depthTest);void 0!==b.depthWrite&&(h.depthWrite=b.depthWrite);void 0!==b.visible&&(h.visible=b.visible);void 0!==b.flipSided&&(h.side=THREE.BackSide);void 0!==b.doubleSided&&(h.side=THREE.DoubleSide);void 0!==b.wireframe&&(h.wireframe=b.wireframe);void 0!==b.vertexColors&&("face"===
b.vertexColors?h.vertexColors=THREE.FaceColors:b.vertexColors&&(h.vertexColors=THREE.VertexColors));b.colorDiffuse?h.color=e(b.colorDiffuse):b.DbgColor&&(h.color=b.DbgColor);b.colorSpecular&&(h.specular=e(b.colorSpecular));b.colorAmbient&&(h.ambient=e(b.colorAmbient));b.colorEmissive&&(h.emissive=e(b.colorEmissive));b.transparency&&(h.opacity=b.transparency);b.specularCoef&&(h.shininess=b.specularCoef);b.mapDiffuse&&a&&d(h,"map",b.mapDiffuse,b.mapDiffuseRepeat,b.mapDiffuseOffset,b.mapDiffuseWrap,
b.mapDiffuseAnisotropy);b.mapLight&&a&&d(h,"lightMap",b.mapLight,b.mapLightRepeat,b.mapLightOffset,b.mapLightWrap,b.mapLightAnisotropy);b.mapBump&&a&&d(h,"bumpMap",b.mapBump,b.mapBumpRepeat,b.mapBumpOffset,b.mapBumpWrap,b.mapBumpAnisotropy);b.mapNormal&&a&&d(h,"normalMap",b.mapNormal,b.mapNormalRepeat,b.mapNormalOffset,b.mapNormalWrap,b.mapNormalAnisotropy);b.mapSpecular&&a&&d(h,"specularMap",b.mapSpecular,b.mapSpecularRepeat,b.mapSpecularOffset,b.mapSpecularWrap,b.mapSpecularAnisotropy);b.mapAlpha&&
a&&d(h,"alphaMap",b.mapAlpha,b.mapAlphaRepeat,b.mapAlphaOffset,b.mapAlphaWrap,b.mapAlphaAnisotropy);b.mapBumpScale&&(h.bumpScale=b.mapBumpScale);b.mapNormalFactor&&(h.normalScale=new THREE.Vector2(b.mapNormalFactor,b.mapNormalFactor));g=new THREE[g](h);void 0!==b.DbgName&&(g.name=b.DbgName);return g}};THREE.Loader.Handlers={handlers:[],add:function(b,a){this.handlers.push(b,a)},get:function(b){for(var a=0,c=this.handlers.length;a<c;a+=2){var d=this.handlers[a+1];if(this.handlers[a].test(b))return d}return null}};
THREE.XHRLoader=function(b){this.cache=new THREE.Cache;this.manager=void 0!==b?b:THREE.DefaultLoadingManager};
THREE.XHRLoader.prototype={constructor:THREE.XHRLoader,load:function(b,a,c,d){var e=this,f=e.cache.get(b);void 0!==f?a&&a(f):(f=new XMLHttpRequest,f.open("GET",b,!0),f.addEventListener("load",function(c){e.cache.add(b,this.response);a&&a(this.response);e.manager.itemEnd(b)},!1),void 0!==c&&f.addEventListener("progress",function(a){c(a)},!1),void 0!==d&&f.addEventListener("error",function(a){d(a)},!1),void 0!==this.crossOrigin&&(f.crossOrigin=this.crossOrigin),void 0!==this.responseType&&(f.responseType=
this.responseType),f.send(null),e.manager.itemStart(b))},setResponseType:function(b){this.responseType=b},setCrossOrigin:function(b){this.crossOrigin=b}};THREE.ImageLoader=function(b){this.cache=new THREE.Cache;this.manager=void 0!==b?b:THREE.DefaultLoadingManager};
THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,load:function(b,a,c,d){var e=this,f=e.cache.get(b);if(void 0!==f)a(f);else return f=document.createElement("img"),void 0!==a&&f.addEventListener("load",function(c){e.cache.add(b,this);a(this);e.manager.itemEnd(b)},!1),void 0!==c&&f.addEventListener("progress",function(a){c(a)},!1),void 0!==d&&f.addEventListener("error",function(a){d(a)},!1),void 0!==this.crossOrigin&&(f.crossOrigin=this.crossOrigin),f.src=b,e.manager.itemStart(b),f},setCrossOrigin:function(b){this.crossOrigin=
b}};THREE.JSONLoader=function(b){THREE.Loader.call(this,b);this.withCredentials=!1};THREE.JSONLoader.prototype=Object.create(THREE.Loader.prototype);THREE.JSONLoader.prototype.constructor=THREE.JSONLoader;THREE.JSONLoader.prototype.load=function(b,a,c){c=c&&"string"===typeof c?c:this.extractUrlBase(b);this.onLoadStart();this.loadAjaxJSON(this,b,a,c)};
THREE.JSONLoader.prototype.loadAjaxJSON=function(b,a,c,d,e){var f=new XMLHttpRequest,g=0;f.onreadystatechange=function(){if(f.readyState===f.DONE)if(200===f.status||0===f.status){if(f.responseText){var h=JSON.parse(f.responseText);if(void 0!==h.metadata&&"scene"===h.metadata.type){console.error('THREE.JSONLoader: "'+a+'" seems to be a Scene. Use THREE.SceneLoader instead.');return}h=b.parse(h,d);c(h.geometry,h.materials)}else console.error('THREE.JSONLoader: "'+a+'" seems to be unreachable or the file is empty.');
b.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load \""+a+'" ('+f.status+")");else f.readyState===f.LOADING?e&&(0===g&&(g=f.getResponseHeader("Content-Length")),e({total:g,loaded:f.responseText.length})):f.readyState===f.HEADERS_RECEIVED&&void 0!==e&&(g=f.getResponseHeader("Content-Length"))};f.open("GET",a,!0);f.withCredentials=this.withCredentials;f.send(null)};
THREE.JSONLoader.prototype.parse=function(b,a){var c=new THREE.Geometry,d=void 0!==b.scale?1/b.scale:1;(function(a){var d,e,h,k,l,p,q,m=b.faces;var r=b.vertices;var t=b.normals,u=b.colors,v=0;if(void 0!==b.uvs){for(d=0;d<b.uvs.length;d++)b.uvs[d].length&&v++;for(d=0;d<v;d++)c.faceVertexUvs[d]=[]}var w=0;for(k=r.length;w<k;)d=new THREE.Vector3,d.x=r[w++]*a,d.y=r[w++]*a,d.z=r[w++]*a,c.vertices.push(d);w=0;for(k=m.length;w<k;)if(a=m[w++],p=a&1,h=a&2,d=a&8,l=a&16,q=a&32,r=a&64,a&=128,p){p=new THREE.Face3;
p.a=m[w];p.b=m[w+1];p.c=m[w+3];var x=new THREE.Face3;x.a=m[w+1];x.b=m[w+2];x.c=m[w+3];w+=4;h&&(h=m[w++],p.materialIndex=h,x.materialIndex=h);h=c.faces.length;if(d)for(d=0;d<v;d++){var C=b.uvs[d];c.faceVertexUvs[d][h]=[];c.faceVertexUvs[d][h+1]=[];for(e=0;4>e;e++){var y=m[w++];var R=C[2*y];y=C[2*y+1];R=new THREE.Vector2(R,y);2!==e&&c.faceVertexUvs[d][h].push(R);0!==e&&c.faceVertexUvs[d][h+1].push(R)}}l&&(l=3*m[w++],p.normal.set(t[l++],t[l++],t[l]),x.normal.copy(p.normal));if(q)for(d=0;4>d;d++)l=3*
m[w++],q=new THREE.Vector3(t[l++],t[l++],t[l]),2!==d&&p.vertexNormals.push(q),0!==d&&x.vertexNormals.push(q);r&&(r=m[w++],r=u[r],p.color.setHex(r),x.color.setHex(r));if(a)for(d=0;4>d;d++)r=m[w++],r=u[r],2!==d&&p.vertexColors.push(new THREE.Color(r)),0!==d&&x.vertexColors.push(new THREE.Color(r));c.faces.push(p);c.faces.push(x)}else{p=new THREE.Face3;p.a=m[w++];p.b=m[w++];p.c=m[w++];h&&(h=m[w++],p.materialIndex=h);h=c.faces.length;if(d)for(d=0;d<v;d++)for(C=b.uvs[d],c.faceVertexUvs[d][h]=[],e=0;3>
e;e++)y=m[w++],R=C[2*y],y=C[2*y+1],R=new THREE.Vector2(R,y),c.faceVertexUvs[d][h].push(R);l&&(l=3*m[w++],p.normal.set(t[l++],t[l++],t[l]));if(q)for(d=0;3>d;d++)l=3*m[w++],q=new THREE.Vector3(t[l++],t[l++],t[l]),p.vertexNormals.push(q);r&&(r=m[w++],p.color.setHex(u[r]));if(a)for(d=0;3>d;d++)r=m[w++],p.vertexColors.push(new THREE.Color(u[r]));c.faces.push(p)}})(d);(function(){var a=void 0!==b.influencesPerVertex?b.influencesPerVertex:2;if(b.skinWeights)for(var d=0,g=b.skinWeights.length;d<g;d+=a)c.skinWeights.push(new THREE.Vector4(b.skinWeights[d],
1<a?b.skinWeights[d+1]:0,2<a?b.skinWeights[d+2]:0,3<a?b.skinWeights[d+3]:0));if(b.skinIndices)for(d=0,g=b.skinIndices.length;d<g;d+=a)c.skinIndices.push(new THREE.Vector4(b.skinIndices[d],1<a?b.skinIndices[d+1]:0,2<a?b.skinIndices[d+2]:0,3<a?b.skinIndices[d+3]:0));c.bones=b.bones;c.bones&&0<c.bones.length&&(c.skinWeights.length!==c.skinIndices.length||c.skinIndices.length!==c.vertices.length)&&console.warn("When skinning, number of vertices ("+c.vertices.length+"), skinIndices ("+c.skinIndices.length+
"), and skinWeights ("+c.skinWeights.length+") should match.");c.animation=b.animation;c.animations=b.animations})();(function(a){if(void 0!==b.morphTargets){var d,e;var h=0;for(d=b.morphTargets.length;h<d;h++){c.morphTargets[h]={};c.morphTargets[h].name=b.morphTargets[h].name;c.morphTargets[h].vertices=[];var k=c.morphTargets[h].vertices;var l=b.morphTargets[h].vertices;var p=0;for(e=l.length;p<e;p+=3){var q=new THREE.Vector3;q.x=l[p]*a;q.y=l[p+1]*a;q.z=l[p+2]*a;k.push(q)}}}if(void 0!==b.morphColors)for(h=
0,d=b.morphColors.length;h<d;h++)for(c.morphColors[h]={},c.morphColors[h].name=b.morphColors[h].name,c.morphColors[h].colors=[],e=c.morphColors[h].colors,k=b.morphColors[h].colors,a=0,p=k.length;a<p;a+=3)l=new THREE.Color(16755200),l.setRGB(k[a],k[a+1],k[a+2]),e.push(l)})(d);c.computeFaceNormals();c.computeBoundingSphere();if(void 0===b.materials||0===b.materials.length)return{geometry:c};d=this.initMaterials(b.materials,a);this.needsTangents(d)&&c.computeTangents();return{geometry:c,materials:d}};
THREE.LoadingManager=function(b,a,c){var d=this,e=0,f=0;this.onLoad=b;this.onProgress=a;this.onError=c;this.itemStart=function(a){f++};this.itemEnd=function(a){e++;if(void 0!==d.onProgress)d.onProgress(a,e,f);if(e===f&&void 0!==d.onLoad)d.onLoad()}};THREE.DefaultLoadingManager=new THREE.LoadingManager;THREE.BufferGeometryLoader=function(b){this.manager=void 0!==b?b:THREE.DefaultLoadingManager};
THREE.BufferGeometryLoader.prototype={constructor:THREE.BufferGeometryLoader,load:function(b,a,c,d){var e=this,f=new THREE.XHRLoader(e.manager);f.setCrossOrigin(this.crossOrigin);f.load(b,function(b){a(e.parse(JSON.parse(b)))},c,d)},setCrossOrigin:function(b){this.crossOrigin=b},parse:function(b){var a=new THREE.BufferGeometry,c=b.attributes,d;for(d in c){var e=c[d],f=new self[e.type](e.array);a.addAttribute(d,new THREE.BufferAttribute(f,e.itemSize))}c=b.offsets;void 0!==c&&(a.offsets=JSON.parse(JSON.stringify(c)));
b=b.boundingSphere;void 0!==b&&(c=new THREE.Vector3,void 0!==b.center&&c.fromArray(b.center),a.boundingSphere=new THREE.Sphere(c,b.radius));return a}};THREE.MaterialLoader=function(b){this.manager=void 0!==b?b:THREE.DefaultLoadingManager};
THREE.MaterialLoader.prototype={constructor:THREE.MaterialLoader,load:function(b,a,c,d){var e=this,f=new THREE.XHRLoader(e.manager);f.setCrossOrigin(this.crossOrigin);f.load(b,function(b){a(e.parse(JSON.parse(b)))},c,d)},setCrossOrigin:function(b){this.crossOrigin=b},parse:function(b){var a=new THREE[b.type];void 0!==b.color&&a.color.setHex(b.color);void 0!==b.ambient&&a.ambient.setHex(b.ambient);void 0!==b.emissive&&a.emissive.setHex(b.emissive);void 0!==b.specular&&a.specular.setHex(b.specular);
void 0!==b.shininess&&(a.shininess=b.shininess);void 0!==b.uniforms&&(a.uniforms=b.uniforms);void 0!==b.vertexShader&&(a.vertexShader=b.vertexShader);void 0!==b.fragmentShader&&(a.fragmentShader=b.fragmentShader);void 0!==b.vertexColors&&(a.vertexColors=b.vertexColors);void 0!==b.shading&&(a.shading=b.shading);void 0!==b.blending&&(a.blending=b.blending);void 0!==b.side&&(a.side=b.side);void 0!==b.opacity&&(a.opacity=b.opacity);void 0!==b.transparent&&(a.transparent=b.transparent);void 0!==b.wireframe&&
(a.wireframe=b.wireframe);if(void 0!==b.materials)for(var c=0,d=b.materials.length;c<d;c++)a.materials.push(this.parse(b.materials[c]));return a}};THREE.ObjectLoader=function(b){this.manager=void 0!==b?b:THREE.DefaultLoadingManager};
THREE.ObjectLoader.prototype={constructor:THREE.ObjectLoader,load:function(b,a,c,d){var e=this,f=new THREE.XHRLoader(e.manager);f.setCrossOrigin(this.crossOrigin);f.load(b,function(b){a(e.parse(JSON.parse(b)))},c,d)},setCrossOrigin:function(b){this.crossOrigin=b},parse:function(b){var a=this.parseGeometries(b.geometries),c=this.parseMaterials(b.materials);return this.parseObject(b.object,a,c)},parseGeometries:function(b){var a={};if(void 0!==b)for(var c=new THREE.JSONLoader,d=new THREE.BufferGeometryLoader,
e=0,f=b.length;e<f;e++){var g=b[e];switch(g.type){case "PlaneGeometry":var h=new THREE.PlaneGeometry(g.width,g.height,g.widthSegments,g.heightSegments);break;case "BoxGeometry":case "CubeGeometry":h=new THREE.BoxGeometry(g.width,g.height,g.depth,g.widthSegments,g.heightSegments,g.depthSegments);break;case "CircleGeometry":h=new THREE.CircleGeometry(g.radius,g.segments);break;case "CylinderGeometry":h=new THREE.CylinderGeometry(g.radiusTop,g.radiusBottom,g.height,g.radialSegments,g.heightSegments,
g.openEnded);break;case "SphereGeometry":h=new THREE.SphereGeometry(g.radius,g.widthSegments,g.heightSegments,g.phiStart,g.phiLength,g.thetaStart,g.thetaLength);break;case "IcosahedronGeometry":h=new THREE.IcosahedronGeometry(g.radius,g.detail);break;case "TorusGeometry":h=new THREE.TorusGeometry(g.radius,g.tube,g.radialSegments,g.tubularSegments,g.arc);break;case "TorusKnotGeometry":h=new THREE.TorusKnotGeometry(g.radius,g.tube,g.radialSegments,g.tubularSegments,g.p,g.q,g.heightScale);break;case "BufferGeometry":h=
d.parse(g.data);break;case "Geometry":h=c.parse(g.data).geometry}h.uuid=g.uuid;void 0!==g.name&&(h.name=g.name);a[g.uuid]=h}return a},parseMaterials:function(b){var a={};if(void 0!==b)for(var c=new THREE.MaterialLoader,d=0,e=b.length;d<e;d++){var f=b[d],g=c.parse(f);g.uuid=f.uuid;void 0!==f.name&&(g.name=f.name);a[f.uuid]=g}return a},parseObject:function(){var b=new THREE.Matrix4;return function(a,c,d){switch(a.type){case "Scene":var e=new THREE.Scene;break;case "PerspectiveCamera":e=new THREE.PerspectiveCamera(a.fov,
a.aspect,a.near,a.far);break;case "OrthographicCamera":e=new THREE.OrthographicCamera(a.left,a.right,a.top,a.bottom,a.near,a.far);break;case "AmbientLight":e=new THREE.AmbientLight(a.color);break;case "DirectionalLight":e=new THREE.DirectionalLight(a.color,a.intensity);break;case "PointLight":e=new THREE.PointLight(a.color,a.intensity,a.distance);break;case "SpotLight":e=new THREE.SpotLight(a.color,a.intensity,a.distance,a.angle,a.exponent);break;case "HemisphereLight":e=new THREE.HemisphereLight(a.color,
a.groundColor,a.intensity);break;case "Mesh":e=c[a.geometry];var f=d[a.material];void 0===e&&console.warn("THREE.ObjectLoader: Undefined geometry",a.geometry);void 0===f&&console.warn("THREE.ObjectLoader: Undefined material",a.material);e=new THREE.Mesh(e,f);break;case "Line":e=c[a.geometry];f=d[a.material];void 0===e&&console.warn("THREE.ObjectLoader: Undefined geometry",a.geometry);void 0===f&&console.warn("THREE.ObjectLoader: Undefined material",a.material);e=new THREE.Line(e,f);break;case "Sprite":f=
d[a.material];void 0===f&&console.warn("THREE.ObjectLoader: Undefined material",a.material);e=new THREE.Sprite(f);break;case "Group":e=new THREE.Group;break;default:e=new THREE.Object3D}e.uuid=a.uuid;void 0!==a.name&&(e.name=a.name);void 0!==a.matrix?(b.fromArray(a.matrix),b.decompose(e.position,e.quaternion,e.scale)):(void 0!==a.position&&e.position.fromArray(a.position),void 0!==a.rotation&&e.rotation.fromArray(a.rotation),void 0!==a.scale&&e.scale.fromArray(a.scale));void 0!==a.visible&&(e.visible=
a.visible);void 0!==a.userData&&(e.userData=a.userData);if(void 0!==a.children)for(var g in a.children)e.add(this.parseObject(a.children[g],c,d));return e}}()};THREE.TextureLoader=function(b){this.manager=void 0!==b?b:THREE.DefaultLoadingManager};
THREE.TextureLoader.prototype={constructor:THREE.TextureLoader,load:function(b,a,c,d){var e=new THREE.ImageLoader(this.manager);e.setCrossOrigin(this.crossOrigin);e.load(b,function(b){b=new THREE.Texture(b);b.needsUpdate=!0;void 0!==a&&a(b)},c,d)},setCrossOrigin:function(b){this.crossOrigin=b}};THREE.DataTextureLoader=THREE.BinaryTextureLoader=function(){this._parser=null};
THREE.BinaryTextureLoader.prototype={constructor:THREE.BinaryTextureLoader,load:function(b,a,c,d){var e=this,f=new THREE.DataTexture,g=new THREE.XHRLoader;g.setResponseType("arraybuffer");g.load(b,function(b){if(b=e._parser(b))void 0!==b.image?f.image=b.image:void 0!==b.data&&(f.image.width=b.width,f.image.height=b.height,f.image.data=b.data),f.wrapS=void 0!==b.wrapS?b.wrapS:THREE.ClampToEdgeWrapping,f.wrapT=void 0!==b.wrapT?b.wrapT:THREE.ClampToEdgeWrapping,f.magFilter=void 0!==b.magFilter?b.magFilter:
THREE.LinearFilter,f.minFilter=void 0!==b.minFilter?b.minFilter:THREE.LinearMipMapLinearFilter,f.anisotropy=void 0!==b.anisotropy?b.anisotropy:1,void 0!==b.format&&(f.format=b.format),void 0!==b.type&&(f.type=b.type),void 0!==b.mipmaps&&(f.mipmaps=b.mipmaps),1===b.mipmapCount&&(f.minFilter=THREE.LinearFilter),f.needsUpdate=!0,a&&a(f,b)},c,d);return f}};THREE.CompressedTextureLoader=function(){this._parser=null};
THREE.CompressedTextureLoader.prototype={constructor:THREE.CompressedTextureLoader,load:function(b,a,c){var d=this,e=[],f=new THREE.CompressedTexture;f.image=e;var g=new THREE.XHRLoader;g.setResponseType("arraybuffer");if(b instanceof Array){var h=0;c=function(c){g.load(b[c],function(b){b=d._parser(b,!0);e[c]={width:b.width,height:b.height,format:b.format,mipmaps:b.mipmaps};h+=1;6===h&&(1==b.mipmapCount&&(f.minFilter=THREE.LinearFilter),f.format=b.format,f.needsUpdate=!0,a&&a(f))})};for(var k=0,l=
b.length;k<l;++k)c(k)}else g.load(b,function(b){b=d._parser(b,!0);if(b.isCubemap)for(var c=b.mipmaps.length/b.mipmapCount,g=0;g<c;g++){e[g]={mipmaps:[]};for(var h=0;h<b.mipmapCount;h++)e[g].mipmaps.push(b.mipmaps[g*b.mipmapCount+h]),e[g].format=b.format,e[g].width=b.width,e[g].height=b.height}else f.image.width=b.width,f.image.height=b.height,f.mipmaps=b.mipmaps;1===b.mipmapCount&&(f.minFilter=THREE.LinearFilter);f.format=b.format;f.needsUpdate=!0;a&&a(f)});return f}};
THREE.Material=function(){Object.defineProperty(this,"id",{value:THREE.MaterialIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Material";this.side=THREE.FrontSide;this.opacity=1;this.transparent=!1;this.blending=THREE.NormalBlending;this.blendSrc=THREE.SrcAlphaFactor;this.blendDst=THREE.OneMinusSrcAlphaFactor;this.blendEquation=THREE.AddEquation;this.depthWrite=this.depthTest=!0;this.polygonOffset=!1;this.overdraw=this.alphaTest=this.polygonOffsetUnits=this.polygonOffsetFactor=
0;this.needsUpdate=this.visible=!0};
THREE.Material.prototype={constructor:THREE.Material,setValues:function(b){if(void 0!==b)for(var a in b){var c=b[a];if(void 0===c)console.warn("THREE.Material: '"+a+"' parameter is undefined.");else if(a in this){var d=this[a];d instanceof THREE.Color?d.set(c):d instanceof THREE.Vector3&&c instanceof THREE.Vector3?d.copy(c):this[a]="overdraw"==a?Number(c):c}}},toJSON:function(){var b={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type};""!==this.name&&
(b.name=this.name);this instanceof THREE.MeshBasicMaterial?(b.color=this.color.getHex(),this.vertexColors!==THREE.NoColors&&(b.vertexColors=this.vertexColors),this.blending!==THREE.NormalBlending&&(b.blending=this.blending),this.side!==THREE.FrontSide&&(b.side=this.side)):this instanceof THREE.MeshLambertMaterial?(b.color=this.color.getHex(),b.ambient=this.ambient.getHex(),b.emissive=this.emissive.getHex(),this.vertexColors!==THREE.NoColors&&(b.vertexColors=this.vertexColors),this.blending!==THREE.NormalBlending&&
(b.blending=this.blending),this.side!==THREE.FrontSide&&(b.side=this.side)):this instanceof THREE.MeshPhongMaterial?(b.color=this.color.getHex(),b.ambient=this.ambient.getHex(),b.emissive=this.emissive.getHex(),b.specular=this.specular.getHex(),b.shininess=this.shininess,this.vertexColors!==THREE.NoColors&&(b.vertexColors=this.vertexColors),this.blending!==THREE.NormalBlending&&(b.blending=this.blending),this.side!==THREE.FrontSide&&(b.side=this.side)):this instanceof THREE.MeshNormalMaterial?(this.shading!==
THREE.FlatShading&&(b.shading=this.shading),this.blending!==THREE.NormalBlending&&(b.blending=this.blending),this.side!==THREE.FrontSide&&(b.side=this.side)):this instanceof THREE.MeshDepthMaterial?(this.blending!==THREE.NormalBlending&&(b.blending=this.blending),this.side!==THREE.FrontSide&&(b.side=this.side)):this instanceof THREE.ShaderMaterial?(b.uniforms=this.uniforms,b.vertexShader=this.vertexShader,b.fragmentShader=this.fragmentShader):this instanceof THREE.SpriteMaterial&&(b.color=this.color.getHex());
1>this.opacity&&(b.opacity=this.opacity);!1!==this.transparent&&(b.transparent=this.transparent);!1!==this.wireframe&&(b.wireframe=this.wireframe);return b},clone:function(b){void 0===b&&(b=new THREE.Material);b.name=this.name;b.side=this.side;b.opacity=this.opacity;b.transparent=this.transparent;b.blending=this.blending;b.blendSrc=this.blendSrc;b.blendDst=this.blendDst;b.blendEquation=this.blendEquation;b.depthTest=this.depthTest;b.depthWrite=this.depthWrite;b.polygonOffset=this.polygonOffset;b.polygonOffsetFactor=
this.polygonOffsetFactor;b.polygonOffsetUnits=this.polygonOffsetUnits;b.alphaTest=this.alphaTest;b.overdraw=this.overdraw;b.visible=this.visible;return b},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Material.prototype);THREE.MaterialIdCount=0;
THREE.LineBasicMaterial=function(b){THREE.Material.call(this);this.type="LineBasicMaterial";this.color=new THREE.Color(16777215);this.linewidth=1;this.linejoin=this.linecap="round";this.vertexColors=THREE.NoColors;this.fog=!0;this.setValues(b)};THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial;
THREE.LineBasicMaterial.prototype.clone=function(){var b=new THREE.LineBasicMaterial;THREE.Material.prototype.clone.call(this,b);b.color.copy(this.color);b.linewidth=this.linewidth;b.linecap=this.linecap;b.linejoin=this.linejoin;b.vertexColors=this.vertexColors;b.fog=this.fog;return b};
THREE.LineDashedMaterial=function(b){THREE.Material.call(this);this.type="LineDashedMaterial";this.color=new THREE.Color(16777215);this.scale=this.linewidth=1;this.dashSize=3;this.gapSize=1;this.vertexColors=!1;this.fog=!0;this.setValues(b)};THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineDashedMaterial.prototype.constructor=THREE.LineDashedMaterial;
THREE.LineDashedMaterial.prototype.clone=function(){var b=new THREE.LineDashedMaterial;THREE.Material.prototype.clone.call(this,b);b.color.copy(this.color);b.linewidth=this.linewidth;b.scale=this.scale;b.dashSize=this.dashSize;b.gapSize=this.gapSize;b.vertexColors=this.vertexColors;b.fog=this.fog;return b};
THREE.MeshBasicMaterial=function(b){THREE.Material.call(this);this.type="MeshBasicMaterial";this.color=new THREE.Color(16777215);this.envMap=this.alphaMap=this.specularMap=this.lightMap=this.map=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=!0;this.shading=THREE.SmoothShading;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.vertexColors=THREE.NoColors;this.morphTargets=this.skinning=!1;this.setValues(b)};
THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial;
THREE.MeshBasicMaterial.prototype.clone=function(){var b=new THREE.MeshBasicMaterial;THREE.Material.prototype.clone.call(this,b);b.color.copy(this.color);b.map=this.map;b.lightMap=this.lightMap;b.specularMap=this.specularMap;b.alphaMap=this.alphaMap;b.envMap=this.envMap;b.combine=this.combine;b.reflectivity=this.reflectivity;b.refractionRatio=this.refractionRatio;b.fog=this.fog;b.shading=this.shading;b.wireframe=this.wireframe;b.wireframeLinewidth=this.wireframeLinewidth;b.wireframeLinecap=this.wireframeLinecap;
b.wireframeLinejoin=this.wireframeLinejoin;b.vertexColors=this.vertexColors;b.skinning=this.skinning;b.morphTargets=this.morphTargets;return b};
THREE.MeshLambertMaterial=function(b){THREE.Material.call(this);this.type="MeshLambertMaterial";this.color=new THREE.Color(16777215);this.ambient=new THREE.Color(16777215);this.emissive=new THREE.Color(0);this.wrapAround=!1;this.wrapRGB=new THREE.Vector3(1,1,1);this.envMap=this.alphaMap=this.specularMap=this.lightMap=this.map=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=!0;this.shading=THREE.SmoothShading;this.wireframe=!1;this.wireframeLinewidth=
1;this.wireframeLinejoin=this.wireframeLinecap="round";this.vertexColors=THREE.NoColors;this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(b)};THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial;
THREE.MeshLambertMaterial.prototype.clone=function(){var b=new THREE.MeshLambertMaterial;THREE.Material.prototype.clone.call(this,b);b.color.copy(this.color);b.ambient.copy(this.ambient);b.emissive.copy(this.emissive);b.wrapAround=this.wrapAround;b.wrapRGB.copy(this.wrapRGB);b.map=this.map;b.lightMap=this.lightMap;b.specularMap=this.specularMap;b.alphaMap=this.alphaMap;b.envMap=this.envMap;b.combine=this.combine;b.reflectivity=this.reflectivity;b.refractionRatio=this.refractionRatio;b.fog=this.fog;
b.shading=this.shading;b.wireframe=this.wireframe;b.wireframeLinewidth=this.wireframeLinewidth;b.wireframeLinecap=this.wireframeLinecap;b.wireframeLinejoin=this.wireframeLinejoin;b.vertexColors=this.vertexColors;b.skinning=this.skinning;b.morphTargets=this.morphTargets;b.morphNormals=this.morphNormals;return b};
THREE.MeshPhongMaterial=function(b){THREE.Material.call(this);this.type="MeshPhongMaterial";this.color=new THREE.Color(16777215);this.ambient=new THREE.Color(16777215);this.emissive=new THREE.Color(0);this.specular=new THREE.Color(1118481);this.shininess=30;this.wrapAround=this.metal=!1;this.wrapRGB=new THREE.Vector3(1,1,1);this.bumpMap=this.lightMap=this.map=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new THREE.Vector2(1,1);this.envMap=this.alphaMap=this.specularMap=null;this.combine=
THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=!0;this.shading=THREE.SmoothShading;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.vertexColors=THREE.NoColors;this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(b)};THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial;
THREE.MeshPhongMaterial.prototype.clone=function(){var b=new THREE.MeshPhongMaterial;THREE.Material.prototype.clone.call(this,b);b.color.copy(this.color);b.ambient.copy(this.ambient);b.emissive.copy(this.emissive);b.specular.copy(this.specular);b.shininess=this.shininess;b.metal=this.metal;b.wrapAround=this.wrapAround;b.wrapRGB.copy(this.wrapRGB);b.map=this.map;b.lightMap=this.lightMap;b.bumpMap=this.bumpMap;b.bumpScale=this.bumpScale;b.normalMap=this.normalMap;b.normalScale.copy(this.normalScale);
b.specularMap=this.specularMap;b.alphaMap=this.alphaMap;b.envMap=this.envMap;b.combine=this.combine;b.reflectivity=this.reflectivity;b.refractionRatio=this.refractionRatio;b.fog=this.fog;b.shading=this.shading;b.wireframe=this.wireframe;b.wireframeLinewidth=this.wireframeLinewidth;b.wireframeLinecap=this.wireframeLinecap;b.wireframeLinejoin=this.wireframeLinejoin;b.vertexColors=this.vertexColors;b.skinning=this.skinning;b.morphTargets=this.morphTargets;b.morphNormals=this.morphNormals;return b};
THREE.MeshDepthMaterial=function(b){THREE.Material.call(this);this.type="MeshDepthMaterial";this.wireframe=this.morphTargets=!1;this.wireframeLinewidth=1;this.setValues(b)};THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial;
THREE.MeshDepthMaterial.prototype.clone=function(){var b=new THREE.MeshDepthMaterial;THREE.Material.prototype.clone.call(this,b);b.wireframe=this.wireframe;b.wireframeLinewidth=this.wireframeLinewidth;return b};THREE.MeshNormalMaterial=function(b){THREE.Material.call(this,b);this.type="MeshNormalMaterial";this.shading=THREE.FlatShading;this.wireframe=!1;this.wireframeLinewidth=1;this.morphTargets=!1;this.setValues(b)};THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype);
THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial;THREE.MeshNormalMaterial.prototype.clone=function(){var b=new THREE.MeshNormalMaterial;THREE.Material.prototype.clone.call(this,b);b.shading=this.shading;b.wireframe=this.wireframe;b.wireframeLinewidth=this.wireframeLinewidth;return b};THREE.MeshFaceMaterial=function(b){this.uuid=THREE.Math.generateUUID();this.type="MeshFaceMaterial";this.materials=b instanceof Array?b:[]};
THREE.MeshFaceMaterial.prototype={constructor:THREE.MeshFaceMaterial,toJSON:function(){for(var b={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},a=0,c=this.materials.length;a<c;a++)b.materials.push(this.materials[a].toJSON());return b},clone:function(){for(var b=new THREE.MeshFaceMaterial,a=0;a<this.materials.length;a++)b.materials.push(this.materials[a].clone());return b}};
THREE.PointCloudMaterial=function(b){THREE.Material.call(this);this.type="PointCloudMaterial";this.color=new THREE.Color(16777215);this.map=null;this.size=1;this.sizeAttenuation=!0;this.vertexColors=THREE.NoColors;this.fog=!0;this.setValues(b)};THREE.PointCloudMaterial.prototype=Object.create(THREE.Material.prototype);THREE.PointCloudMaterial.prototype.constructor=THREE.PointCloudMaterial;
THREE.PointCloudMaterial.prototype.clone=function(){var b=new THREE.PointCloudMaterial;THREE.Material.prototype.clone.call(this,b);b.color.copy(this.color);b.map=this.map;b.size=this.size;b.sizeAttenuation=this.sizeAttenuation;b.vertexColors=this.vertexColors;b.fog=this.fog;return b};THREE.ParticleBasicMaterial=function(b){console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointCloudMaterial.");return new THREE.PointCloudMaterial(b)};
THREE.ParticleSystemMaterial=function(b){console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointCloudMaterial.");return new THREE.PointCloudMaterial(b)};
THREE.ShaderMaterial=function(b){THREE.Material.call(this);this.type="ShaderMaterial";this.defines={};this.uniforms={};this.attributes=null;this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.shading=THREE.SmoothShading;this.linewidth=1;this.wireframe=!1;this.wireframeLinewidth=1;this.lights=this.fog=!1;this.vertexColors=THREE.NoColors;this.morphNormals=
this.morphTargets=this.skinning=!1;this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=void 0;this.setValues(b)};THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype);THREE.ShaderMaterial.prototype.constructor=THREE.ShaderMaterial;
THREE.ShaderMaterial.prototype.clone=function(){var b=new THREE.ShaderMaterial;THREE.Material.prototype.clone.call(this,b);b.fragmentShader=this.fragmentShader;b.vertexShader=this.vertexShader;b.uniforms=THREE.UniformsUtils.clone(this.uniforms);b.attributes=this.attributes;b.defines=this.defines;b.shading=this.shading;b.wireframe=this.wireframe;b.wireframeLinewidth=this.wireframeLinewidth;b.fog=this.fog;b.lights=this.lights;b.vertexColors=this.vertexColors;b.skinning=this.skinning;b.morphTargets=
this.morphTargets;b.morphNormals=this.morphNormals;return b};THREE.RawShaderMaterial=function(b){THREE.ShaderMaterial.call(this,b);this.type="RawShaderMaterial"};THREE.RawShaderMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype);THREE.RawShaderMaterial.prototype.constructor=THREE.RawShaderMaterial;THREE.RawShaderMaterial.prototype.clone=function(){var b=new THREE.RawShaderMaterial;THREE.ShaderMaterial.prototype.clone.call(this,b);return b};
THREE.SpriteMaterial=function(b){THREE.Material.call(this);this.type="SpriteMaterial";this.color=new THREE.Color(16777215);this.map=null;this.rotation=0;this.fog=!1;this.setValues(b)};THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteMaterial.prototype.constructor=THREE.SpriteMaterial;
THREE.SpriteMaterial.prototype.clone=function(){var b=new THREE.SpriteMaterial;THREE.Material.prototype.clone.call(this,b);b.color.copy(this.color);b.map=this.map;b.rotation=this.rotation;b.fog=this.fog;return b};
THREE.Texture=function(b,a,c,d,e,f,g,h,k){Object.defineProperty(this,"id",{value:THREE.TextureIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.image=void 0!==b?b:THREE.Texture.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=void 0!==a?a:THREE.Texture.DEFAULT_MAPPING;this.wrapS=void 0!==c?c:THREE.ClampToEdgeWrapping;this.wrapT=void 0!==d?d:THREE.ClampToEdgeWrapping;this.magFilter=void 0!==e?e:THREE.LinearFilter;this.minFilter=void 0!==f?f:THREE.LinearMipMapLinearFilter;this.anisotropy=
void 0!==k?k:1;this.format=void 0!==g?g:THREE.RGBAFormat;this.type=void 0!==h?h:THREE.UnsignedByteType;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this._needsUpdate=!1;this.onUpdate=null};THREE.Texture.DEFAULT_IMAGE=void 0;THREE.Texture.DEFAULT_MAPPING=THREE.UVMapping;
THREE.Texture.prototype={constructor:THREE.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(b){!0===b&&this.update();this._needsUpdate=b},clone:function(b){void 0===b&&(b=new THREE.Texture);b.image=this.image;b.mipmaps=this.mipmaps.slice(0);b.mapping=this.mapping;b.wrapS=this.wrapS;b.wrapT=this.wrapT;b.magFilter=this.magFilter;b.minFilter=this.minFilter;b.anisotropy=this.anisotropy;b.format=this.format;b.type=this.type;b.offset.copy(this.offset);b.repeat.copy(this.repeat);b.generateMipmaps=
this.generateMipmaps;b.premultiplyAlpha=this.premultiplyAlpha;b.flipY=this.flipY;b.unpackAlignment=this.unpackAlignment;return b},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Texture.prototype);THREE.TextureIdCount=0;THREE.CubeTexture=function(b,a,c,d,e,f,g,h,k){a=void 0!==a?a:THREE.CubeReflectionMapping;THREE.Texture.call(this,b,a,c,d,e,f,g,h,k);this.images=b};
THREE.CubeTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CubeTexture.prototype.constructor=THREE.CubeTexture;THREE.CubeTexture.clone=function(b){void 0===b&&(b=new THREE.CubeTexture);THREE.Texture.prototype.clone.call(this,b);b.images=this.images;return b};THREE.CompressedTexture=function(b,a,c,d,e,f,g,h,k,l,p){THREE.Texture.call(this,null,f,g,h,k,l,d,e,p);this.image={width:a,height:c};this.mipmaps=b;this.generateMipmaps=this.flipY=!1};THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype);
THREE.CompressedTexture.prototype.constructor=THREE.CompressedTexture;THREE.CompressedTexture.prototype.clone=function(){var b=new THREE.CompressedTexture;THREE.Texture.prototype.clone.call(this,b);return b};THREE.DataTexture=function(b,a,c,d,e,f,g,h,k,l,p){THREE.Texture.call(this,null,f,g,h,k,l,d,e,p);this.image={data:b,width:a,height:c}};THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype);THREE.DataTexture.prototype.constructor=THREE.DataTexture;
THREE.DataTexture.prototype.clone=function(){var b=new THREE.DataTexture;THREE.Texture.prototype.clone.call(this,b);return b};THREE.VideoTexture=function(b,a,c,d,e,f,g,h,k){THREE.Texture.call(this,b,a,c,d,e,f,g,h,k);this.generateMipmaps=!1;var l=this,p=function(){requestAnimationFrame(p);b.readyState===b.HAVE_ENOUGH_DATA&&(l.needsUpdate=!0)};p()};THREE.VideoTexture.prototype=Object.create(THREE.Texture.prototype);THREE.VideoTexture.prototype.constructor=THREE.VideoTexture;
THREE.Group=function(){THREE.Object3D.call(this);this.type="Group"};THREE.Group.prototype=Object.create(THREE.Object3D.prototype);THREE.Group.prototype.constructor=THREE.Group;THREE.PointCloud=function(b,a){THREE.Object3D.call(this);this.type="PointCloud";this.geometry=void 0!==b?b:new THREE.Geometry;this.material=void 0!==a?a:new THREE.PointCloudMaterial({color:16777215*Math.random()})};THREE.PointCloud.prototype=Object.create(THREE.Object3D.prototype);THREE.PointCloud.prototype.constructor=THREE.PointCloud;
THREE.PointCloud.prototype.raycast=function(){var b=new THREE.Matrix4,a=new THREE.Ray;return function(c,d){var e=this,f=e.geometry,g=c.params.PointCloud.threshold;b.getInverse(this.matrixWorld);a.copy(c.ray).applyMatrix4(b);if(null===f.boundingBox||!1!==a.isIntersectionBox(f.boundingBox)){var h=g/((this.scale.x+this.scale.y+this.scale.z)/3),k=new THREE.Vector3;g=function(b,f){var g=a.distanceToPoint(b);if(g<h){var k=a.closestPointToPoint(b);k.applyMatrix4(e.matrixWorld);var l=c.ray.origin.distanceTo(k);
d.push({distance:l,distanceToRay:g,point:k.clone(),index:f,face:null,object:e})}};if(f instanceof THREE.BufferGeometry){var l=f.attributes,p=l.position.array;if(void 0!==l.index){l=l.index.array;var q=f.offsets;0===q.length&&(q=[{start:0,count:l.length,index:0}]);for(var m=0,r=q.length;m<r;++m){var t=q[m].start,u=q[m].index;f=t;for(t+=q[m].count;f<t;f++){var v=u+l[f];k.fromArray(p,3*v);g(k,v)}}}else for(l=p.length/3,f=0;f<l;f++)k.set(p[3*f],p[3*f+1],p[3*f+2]),g(k,f)}else for(k=this.geometry.vertices,
f=0;f<k.length;f++)g(k[f],f)}}}();THREE.PointCloud.prototype.clone=function(b){void 0===b&&(b=new THREE.PointCloud(this.geometry,this.material));THREE.Object3D.prototype.clone.call(this,b);return b};THREE.ParticleSystem=function(b,a){console.warn("THREE.ParticleSystem has been renamed to THREE.PointCloud.");return new THREE.PointCloud(b,a)};
THREE.Line=function(b,a,c){THREE.Object3D.call(this);this.type="Line";this.geometry=void 0!==b?b:new THREE.Geometry;this.material=void 0!==a?a:new THREE.LineBasicMaterial({color:16777215*Math.random()});this.mode=void 0!==c?c:THREE.LineStrip};THREE.LineStrip=0;THREE.LinePieces=1;THREE.Line.prototype=Object.create(THREE.Object3D.prototype);THREE.Line.prototype.constructor=THREE.Line;
THREE.Line.prototype.raycast=function(){var b=new THREE.Matrix4,a=new THREE.Ray,c=new THREE.Sphere;return function(d,e){var f=d.linePrecision;f*=f;var g=this.geometry;null===g.boundingSphere&&g.computeBoundingSphere();c.copy(g.boundingSphere);c.applyMatrix4(this.matrixWorld);if(!1!==d.ray.isIntersectionSphere(c)){b.getInverse(this.matrixWorld);a.copy(d.ray).applyMatrix4(b);var h=new THREE.Vector3,k=new THREE.Vector3,l=new THREE.Vector3,p=new THREE.Vector3,q=this.mode===THREE.LineStrip?1:2;if(g instanceof
THREE.BufferGeometry){var m=g.attributes;if(void 0!==m.index){var r=m.index.array;m=m.position.array;var t=g.offsets;0===t.length&&(t=[{start:0,count:r.length,index:0}]);for(var u=0;u<t.length;u++){var v=t[u].start,w=t[u].count,x=t[u].index;for(g=v;g<v+w-1;g+=q){var C=x+r[g+1];h.fromArray(m,3*(x+r[g]));k.fromArray(m,3*C);C=a.distanceSqToSegment(h,k,p,l);C>f||(C=a.origin.distanceTo(p),C<d.near||C>d.far||e.push({distance:C,point:l.clone().applyMatrix4(this.matrixWorld),face:null,faceIndex:null,object:this}))}}}else for(m=
m.position.array,g=0;g<m.length/3-1;g+=q)h.fromArray(m,3*g),k.fromArray(m,3*g+3),C=a.distanceSqToSegment(h,k,p,l),C>f||(C=a.origin.distanceTo(p),C<d.near||C>d.far||e.push({distance:C,point:l.clone().applyMatrix4(this.matrixWorld),face:null,faceIndex:null,object:this}))}else if(g instanceof THREE.Geometry)for(h=g.vertices,k=h.length,g=0;g<k-1;g+=q)C=a.distanceSqToSegment(h[g],h[g+1],p,l),C>f||(C=a.origin.distanceTo(p),C<d.near||C>d.far||e.push({distance:C,point:l.clone().applyMatrix4(this.matrixWorld),
face:null,faceIndex:null,object:this}))}}}();THREE.Line.prototype.clone=function(b){void 0===b&&(b=new THREE.Line(this.geometry,this.material,this.mode));THREE.Object3D.prototype.clone.call(this,b);return b};THREE.Mesh=function(b,a){THREE.Object3D.call(this);this.type="Mesh";this.geometry=void 0!==b?b:new THREE.Geometry;this.material=void 0!==a?a:new THREE.MeshBasicMaterial({color:16777215*Math.random()});this.updateMorphTargets()};THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype);
THREE.Mesh.prototype.constructor=THREE.Mesh;THREE.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&0<this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var b=0,a=this.geometry.morphTargets.length;b<a;b++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[b].name]=b}};
THREE.Mesh.prototype.getMorphTargetIndexByName=function(b){if(void 0!==this.morphTargetDictionary[b])return this.morphTargetDictionary[b];console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+b+" does not exist. Returning 0.");return 0};
THREE.Mesh.prototype.raycast=function(){var b=new THREE.Matrix4,a=new THREE.Ray,c=new THREE.Sphere,d=new THREE.Vector3,e=new THREE.Vector3,f=new THREE.Vector3;return function(g,h){var k=this.geometry;null===k.boundingSphere&&k.computeBoundingSphere();c.copy(k.boundingSphere);c.applyMatrix4(this.matrixWorld);if(!1!==g.ray.isIntersectionSphere(c)&&(b.getInverse(this.matrixWorld),a.copy(g.ray).applyMatrix4(b),null===k.boundingBox||!1!==a.isIntersectionBox(k.boundingBox)))if(k instanceof THREE.BufferGeometry){var l=
this.material;if(void 0!==l){var p=k.attributes,q=g.precision;if(void 0!==p.index){var m=p.index.array,r=p.position.array,t=k.offsets;0===t.length&&(t=[{start:0,count:m.length,index:0}]);for(var u=0,v=t.length;u<v;++u){p=t[u].start;var w=t[u].index;k=p;for(var x=p+t[u].count;k<x;k+=3){p=w+m[k];var C=w+m[k+1];var y=w+m[k+2];d.fromArray(r,3*p);e.fromArray(r,3*C);f.fromArray(r,3*y);var R=l.side===THREE.BackSide?a.intersectTriangle(f,e,d,!0):a.intersectTriangle(d,e,f,l.side!==THREE.DoubleSide);if(null!==
R){R.applyMatrix4(this.matrixWorld);var P=g.ray.origin.distanceTo(R);P<q||P<g.near||P>g.far||h.push({distance:P,point:R,face:new THREE.Face3(p,C,y,THREE.Triangle.normal(d,e,f)),faceIndex:null,object:this})}}}}else for(r=p.position.array,m=k=0,x=r.length;k<x;k+=3,m+=9)p=k,C=k+1,y=k+2,d.fromArray(r,m),e.fromArray(r,m+3),f.fromArray(r,m+6),R=l.side===THREE.BackSide?a.intersectTriangle(f,e,d,!0):a.intersectTriangle(d,e,f,l.side!==THREE.DoubleSide),null!==R&&(R.applyMatrix4(this.matrixWorld),P=g.ray.origin.distanceTo(R),
P<q||P<g.near||P>g.far||h.push({distance:P,point:R,face:new THREE.Face3(p,C,y,THREE.Triangle.normal(d,e,f)),faceIndex:null,object:this}))}}else if(k instanceof THREE.Geometry)for(m=this.material instanceof THREE.MeshFaceMaterial,r=!0===m?this.material.materials:null,q=g.precision,t=k.vertices,u=0,v=k.faces.length;u<v;u++)if(w=k.faces[u],l=!0===m?r[w.materialIndex]:this.material,void 0!==l){p=t[w.a];C=t[w.b];y=t[w.c];if(!0===l.morphTargets){R=k.morphTargets;P=this.morphTargetInfluences;d.set(0,0,0);
e.set(0,0,0);f.set(0,0,0);x=0;for(var A=R.length;x<A;x++){var M=P[x];if(0!==M){var Q=R[x].vertices;d.x+=(Q[w.a].x-p.x)*M;d.y+=(Q[w.a].y-p.y)*M;d.z+=(Q[w.a].z-p.z)*M;e.x+=(Q[w.b].x-C.x)*M;e.y+=(Q[w.b].y-C.y)*M;e.z+=(Q[w.b].z-C.z)*M;f.x+=(Q[w.c].x-y.x)*M;f.y+=(Q[w.c].y-y.y)*M;f.z+=(Q[w.c].z-y.z)*M}}d.add(p);e.add(C);f.add(y);p=d;C=e;y=f}R=l.side===THREE.BackSide?a.intersectTriangle(y,C,p,!0):a.intersectTriangle(p,C,y,l.side!==THREE.DoubleSide);null!==R&&(R.applyMatrix4(this.matrixWorld),P=g.ray.origin.distanceTo(R),
P<q||P<g.near||P>g.far||h.push({distance:P,point:R,face:w,faceIndex:u,object:this}))}}}();THREE.Mesh.prototype.clone=function(b,a){void 0===b&&(b=new THREE.Mesh(this.geometry,this.material));THREE.Object3D.prototype.clone.call(this,b,a);return b};THREE.Bone=function(b){THREE.Object3D.call(this);this.skin=b};THREE.Bone.prototype=Object.create(THREE.Object3D.prototype);THREE.Bone.prototype.constructor=THREE.Bone;
THREE.Skeleton=function(b,a,c){this.useVertexTexture=void 0!==c?c:!0;this.identityMatrix=new THREE.Matrix4;b=b||[];this.bones=b.slice(0);this.useVertexTexture?(this.boneTextureHeight=this.boneTextureWidth=256<this.bones.length?64:64<this.bones.length?32:16<this.bones.length?16:8,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType),this.boneTexture.minFilter=
THREE.NearestFilter,this.boneTexture.magFilter=THREE.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1):this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===a)this.calculateInverses();else if(this.bones.length===a.length)this.boneInverses=a.slice(0);else for(console.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[],a=0,b=this.bones.length;a<b;a++)this.boneInverses.push(new THREE.Matrix4)};
THREE.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var b=0,a=this.bones.length;b<a;b++){var c=new THREE.Matrix4;this.bones[b]&&c.getInverse(this.bones[b].matrixWorld);this.boneInverses.push(c)}};
THREE.Skeleton.prototype.pose=function(){for(var b,a=0,c=this.bones.length;a<c;a++)(b=this.bones[a])&&b.matrixWorld.getInverse(this.boneInverses[a]);a=0;for(c=this.bones.length;a<c;a++)if(b=this.bones[a])b.parent?(b.matrix.getInverse(b.parent.matrixWorld),b.matrix.multiply(b.matrixWorld)):b.matrix.copy(b.matrixWorld),b.matrix.decompose(b.position,b.quaternion,b.scale)};
THREE.Skeleton.prototype.update=function(){var b=new THREE.Matrix4;return function(){for(var a=0,c=this.bones.length;a<c;a++)b.multiplyMatrices(this.bones[a]?this.bones[a].matrixWorld:this.identityMatrix,this.boneInverses[a]),b.flattenToArrayOffset(this.boneMatrices,16*a);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}();
THREE.SkinnedMesh=function(b,a,c){THREE.Mesh.call(this,b,a);this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new THREE.Matrix4;this.bindMatrixInverse=new THREE.Matrix4;b=[];if(this.geometry&&void 0!==this.geometry.bones){for(var d,e,f,g,h=0,k=this.geometry.bones.length;h<k;++h)d=this.geometry.bones[h],e=d.pos,f=d.rotq,g=d.scl,a=new THREE.Bone(this),b.push(a),a.name=d.name,a.position.set(e[0],e[1],e[2]),a.quaternion.set(f[0],f[1],f[2],f[3]),void 0!==g?a.scale.set(g[0],g[1],g[2]):a.scale.set(1,
1,1);h=0;for(k=this.geometry.bones.length;h<k;++h)d=this.geometry.bones[h],-1!==d.parent?b[d.parent].add(b[h]):this.add(b[h])}this.normalizeSkinWeights();this.updateMatrixWorld(!0);this.bind(new THREE.Skeleton(b,void 0,c))};THREE.SkinnedMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh;THREE.SkinnedMesh.prototype.bind=function(b,a){this.skeleton=b;void 0===a&&(this.updateMatrixWorld(!0),a=this.matrixWorld);this.bindMatrix.copy(a);this.bindMatrixInverse.getInverse(a)};
THREE.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()};THREE.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof THREE.Geometry)for(var b=0;b<this.geometry.skinIndices.length;b++){var a=this.geometry.skinWeights[b],c=1/a.lengthManhattan();Infinity!==c?a.multiplyScalar(c):a.set(1)}};
THREE.SkinnedMesh.prototype.updateMatrixWorld=function(b){THREE.Mesh.prototype.updateMatrixWorld.call(this,!0);"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unreckognized bindMode: "+this.bindMode)};
THREE.SkinnedMesh.prototype.clone=function(b){void 0===b&&(b=new THREE.SkinnedMesh(this.geometry,this.material,this.useVertexTexture));THREE.Mesh.prototype.clone.call(this,b);return b};THREE.MorphAnimMesh=function(b,a){THREE.Mesh.call(this,b,a);this.type="MorphAnimMesh";this.duration=1E3;this.mirroredLoop=!1;this.currentKeyframe=this.lastKeyframe=this.time=0;this.direction=1;this.directionBackwards=!1;this.setFrameRange(0,this.geometry.morphTargets.length-1)};THREE.MorphAnimMesh.prototype=Object.create(THREE.Mesh.prototype);
THREE.MorphAnimMesh.prototype.constructor=THREE.MorphAnimMesh;THREE.MorphAnimMesh.prototype.setFrameRange=function(b,a){this.startKeyframe=b;this.endKeyframe=a;this.length=this.endKeyframe-this.startKeyframe+1};THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1;this.directionBackwards=!1};THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1;this.directionBackwards=!0};
THREE.MorphAnimMesh.prototype.parseAnimations=function(){var b=this.geometry;b.animations||(b.animations={});for(var a,c=b.animations,d=/([a-z]+)_?(\d+)/,e=0,f=b.morphTargets.length;e<f;e++){var g=b.morphTargets[e].name.match(d);if(g&&1<g.length){g=g[1];c[g]||(c[g]={start:Infinity,end:-Infinity});var h=c[g];e<h.start&&(h.start=e);e>h.end&&(h.end=e);a||(a=g)}}b.firstAnimation=a};
THREE.MorphAnimMesh.prototype.setAnimationLabel=function(b,a,c){this.geometry.animations||(this.geometry.animations={});this.geometry.animations[b]={start:a,end:c}};THREE.MorphAnimMesh.prototype.playAnimation=function(b,a){var c=this.geometry.animations[b];c?(this.setFrameRange(c.start,c.end),this.duration=(c.end-c.start)/a*1E3,this.time=0):console.warn("animation["+b+"] undefined")};
THREE.MorphAnimMesh.prototype.updateAnimation=function(b){var a=this.duration/this.length;this.time+=this.direction*b;if(this.mirroredLoop){if(this.time>this.duration||0>this.time)this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),0>this.time&&(this.time=0,this.directionBackwards=!1)}else this.time%=this.duration,0>this.time&&(this.time+=this.duration);b=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/a),0,this.length-1);b!==this.currentKeyframe&&
(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[b]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=b);a=this.time%a/a;this.directionBackwards&&(a=1-a);this.morphTargetInfluences[this.currentKeyframe]=a;this.morphTargetInfluences[this.lastKeyframe]=1-a};
THREE.MorphAnimMesh.prototype.interpolateTargets=function(b,a,c){for(var d=this.morphTargetInfluences,e=0,f=d.length;e<f;e++)d[e]=0;-1<b&&(d[b]=1-c);-1<a&&(d[a]=c)};
THREE.MorphAnimMesh.prototype.clone=function(b){void 0===b&&(b=new THREE.MorphAnimMesh(this.geometry,this.material));b.duration=this.duration;b.mirroredLoop=this.mirroredLoop;b.time=this.time;b.lastKeyframe=this.lastKeyframe;b.currentKeyframe=this.currentKeyframe;b.direction=this.direction;b.directionBackwards=this.directionBackwards;THREE.Mesh.prototype.clone.call(this,b);return b};THREE.LOD=function(){THREE.Object3D.call(this);this.objects=[]};THREE.LOD.prototype=Object.create(THREE.Object3D.prototype);
THREE.LOD.prototype.constructor=THREE.LOD;THREE.LOD.prototype.addLevel=function(b,a){void 0===a&&(a=0);a=Math.abs(a);for(var c=0;c<this.objects.length&&!(a<this.objects[c].distance);c++);this.objects.splice(c,0,{distance:a,object:b});this.add(b)};THREE.LOD.prototype.getObjectForDistance=function(b){for(var a=1,c=this.objects.length;a<c&&!(b<this.objects[a].distance);a++);return this.objects[a-1].object};
THREE.LOD.prototype.raycast=function(){var b=new THREE.Vector3;return function(a,c){b.setFromMatrixPosition(this.matrixWorld);var d=a.ray.origin.distanceTo(b);this.getObjectForDistance(d).raycast(a,c)}}();
THREE.LOD.prototype.update=function(){var b=new THREE.Vector3,a=new THREE.Vector3;return function(c){if(1<this.objects.length){b.setFromMatrixPosition(c.matrixWorld);a.setFromMatrixPosition(this.matrixWorld);c=b.distanceTo(a);this.objects[0].object.visible=!0;for(var d=1,e=this.objects.length;d<e;d++)if(c>=this.objects[d].distance)this.objects[d-1].object.visible=!1,this.objects[d].object.visible=!0;else break;for(;d<e;d++)this.objects[d].object.visible=!1}}}();
THREE.LOD.prototype.clone=function(b){void 0===b&&(b=new THREE.LOD);THREE.Object3D.prototype.clone.call(this,b);for(var a=0,c=this.objects.length;a<c;a++){var d=this.objects[a].object.clone();d.visible=0===a;b.addLevel(d,this.objects[a].distance)}return b};
THREE.Sprite=function(){var b=new Uint16Array([0,1,2,0,2,3]),a=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),c=new Float32Array([0,0,1,0,1,1,0,1]),d=new THREE.BufferGeometry;d.addAttribute("index",new THREE.BufferAttribute(b,1));d.addAttribute("position",new THREE.BufferAttribute(a,3));d.addAttribute("uv",new THREE.BufferAttribute(c,2));return function(a){THREE.Object3D.call(this);this.type="Sprite";this.geometry=d;this.material=void 0!==a?a:new THREE.SpriteMaterial}}();
THREE.Sprite.prototype=Object.create(THREE.Object3D.prototype);THREE.Sprite.prototype.constructor=THREE.Sprite;THREE.Sprite.prototype.raycast=function(){var b=new THREE.Vector3;return function(a,c){b.setFromMatrixPosition(this.matrixWorld);var d=a.ray.distanceToPoint(b);d>this.scale.x||c.push({distance:d,point:this.position,face:null,object:this})}}();THREE.Sprite.prototype.clone=function(b){void 0===b&&(b=new THREE.Sprite(this.material));THREE.Object3D.prototype.clone.call(this,b);return b};
THREE.Particle=THREE.Sprite;THREE.LensFlare=function(b,a,c,d,e){THREE.Object3D.call(this);this.lensFlares=[];this.positionScreen=new THREE.Vector3;this.customUpdateCallback=void 0;void 0!==b&&this.add(b,a,c,d,e)};THREE.LensFlare.prototype=Object.create(THREE.Object3D.prototype);THREE.LensFlare.prototype.constructor=THREE.LensFlare;
THREE.LensFlare.prototype.add=function(b,a,c,d,e,f){void 0===a&&(a=-1);void 0===c&&(c=0);void 0===f&&(f=1);void 0===e&&(e=new THREE.Color(16777215));void 0===d&&(d=THREE.NormalBlending);c=Math.min(c,Math.max(0,c));this.lensFlares.push({texture:b,size:a,distance:c,x:0,y:0,z:0,scale:1,rotation:1,opacity:f,color:e,blending:d})};
THREE.LensFlare.prototype.updateLensFlares=function(){var b,a=this.lensFlares.length,c=2*-this.positionScreen.x,d=2*-this.positionScreen.y;for(b=0;b<a;b++){var e=this.lensFlares[b];e.x=this.positionScreen.x+c*e.distance;e.y=this.positionScreen.y+d*e.distance;e.wantedRotation=e.x*Math.PI*.25;e.rotation+=.25*(e.wantedRotation-e.rotation)}};THREE.Scene=function(){THREE.Object3D.call(this);this.type="Scene";this.overrideMaterial=this.fog=null;this.autoUpdate=!0};THREE.Scene.prototype=Object.create(THREE.Object3D.prototype);
THREE.Scene.prototype.constructor=THREE.Scene;THREE.Scene.prototype.clone=function(b){void 0===b&&(b=new THREE.Scene);THREE.Object3D.prototype.clone.call(this,b);null!==this.fog&&(b.fog=this.fog.clone());null!==this.overrideMaterial&&(b.overrideMaterial=this.overrideMaterial.clone());b.autoUpdate=this.autoUpdate;b.matrixAutoUpdate=this.matrixAutoUpdate;return b};THREE.Fog=function(b,a,c){this.name="";this.color=new THREE.Color(b);this.near=void 0!==a?a:1;this.far=void 0!==c?c:1E3};
THREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)};THREE.FogExp2=function(b,a){this.name="";this.color=new THREE.Color(b);this.density=void 0!==a?a:2.5E-4};THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)};THREE.ShaderChunk={};THREE.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\n\tif ( gl_FragColor.a < ALPHATEST ) discard;\n\n#endif\n";THREE.ShaderChunk.lights_lambert_vertex="vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n\tvLightBack = vec3( 0.0 );\n\n#endif\n\ntransformedNormal = normalize( transformedNormal );\n\n#if MAX_DIR_LIGHTS > 0\n\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\tvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n\tvec3 dirVector = normalize( lDirection.xyz );\n\n\tfloat dotProduct = dot( transformedNormal, dirVector );\n\tvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t#endif\n\n\t#endif\n\n\t#ifdef WRAP_AROUND\n\n\t\tvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\tdirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tdirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n\n\t\t#endif\n\n\t#endif\n\n\tvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n\n\t#endif\n\n}\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n\t\tfloat lDistance = 1.0;\n\t\tif ( pointLightDistance[ i ] > 0.0 )\n\t\t\tlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n\n\t\tlVector = normalize( lVector );\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\n\t\tvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t\tpointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tpointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t\tvLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;\n\n\t\t#endif\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n\t\t\tfloat lDistance = 1.0;\n\t\t\tif ( spotLightDistance[ i ] > 0.0 )\n\t\t\t\tlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n\n\t\t\tlVector = normalize( lVector );\n\n\t\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\t\t\tvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\t\tvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t\t\tspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n\n\t\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\t\tspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\tvLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tvLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;\n\n\t\t\t#endif\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n\t\tvec3 lVector = normalize( lDirection.xyz );\n\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\t\tfloat hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\n\n\t\tvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n\t\t#endif\n\n\t}\n\n#endif\n\nvLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;\n\n#ifdef DOUBLE_SIDED\n\n\tvLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;\n\n#endif";
THREE.ShaderChunk.map_particle_pars_fragment="#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif";THREE.ShaderChunk.default_vertex="#ifdef USE_SKINNING\n\n\tvec4 mvPosition = modelViewMatrix * skinned;\n\n#elif defined( USE_MORPHTARGETS )\n\n\tvec4 mvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n\n#else\n\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;\n";THREE.ShaderChunk.map_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvarying vec2 vUv;\n\n#endif\n\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif";
THREE.ShaderChunk.skinnormal_vertex="#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\t#ifdef USE_MORPHNORMALS\n\n\tvec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n\n\t#else\n\n\tvec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n\n\t#endif\n\n#endif\n";
THREE.ShaderChunk.logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n\tuniform float logDepthBufFC;\n\n#endif";THREE.ShaderChunk.lightmap_pars_vertex="#ifdef USE_LIGHTMAP\n\n\tvarying vec2 vUv2;\n\n#endif";THREE.ShaderChunk.lights_phong_fragment="vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n\n#ifdef DOUBLE_SIDED\n\n\tnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n#endif\n\n#ifdef USE_NORMALMAP\n\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tvec3 pointDiffuse = vec3( 0.0 );\n\tvec3 pointSpecular = vec3( 0.0 );\n\n\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n\t\tfloat lDistance = 1.0;\n\t\tif ( pointLightDistance[ i ] > 0.0 )\n\t\t\tlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n\n\t\tlVector = normalize( lVector );\n\n\t\t\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, lVector );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\tfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\tvec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n\n\t\t#else\n\n\t\t\tfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t#endif\n\n\t\tpointDiffuse += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\n\n\t\t\t\t// specular\n\n\t\tvec3 pointHalfVector = normalize( lVector + viewPosition );\n\t\tfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n\t\tfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\n\t\tpointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tvec3 spotDiffuse = vec3( 0.0 );\n\tvec3 spotSpecular = vec3( 0.0 );\n\n\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n\t\tfloat lDistance = 1.0;\n\t\tif ( spotLightDistance[ i ] > 0.0 )\n\t\t\tlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n\n\t\tlVector = normalize( lVector );\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n\t\t\t\t\t// diffuse\n\n\t\t\tfloat dotProduct = dot( normal, lVector );\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\t\tfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\t\tvec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n\n\t\t\t#else\n\n\t\t\t\tfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t\t#endif\n\n\t\t\tspotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\n\n\t\t\t\t\t// specular\n\n\t\t\tvec3 spotHalfVector = normalize( lVector + viewPosition );\n\t\t\tfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n\t\t\tfloat spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n\n\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\n\t\t\tspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n\tvec3 dirDiffuse = vec3( 0.0 );\n\tvec3 dirSpecular = vec3( 0.0 );\n\n\tfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\t\tvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n\t\tvec3 dirVector = normalize( lDirection.xyz );\n\n\t\t\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, dirVector );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\tfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\tvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n\n\t\t#else\n\n\t\t\tfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t#endif\n\n\t\tdirDiffuse += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\n\n\t\t// specular\n\n\t\tvec3 dirHalfVector = normalize( dirVector + viewPosition );\n\t\tfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n\t\tfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n\n\t\t/*\n\t\t// fresnel term from skin shader\n\t\tconst float F0 = 0.128;\n\n\t\tfloat base = 1.0 - dot( viewPosition, dirHalfVector );\n\t\tfloat exponential = pow( base, 5.0 );\n\n\t\tfloat fresnel = exponential + F0 * ( 1.0 - exponential );\n\t\t*/\n\n\t\t/*\n\t\t// fresnel term from fresnel shader\n\t\tconst float mFresnelBias = 0.08;\n\t\tconst float mFresnelScale = 0.3;\n\t\tconst float mFresnelPower = 5.0;\n\n\t\tfloat fresnel = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( -viewPosition ), normal ), mFresnelPower );\n\t\t*/\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t// \t\tdirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization * fresnel;\n\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n\t\tdirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n\n\n\t}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tvec3 hemiDiffuse = vec3( 0.0 );\n\tvec3 hemiSpecular = vec3( 0.0 );\n\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n\t\tvec3 lVector = normalize( lDirection.xyz );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, lVector );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n\t\tvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\themiDiffuse += diffuse * hemiColor;\n\n\t\t// specular (sky light)\n\n\t\tvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n\t\tfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n\t\tfloat hemiSpecularWeightSky = specularStrength * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );\n\n\t\t// specular (ground light)\n\n\t\tvec3 lVectorGround = -lVector;\n\n\t\tvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n\t\tfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n\t\tfloat hemiSpecularWeightGround = specularStrength * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );\n\n\t\tfloat dotProductGround = dot( normal, lVectorGround );\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\tvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\n\t\tvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\n\t\themiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n\n\t}\n\n#endif\n\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n\n#if MAX_DIR_LIGHTS > 0\n\n\ttotalDiffuse += dirDiffuse;\n\ttotalSpecular += dirSpecular;\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\ttotalDiffuse += hemiDiffuse;\n\ttotalSpecular += hemiSpecular;\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\ttotalDiffuse += pointDiffuse;\n\ttotalSpecular += pointSpecular;\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\ttotalDiffuse += spotDiffuse;\n\ttotalSpecular += spotSpecular;\n\n#endif\n\n#ifdef METAL\n\n\tgl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n\n#else\n\n\tgl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n\n#endif";
THREE.ShaderChunk.fog_pars_fragment="#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n\n#endif";THREE.ShaderChunk.morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\n\tvec3 morphedNormal = vec3( 0.0 );\n\n\tmorphedNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tmorphedNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tmorphedNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tmorphedNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n\tmorphedNormal += normal;\n\n#endif";
THREE.ShaderChunk.envmap_pars_fragment="#ifdef USE_ENVMAP\n\n\tuniform float reflectivity;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tuniform float refractionRatio;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\n\t#endif\n\n#endif\n";THREE.ShaderChunk.logdepthbuf_fragment="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif";
THREE.ShaderChunk.normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n\t\t\t// Per-Pixel Tangent Space Normal Mapping\n\t\t\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\n\t}\n\n#endif\n";
THREE.ShaderChunk.lights_phong_pars_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n";THREE.ShaderChunk.lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\n\tvarying vec2 vUv2;\n\tuniform sampler2D lightMap;\n\n#endif";THREE.ShaderChunk.shadowmap_vertex="#ifdef USE_SHADOWMAP\n\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\tvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n\t}\n\n#endif";
THREE.ShaderChunk.lights_phong_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvWorldPosition = worldPosition.xyz;\n\n#endif";THREE.ShaderChunk.map_fragment="#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\t#ifdef GAMMA_INPUT\n\n\t\ttexelColor.xyz *= texelColor.xyz;\n\n\t#endif\n\n\tgl_FragColor = gl_FragColor * texelColor;\n\n#endif";THREE.ShaderChunk.lightmap_vertex="#ifdef USE_LIGHTMAP\n\n\tvUv2 = uv2;\n\n#endif";
THREE.ShaderChunk.map_particle_fragment="#ifdef USE_MAP\n\n\tgl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );\n\n#endif";THREE.ShaderChunk.color_pars_fragment="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n";THREE.ShaderChunk.color_vertex="#ifdef USE_COLOR\n\n\t#ifdef GAMMA_INPUT\n\n\t\tvColor = color * color;\n\n\t#else\n\n\t\tvColor = color;\n\n\t#endif\n\n#endif";THREE.ShaderChunk.skinning_vertex="#ifdef USE_SKINNING\n\n\t#ifdef USE_MORPHTARGETS\n\n\tvec4 skinVertex = bindMatrix * vec4( morphed, 1.0 );\n\n\t#else\n\n\tvec4 skinVertex = bindMatrix * vec4( position, 1.0 );\n\n\t#endif\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n\n#endif\n";
THREE.ShaderChunk.envmap_pars_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvarying vec3 vReflect;\n\n\tuniform float refractionRatio;\n\n#endif\n";THREE.ShaderChunk.linear_to_gamma_fragment="#ifdef GAMMA_OUTPUT\n\n\tgl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n\n#endif";THREE.ShaderChunk.color_pars_vertex="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif";THREE.ShaderChunk.lights_lambert_pars_vertex="uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 emissive;\n\nuniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#ifdef WRAP_AROUND\n\n\tuniform vec3 wrapRGB;\n\n#endif\n";
THREE.ShaderChunk.map_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n\n#endif\n";THREE.ShaderChunk.envmap_fragment="#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n\t\t// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\n\t\t// Transforming Normal Vectors with the Inverse Transformation\n\n\t\tvec3 worldNormal = normalize( vec3( vec4( normal, 0.0 ) * viewMatrix ) );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#else\n\n\t\tvec3 reflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef DOUBLE_SIDED\n\t\tfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\t#else\n\t\tfloat flipNormal = 1.0;\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = clamp( flipNormal * reflectVec.y * 0.5 + 0.5, 0.0, 1.0);\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * 0.15915494309189533576888376337251 + 0.5; // reciprocal( 2 PI ) + 0.5\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t\t\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#endif\n\n\t#ifdef GAMMA_INPUT\n\n\t\tenvColor.xyz *= envColor.xyz;\n\n\t#endif\n\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\n\t\tgl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\n\t\tgl_FragColor.xyz = mix( gl_FragColor.xyz, envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\n\t\tgl_FragColor.xyz += envColor.xyz * specularStrength * reflectivity;\n\n\t#endif\n\n#endif\n";
THREE.ShaderChunk.specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif";THREE.ShaderChunk.logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\n\tgl_Position.z = log2(max(1e-6, gl_Position.w + 1.0)) * logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n\t#endif\n\n#endif";THREE.ShaderChunk.morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\n\t#ifndef USE_MORPHNORMALS\n\n\tuniform float morphTargetInfluences[ 8 ];\n\n\t#else\n\n\tuniform float morphTargetInfluences[ 4 ];\n\n\t#endif\n\n#endif";
THREE.ShaderChunk.specularmap_fragment="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif";THREE.ShaderChunk.fog_fragment="#ifdef USE_FOG\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n\t#else\n\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\n\t#endif\n\n\t#ifdef FOG_EXP2\n\n\t\tconst float LOG2 = 1.442695;\n\t\tfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\n\t\tfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\n\t#endif\n\t\n\tgl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n\n#endif";
THREE.ShaderChunk.bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\n\t\t\t// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\n\t\t\t//\thttp://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\n\n\t\t\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n\tvec2 dHdxy_fwd() {\n\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n\t\treturn vec2( dBx, dBy );\n\n\t}\n\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\t\t// normalized\n\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t}\n\n#endif";
THREE.ShaderChunk.defaultnormal_vertex="#ifdef USE_SKINNING\n\n\tvec3 objectNormal = skinnedNormal.xyz;\n\n#elif defined( USE_MORPHNORMALS )\n\n\tvec3 objectNormal = morphedNormal;\n\n#else\n\n\tvec3 objectNormal = normal;\n\n#endif\n\n#ifdef FLIP_SIDED\n\n\tobjectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;\n";THREE.ShaderChunk.lights_phong_pars_fragment="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n\n#ifdef WRAP_AROUND\n\n\tuniform vec3 wrapRGB;\n\n#endif\n\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;";
THREE.ShaderChunk.skinbase_vertex="#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif";THREE.ShaderChunk.map_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif";
THREE.ShaderChunk.lightmap_fragment="#ifdef USE_LIGHTMAP\n\n\tgl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n\n#endif";THREE.ShaderChunk.shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\tuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n\n#endif";THREE.ShaderChunk.color_fragment="#ifdef USE_COLOR\n\n\tgl_FragColor = gl_FragColor * vec4( vColor, 1.0 );\n\n#endif";THREE.ShaderChunk.morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\n\tvec3 morphed = vec3( 0.0 );\n\tmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\tmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\tmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\tmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n\t#ifndef USE_MORPHNORMALS\n\n\tmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\tmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\tmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\tmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n\t#endif\n\n\tmorphed += position;\n\n#endif";
THREE.ShaderChunk.envmap_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;\n\tworldNormal = normalize( worldNormal );\n\n\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t#else\n\n\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t#endif\n\n#endif\n";
THREE.ShaderChunk.shadowmap_fragment="#ifdef USE_SHADOWMAP\n\n\t#ifdef SHADOWMAP_DEBUG\n\n\t\tvec3 frustumColors[3];\n\t\tfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\n\t\tfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\n\t\tfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n\n\t#endif\n\n\t#ifdef SHADOWMAP_CASCADE\n\n\t\tint inFrustumCount = 0;\n\n\t#endif\n\n\tfloat fDepth;\n\tvec3 shadowColor = vec3( 1.0 );\n\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\tvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\n\t\t\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\n\t\t\t\t// if ( all( something, something ) ) using this instead\n\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\n\t\t\t\t// don't shadow pixels outside of light frustum\n\t\t\t\t// use just first frustum (for cascades)\n\t\t\t\t// don't shadow pixels behind far plane of light frustum\n\n\t\t#ifdef SHADOWMAP_CASCADE\n\n\t\t\tinFrustumCount += int( inFrustum );\n\t\t\tbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n\n\t\t#else\n\n\t\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n\t\t#endif\n\n\t\tbool frustumTest = all( frustumTestVec );\n\n\t\tif ( frustumTest ) {\n\n\t\t\tshadowCoord.z += shadowBias[ i ];\n\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\n\t\t\t\t\t\t// Percentage-close filtering\n\t\t\t\t\t\t// (9 pixel kernel)\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\n\n\t\t\t\tfloat shadow = 0.0;\n\n\t\t/*\n\t\t\t\t\t\t// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\n\t\t\t\t\t\t// must enroll loop manually\n\n\t\t\t\tfor ( float y = -1.25; y <= 1.25; y += 1.25 )\n\t\t\t\t\tfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n\n\t\t\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n\n\t\t\t\t\t\t\t\t// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\n\t\t\t\t\t\t\t\t//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\n\n\t\t\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\n\t\t\t\t\t\tif ( fDepth < shadowCoord.z )\n\t\t\t\t\t\t\tshadow += 1.0;\n\n\t\t\t\t}\n\n\t\t\t\tshadow /= 9.0;\n\n\t\t*/\n\n\t\t\t\tconst float shadowDelta = 1.0 / 9.0;\n\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n\t\t\t\tfloat dx0 = -1.25 * xPixelOffset;\n\t\t\t\tfloat dy0 = -1.25 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.25 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.25 * yPixelOffset;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n\t\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\t\t\t\t// Percentage-close filtering\n\t\t\t\t\t\t// (9 pixel kernel)\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\n\n\t\t\t\tfloat shadow = 0.0;\n\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n\t\t\t\tfloat dx0 = -1.0 * xPixelOffset;\n\t\t\t\tfloat dy0 = -1.0 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.0 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.0 * yPixelOffset;\n\n\t\t\t\tmat3 shadowKernel;\n\t\t\t\tmat3 depthKernel;\n\n\t\t\t\tdepthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tdepthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tdepthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tdepthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tdepthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tdepthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tdepthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tdepthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tdepthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n\t\t\t\tvec3 shadowZ = vec3( shadowCoord.z );\n\t\t\t\tshadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\n\t\t\t\tshadowKernel[0] *= vec3(0.25);\n\n\t\t\t\tshadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\n\t\t\t\tshadowKernel[1] *= vec3(0.25);\n\n\t\t\t\tshadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\n\t\t\t\tshadowKernel[2] *= vec3(0.25);\n\n\t\t\t\tvec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\n\n\t\t\t\tshadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\n\t\t\t\tshadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\n\n\t\t\t\tvec4 shadowValues;\n\t\t\t\tshadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\n\t\t\t\tshadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\n\t\t\t\tshadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\n\t\t\t\tshadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\n\n\t\t\t\tshadow = dot( shadowValues, vec4( 1.0 ) );\n\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n\t\t\t#else\n\n\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\n\t\t\t\tif ( fDepth < shadowCoord.z )\n\n\t\t// spot with multiple shadows is darker\n\n\t\t\t\t\tshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n\n\t\t// spot with multiple shadows has the same color as single shadow spot\n\n\t\t// \t\t\t\t\tshadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\n\n\t\t\t#endif\n\n\t\t}\n\n\n\t\t#ifdef SHADOWMAP_DEBUG\n\n\t\t\t#ifdef SHADOWMAP_CASCADE\n\n\t\t\t\tif ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n\n\t\t\t#else\n\n\t\t\t\tif ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t}\n\n\t#ifdef GAMMA_OUTPUT\n\n\t\tshadowColor *= shadowColor;\n\n\t#endif\n\n\tgl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n\n#endif\n";
THREE.ShaderChunk.worldpos_vertex="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n\t#ifdef USE_SKINNING\n\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\n\t#elif defined( USE_MORPHTARGETS )\n\n\t\tvec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n\n\t#else\n\n\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\n\t#endif\n\n#endif\n";THREE.ShaderChunk.shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\n\tuniform sampler2D shadowMap[ MAX_SHADOWS ];\n\tuniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n\tuniform float shadowDarkness[ MAX_SHADOWS ];\n\tuniform float shadowBias[ MAX_SHADOWS ];\n\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n\tfloat unpackDepth( const in vec4 rgba_depth ) {\n\n\t\tconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n\t\tfloat depth = dot( rgba_depth, bit_shift );\n\t\treturn depth;\n\n\t}\n\n#endif";
THREE.ShaderChunk.skinning_pars_vertex="#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\n\t#ifdef BONE_TEXTURE\n\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\t\treturn bone;\n\n\t\t}\n\n\t#else\n\n\t\tuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tmat4 bone = boneGlobalMatrices[ int(i) ];\n\t\t\treturn bone;\n\n\t\t}\n\n\t#endif\n\n#endif\n";
THREE.ShaderChunk.logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\n\tuniform float logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\t#extension GL_EXT_frag_depth : enable\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n#endif";THREE.ShaderChunk.alphamap_fragment="#ifdef USE_ALPHAMAP\n\n\tgl_FragColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n";THREE.ShaderChunk.alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n";
THREE.UniformsUtils={merge:function(b){for(var a={},c=0;c<b.length;c++){var d=this.clone(b[c]),e;for(e in d)a[e]=d[e]}return a},clone:function(b){var a={},c;for(c in b){a[c]={};for(var d in b[c]){var e=b[c][d];a[c][d]=e instanceof THREE.Color||e instanceof THREE.Vector2||e instanceof THREE.Vector3||e instanceof THREE.Vector4||e instanceof THREE.Matrix4||e instanceof THREE.Texture?e.clone():e instanceof Array?e.slice():e}}return a}};
THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",
value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new THREE.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:2.5E-4},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",
value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},
map:{type:"t",value:null},fogDensity:{type:"f",value:2.5E-4},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}};
THREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap]),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,
THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinbase_vertex,"\t#ifdef USE_ENVMAP",THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"\t#endif",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n\tgl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,
THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,
{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,
THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,
THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,
THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n\tgl_FragColor = vec4( vec3( 1.0 ), opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,"\t#ifdef DOUBLE_SIDED\n\t\tif ( gl_FrontFacing )\n\t\t\tgl_FragColor.xyz *= vLightFront;\n\t\telse\n\t\t\tgl_FragColor.xyz *= vLightBack;\n\t#else\n\t\tgl_FragColor.xyz *= vLightFront;\n\t#endif",
THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.bump,THREE.UniformsLib.normalmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},
specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define PHONG\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,
THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"\tvNormal = normalize( transformedNormal );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"\tvViewPosition = -mvPosition.xyz;",
THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["#define PHONG\nuniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,
THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.bumpmap_pars_fragment,THREE.ShaderChunk.normalmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n\tgl_FragColor = vec4( vec3( 1.0 ), opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,
THREE.ShaderChunk.lights_phong_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.particle,THREE.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,
THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\tgl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",
THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n\tgl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,
THREE.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,
"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tgl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.fog_fragment,
"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2E3},opacity:{type:"f",value:1}},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float mNear;\nuniform float mFar;\nuniform float opacity;",THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",THREE.ShaderChunk.logdepthbuf_fragment,
"\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\t#else\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\t#endif\n\tfloat color = 1.0 - smoothstep( mNear, mFar, depth );\n\tgl_FragColor = vec4( vec3( color ), opacity );\n}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {\n\tvNormal = normalize( normalMatrix * normal );",
THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vNormal;",THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n\tgl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",THREE.ShaderChunk.logdepthbuf_pars_vertex,
"void main() {\n\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\tvWorldPosition = worldPosition.xyz;\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vWorldPosition;",THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",THREE.ShaderChunk.logdepthbuf_fragment,
"}"].join("\n")},equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {\n\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\tvWorldPosition = worldPosition.xyz;\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;\nuniform float tFlip;\nvarying vec3 vWorldPosition;",
THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\nvec3 direction = normalize( vWorldPosition );\nvec2 sampleUV;\nsampleUV.y = clamp( tFlip * direction.y * -0.5 + 0.5, 0.0, 1.0);\nsampleUV.x = atan( direction.z, direction.x ) * 0.15915494309189533576888376337251 + 0.5;\ngl_FragColor = texture2D( tEquirect, sampleUV );",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,
THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[THREE.ShaderChunk.logdepthbuf_pars_fragment,"vec4 pack_depth( const in float depth ) {\n\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\n\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\n\tvec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );\n\tres -= res.xxyz * bit_mask;\n\treturn res;\n}\nvoid main() {",
THREE.ShaderChunk.logdepthbuf_fragment,"\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tgl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );\n\t#else\n\t\tgl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n\t#endif\n}"].join("\n")}};
THREE.WebGLRenderer=function(b){function a(a){var b=a.geometry;a=a.material;var c=b.vertices.length;if(a.attributes){void 0===b.__webglCustomAttributesList&&(b.__webglCustomAttributesList=[]);for(var d in a.attributes){var e=a.attributes[d];if(!e.__webglInitialized||e.createUniqueBuffers){e.__webglInitialized=!0;var f=1;"v2"===e.type?f=2:"v3"===e.type?f=3:"v4"===e.type?f=4:"c"===e.type&&(f=3);e.size=f;e.array=new Float32Array(c*f);e.buffer=n.createBuffer();e.buffer.belongsToAttribute=d;e.needsUpdate=
!0}b.__webglCustomAttributesList.push(e)}}}function c(a,b){var c=b.geometry,e=a.faces3,f=3*e.length,g=1*e.length,h=3*e.length;e=d(b,a);a.__vertexArray=new Float32Array(3*f);a.__normalArray=new Float32Array(3*f);a.__colorArray=new Float32Array(3*f);a.__uvArray=new Float32Array(2*f);1<c.faceVertexUvs.length&&(a.__uv2Array=new Float32Array(2*f));c.hasTangents&&(a.__tangentArray=new Float32Array(4*f));b.geometry.skinWeights.length&&b.geometry.skinIndices.length&&(a.__skinIndexArray=new Float32Array(4*
f),a.__skinWeightArray=new Float32Array(4*f));c=null!==ea.get("OES_element_index_uint")&&21845<g?Uint32Array:Uint16Array;a.__typeArray=c;a.__faceArray=new c(3*g);a.__lineArray=new c(2*h);var k=a.numMorphTargets;if(k)for(a.__morphTargetsArrays=[],c=0;c<k;c++)a.__morphTargetsArrays.push(new Float32Array(3*f));if(k=a.numMorphNormals)for(a.__morphNormalsArrays=[],c=0;c<k;c++)a.__morphNormalsArrays.push(new Float32Array(3*f));a.__webglFaceCount=3*g;a.__webglLineCount=2*h;if(e.attributes){void 0===a.__webglCustomAttributesList&&
(a.__webglCustomAttributesList=[]);for(var l in e.attributes){g=e.attributes[l];h={};for(var m in g)h[m]=g[m];if(!h.__webglInitialized||h.createUniqueBuffers)h.__webglInitialized=!0,c=1,"v2"===h.type?c=2:"v3"===h.type?c=3:"v4"===h.type?c=4:"c"===h.type&&(c=3),h.size=c,h.array=new Float32Array(f*c),h.buffer=n.createBuffer(),h.buffer.belongsToAttribute=l,g.needsUpdate=!0,h.__original=g;a.__webglCustomAttributesList.push(h)}}a.__inittedArrays=!0}function d(a,b){return a.material instanceof THREE.MeshFaceMaterial?
a.material.materials[b.materialIndex]:a.material}function e(a,b,c,d){c=c.attributes;var e=b.attributes;b=b.attributesKeys;for(var f=0,k=b.length;f<k;f++){var l=b[f],m=e[l];if(0<=m){var p=c[l];void 0!==p?(l=p.itemSize,n.bindBuffer(n.ARRAY_BUFFER,p.buffer),g(m),n.vertexAttribPointer(m,l,n.FLOAT,!1,0,d*l*4)):void 0!==a.defaultAttributeValues&&(2===a.defaultAttributeValues[l].length?n.vertexAttrib2fv(m,a.defaultAttributeValues[l]):3===a.defaultAttributeValues[l].length&&n.vertexAttrib3fv(m,a.defaultAttributeValues[l]))}}h()}
function f(){for(var a=0,b=Db.length;a<b;a++)Db[a]=0}function g(a){Db[a]=1;0===Ya[a]&&(n.enableVertexAttribArray(a),Ya[a]=1)}function h(){for(var a=0,b=Ya.length;a<b;a++)Ya[a]!==Db[a]&&(n.disableVertexAttribArray(a),Ya[a]=0)}function k(a,b){return a.material.id!==b.material.id?a.material.id-b.material.id:a.z!==b.z?a.z-b.z:a.id-b.id}function l(a,b){return a.z!==b.z?b.z-a.z:a.id-b.id}function p(a,b){return b[0]-a[0]}function q(b){if(!1!==b.visible){if(!(b instanceof THREE.Scene||b instanceof THREE.Group)){void 0===
b.__webglInit&&(b.__webglInit=!0,b._modelViewMatrix=new THREE.Matrix4,b._normalMatrix=new THREE.Matrix3,b.addEventListener("removed",gc));var c=b.geometry;if(void 0!==c&&void 0===c.__webglInit)if(c.__webglInit=!0,c.addEventListener("dispose",hc),c instanceof THREE.BufferGeometry)F.info.memory.geometries++;else if(b instanceof THREE.Mesh)u(b,c);else if(b instanceof THREE.Line){if(void 0===c.__webglVertexBuffer){c.__webglVertexBuffer=n.createBuffer();c.__webglColorBuffer=n.createBuffer();c.__webglLineDistanceBuffer=
n.createBuffer();F.info.memory.geometries++;var d=c.vertices.length;c.__vertexArray=new Float32Array(3*d);c.__colorArray=new Float32Array(3*d);c.__lineDistanceArray=new Float32Array(1*d);c.__webglLineCount=d;a(b);c.verticesNeedUpdate=!0;c.colorsNeedUpdate=!0;c.lineDistancesNeedUpdate=!0}}else b instanceof THREE.PointCloud&&void 0===c.__webglVertexBuffer&&(c.__webglVertexBuffer=n.createBuffer(),c.__webglColorBuffer=n.createBuffer(),F.info.memory.geometries++,d=c.vertices.length,c.__vertexArray=new Float32Array(3*
d),c.__colorArray=new Float32Array(3*d),c.__sortArray=[],c.__webglParticleCount=d,a(b),c.verticesNeedUpdate=!0,c.colorsNeedUpdate=!0);if(void 0===b.__webglActive)if(b.__webglActive=!0,b instanceof THREE.Mesh)if(c instanceof THREE.BufferGeometry)v(Ja,c,b);else{if(c instanceof THREE.Geometry){c=vb[c.id];d=0;for(var e=c.length;d<e;d++)v(Ja,c[d],b)}}else b instanceof THREE.Line||b instanceof THREE.PointCloud?v(Ja,c,b):(b instanceof THREE.ImmediateRenderObject||b.immediateRenderCallback)&&Ka.push({id:null,
object:b,opaque:null,transparent:null,z:0});if(b instanceof THREE.Light)Fa.push(b);else if(b instanceof THREE.Sprite)wb.push(b);else if(b instanceof THREE.LensFlare)eb.push(b);else if((c=Ja[b.id])&&(!1===b.frustumCulled||!0===fb.intersectsObject(b)))for(d=0,e=c.length;d<e;d++){var f=c[d],g=f,h=g.object,k=g.buffer,l=h.geometry;h=h.material;h instanceof THREE.MeshFaceMaterial?(h=h.materials[l instanceof THREE.BufferGeometry?0:k.materialIndex],g.material=h,h.transparent?La.push(g):Na.push(g)):h&&(g.material=
h,h.transparent?La.push(g):Na.push(g));f.render=!0;!0===F.sortObjects&&(Ga.setFromMatrixPosition(b.matrixWorld),Ga.applyProjection(jb),f.z=Ga.z)}}d=0;for(e=b.children.length;d<e;d++)q(b.children[d])}}function m(a,b,c,d,e,f){for(var g,h=0,k=a.length;h<k;h++){g=a[h];var l=g.object,m=g.buffer;A(l,b);if(f)g=f;else{g=g.material;if(!g)continue;e&&F.setBlending(g.blending,g.blendEquation,g.blendSrc,g.blendDst);F.setDepthTest(g.depthTest);F.setDepthWrite(g.depthWrite);B(g.polygonOffset,g.polygonOffsetFactor,
g.polygonOffsetUnits)}F.setMaterialFaces(g);m instanceof THREE.BufferGeometry?F.renderBufferDirect(b,c,d,g,m,l):F.renderBuffer(b,c,d,g,m,l)}}function r(a,b,c,d,e,f,g){for(var h,k=0,l=a.length;k<l;k++){h=a[k];var m=h.object;if(m.visible){if(g)h=g;else{h=h[b];if(!h)continue;f&&F.setBlending(h.blending,h.blendEquation,h.blendSrc,h.blendDst);F.setDepthTest(h.depthTest);F.setDepthWrite(h.depthWrite);B(h.polygonOffset,h.polygonOffsetFactor,h.polygonOffsetUnits)}F.renderImmediateObject(c,d,e,h,m)}}}function t(a){var b=
a.object.material;b.transparent?(a.transparent=b,a.opaque=null):(a.opaque=b,a.transparent=null)}function u(a,b){var d=a.material;if(void 0===vb[b.id]||!0===b.groupsNeedUpdate){delete Ja[a.id];var e=vb,f=b.id;d=d instanceof THREE.MeshFaceMaterial;var g=ea.get("OES_element_index_uint")?4294967296:65535;var h={};for(var k=b.morphTargets.length,l=b.morphNormals.length,m,p={},r=[],q=0,wa=b.faces.length;q<wa;q++){var t=b.faces[q];var u=d?t.materialIndex:0;u in h||(h[u]={hash:u,counter:0});t=h[u].hash+"_"+
h[u].counter;t in p||(m={id:ic++,faces3:[],materialIndex:u,vertices:0,numMorphTargets:k,numMorphNormals:l},p[t]=m,r.push(m));p[t].vertices+3>g&&(h[u].counter+=1,t=h[u].hash+"_"+h[u].counter,t in p||(m={id:ic++,faces3:[],materialIndex:u,vertices:0,numMorphTargets:k,numMorphNormals:l},p[t]=m,r.push(m)));p[t].faces3.push(q);p[t].vertices+=3}e[f]=r;b.groupsNeedUpdate=!1}e=vb[b.id];f=0;for(d=e.length;f<d;f++){g=e[f];if(void 0===g.__webglVertexBuffer){h=g;h.__webglVertexBuffer=n.createBuffer();h.__webglNormalBuffer=
n.createBuffer();h.__webglTangentBuffer=n.createBuffer();h.__webglColorBuffer=n.createBuffer();h.__webglUVBuffer=n.createBuffer();h.__webglUV2Buffer=n.createBuffer();h.__webglSkinIndicesBuffer=n.createBuffer();h.__webglSkinWeightsBuffer=n.createBuffer();h.__webglFaceBuffer=n.createBuffer();h.__webglLineBuffer=n.createBuffer();if(l=h.numMorphTargets)for(h.__webglMorphTargetsBuffers=[],k=0;k<l;k++)h.__webglMorphTargetsBuffers.push(n.createBuffer());if(l=h.numMorphNormals)for(h.__webglMorphNormalsBuffers=
[],k=0;k<l;k++)h.__webglMorphNormalsBuffers.push(n.createBuffer());F.info.memory.geometries++;c(g,a);b.verticesNeedUpdate=!0;b.morphTargetsNeedUpdate=!0;b.elementsNeedUpdate=!0;b.uvsNeedUpdate=!0;b.normalsNeedUpdate=!0;b.tangentsNeedUpdate=!0;h=b.colorsNeedUpdate=!0}else h=!1;(h||void 0===a.__webglActive)&&v(Ja,g,a)}a.__webglActive=!0}function v(a,b,c){var d=c.id;a[d]=a[d]||[];a[d].push({id:d,buffer:b,object:c,material:null,z:0})}function w(a){var b=a.geometry;if(b instanceof THREE.BufferGeometry)for(var e=
b.attributes,f=b.attributesKeys,g=0,h=f.length;g<h;g++){var k=f[g],l=e[k];void 0===l.buffer&&(l.buffer=n.createBuffer(),l.needsUpdate=!0);if(!0===l.needsUpdate){var m="index"===k?n.ELEMENT_ARRAY_BUFFER:n.ARRAY_BUFFER;n.bindBuffer(m,l.buffer);n.bufferData(m,l.array,n.STATIC_DRAW);l.needsUpdate=!1}}else if(a instanceof THREE.Mesh){!0===b.groupsNeedUpdate&&u(a,b);var p=vb[b.id];g=0;for(var r=p.length;g<r;g++){var q=p[g],wa=d(a,q);!0===b.groupsNeedUpdate&&c(q,a);var t=wa.attributes&&x(wa);if(b.verticesNeedUpdate||
b.morphTargetsNeedUpdate||b.elementsNeedUpdate||b.uvsNeedUpdate||b.normalsNeedUpdate||b.colorsNeedUpdate||b.tangentsNeedUpdate||t){var w=q,v=a,y=n.DYNAMIC_DRAW,R=!b.dynamic,P=wa;if(w.__inittedArrays){var M=P&&void 0!==P.shading&&P.shading===THREE.SmoothShading,A=void 0,D=void 0,E=void 0,B=void 0,F=void 0,I=void 0,G=void 0,K=void 0,N=void 0,T=void 0,Q=void 0,L=void 0,H=void 0,X=void 0,ba=void 0,V=void 0,Fa=void 0,va=void 0,Ra=void 0,Z=void 0,Ja=void 0,da=void 0,ea=void 0,Ka=void 0,ka=void 0,O=void 0,
Na=void 0,La=void 0,oa=void 0,ta=void 0,wb=void 0,xa=void 0,Ga=void 0,ia=void 0,la=void 0,Ea=void 0,Za=void 0,ca=void 0,Da=void 0,eb=void 0,Ua=0,$a=0,Ia=0,ab=0,Qa=0,ob=0,Oa=0,xb=0,bb=0,fa=0,pa=0,J=0,Aa=void 0,Sa=w.__vertexArray,kb=w.__uvArray,yb=w.__uv2Array,pb=w.__normalArray,Ta=w.__tangentArray,cb=w.__colorArray,Pa=w.__skinIndexArray,Ba=w.__skinWeightArray,zb=w.__morphTargetsArrays,gb=w.__morphNormalsArrays,hb=w.__webglCustomAttributesList,z=void 0,ma=w.__faceArray,ua=w.__lineArray,qa=v.geometry,
Ya=qa.elementsNeedUpdate,Hb=qa.uvsNeedUpdate,Eb=qa.normalsNeedUpdate,Ob=qa.tangentsNeedUpdate,Db=qa.colorsNeedUpdate,lb=qa.morphTargetsNeedUpdate,ec=qa.vertices,W=w.faces3,Ma=qa.faces,Va=qa.faceVertexUvs[0],Kb=qa.faceVertexUvs[1],fc=qa.skinIndices,aa=qa.skinWeights,Lb=qa.morphTargets,S=qa.morphNormals;if(qa.verticesNeedUpdate){A=0;for(D=W.length;A<D;A++)B=Ma[W[A]],L=ec[B.a],H=ec[B.b],X=ec[B.c],Sa[$a]=L.x,Sa[$a+1]=L.y,Sa[$a+2]=L.z,Sa[$a+3]=H.x,Sa[$a+4]=H.y,Sa[$a+5]=H.z,Sa[$a+6]=X.x,Sa[$a+7]=X.y,Sa[$a+
8]=X.z,$a+=9;n.bindBuffer(n.ARRAY_BUFFER,w.__webglVertexBuffer);n.bufferData(n.ARRAY_BUFFER,Sa,y)}if(lb)for(la=0,Ea=Lb.length;la<Ea;la++){A=pa=0;for(D=W.length;A<D;A++)Da=W[A],B=Ma[Da],L=Lb[la].vertices[B.a],H=Lb[la].vertices[B.b],X=Lb[la].vertices[B.c],Za=zb[la],Za[pa]=L.x,Za[pa+1]=L.y,Za[pa+2]=L.z,Za[pa+3]=H.x,Za[pa+4]=H.y,Za[pa+5]=H.z,Za[pa+6]=X.x,Za[pa+7]=X.y,Za[pa+8]=X.z,P.morphNormals&&(M?(eb=S[la].vertexNormals[Da],va=eb.a,Ra=eb.b,Z=eb.c):Z=Ra=va=S[la].faceNormals[Da],ca=gb[la],ca[pa]=va.x,
ca[pa+1]=va.y,ca[pa+2]=va.z,ca[pa+3]=Ra.x,ca[pa+4]=Ra.y,ca[pa+5]=Ra.z,ca[pa+6]=Z.x,ca[pa+7]=Z.y,ca[pa+8]=Z.z),pa+=9;n.bindBuffer(n.ARRAY_BUFFER,w.__webglMorphTargetsBuffers[la]);n.bufferData(n.ARRAY_BUFFER,zb[la],y);P.morphNormals&&(n.bindBuffer(n.ARRAY_BUFFER,w.__webglMorphNormalsBuffers[la]),n.bufferData(n.ARRAY_BUFFER,gb[la],y))}if(aa.length){A=0;for(D=W.length;A<D;A++)B=Ma[W[A]],Ka=aa[B.a],ka=aa[B.b],O=aa[B.c],Ba[fa]=Ka.x,Ba[fa+1]=Ka.y,Ba[fa+2]=Ka.z,Ba[fa+3]=Ka.w,Ba[fa+4]=ka.x,Ba[fa+5]=ka.y,Ba[fa+
6]=ka.z,Ba[fa+7]=ka.w,Ba[fa+8]=O.x,Ba[fa+9]=O.y,Ba[fa+10]=O.z,Ba[fa+11]=O.w,Na=fc[B.a],La=fc[B.b],oa=fc[B.c],Pa[fa]=Na.x,Pa[fa+1]=Na.y,Pa[fa+2]=Na.z,Pa[fa+3]=Na.w,Pa[fa+4]=La.x,Pa[fa+5]=La.y,Pa[fa+6]=La.z,Pa[fa+7]=La.w,Pa[fa+8]=oa.x,Pa[fa+9]=oa.y,Pa[fa+10]=oa.z,Pa[fa+11]=oa.w,fa+=12;0<fa&&(n.bindBuffer(n.ARRAY_BUFFER,w.__webglSkinIndicesBuffer),n.bufferData(n.ARRAY_BUFFER,Pa,y),n.bindBuffer(n.ARRAY_BUFFER,w.__webglSkinWeightsBuffer),n.bufferData(n.ARRAY_BUFFER,Ba,y))}if(Db){A=0;for(D=W.length;A<D;A++)B=
Ma[W[A]],G=B.vertexColors,K=B.color,3===G.length&&P.vertexColors===THREE.VertexColors?(Ja=G[0],da=G[1],ea=G[2]):ea=da=Ja=K,cb[bb]=Ja.r,cb[bb+1]=Ja.g,cb[bb+2]=Ja.b,cb[bb+3]=da.r,cb[bb+4]=da.g,cb[bb+5]=da.b,cb[bb+6]=ea.r,cb[bb+7]=ea.g,cb[bb+8]=ea.b,bb+=9;0<bb&&(n.bindBuffer(n.ARRAY_BUFFER,w.__webglColorBuffer),n.bufferData(n.ARRAY_BUFFER,cb,y))}if(Ob&&qa.hasTangents){A=0;for(D=W.length;A<D;A++)B=Ma[W[A]],N=B.vertexTangents,ba=N[0],V=N[1],Fa=N[2],Ta[Oa]=ba.x,Ta[Oa+1]=ba.y,Ta[Oa+2]=ba.z,Ta[Oa+3]=ba.w,
Ta[Oa+4]=V.x,Ta[Oa+5]=V.y,Ta[Oa+6]=V.z,Ta[Oa+7]=V.w,Ta[Oa+8]=Fa.x,Ta[Oa+9]=Fa.y,Ta[Oa+10]=Fa.z,Ta[Oa+11]=Fa.w,Oa+=12;n.bindBuffer(n.ARRAY_BUFFER,w.__webglTangentBuffer);n.bufferData(n.ARRAY_BUFFER,Ta,y)}if(Eb){A=0;for(D=W.length;A<D;A++)if(B=Ma[W[A]],F=B.vertexNormals,I=B.normal,3===F.length&&M)for(ta=0;3>ta;ta++)xa=F[ta],pb[ob]=xa.x,pb[ob+1]=xa.y,pb[ob+2]=xa.z,ob+=3;else for(ta=0;3>ta;ta++)pb[ob]=I.x,pb[ob+1]=I.y,pb[ob+2]=I.z,ob+=3;n.bindBuffer(n.ARRAY_BUFFER,w.__webglNormalBuffer);n.bufferData(n.ARRAY_BUFFER,
pb,y)}if(Hb&&Va){A=0;for(D=W.length;A<D;A++)if(E=W[A],T=Va[E],void 0!==T)for(ta=0;3>ta;ta++)Ga=T[ta],kb[Ia]=Ga.x,kb[Ia+1]=Ga.y,Ia+=2;0<Ia&&(n.bindBuffer(n.ARRAY_BUFFER,w.__webglUVBuffer),n.bufferData(n.ARRAY_BUFFER,kb,y))}if(Hb&&Kb){A=0;for(D=W.length;A<D;A++)if(E=W[A],Q=Kb[E],void 0!==Q)for(ta=0;3>ta;ta++)ia=Q[ta],yb[ab]=ia.x,yb[ab+1]=ia.y,ab+=2;0<ab&&(n.bindBuffer(n.ARRAY_BUFFER,w.__webglUV2Buffer),n.bufferData(n.ARRAY_BUFFER,yb,y))}if(Ya){A=0;for(D=W.length;A<D;A++)ma[Qa]=Ua,ma[Qa+1]=Ua+1,ma[Qa+
2]=Ua+2,Qa+=3,ua[xb]=Ua,ua[xb+1]=Ua+1,ua[xb+2]=Ua,ua[xb+3]=Ua+2,ua[xb+4]=Ua+1,ua[xb+5]=Ua+2,xb+=6,Ua+=3;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,w.__webglFaceBuffer);n.bufferData(n.ELEMENT_ARRAY_BUFFER,ma,y);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,w.__webglLineBuffer);n.bufferData(n.ELEMENT_ARRAY_BUFFER,ua,y)}if(hb)for(ta=0,wb=hb.length;ta<wb;ta++)if(z=hb[ta],z.__original.needsUpdate){J=0;if(1===z.size)if(void 0===z.boundTo||"vertices"===z.boundTo)for(A=0,D=W.length;A<D;A++)B=Ma[W[A]],z.array[J]=z.value[B.a],
z.array[J+1]=z.value[B.b],z.array[J+2]=z.value[B.c],J+=3;else{if("faces"===z.boundTo)for(A=0,D=W.length;A<D;A++)Aa=z.value[W[A]],z.array[J]=Aa,z.array[J+1]=Aa,z.array[J+2]=Aa,J+=3}else if(2===z.size)if(void 0===z.boundTo||"vertices"===z.boundTo)for(A=0,D=W.length;A<D;A++)B=Ma[W[A]],L=z.value[B.a],H=z.value[B.b],X=z.value[B.c],z.array[J]=L.x,z.array[J+1]=L.y,z.array[J+2]=H.x,z.array[J+3]=H.y,z.array[J+4]=X.x,z.array[J+5]=X.y,J+=6;else{if("faces"===z.boundTo)for(A=0,D=W.length;A<D;A++)X=H=L=Aa=z.value[W[A]],
z.array[J]=L.x,z.array[J+1]=L.y,z.array[J+2]=H.x,z.array[J+3]=H.y,z.array[J+4]=X.x,z.array[J+5]=X.y,J+=6}else if(3===z.size){var U="c"===z.type?["r","g","b"]:["x","y","z"];if(void 0===z.boundTo||"vertices"===z.boundTo)for(A=0,D=W.length;A<D;A++)B=Ma[W[A]],L=z.value[B.a],H=z.value[B.b],X=z.value[B.c],z.array[J]=L[U[0]],z.array[J+1]=L[U[1]],z.array[J+2]=L[U[2]],z.array[J+3]=H[U[0]],z.array[J+4]=H[U[1]],z.array[J+5]=H[U[2]],z.array[J+6]=X[U[0]],z.array[J+7]=X[U[1]],z.array[J+8]=X[U[2]],J+=9;else if("faces"===
z.boundTo)for(A=0,D=W.length;A<D;A++)X=H=L=Aa=z.value[W[A]],z.array[J]=L[U[0]],z.array[J+1]=L[U[1]],z.array[J+2]=L[U[2]],z.array[J+3]=H[U[0]],z.array[J+4]=H[U[1]],z.array[J+5]=H[U[2]],z.array[J+6]=X[U[0]],z.array[J+7]=X[U[1]],z.array[J+8]=X[U[2]],J+=9;else if("faceVertices"===z.boundTo)for(A=0,D=W.length;A<D;A++)Aa=z.value[W[A]],L=Aa[0],H=Aa[1],X=Aa[2],z.array[J]=L[U[0]],z.array[J+1]=L[U[1]],z.array[J+2]=L[U[2]],z.array[J+3]=H[U[0]],z.array[J+4]=H[U[1]],z.array[J+5]=H[U[2]],z.array[J+6]=X[U[0]],z.array[J+
7]=X[U[1]],z.array[J+8]=X[U[2]],J+=9}else if(4===z.size)if(void 0===z.boundTo||"vertices"===z.boundTo)for(A=0,D=W.length;A<D;A++)B=Ma[W[A]],L=z.value[B.a],H=z.value[B.b],X=z.value[B.c],z.array[J]=L.x,z.array[J+1]=L.y,z.array[J+2]=L.z,z.array[J+3]=L.w,z.array[J+4]=H.x,z.array[J+5]=H.y,z.array[J+6]=H.z,z.array[J+7]=H.w,z.array[J+8]=X.x,z.array[J+9]=X.y,z.array[J+10]=X.z,z.array[J+11]=X.w,J+=12;else if("faces"===z.boundTo)for(A=0,D=W.length;A<D;A++)X=H=L=Aa=z.value[W[A]],z.array[J]=L.x,z.array[J+1]=
L.y,z.array[J+2]=L.z,z.array[J+3]=L.w,z.array[J+4]=H.x,z.array[J+5]=H.y,z.array[J+6]=H.z,z.array[J+7]=H.w,z.array[J+8]=X.x,z.array[J+9]=X.y,z.array[J+10]=X.z,z.array[J+11]=X.w,J+=12;else if("faceVertices"===z.boundTo)for(A=0,D=W.length;A<D;A++)Aa=z.value[W[A]],L=Aa[0],H=Aa[1],X=Aa[2],z.array[J]=L.x,z.array[J+1]=L.y,z.array[J+2]=L.z,z.array[J+3]=L.w,z.array[J+4]=H.x,z.array[J+5]=H.y,z.array[J+6]=H.z,z.array[J+7]=H.w,z.array[J+8]=X.x,z.array[J+9]=X.y,z.array[J+10]=X.z,z.array[J+11]=X.w,J+=12;n.bindBuffer(n.ARRAY_BUFFER,
z.buffer);n.bufferData(n.ARRAY_BUFFER,z.array,y)}R&&(delete w.__inittedArrays,delete w.__colorArray,delete w.__normalArray,delete w.__tangentArray,delete w.__uvArray,delete w.__uv2Array,delete w.__faceArray,delete w.__vertexArray,delete w.__lineArray,delete w.__skinIndexArray,delete w.__skinWeightArray)}}}b.verticesNeedUpdate=!1;b.morphTargetsNeedUpdate=!1;b.elementsNeedUpdate=!1;b.uvsNeedUpdate=!1;b.normalsNeedUpdate=!1;b.colorsNeedUpdate=!1;b.tangentsNeedUpdate=!1;wa.attributes&&C(wa)}else if(a instanceof
THREE.Line){wa=d(a,b);t=wa.attributes&&x(wa);if(b.verticesNeedUpdate||b.colorsNeedUpdate||b.lineDistancesNeedUpdate||t){var Y=n.DYNAMIC_DRAW,Ha,na,Fb,jc=b.vertices,kc=b.colors,qb=b.lineDistances,Ca=jc.length,Sb=kc.length,ub=qb.length,db=b.__vertexArray,Gb=b.__colorArray,rb=b.__lineDistanceArray,Cb=b.colorsNeedUpdate,Mb=b.lineDistancesNeedUpdate,Vb=b.__webglCustomAttributesList,nb,ya,ha;if(b.verticesNeedUpdate){for(Ha=0;Ha<Ca;Ha++){var ib=jc[Ha];var ra=3*Ha;db[ra]=ib.x;db[ra+1]=ib.y;db[ra+2]=ib.z}n.bindBuffer(n.ARRAY_BUFFER,
b.__webglVertexBuffer);n.bufferData(n.ARRAY_BUFFER,db,Y)}if(Cb){for(na=0;na<Sb;na++){var fb=kc[na];ra=3*na;Gb[ra]=fb.r;Gb[ra+1]=fb.g;Gb[ra+2]=fb.b}n.bindBuffer(n.ARRAY_BUFFER,b.__webglColorBuffer);n.bufferData(n.ARRAY_BUFFER,Gb,Y)}if(Mb){for(Fb=0;Fb<ub;Fb++)rb[Fb]=qb[Fb];n.bindBuffer(n.ARRAY_BUFFER,b.__webglLineDistanceBuffer);n.bufferData(n.ARRAY_BUFFER,rb,Y)}if(Vb){var jb=0;for(nb=Vb.length;jb<nb;jb++)if(ha=Vb[jb],ha.needsUpdate&&(void 0===ha.boundTo||"vertices"===ha.boundTo)){ra=0;var Wb=ha.value.length;
if(1===ha.size)for(ya=0;ya<Wb;ya++)ha.array[ya]=ha.value[ya];else if(2===ha.size)for(ya=0;ya<Wb;ya++){var Wa=ha.value[ya];ha.array[ra]=Wa.x;ha.array[ra+1]=Wa.y;ra+=2}else if(3===ha.size)if("c"===ha.type)for(ya=0;ya<Wb;ya++)Wa=ha.value[ya],ha.array[ra]=Wa.r,ha.array[ra+1]=Wa.g,ha.array[ra+2]=Wa.b,ra+=3;else for(ya=0;ya<Wb;ya++)Wa=ha.value[ya],ha.array[ra]=Wa.x,ha.array[ra+1]=Wa.y,ha.array[ra+2]=Wa.z,ra+=3;else if(4===ha.size)for(ya=0;ya<Wb;ya++)Wa=ha.value[ya],ha.array[ra]=Wa.x,ha.array[ra+1]=Wa.y,
ha.array[ra+2]=Wa.z,ha.array[ra+3]=Wa.w,ra+=4;n.bindBuffer(n.ARRAY_BUFFER,ha.buffer);n.bufferData(n.ARRAY_BUFFER,ha.array,Y);ha.needsUpdate=!1}}}b.verticesNeedUpdate=!1;b.colorsNeedUpdate=!1;b.lineDistancesNeedUpdate=!1;wa.attributes&&C(wa)}else if(a instanceof THREE.PointCloud){wa=d(a,b);t=wa.attributes&&x(wa);if(b.verticesNeedUpdate||b.colorsNeedUpdate||t){var Nb=n.DYNAMIC_DRAW,Xb,Yb,Qb=b.vertices,Zb=Qb.length,Rb=b.colors,$b=Rb.length,bc=b.__vertexArray,cc=b.__colorArray,Ib=b.colorsNeedUpdate,sb=
b.__webglCustomAttributesList,Ab,za,Pb;if(b.verticesNeedUpdate){for(Xb=0;Xb<Zb;Xb++){var tb=Qb[Xb];var sa=3*Xb;bc[sa]=tb.x;bc[sa+1]=tb.y;bc[sa+2]=tb.z}n.bindBuffer(n.ARRAY_BUFFER,b.__webglVertexBuffer);n.bufferData(n.ARRAY_BUFFER,bc,Nb)}if(Ib){for(Yb=0;Yb<$b;Yb++){var mb=Rb[Yb];sa=3*Yb;cc[sa]=mb.r;cc[sa+1]=mb.g;cc[sa+2]=mb.b}n.bindBuffer(n.ARRAY_BUFFER,b.__webglColorBuffer);n.bufferData(n.ARRAY_BUFFER,cc,Nb)}if(sb){var Bb=0;for(Ab=sb.length;Bb<Ab;Bb++){var ja=sb[Bb];if(ja.needsUpdate&&(void 0===ja.boundTo||
"vertices"===ja.boundTo))if(Pb=ja.value.length,sa=0,1===ja.size)for(za=0;za<Pb;za++)ja.array[za]=ja.value[za];else if(2===ja.size)for(za=0;za<Pb;za++){var Xa=ja.value[za];ja.array[sa]=Xa.x;ja.array[sa+1]=Xa.y;sa+=2}else if(3===ja.size)if("c"===ja.type)for(za=0;za<Pb;za++)Xa=ja.value[za],ja.array[sa]=Xa.r,ja.array[sa+1]=Xa.g,ja.array[sa+2]=Xa.b,sa+=3;else for(za=0;za<Pb;za++)Xa=ja.value[za],ja.array[sa]=Xa.x,ja.array[sa+1]=Xa.y,ja.array[sa+2]=Xa.z,sa+=3;else if(4===ja.size)for(za=0;za<Pb;za++)Xa=ja.value[za],
ja.array[sa]=Xa.x,ja.array[sa+1]=Xa.y,ja.array[sa+2]=Xa.z,ja.array[sa+3]=Xa.w,sa+=4;n.bindBuffer(n.ARRAY_BUFFER,ja.buffer);n.bufferData(n.ARRAY_BUFFER,ja.array,Nb);ja.needsUpdate=!1}}}b.verticesNeedUpdate=!1;b.colorsNeedUpdate=!1;wa.attributes&&C(wa)}}function x(a){for(var b in a.attributes)if(a.attributes[b].needsUpdate)return!0;return!1}function C(a){for(var b in a.attributes)a.attributes[b].needsUpdate=!1}function y(a,b,c,d,e){Nb=0;if(d.needsUpdate){d.program&&lc(d);d.addEventListener("dispose",
mc);var f=Ec[d.type];if(f){var g=THREE.ShaderLib[f];d.__webglShader={uniforms:THREE.UniformsUtils.clone(g.uniforms),vertexShader:g.vertexShader,fragmentShader:g.fragmentShader}}else d.__webglShader={uniforms:d.uniforms,vertexShader:d.vertexShader,fragmentShader:d.fragmentShader};for(var h=0,k=0,l=0,m=0,p=0,r=b.length;p<r;p++){var q=b[p];q.onlyShadow||!1===q.visible||(q instanceof THREE.DirectionalLight&&h++,q instanceof THREE.PointLight&&k++,q instanceof THREE.SpotLight&&l++,q instanceof THREE.HemisphereLight&&
m++)}var t=h;var wa=k;var u=l;var w=m;for(var v,y=0,dc=0,x=b.length;dc<x;dc++){var C=b[dc];C.castShadow&&(C instanceof THREE.SpotLight&&y++,C instanceof THREE.DirectionalLight&&!C.shadowCascade&&y++)}v=y;if(Qb&&e&&e.skeleton&&e.skeleton.useVertexTexture)var A=1024;else{var Dc=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),Ub=Math.floor((Dc-20)/4);void 0!==e&&e instanceof THREE.SkinnedMesh&&(Ub=Math.min(e.skeleton.bones.length,Ub),Ub<e.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+
e.skeleton.bones.length+", this GPU supports just "+Ub+" (try OpenGL instead of ANGLE)"));A=Ub}var B={precision:V,supportsVertexTextures:Zb,map:!!d.map,envMap:!!d.envMap,envMapMode:d.envMap&&d.envMap.mapping,lightMap:!!d.lightMap,bumpMap:!!d.bumpMap,normalMap:!!d.normalMap,specularMap:!!d.specularMap,alphaMap:!!d.alphaMap,combine:d.combine,vertexColors:d.vertexColors,fog:c,useFog:d.fog,fogExp:c instanceof THREE.FogExp2,sizeAttenuation:d.sizeAttenuation,logarithmicDepthBuffer:X,skinning:d.skinning,
maxBones:A,useVertexTexture:Qb&&e&&e.skeleton&&e.skeleton.useVertexTexture,morphTargets:d.morphTargets,morphNormals:d.morphNormals,maxMorphTargets:F.maxMorphTargets,maxMorphNormals:F.maxMorphNormals,maxDirLights:t,maxPointLights:wa,maxSpotLights:u,maxHemiLights:w,maxShadows:v,shadowMapEnabled:F.shadowMapEnabled&&e.receiveShadow&&0<v,shadowMapType:F.shadowMapType,shadowMapDebug:F.shadowMapDebug,shadowMapCascade:F.shadowMapCascade,alphaTest:d.alphaTest,metal:d.metal,wrapAround:d.wrapAround,doubleSided:d.side===
THREE.DoubleSide,flipSided:d.side===THREE.BackSide},E=[];f?E.push(f):(E.push(d.fragmentShader),E.push(d.vertexShader));if(void 0!==d.defines)for(var H in d.defines)E.push(H),E.push(d.defines[H]);for(H in B)E.push(H),E.push(B[H]);for(var G=E.join(),Jb,K=0,N=ab.length;K<N;K++){var ba=ab[K];if(ba.code===G){Jb=ba;Jb.usedTimes++;break}}void 0===Jb&&(Jb=new THREE.WebGLProgram(F,G,d,B),ab.push(Jb),F.info.memory.programs=ab.length);d.program=Jb;var Fa=Jb.attributes;if(d.morphTargets){d.numSupportedMorphTargets=
0;for(var va,Ra="morphTarget",Z=0;Z<F.maxMorphTargets;Z++)va=Ra+Z,0<=Fa[va]&&d.numSupportedMorphTargets++}if(d.morphNormals)for(d.numSupportedMorphNormals=0,Ra="morphNormal",Z=0;Z<F.maxMorphNormals;Z++)va=Ra+Z,0<=Fa[va]&&d.numSupportedMorphNormals++;d.uniformsList=[];for(var Ja in d.__webglShader.uniforms){var da=d.program.uniforms[Ja];da&&d.uniformsList.push([d.__webglShader.uniforms[Ja],da])}d.needsUpdate=!1}d.morphTargets&&!e.__webglMorphTargetInfluences&&(e.__webglMorphTargetInfluences=new Float32Array(F.maxMorphTargets));
var ea=!1,Ka=!1,Na=!1,La=d.program,ka=La.uniforms,O=d.__webglShader.uniforms;La.id!==Rb&&(n.useProgram(La.program),Rb=La.id,Na=Ka=ea=!0);d.id!==Hb&&(-1===Hb&&(Na=!0),Hb=d.id,Ka=!0);if(ea||a!==Ob)n.uniformMatrix4fv(ka.projectionMatrix,!1,a.projectionMatrix.elements),X&&n.uniform1f(ka.logDepthBufFC,2/(Math.log(a.far+1)/Math.LN2)),a!==Ob&&(Ob=a),(d instanceof THREE.ShaderMaterial||d instanceof THREE.MeshPhongMaterial||d.envMap)&&null!==ka.cameraPosition&&(Ga.setFromMatrixPosition(a.matrixWorld),n.uniform3f(ka.cameraPosition,
Ga.x,Ga.y,Ga.z)),(d instanceof THREE.MeshPhongMaterial||d instanceof THREE.MeshLambertMaterial||d instanceof THREE.MeshBasicMaterial||d instanceof THREE.ShaderMaterial||d.skinning)&&null!==ka.viewMatrix&&n.uniformMatrix4fv(ka.viewMatrix,!1,a.matrixWorldInverse.elements);if(d.skinning)if(e.bindMatrix&&null!==ka.bindMatrix&&n.uniformMatrix4fv(ka.bindMatrix,!1,e.bindMatrix.elements),e.bindMatrixInverse&&null!==ka.bindMatrixInverse&&n.uniformMatrix4fv(ka.bindMatrixInverse,!1,e.bindMatrixInverse.elements),
Qb&&e.skeleton&&e.skeleton.useVertexTexture){if(null!==ka.boneTexture){var wb=P();n.uniform1i(ka.boneTexture,wb);F.setTexture(e.skeleton.boneTexture,wb)}null!==ka.boneTextureWidth&&n.uniform1i(ka.boneTextureWidth,e.skeleton.boneTextureWidth);null!==ka.boneTextureHeight&&n.uniform1i(ka.boneTextureHeight,e.skeleton.boneTextureHeight)}else e.skeleton&&e.skeleton.boneMatrices&&null!==ka.boneGlobalMatrices&&n.uniformMatrix4fv(ka.boneGlobalMatrices,!1,e.skeleton.boneMatrices);if(Ka){c&&d.fog&&(O.fogColor.value=
c.color,c instanceof THREE.Fog?(O.fogNear.value=c.near,O.fogFar.value=c.far):c instanceof THREE.FogExp2&&(O.fogDensity.value=c.density));if(d instanceof THREE.MeshPhongMaterial||d instanceof THREE.MeshLambertMaterial||d.lights){if(Sb){Na=!0;var ia,Da=0,ta=0,Ea=0,xa,eb,Ia,la,Qa,Za,ca=nc,Ya=ca.directional.colors,ib=ca.directional.positions,Ua=ca.point.colors,$a=ca.point.positions,vb=ca.point.distances,fb=ca.spot.colors,jb=ca.spot.positions,ob=ca.spot.distances,Oa=ca.spot.directions,xb=ca.spot.anglesCos,
bb=ca.spot.exponents,fa=ca.hemi.skyColors,pa=ca.hemi.groundColors,J=ca.hemi.positions,Aa=0,Sa=0,kb=0,yb=0,pb=0,Ta=0,cb=0,Pa=0,Ba=0,zb=0,gb=0,hb=0;var z=0;for(ia=b.length;z<ia;z++){var ma=b[z];ma.onlyShadow||(xa=ma.color,la=ma.intensity,Za=ma.distance,ma instanceof THREE.AmbientLight?ma.visible&&(F.gammaInput?(Da+=xa.r*xa.r,ta+=xa.g*xa.g,Ea+=xa.b*xa.b):(Da+=xa.r,ta+=xa.g,Ea+=xa.b)):ma instanceof THREE.DirectionalLight?(pb+=1,ma.visible&&(oa.setFromMatrixPosition(ma.matrixWorld),Ga.setFromMatrixPosition(ma.target.matrixWorld),
oa.sub(Ga),oa.normalize(),Ba=3*Aa,ib[Ba]=oa.x,ib[Ba+1]=oa.y,ib[Ba+2]=oa.z,F.gammaInput?M(Ya,Ba,xa,la*la):Q(Ya,Ba,xa,la),Aa+=1)):ma instanceof THREE.PointLight?(Ta+=1,ma.visible&&(zb=3*Sa,F.gammaInput?M(Ua,zb,xa,la*la):Q(Ua,zb,xa,la),Ga.setFromMatrixPosition(ma.matrixWorld),$a[zb]=Ga.x,$a[zb+1]=Ga.y,$a[zb+2]=Ga.z,vb[Sa]=Za,Sa+=1)):ma instanceof THREE.SpotLight?(cb+=1,ma.visible&&(gb=3*kb,F.gammaInput?M(fb,gb,xa,la*la):Q(fb,gb,xa,la),oa.setFromMatrixPosition(ma.matrixWorld),jb[gb]=oa.x,jb[gb+1]=oa.y,
jb[gb+2]=oa.z,ob[kb]=Za,Ga.setFromMatrixPosition(ma.target.matrixWorld),oa.sub(Ga),oa.normalize(),Oa[gb]=oa.x,Oa[gb+1]=oa.y,Oa[gb+2]=oa.z,xb[kb]=Math.cos(ma.angle),bb[kb]=ma.exponent,kb+=1)):ma instanceof THREE.HemisphereLight&&(Pa+=1,ma.visible&&(oa.setFromMatrixPosition(ma.matrixWorld),oa.normalize(),hb=3*yb,J[hb]=oa.x,J[hb+1]=oa.y,J[hb+2]=oa.z,eb=ma.color,Ia=ma.groundColor,F.gammaInput?(Qa=la*la,M(fa,hb,eb,Qa),M(pa,hb,Ia,Qa)):(Q(fa,hb,eb,la),Q(pa,hb,Ia,la)),yb+=1)))}z=3*Aa;for(ia=Math.max(Ya.length,
3*pb);z<ia;z++)Ya[z]=0;z=3*Sa;for(ia=Math.max(Ua.length,3*Ta);z<ia;z++)Ua[z]=0;z=3*kb;for(ia=Math.max(fb.length,3*cb);z<ia;z++)fb[z]=0;z=3*yb;for(ia=Math.max(fa.length,3*Pa);z<ia;z++)fa[z]=0;z=3*yb;for(ia=Math.max(pa.length,3*Pa);z<ia;z++)pa[z]=0;ca.directional.length=Aa;ca.point.length=Sa;ca.spot.length=kb;ca.hemi.length=yb;ca.ambient[0]=Da;ca.ambient[1]=ta;ca.ambient[2]=Ea;Sb=!1}if(Na){var ua=nc;O.ambientLightColor.value=ua.ambient;O.directionalLightColor.value=ua.directional.colors;O.directionalLightDirection.value=
ua.directional.positions;O.pointLightColor.value=ua.point.colors;O.pointLightPosition.value=ua.point.positions;O.pointLightDistance.value=ua.point.distances;O.spotLightColor.value=ua.spot.colors;O.spotLightPosition.value=ua.spot.positions;O.spotLightDistance.value=ua.spot.distances;O.spotLightDirection.value=ua.spot.directions;O.spotLightAngleCos.value=ua.spot.anglesCos;O.spotLightExponent.value=ua.spot.exponents;O.hemisphereLightSkyColor.value=ua.hemi.skyColors;O.hemisphereLightGroundColor.value=
ua.hemi.groundColors;O.hemisphereLightDirection.value=ua.hemi.positions;R(O,!0)}else R(O,!1)}if(d instanceof THREE.MeshBasicMaterial||d instanceof THREE.MeshLambertMaterial||d instanceof THREE.MeshPhongMaterial){O.opacity.value=d.opacity;F.gammaInput?O.diffuse.value.copyGammaToLinear(d.color):O.diffuse.value=d.color;O.map.value=d.map;O.lightMap.value=d.lightMap;O.specularMap.value=d.specularMap;O.alphaMap.value=d.alphaMap;d.bumpMap&&(O.bumpMap.value=d.bumpMap,O.bumpScale.value=d.bumpScale);d.normalMap&&
(O.normalMap.value=d.normalMap,O.normalScale.value.copy(d.normalScale));var qa;d.map?qa=d.map:d.specularMap?qa=d.specularMap:d.normalMap?qa=d.normalMap:d.bumpMap?qa=d.bumpMap:d.alphaMap&&(qa=d.alphaMap);if(void 0!==qa){var sb=qa.offset,tb=qa.repeat;O.offsetRepeat.value.set(sb.x,sb.y,tb.x,tb.y)}O.envMap.value=d.envMap;O.flipEnvMap.value=d.envMap instanceof THREE.WebGLRenderTargetCube?1:-1;O.reflectivity.value=d.reflectivity;O.refractionRatio.value=d.refractionRatio}d instanceof THREE.LineBasicMaterial?
(O.diffuse.value=d.color,O.opacity.value=d.opacity):d instanceof THREE.LineDashedMaterial?(O.diffuse.value=d.color,O.opacity.value=d.opacity,O.dashSize.value=d.dashSize,O.totalSize.value=d.dashSize+d.gapSize,O.scale.value=d.scale):d instanceof THREE.PointCloudMaterial?(O.psColor.value=d.color,O.opacity.value=d.opacity,O.size.value=d.size,O.scale.value=T.height/2,O.map.value=d.map):d instanceof THREE.MeshPhongMaterial?(O.shininess.value=d.shininess,F.gammaInput?(O.ambient.value.copyGammaToLinear(d.ambient),
O.emissive.value.copyGammaToLinear(d.emissive),O.specular.value.copyGammaToLinear(d.specular)):(O.ambient.value=d.ambient,O.emissive.value=d.emissive,O.specular.value=d.specular),d.wrapAround&&O.wrapRGB.value.copy(d.wrapRGB)):d instanceof THREE.MeshLambertMaterial?(F.gammaInput?(O.ambient.value.copyGammaToLinear(d.ambient),O.emissive.value.copyGammaToLinear(d.emissive)):(O.ambient.value=d.ambient,O.emissive.value=d.emissive),d.wrapAround&&O.wrapRGB.value.copy(d.wrapRGB)):d instanceof THREE.MeshDepthMaterial?
(O.mNear.value=a.near,O.mFar.value=a.far,O.opacity.value=d.opacity):d instanceof THREE.MeshNormalMaterial&&(O.opacity.value=d.opacity);if(e.receiveShadow&&!d._shadowPass&&O.shadowMatrix)for(var Eb=0,mb=0,Bb=b.length;mb<Bb;mb++){var lb=b[mb];lb.castShadow&&(lb instanceof THREE.SpotLight||lb instanceof THREE.DirectionalLight&&!lb.shadowCascade)&&(O.shadowMap.value[Eb]=lb.shadowMap,O.shadowMapSize.value[Eb]=lb.shadowMapSize,O.shadowMatrix.value[Eb]=lb.shadowMatrix,O.shadowDarkness.value[Eb]=lb.shadowDarkness,
O.shadowBias.value[Eb]=lb.shadowBias,Eb++)}for(var nb=d.uniformsList,W,Ma,Va,Kb=0,Db=nb.length;Kb<Db;Kb++){var aa=nb[Kb][0];if(!1!==aa.needsUpdate){var Lb=aa.type,S=aa.value,U=nb[Kb][1];switch(Lb){case "1i":n.uniform1i(U,S);break;case "1f":n.uniform1f(U,S);break;case "2f":n.uniform2f(U,S[0],S[1]);break;case "3f":n.uniform3f(U,S[0],S[1],S[2]);break;case "4f":n.uniform4f(U,S[0],S[1],S[2],S[3]);break;case "1iv":n.uniform1iv(U,S);break;case "3iv":n.uniform3iv(U,S);break;case "1fv":n.uniform1fv(U,S);break;
case "2fv":n.uniform2fv(U,S);break;case "3fv":n.uniform3fv(U,S);break;case "4fv":n.uniform4fv(U,S);break;case "Matrix3fv":n.uniformMatrix3fv(U,!1,S);break;case "Matrix4fv":n.uniformMatrix4fv(U,!1,S);break;case "i":n.uniform1i(U,S);break;case "f":n.uniform1f(U,S);break;case "v2":n.uniform2f(U,S.x,S.y);break;case "v3":n.uniform3f(U,S.x,S.y,S.z);break;case "v4":n.uniform4f(U,S.x,S.y,S.z,S.w);break;case "c":n.uniform3f(U,S.r,S.g,S.b);break;case "iv1":n.uniform1iv(U,S);break;case "iv":n.uniform3iv(U,S);
break;case "fv1":n.uniform1fv(U,S);break;case "fv":n.uniform3fv(U,S);break;case "v2v":void 0===aa._array&&(aa._array=new Float32Array(2*S.length));for(var Y=0,Ha=S.length;Y<Ha;Y++)Va=2*Y,aa._array[Va]=S[Y].x,aa._array[Va+1]=S[Y].y;n.uniform2fv(U,aa._array);break;case "v3v":void 0===aa._array&&(aa._array=new Float32Array(3*S.length));Y=0;for(Ha=S.length;Y<Ha;Y++)Va=3*Y,aa._array[Va]=S[Y].x,aa._array[Va+1]=S[Y].y,aa._array[Va+2]=S[Y].z;n.uniform3fv(U,aa._array);break;case "v4v":void 0===aa._array&&
(aa._array=new Float32Array(4*S.length));Y=0;for(Ha=S.length;Y<Ha;Y++)Va=4*Y,aa._array[Va]=S[Y].x,aa._array[Va+1]=S[Y].y,aa._array[Va+2]=S[Y].z,aa._array[Va+3]=S[Y].w;n.uniform4fv(U,aa._array);break;case "m3":n.uniformMatrix3fv(U,!1,S.elements);break;case "m3v":void 0===aa._array&&(aa._array=new Float32Array(9*S.length));Y=0;for(Ha=S.length;Y<Ha;Y++)S[Y].flattenToArrayOffset(aa._array,9*Y);n.uniformMatrix3fv(U,!1,aa._array);break;case "m4":n.uniformMatrix4fv(U,!1,S.elements);break;case "m4v":void 0===
aa._array&&(aa._array=new Float32Array(16*S.length));Y=0;for(Ha=S.length;Y<Ha;Y++)S[Y].flattenToArrayOffset(aa._array,16*Y);n.uniformMatrix4fv(U,!1,aa._array);break;case "t":W=S;Ma=P();n.uniform1i(U,Ma);if(!W)continue;if(W instanceof THREE.CubeTexture||W.image instanceof Array&&6===W.image.length){var na=W,Fb=Ma;if(6===na.image.length)if(na.needsUpdate){na.image.__webglTextureCube||(na.addEventListener("dispose",$b),na.image.__webglTextureCube=n.createTexture(),F.info.memory.textures++);n.activeTexture(n.TEXTURE0+
Fb);n.bindTexture(n.TEXTURE_CUBE_MAP,na.image.__webglTextureCube);n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,na.flipY);for(var Ab=na instanceof THREE.CompressedTexture,ub=na.image[0]instanceof THREE.DataTexture,qb=[],Ca=0;6>Ca;Ca++)qb[Ca]=!F.autoScaleCubemaps||Ab||ub?ub?na.image[Ca].image:na.image[Ca]:I(na.image[Ca],Fc);var Cb=qb[0],Ib=THREE.Math.isPowerOfTwo(Cb.width)&&THREE.Math.isPowerOfTwo(Cb.height),db=L(na.format),Gb=L(na.type);D(n.TEXTURE_CUBE_MAP,na,Ib);for(Ca=0;6>Ca;Ca++)if(Ab)for(var rb,Tb=qb[Ca].mipmaps,
Mb=0,Vb=Tb.length;Mb<Vb;Mb++)rb=Tb[Mb],na.format!==THREE.RGBAFormat&&na.format!==THREE.RGBFormat?-1<oc().indexOf(db)?n.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ca,Mb,db,rb.width,rb.height,0,rb.data):console.warn("Attempt to load unsupported compressed texture format"):n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ca,Mb,db,rb.width,rb.height,0,db,Gb,rb.data);else ub?n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ca,0,db,qb[Ca].width,qb[Ca].height,0,db,Gb,qb[Ca].data):n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+
Ca,0,db,db,Gb,qb[Ca]);na.generateMipmaps&&Ib&&n.generateMipmap(n.TEXTURE_CUBE_MAP);na.needsUpdate=!1;if(na.onUpdate)na.onUpdate()}else n.activeTexture(n.TEXTURE0+Fb),n.bindTexture(n.TEXTURE_CUBE_MAP,na.image.__webglTextureCube)}else if(W instanceof THREE.WebGLRenderTargetCube){var ac=W;n.activeTexture(n.TEXTURE0+Ma);n.bindTexture(n.TEXTURE_CUBE_MAP,ac.__webglTexture)}else F.setTexture(W,Ma);break;case "tv":void 0===aa._array&&(aa._array=[]);Y=0;for(Ha=aa.value.length;Y<Ha;Y++)aa._array[Y]=P();n.uniform1iv(U,
aa._array);Y=0;for(Ha=aa.value.length;Y<Ha;Y++)W=aa.value[Y],Ma=aa._array[Y],W&&F.setTexture(W,Ma);break;default:console.warn("THREE.WebGLRenderer: Unknown uniform type: "+Lb)}}}}n.uniformMatrix4fv(ka.modelViewMatrix,!1,e._modelViewMatrix.elements);ka.normalMatrix&&n.uniformMatrix3fv(ka.normalMatrix,!1,e._normalMatrix.elements);null!==ka.modelMatrix&&n.uniformMatrix4fv(ka.modelMatrix,!1,e.matrixWorld.elements);return La}function R(a,b){a.ambientLightColor.needsUpdate=b;a.directionalLightColor.needsUpdate=
b;a.directionalLightDirection.needsUpdate=b;a.pointLightColor.needsUpdate=b;a.pointLightPosition.needsUpdate=b;a.pointLightDistance.needsUpdate=b;a.spotLightColor.needsUpdate=b;a.spotLightPosition.needsUpdate=b;a.spotLightDistance.needsUpdate=b;a.spotLightDirection.needsUpdate=b;a.spotLightAngleCos.needsUpdate=b;a.spotLightExponent.needsUpdate=b;a.hemisphereLightSkyColor.needsUpdate=b;a.hemisphereLightGroundColor.needsUpdate=b;a.hemisphereLightDirection.needsUpdate=b}function P(){var a=Nb;a>=pc&&
console.warn("WebGLRenderer: trying to use "+a+" texture units while this GPU supports only "+pc);Nb+=1;return a}function A(a,b){a._modelViewMatrix.multiplyMatrices(b.matrixWorldInverse,a.matrixWorld);a._normalMatrix.getNormalMatrix(a._modelViewMatrix)}function M(a,b,c,d){a[b]=c.r*c.r*d;a[b+1]=c.g*c.g*d;a[b+2]=c.b*c.b*d}function Q(a,b,c,d){a[b]=c.r*d;a[b+1]=c.g*d;a[b+2]=c.b*d}function K(a){a*=E;a!==qc&&(n.lineWidth(a),qc=a)}function B(a,b,c){rc!==a&&(a?n.enable(n.POLYGON_OFFSET_FILL):n.disable(n.POLYGON_OFFSET_FILL),
rc=a);!a||sc===b&&tc===c||(n.polygonOffset(b,c),sc=b,tc=c)}function D(a,b,c){c?(n.texParameteri(a,n.TEXTURE_WRAP_S,L(b.wrapS)),n.texParameteri(a,n.TEXTURE_WRAP_T,L(b.wrapT)),n.texParameteri(a,n.TEXTURE_MAG_FILTER,L(b.magFilter)),n.texParameteri(a,n.TEXTURE_MIN_FILTER,L(b.minFilter))):(n.texParameteri(a,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(a,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),b.wrapS===THREE.ClampToEdgeWrapping&&b.wrapT===THREE.ClampToEdgeWrapping||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT is set to THREE.ClampToEdgeWrapping. ( "+
b.sourceFile+" )"),n.texParameteri(a,n.TEXTURE_MAG_FILTER,N(b.magFilter)),n.texParameteri(a,n.TEXTURE_MIN_FILTER,N(b.minFilter)),b.minFilter!==THREE.NearestFilter&&b.minFilter!==THREE.LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter is set to THREE.LinearFilter or THREE.NearestFilter. ( "+b.sourceFile+" )"));(c=ea.get("EXT_texture_filter_anisotropic"))&&b.type!==THREE.FloatType&&(1<b.anisotropy||b.__oldAnisotropy)&&(n.texParameterf(a,c.TEXTURE_MAX_ANISOTROPY_EXT,
Math.min(b.anisotropy,F.getMaxAnisotropy())),b.__oldAnisotropy=b.anisotropy)}function I(a,b){if(a.width>b||a.height>b){var c=b/Math.max(a.width,a.height),d=document.createElement("canvas");d.width=Math.floor(a.width*c);d.height=Math.floor(a.height*c);d.getContext("2d").drawImage(a,0,0,a.width,a.height,0,0,d.width,d.height);console.log("THREE.WebGLRenderer:",a,"is too big ("+a.width+"x"+a.height+"). Resized to "+d.width+"x"+d.height+".");return d}return a}function G(a,b){n.bindRenderbuffer(n.RENDERBUFFER,
a);b.depthBuffer&&!b.stencilBuffer?(n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_COMPONENT16,b.width,b.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,a)):b.depthBuffer&&b.stencilBuffer?(n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,b.width,b.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,a)):n.renderbufferStorage(n.RENDERBUFFER,n.RGBA4,b.width,b.height)}function H(a){a instanceof THREE.WebGLRenderTargetCube?(n.bindTexture(n.TEXTURE_CUBE_MAP,
a.__webglTexture),n.generateMipmap(n.TEXTURE_CUBE_MAP),n.bindTexture(n.TEXTURE_CUBE_MAP,null)):(n.bindTexture(n.TEXTURE_2D,a.__webglTexture),n.generateMipmap(n.TEXTURE_2D),n.bindTexture(n.TEXTURE_2D,null))}function N(a){return a===THREE.NearestFilter||a===THREE.NearestMipMapNearestFilter||a===THREE.NearestMipMapLinearFilter?n.NEAREST:n.LINEAR}function L(a){if(a===THREE.RepeatWrapping)return n.REPEAT;if(a===THREE.ClampToEdgeWrapping)return n.CLAMP_TO_EDGE;if(a===THREE.MirroredRepeatWrapping)return n.MIRRORED_REPEAT;
if(a===THREE.NearestFilter)return n.NEAREST;if(a===THREE.NearestMipMapNearestFilter)return n.NEAREST_MIPMAP_NEAREST;if(a===THREE.NearestMipMapLinearFilter)return n.NEAREST_MIPMAP_LINEAR;if(a===THREE.LinearFilter)return n.LINEAR;if(a===THREE.LinearMipMapNearestFilter)return n.LINEAR_MIPMAP_NEAREST;if(a===THREE.LinearMipMapLinearFilter)return n.LINEAR_MIPMAP_LINEAR;if(a===THREE.UnsignedByteType)return n.UNSIGNED_BYTE;if(a===THREE.UnsignedShort4444Type)return n.UNSIGNED_SHORT_4_4_4_4;if(a===THREE.UnsignedShort5551Type)return n.UNSIGNED_SHORT_5_5_5_1;
if(a===THREE.UnsignedShort565Type)return n.UNSIGNED_SHORT_5_6_5;if(a===THREE.ByteType)return n.BYTE;if(a===THREE.ShortType)return n.SHORT;if(a===THREE.UnsignedShortType)return n.UNSIGNED_SHORT;if(a===THREE.IntType)return n.INT;if(a===THREE.UnsignedIntType)return n.UNSIGNED_INT;if(a===THREE.FloatType)return n.FLOAT;if(a===THREE.AlphaFormat)return n.ALPHA;if(a===THREE.RGBFormat)return n.RGB;if(a===THREE.RGBAFormat)return n.RGBA;if(a===THREE.LuminanceFormat)return n.LUMINANCE;if(a===THREE.LuminanceAlphaFormat)return n.LUMINANCE_ALPHA;
if(a===THREE.AddEquation)return n.FUNC_ADD;if(a===THREE.SubtractEquation)return n.FUNC_SUBTRACT;if(a===THREE.ReverseSubtractEquation)return n.FUNC_REVERSE_SUBTRACT;if(a===THREE.ZeroFactor)return n.ZERO;if(a===THREE.OneFactor)return n.ONE;if(a===THREE.SrcColorFactor)return n.SRC_COLOR;if(a===THREE.OneMinusSrcColorFactor)return n.ONE_MINUS_SRC_COLOR;if(a===THREE.SrcAlphaFactor)return n.SRC_ALPHA;if(a===THREE.OneMinusSrcAlphaFactor)return n.ONE_MINUS_SRC_ALPHA;if(a===THREE.DstAlphaFactor)return n.DST_ALPHA;
if(a===THREE.OneMinusDstAlphaFactor)return n.ONE_MINUS_DST_ALPHA;if(a===THREE.DstColorFactor)return n.DST_COLOR;if(a===THREE.OneMinusDstColorFactor)return n.ONE_MINUS_DST_COLOR;if(a===THREE.SrcAlphaSaturateFactor)return n.SRC_ALPHA_SATURATE;var b=ea.get("WEBGL_compressed_texture_s3tc");if(null!==b){if(a===THREE.RGB_S3TC_DXT1_Format)return b.COMPRESSED_RGB_S3TC_DXT1_EXT;if(a===THREE.RGBA_S3TC_DXT1_Format)return b.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(a===THREE.RGBA_S3TC_DXT3_Format)return b.COMPRESSED_RGBA_S3TC_DXT3_EXT;
if(a===THREE.RGBA_S3TC_DXT5_Format)return b.COMPRESSED_RGBA_S3TC_DXT5_EXT}b=ea.get("WEBGL_compressed_texture_pvrtc");if(null!==b){if(a===THREE.RGB_PVRTC_4BPPV1_Format)return b.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(a===THREE.RGB_PVRTC_2BPPV1_Format)return b.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(a===THREE.RGBA_PVRTC_4BPPV1_Format)return b.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(a===THREE.RGBA_PVRTC_2BPPV1_Format)return b.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}b=ea.get("EXT_blend_minmax");if(null!==b){if(a===THREE.MinEquation)return b.MIN_EXT;
if(a===THREE.MaxEquation)return b.MAX_EXT}return 0}console.log("THREE.WebGLRenderer",THREE.REVISION);b=b||{};var T=void 0!==b.canvas?b.canvas:document.createElement("canvas"),ba=void 0!==b.context?b.context:null,E=1,V=void 0!==b.precision?b.precision:"highp",da=void 0!==b.alpha?b.alpha:!1,Da=void 0!==b.depth?b.depth:!0,Ia=void 0!==b.stencil?b.stencil:!0,Ea=void 0!==b.antialias?b.antialias:!1,ia=void 0!==b.premultipliedAlpha?b.premultipliedAlpha:!0,Z=void 0!==b.preserveDrawingBuffer?b.preserveDrawingBuffer:
!1,X=void 0!==b.logarithmicDepthBuffer?b.logarithmicDepthBuffer:!1,va=new THREE.Color(0),Ra=0,Fa=[],Ja={},Ka=[],Na=[],La=[],wb=[],eb=[];this.domElement=T;this.context=null;this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;this.shadowMapEnabled=this.gammaOutput=this.gammaInput=!1;this.shadowMapType=THREE.PCFShadowMap;this.shadowMapCullFace=THREE.CullFaceFront;this.shadowMapCascade=this.shadowMapDebug=!1;this.maxMorphTargets=8;this.maxMorphNormals=4;this.autoScaleCubemaps=
!0;this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var F=this,ab=[],Rb=null,uc=null,Hb=-1,Qa="",Ob=null,Nb=0,Ib=-1,sb=-1,Ab=-1,tb=-1,mb=-1,Bb=-1,Tb=-1,ac=-1,rc=null,sc=null,tc=null,qc=null,ub=0,Cb=0,nb=T.width,ib=T.height,vc=0,wc=0,Db=new Uint8Array(16),Ya=new Uint8Array(16),fb=new THREE.Frustum,jb=new THREE.Matrix4;new THREE.Matrix4;var Ga=new THREE.Vector3,oa=new THREE.Vector3,Sb=!0,nc={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},
point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};try{var xc={alpha:da,depth:Da,stencil:Ia,antialias:Ea,premultipliedAlpha:ia,preserveDrawingBuffer:Z};var n=ba||T.getContext("webgl",xc)||T.getContext("experimental-webgl",xc);if(null===n){if(null!==T.getContext("webgl"))throw"Error creating WebGL context with your selected attributes.";throw"Error creating WebGL context.";
}T.addEventListener("webglcontextlost",function(a){a.preventDefault();yc();zc();Ja={}},!1)}catch(wa){console.error(wa)}void 0===n.getShaderPrecisionFormat&&(n.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}});var ea=new THREE.WebGLExtensions(n);ea.get("OES_texture_float");ea.get("OES_texture_float_linear");ea.get("OES_standard_derivatives");X&&ea.get("EXT_frag_depth");var zc=function(){n.clearColor(0,0,0,1);n.clearDepth(1);n.clearStencil(0);n.enable(n.DEPTH_TEST);n.depthFunc(n.LEQUAL);
n.frontFace(n.CCW);n.cullFace(n.BACK);n.enable(n.CULL_FACE);n.enable(n.BLEND);n.blendEquation(n.FUNC_ADD);n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA);n.viewport(ub,Cb,nb,ib);n.clearColor(va.r,va.g,va.b,Ra)},yc=function(){Ob=Rb=null;sb=Ib=ac=Tb=Ab=-1;Qa="";Hb=-1;Sb=!0;for(var a=0;a<Ya.length;a++)Ya[a]=0};zc();this.context=n;var pc=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),Gc=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),Hc=n.getParameter(n.MAX_TEXTURE_SIZE),Fc=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),
Zb=0<Gc,Qb=Zb&&ea.get("OES_texture_float"),Ic=n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT),Jc=n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT);n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.LOW_FLOAT);var Kc=n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT),Lc=n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT);n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.LOW_FLOAT);var oc=function(){var a;return function(){if(void 0!==a)return a;a=[];if(ea.get("WEBGL_compressed_texture_pvrtc")||
ea.get("WEBGL_compressed_texture_s3tc"))for(var b=n.getParameter(n.COMPRESSED_TEXTURE_FORMATS),c=0;c<b.length;c++)a.push(b[c]);return a}}(),Mc=0<Ic.precision&&0<Kc.precision,Ac=0<Jc.precision&&0<Lc.precision;"highp"!==V||Mc||(Ac?(V="mediump",console.warn("THREE.WebGLRenderer: highp not supported, using mediump.")):(V="lowp",console.warn("THREE.WebGLRenderer: highp and mediump not supported, using lowp.")));"mediump"!==V||Ac||(V="lowp",console.warn("THREE.WebGLRenderer: mediump not supported, using lowp."));
var Nc=new THREE.ShadowMapPlugin(this,Fa,Ja,Ka),Oc=new THREE.SpritePlugin(this,wb),Pc=new THREE.LensFlarePlugin(this,eb);this.getContext=function(){return n};this.forceContextLoss=function(){ea.get("WEBGL_lose_context").loseContext()};this.supportsVertexTextures=function(){return Zb};this.supportsFloatTextures=function(){return ea.get("OES_texture_float")};this.supportsStandardDerivatives=function(){return ea.get("OES_standard_derivatives")};this.supportsCompressedTextureS3TC=function(){return ea.get("WEBGL_compressed_texture_s3tc")};
this.supportsCompressedTexturePVRTC=function(){return ea.get("WEBGL_compressed_texture_pvrtc")};this.supportsBlendMinMax=function(){return ea.get("EXT_blend_minmax")};this.getMaxAnisotropy=function(){var a;return function(){if(void 0!==a)return a;var b=ea.get("EXT_texture_filter_anisotropic");return a=null!==b?n.getParameter(b.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}}();this.getPrecision=function(){return V};this.getPixelRatio=function(){return E};this.setPixelRatio=function(a){E=a};this.setSize=function(a,
b,c){T.width=a*E;T.height=b*E;!1!==c&&(T.style.width=a+"px",T.style.height=b+"px");this.setViewport(0,0,a,b)};this.setViewport=function(a,b,c,d){ub=a*E;Cb=b*E;nb=c*E;ib=d*E;n.viewport(ub,Cb,nb,ib)};this.setScissor=function(a,b,c,d){n.scissor(a*E,b*E,c*E,d*E)};this.enableScissorTest=function(a){a?n.enable(n.SCISSOR_TEST):n.disable(n.SCISSOR_TEST)};this.getClearColor=function(){return va};this.setClearColor=function(a,b){va.set(a);Ra=void 0!==b?b:1;n.clearColor(va.r,va.g,va.b,Ra)};this.getClearAlpha=
function(){return Ra};this.setClearAlpha=function(a){Ra=a;n.clearColor(va.r,va.g,va.b,Ra)};this.clear=function(a,b,c){var d=0;if(void 0===a||a)d|=n.COLOR_BUFFER_BIT;if(void 0===b||b)d|=n.DEPTH_BUFFER_BIT;if(void 0===c||c)d|=n.STENCIL_BUFFER_BIT;n.clear(d)};this.clearColor=function(){n.clear(n.COLOR_BUFFER_BIT)};this.clearDepth=function(){n.clear(n.DEPTH_BUFFER_BIT)};this.clearStencil=function(){n.clear(n.STENCIL_BUFFER_BIT)};this.clearTarget=function(a,b,c,d){this.setRenderTarget(a);this.clear(b,
c,d)};this.resetGLState=yc;var gc=function(a){a.target.traverse(function(a){a.removeEventListener("remove",gc);if(a instanceof THREE.Mesh||a instanceof THREE.PointCloud||a instanceof THREE.Line)delete Ja[a.id];else if(a instanceof THREE.ImmediateRenderObject||a.immediateRenderCallback)for(var b=Ka,c=b.length-1;0<=c;c--)b[c].object===a&&b.splice(c,1);delete a.__webglInit;delete a._modelViewMatrix;delete a._normalMatrix;delete a.__webglActive})},hc=function(a){a=a.target;a.removeEventListener("dispose",
hc);delete a.__webglInit;if(a instanceof THREE.BufferGeometry){for(var b in a.attributes){var c=a.attributes[b];void 0!==c.buffer&&(n.deleteBuffer(c.buffer),delete c.buffer)}F.info.memory.geometries--}else if(b=vb[a.id],void 0!==b){c=0;for(var d=b.length;c<d;c++){var e=b[c];if(void 0!==e.numMorphTargets){for(var f=0,g=e.numMorphTargets;f<g;f++)n.deleteBuffer(e.__webglMorphTargetsBuffers[f]);delete e.__webglMorphTargetsBuffers}if(void 0!==e.numMorphNormals){f=0;for(g=e.numMorphNormals;f<g;f++)n.deleteBuffer(e.__webglMorphNormalsBuffers[f]);
delete e.__webglMorphNormalsBuffers}Bc(e)}delete vb[a.id]}else Bc(a);Qa=""},$b=function(a){a=a.target;a.removeEventListener("dispose",$b);a.image&&a.image.__webglTextureCube?(n.deleteTexture(a.image.__webglTextureCube),delete a.image.__webglTextureCube):void 0!==a.__webglInit&&(n.deleteTexture(a.__webglTexture),delete a.__webglTexture,delete a.__webglInit);F.info.memory.textures--},Cc=function(a){a=a.target;a.removeEventListener("dispose",Cc);if(a&&void 0!==a.__webglTexture){n.deleteTexture(a.__webglTexture);
delete a.__webglTexture;if(a instanceof THREE.WebGLRenderTargetCube)for(var b=0;6>b;b++)n.deleteFramebuffer(a.__webglFramebuffer[b]),n.deleteRenderbuffer(a.__webglRenderbuffer[b]);else n.deleteFramebuffer(a.__webglFramebuffer),n.deleteRenderbuffer(a.__webglRenderbuffer);delete a.__webglFramebuffer;delete a.__webglRenderbuffer}F.info.memory.textures--},mc=function(a){a=a.target;a.removeEventListener("dispose",mc);lc(a)},Bc=function(a){for(var b="__webglVertexBuffer __webglNormalBuffer __webglTangentBuffer __webglColorBuffer __webglUVBuffer __webglUV2Buffer __webglSkinIndicesBuffer __webglSkinWeightsBuffer __webglFaceBuffer __webglLineBuffer __webglLineDistanceBuffer".split(" "),
c=0,d=b.length;c<d;c++){var e=b[c];void 0!==a[e]&&(n.deleteBuffer(a[e]),delete a[e])}if(void 0!==a.__webglCustomAttributesList){for(e in a.__webglCustomAttributesList)n.deleteBuffer(a.__webglCustomAttributesList[e].buffer);delete a.__webglCustomAttributesList}F.info.memory.geometries--},lc=function(a){var b=a.program.program;if(void 0!==b){a.program=void 0;var c,d,e=!1;a=0;for(c=ab.length;a<c;a++)if(d=ab[a],d.program===b){d.usedTimes--;0===d.usedTimes&&(e=!0);break}if(!0===e){e=[];a=0;for(c=ab.length;a<
c;a++)d=ab[a],d.program!==b&&e.push(d);ab=e;n.deleteProgram(b);F.info.memory.programs--}}};this.renderBufferImmediate=function(a,b,c){f();a.hasPositions&&!a.__webglVertexBuffer&&(a.__webglVertexBuffer=n.createBuffer());a.hasNormals&&!a.__webglNormalBuffer&&(a.__webglNormalBuffer=n.createBuffer());a.hasUvs&&!a.__webglUvBuffer&&(a.__webglUvBuffer=n.createBuffer());a.hasColors&&!a.__webglColorBuffer&&(a.__webglColorBuffer=n.createBuffer());a.hasPositions&&(n.bindBuffer(n.ARRAY_BUFFER,a.__webglVertexBuffer),
n.bufferData(n.ARRAY_BUFFER,a.positionArray,n.DYNAMIC_DRAW),g(b.attributes.position),n.vertexAttribPointer(b.attributes.position,3,n.FLOAT,!1,0,0));if(a.hasNormals){n.bindBuffer(n.ARRAY_BUFFER,a.__webglNormalBuffer);if(c.shading===THREE.FlatShading){var d,e=3*a.count;for(d=0;d<e;d+=9){var k=a.normalArray;var l=k[d];var m=k[d+1];var p=k[d+2];var q=k[d+3];var r=k[d+4];var t=k[d+5];var u=k[d+6];var w=k[d+7];var v=k[d+8];l=(l+q+u)/3;m=(m+r+w)/3;p=(p+t+v)/3;k[d]=l;k[d+1]=m;k[d+2]=p;k[d+3]=l;k[d+4]=m;k[d+
5]=p;k[d+6]=l;k[d+7]=m;k[d+8]=p}}n.bufferData(n.ARRAY_BUFFER,a.normalArray,n.DYNAMIC_DRAW);g(b.attributes.normal);n.vertexAttribPointer(b.attributes.normal,3,n.FLOAT,!1,0,0)}a.hasUvs&&c.map&&(n.bindBuffer(n.ARRAY_BUFFER,a.__webglUvBuffer),n.bufferData(n.ARRAY_BUFFER,a.uvArray,n.DYNAMIC_DRAW),g(b.attributes.uv),n.vertexAttribPointer(b.attributes.uv,2,n.FLOAT,!1,0,0));a.hasColors&&c.vertexColors!==THREE.NoColors&&(n.bindBuffer(n.ARRAY_BUFFER,a.__webglColorBuffer),n.bufferData(n.ARRAY_BUFFER,a.colorArray,
n.DYNAMIC_DRAW),g(b.attributes.color),n.vertexAttribPointer(b.attributes.color,3,n.FLOAT,!1,0,0));h();n.drawArrays(n.TRIANGLES,0,a.count);a.count=0};this.renderBufferDirect=function(a,b,c,d,g,h){if(!1!==d.visible)if(w(h),a=y(a,b,c,d,h),b=!1,c="direct_"+g.id+"_"+a.id+"_"+(d.wireframe?1:0),c!==Qa&&(Qa=c,b=!0),b&&f(),h instanceof THREE.Mesh){h=!0===d.wireframe?n.LINES:n.TRIANGLES;var k=g.attributes.index;if(k){var l,m;k.array instanceof Uint32Array&&ea.get("OES_element_index_uint")?(l=n.UNSIGNED_INT,
m=4):(l=n.UNSIGNED_SHORT,m=2);c=g.offsets;if(0===c.length)b&&(e(d,a,g,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,k.buffer)),n.drawElements(h,k.array.length,l,0),F.info.render.calls++,F.info.render.vertices+=k.array.length,F.info.render.faces+=k.array.length/3;else{b=!0;for(var p=0,q=c.length;p<q;p++){var r=c[p].index;b&&(e(d,a,g,r),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,k.buffer));n.drawElements(h,c[p].count,l,c[p].start*m);F.info.render.calls++;F.info.render.vertices+=c[p].count;F.info.render.faces+=c[p].count/
3}}}else b&&e(d,a,g,0),d=g.attributes.position,n.drawArrays(h,0,d.array.length/3),F.info.render.calls++,F.info.render.vertices+=d.array.length/3,F.info.render.faces+=d.array.length/9}else if(h instanceof THREE.PointCloud)if(h=n.POINTS,k=g.attributes.index)if(k.array instanceof Uint32Array&&ea.get("OES_element_index_uint")?(l=n.UNSIGNED_INT,m=4):(l=n.UNSIGNED_SHORT,m=2),c=g.offsets,0===c.length)b&&(e(d,a,g,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,k.buffer)),n.drawElements(h,k.array.length,l,0),F.info.render.calls++,
F.info.render.points+=k.array.length;else for(1<c.length&&(b=!0),p=0,q=c.length;p<q;p++)r=c[p].index,b&&(e(d,a,g,r),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,k.buffer)),n.drawElements(h,c[p].count,l,c[p].start*m),F.info.render.calls++,F.info.render.points+=c[p].count;else if(b&&e(d,a,g,0),d=g.attributes.position,c=g.offsets,0===c.length)n.drawArrays(h,0,d.array.length/3),F.info.render.calls++,F.info.render.points+=d.array.length/3;else for(p=0,q=c.length;p<q;p++)n.drawArrays(h,c[p].index,c[p].count),F.info.render.calls++,
F.info.render.points+=c[p].count;else if(h instanceof THREE.Line)if(h=h.mode===THREE.LineStrip?n.LINE_STRIP:n.LINES,K(d.linewidth),k=g.attributes.index)if(k.array instanceof Uint32Array?(l=n.UNSIGNED_INT,m=4):(l=n.UNSIGNED_SHORT,m=2),c=g.offsets,0===c.length)b&&(e(d,a,g,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,k.buffer)),n.drawElements(h,k.array.length,l,0),F.info.render.calls++,F.info.render.vertices+=k.array.length;else for(1<c.length&&(b=!0),p=0,q=c.length;p<q;p++)r=c[p].index,b&&(e(d,a,g,r),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,
k.buffer)),n.drawElements(h,c[p].count,l,c[p].start*m),F.info.render.calls++,F.info.render.vertices+=c[p].count;else if(b&&e(d,a,g,0),d=g.attributes.position,c=g.offsets,0===c.length)n.drawArrays(h,0,d.array.length/3),F.info.render.calls++,F.info.render.vertices+=d.array.length/3;else for(p=0,q=c.length;p<q;p++)n.drawArrays(h,c[p].index,c[p].count),F.info.render.calls++,F.info.render.vertices+=c[p].count};this.renderBuffer=function(a,b,c,d,e,k){if(!1!==d.visible){w(k);c=y(a,b,c,d,k);b=c.attributes;
a=!1;c=e.id+"_"+c.id+"_"+(d.wireframe?1:0);c!==Qa&&(Qa=c,a=!0);a&&f();if(!d.morphTargets&&0<=b.position)a&&(n.bindBuffer(n.ARRAY_BUFFER,e.__webglVertexBuffer),g(b.position),n.vertexAttribPointer(b.position,3,n.FLOAT,!1,0,0));else if(k.morphTargetBase){c=d.program.attributes;-1!==k.morphTargetBase&&0<=c.position?(n.bindBuffer(n.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[k.morphTargetBase]),g(c.position),n.vertexAttribPointer(c.position,3,n.FLOAT,!1,0,0)):0<=c.position&&(n.bindBuffer(n.ARRAY_BUFFER,
e.__webglVertexBuffer),g(c.position),n.vertexAttribPointer(c.position,3,n.FLOAT,!1,0,0));if(k.morphTargetForcedOrder.length)for(var l=0,m=k.morphTargetForcedOrder,q=k.morphTargetInfluences,r;l<d.numSupportedMorphTargets&&l<m.length;)r=c["morphTarget"+l],0<=r&&(n.bindBuffer(n.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[m[l]]),g(r),n.vertexAttribPointer(r,3,n.FLOAT,!1,0,0)),r=c["morphNormal"+l],0<=r&&d.morphNormals&&(n.bindBuffer(n.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[m[l]]),g(r),n.vertexAttribPointer(r,
3,n.FLOAT,!1,0,0)),k.__webglMorphTargetInfluences[l]=q[m[l]],l++;else{m=[];q=k.morphTargetInfluences;l=0;for(r=q.length;l<r;l++)m.push([q[l],l]);m.length>d.numSupportedMorphTargets?(m.sort(p),m.length=d.numSupportedMorphTargets):m.length>d.numSupportedMorphNormals?m.sort(p):0===m.length&&m.push([0,0]);l=0;for(var t=d.numSupportedMorphTargets;l<t;l++)if(m[l]){var u=m[l][1];r=c["morphTarget"+l];0<=r&&(n.bindBuffer(n.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[u]),g(r),n.vertexAttribPointer(r,3,n.FLOAT,
!1,0,0));r=c["morphNormal"+l];0<=r&&d.morphNormals&&(n.bindBuffer(n.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[u]),g(r),n.vertexAttribPointer(r,3,n.FLOAT,!1,0,0));k.__webglMorphTargetInfluences[l]=q[u]}else k.__webglMorphTargetInfluences[l]=0}null!==d.program.uniforms.morphTargetInfluences&&n.uniform1fv(d.program.uniforms.morphTargetInfluences,k.__webglMorphTargetInfluences)}if(a){if(e.__webglCustomAttributesList)for(c=0,q=e.__webglCustomAttributesList.length;c<q;c++)m=e.__webglCustomAttributesList[c],
0<=b[m.buffer.belongsToAttribute]&&(n.bindBuffer(n.ARRAY_BUFFER,m.buffer),g(b[m.buffer.belongsToAttribute]),n.vertexAttribPointer(b[m.buffer.belongsToAttribute],m.size,n.FLOAT,!1,0,0));0<=b.color&&(0<k.geometry.colors.length||0<k.geometry.faces.length?(n.bindBuffer(n.ARRAY_BUFFER,e.__webglColorBuffer),g(b.color),n.vertexAttribPointer(b.color,3,n.FLOAT,!1,0,0)):void 0!==d.defaultAttributeValues&&n.vertexAttrib3fv(b.color,d.defaultAttributeValues.color));0<=b.normal&&(n.bindBuffer(n.ARRAY_BUFFER,e.__webglNormalBuffer),
g(b.normal),n.vertexAttribPointer(b.normal,3,n.FLOAT,!1,0,0));0<=b.tangent&&(n.bindBuffer(n.ARRAY_BUFFER,e.__webglTangentBuffer),g(b.tangent),n.vertexAttribPointer(b.tangent,4,n.FLOAT,!1,0,0));0<=b.uv&&(k.geometry.faceVertexUvs[0]?(n.bindBuffer(n.ARRAY_BUFFER,e.__webglUVBuffer),g(b.uv),n.vertexAttribPointer(b.uv,2,n.FLOAT,!1,0,0)):void 0!==d.defaultAttributeValues&&n.vertexAttrib2fv(b.uv,d.defaultAttributeValues.uv));0<=b.uv2&&(k.geometry.faceVertexUvs[1]?(n.bindBuffer(n.ARRAY_BUFFER,e.__webglUV2Buffer),
g(b.uv2),n.vertexAttribPointer(b.uv2,2,n.FLOAT,!1,0,0)):void 0!==d.defaultAttributeValues&&n.vertexAttrib2fv(b.uv2,d.defaultAttributeValues.uv2));d.skinning&&0<=b.skinIndex&&0<=b.skinWeight&&(n.bindBuffer(n.ARRAY_BUFFER,e.__webglSkinIndicesBuffer),g(b.skinIndex),n.vertexAttribPointer(b.skinIndex,4,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,e.__webglSkinWeightsBuffer),g(b.skinWeight),n.vertexAttribPointer(b.skinWeight,4,n.FLOAT,!1,0,0));0<=b.lineDistance&&(n.bindBuffer(n.ARRAY_BUFFER,e.__webglLineDistanceBuffer),
g(b.lineDistance),n.vertexAttribPointer(b.lineDistance,1,n.FLOAT,!1,0,0))}h();k instanceof THREE.Mesh?(k=e.__typeArray===Uint32Array?n.UNSIGNED_INT:n.UNSIGNED_SHORT,d.wireframe?(K(d.wireframeLinewidth),a&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),n.drawElements(n.LINES,e.__webglLineCount,k,0)):(a&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),n.drawElements(n.TRIANGLES,e.__webglFaceCount,k,0)),F.info.render.calls++,F.info.render.vertices+=e.__webglFaceCount,F.info.render.faces+=
e.__webglFaceCount/3):k instanceof THREE.Line?(k=k.mode===THREE.LineStrip?n.LINE_STRIP:n.LINES,K(d.linewidth),n.drawArrays(k,0,e.__webglLineCount),F.info.render.calls++):k instanceof THREE.PointCloud&&(n.drawArrays(n.POINTS,0,e.__webglParticleCount),F.info.render.calls++,F.info.render.points+=e.__webglParticleCount)}};this.render=function(a,b,c,d){if(!1===b instanceof THREE.Camera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else{var e=a.fog;Qa="";Hb=-1;
Ob=null;Sb=!0;!0===a.autoUpdate&&a.updateMatrixWorld();void 0===b.parent&&b.updateMatrixWorld();a.traverse(function(a){a instanceof THREE.SkinnedMesh&&a.skeleton.update()});b.matrixWorldInverse.getInverse(b.matrixWorld);jb.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse);fb.setFromMatrix(jb);Fa.length=0;Na.length=0;La.length=0;wb.length=0;eb.length=0;q(a);!0===F.sortObjects&&(Na.sort(k),La.sort(l));Nc.render(a,b);F.info.render.calls=0;F.info.render.vertices=0;F.info.render.faces=0;F.info.render.points=
0;this.setRenderTarget(c);(this.autoClear||d)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);d=0;for(var f=Ka.length;d<f;d++){var g=Ka[d],h=g.object;h.visible&&(A(h,b),t(g))}a.overrideMaterial?(d=a.overrideMaterial,this.setBlending(d.blending,d.blendEquation,d.blendSrc,d.blendDst),this.setDepthTest(d.depthTest),this.setDepthWrite(d.depthWrite),B(d.polygonOffset,d.polygonOffsetFactor,d.polygonOffsetUnits),m(Na,b,Fa,e,!0,d),m(La,b,Fa,e,!0,d),r(Ka,"",b,Fa,e,!1,d)):(d=null,
this.setBlending(THREE.NoBlending),m(Na,b,Fa,e,!1,d),r(Ka,"opaque",b,Fa,e,!1,d),m(La,b,Fa,e,!0,d),r(Ka,"transparent",b,Fa,e,!0,d));Oc.render(a,b);Pc.render(a,b,vc,wc);c&&c.generateMipmaps&&c.minFilter!==THREE.NearestFilter&&c.minFilter!==THREE.LinearFilter&&H(c);this.setDepthTest(!0);this.setDepthWrite(!0)}};this.renderImmediateObject=function(a,b,c,d,e){var f=y(a,b,c,d,e);Qa="";F.setMaterialFaces(d);e.immediateRenderCallback?e.immediateRenderCallback(f,n,fb):e.render(function(a){F.renderBufferImmediate(a,
f,d)})};var vb={},ic=0,Ec={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointCloudMaterial:"particle_basic"};this.setFaceCulling=function(a,b){a===THREE.CullFaceNone?n.disable(n.CULL_FACE):(b===THREE.FrontFaceDirectionCW?n.frontFace(n.CW):n.frontFace(n.CCW),a===THREE.CullFaceBack?n.cullFace(n.BACK):a===THREE.CullFaceFront?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK),
n.enable(n.CULL_FACE))};this.setMaterialFaces=function(a){var b=a.side===THREE.DoubleSide;a=a.side===THREE.BackSide;Ib!==b&&(b?n.disable(n.CULL_FACE):n.enable(n.CULL_FACE),Ib=b);sb!==a&&(a?n.frontFace(n.CW):n.frontFace(n.CCW),sb=a)};this.setDepthTest=function(a){Tb!==a&&(a?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),Tb=a)};this.setDepthWrite=function(a){ac!==a&&(n.depthMask(a),ac=a)};this.setBlending=function(a,b,c,d){a!==Ab&&(a===THREE.NoBlending?n.disable(n.BLEND):a===THREE.AdditiveBlending?
(n.enable(n.BLEND),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.SRC_ALPHA,n.ONE)):a===THREE.SubtractiveBlending?(n.enable(n.BLEND),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ZERO,n.ONE_MINUS_SRC_COLOR)):a===THREE.MultiplyBlending?(n.enable(n.BLEND),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ZERO,n.SRC_COLOR)):a===THREE.CustomBlending?n.enable(n.BLEND):(n.enable(n.BLEND),n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD),n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA)),Ab=
a);if(a===THREE.CustomBlending){if(b!==tb&&(n.blendEquation(L(b)),tb=b),c!==mb||d!==Bb)n.blendFunc(L(c),L(d)),mb=c,Bb=d}else Bb=mb=tb=null};this.uploadTexture=function(a){void 0===a.__webglInit&&(a.__webglInit=!0,a.addEventListener("dispose",$b),a.__webglTexture=n.createTexture(),F.info.memory.textures++);n.bindTexture(n.TEXTURE_2D,a.__webglTexture);n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,a.flipY);n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha);n.pixelStorei(n.UNPACK_ALIGNMENT,a.unpackAlignment);
a.image=I(a.image,Hc);var b=a.image,c=THREE.Math.isPowerOfTwo(b.width)&&THREE.Math.isPowerOfTwo(b.height),d=L(a.format),e=L(a.type);D(n.TEXTURE_2D,a,c);var f=a.mipmaps;if(a instanceof THREE.DataTexture)if(0<f.length&&c){for(var g=0,h=f.length;g<h;g++)b=f[g],n.texImage2D(n.TEXTURE_2D,g,d,b.width,b.height,0,d,e,b.data);a.generateMipmaps=!1}else n.texImage2D(n.TEXTURE_2D,0,d,b.width,b.height,0,d,e,b.data);else if(a instanceof THREE.CompressedTexture)for(g=0,h=f.length;g<h;g++)b=f[g],a.format!==THREE.RGBAFormat&&
a.format!==THREE.RGBFormat?-1<oc().indexOf(d)?n.compressedTexImage2D(n.TEXTURE_2D,g,d,b.width,b.height,0,b.data):console.warn("Attempt to load unsupported compressed texture format"):n.texImage2D(n.TEXTURE_2D,g,d,b.width,b.height,0,d,e,b.data);else if(0<f.length&&c){g=0;for(h=f.length;g<h;g++)b=f[g],n.texImage2D(n.TEXTURE_2D,g,d,d,e,b);a.generateMipmaps=!1}else n.texImage2D(n.TEXTURE_2D,0,d,d,e,a.image);a.generateMipmaps&&c&&n.generateMipmap(n.TEXTURE_2D);a.needsUpdate=!1;if(a.onUpdate)a.onUpdate()};
this.setTexture=function(a,b){n.activeTexture(n.TEXTURE0+b);a.needsUpdate?F.uploadTexture(a):n.bindTexture(n.TEXTURE_2D,a.__webglTexture)};this.setRenderTarget=function(a){var b=a instanceof THREE.WebGLRenderTargetCube;if(a&&void 0===a.__webglFramebuffer){void 0===a.depthBuffer&&(a.depthBuffer=!0);void 0===a.stencilBuffer&&(a.stencilBuffer=!0);a.addEventListener("dispose",Cc);a.__webglTexture=n.createTexture();F.info.memory.textures++;var c=THREE.Math.isPowerOfTwo(a.width)&&THREE.Math.isPowerOfTwo(a.height),
d=L(a.format),e=L(a.type);if(b){a.__webglFramebuffer=[];a.__webglRenderbuffer=[];n.bindTexture(n.TEXTURE_CUBE_MAP,a.__webglTexture);D(n.TEXTURE_CUBE_MAP,a,c);for(var f=0;6>f;f++){a.__webglFramebuffer[f]=n.createFramebuffer();a.__webglRenderbuffer[f]=n.createRenderbuffer();n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+f,0,d,a.width,a.height,0,d,e,null);var g=a,h=n.TEXTURE_CUBE_MAP_POSITIVE_X+f;n.bindFramebuffer(n.FRAMEBUFFER,a.__webglFramebuffer[f]);n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,
h,g.__webglTexture,0);G(a.__webglRenderbuffer[f],a)}c&&n.generateMipmap(n.TEXTURE_CUBE_MAP)}else a.__webglFramebuffer=n.createFramebuffer(),a.__webglRenderbuffer=a.shareDepthFrom?a.shareDepthFrom.__webglRenderbuffer:n.createRenderbuffer(),n.bindTexture(n.TEXTURE_2D,a.__webglTexture),D(n.TEXTURE_2D,a,c),n.texImage2D(n.TEXTURE_2D,0,d,a.width,a.height,0,d,e,null),d=n.TEXTURE_2D,n.bindFramebuffer(n.FRAMEBUFFER,a.__webglFramebuffer),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,d,a.__webglTexture,
0),a.shareDepthFrom?a.depthBuffer&&!a.stencilBuffer?n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,a.__webglRenderbuffer):a.depthBuffer&&a.stencilBuffer&&n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,a.__webglRenderbuffer):G(a.__webglRenderbuffer,a),c&&n.generateMipmap(n.TEXTURE_2D);b?n.bindTexture(n.TEXTURE_CUBE_MAP,null):n.bindTexture(n.TEXTURE_2D,null);n.bindRenderbuffer(n.RENDERBUFFER,null);n.bindFramebuffer(n.FRAMEBUFFER,null)}a?
(b=b?a.__webglFramebuffer[a.activeCubeFace]:a.__webglFramebuffer,c=a.width,a=a.height,e=d=0):(b=null,c=nb,a=ib,d=ub,e=Cb);b!==uc&&(n.bindFramebuffer(n.FRAMEBUFFER,b),n.viewport(d,e,c,a),uc=b);vc=c;wc=a};this.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};this.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};this.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};
this.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}};
THREE.WebGLRenderTarget=function(b,a,c){this.width=b;this.height=a;c=c||{};this.wrapS=void 0!==c.wrapS?c.wrapS:THREE.ClampToEdgeWrapping;this.wrapT=void 0!==c.wrapT?c.wrapT:THREE.ClampToEdgeWrapping;this.magFilter=void 0!==c.magFilter?c.magFilter:THREE.LinearFilter;this.minFilter=void 0!==c.minFilter?c.minFilter:THREE.LinearMipMapLinearFilter;this.anisotropy=void 0!==c.anisotropy?c.anisotropy:1;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.format=void 0!==c.format?c.format:
THREE.RGBAFormat;this.type=void 0!==c.type?c.type:THREE.UnsignedByteType;this.depthBuffer=void 0!==c.depthBuffer?c.depthBuffer:!0;this.stencilBuffer=void 0!==c.stencilBuffer?c.stencilBuffer:!0;this.generateMipmaps=!0;this.shareDepthFrom=null};
THREE.WebGLRenderTarget.prototype={constructor:THREE.WebGLRenderTarget,setSize:function(b,a){this.width=b;this.height=a},clone:function(){var b=new THREE.WebGLRenderTarget(this.width,this.height);b.wrapS=this.wrapS;b.wrapT=this.wrapT;b.magFilter=this.magFilter;b.minFilter=this.minFilter;b.anisotropy=this.anisotropy;b.offset.copy(this.offset);b.repeat.copy(this.repeat);b.format=this.format;b.type=this.type;b.depthBuffer=this.depthBuffer;b.stencilBuffer=this.stencilBuffer;b.generateMipmaps=this.generateMipmaps;
b.shareDepthFrom=this.shareDepthFrom;return b},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.WebGLRenderTarget.prototype);THREE.WebGLRenderTargetCube=function(b,a,c){THREE.WebGLRenderTarget.call(this,b,a,c);this.activeCubeFace=0};THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype);THREE.WebGLRenderTargetCube.prototype.constructor=THREE.WebGLRenderTargetCube;
THREE.WebGLExtensions=function(b){var a={};this.get=function(c){if(void 0!==a[c])return a[c];switch(c){case "EXT_texture_filter_anisotropic":var d=b.getExtension("EXT_texture_filter_anisotropic")||b.getExtension("MOZ_EXT_texture_filter_anisotropic")||b.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case "WEBGL_compressed_texture_s3tc":d=b.getExtension("WEBGL_compressed_texture_s3tc")||b.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||b.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");
break;case "WEBGL_compressed_texture_pvrtc":d=b.getExtension("WEBGL_compressed_texture_pvrtc")||b.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:d=b.getExtension(c)}null===d&&console.log("THREE.WebGLRenderer: "+c+" extension not supported.");return a[c]=d}};
THREE.WebGLProgram=function(){var b=0;return function(a,c,d,e){var f=a.context,g=d.defines,h=d.__webglShader.uniforms,k=d.attributes,l=d.__webglShader.vertexShader,p=d.__webglShader.fragmentShader,q=d.index0AttributeName;void 0===q&&!0===e.morphTargets&&(q="position");var m="SHADOWMAP_TYPE_BASIC";e.shadowMapType===THREE.PCFShadowMap?m="SHADOWMAP_TYPE_PCF":e.shadowMapType===THREE.PCFSoftShadowMap&&(m="SHADOWMAP_TYPE_PCF_SOFT");var r="ENVMAP_TYPE_CUBE",t="ENVMAP_MODE_REFLECTION",u="ENVMAP_BLENDING_MULTIPLY";
if(e.envMap){switch(d.envMap.mapping){case THREE.CubeReflectionMapping:case THREE.CubeRefractionMapping:r="ENVMAP_TYPE_CUBE";break;case THREE.EquirectangularReflectionMapping:case THREE.EquirectangularRefractionMapping:r="ENVMAP_TYPE_EQUIREC";break;case THREE.SphericalReflectionMapping:r="ENVMAP_TYPE_SPHERE"}switch(d.envMap.mapping){case THREE.CubeRefractionMapping:case THREE.EquirectangularRefractionMapping:t="ENVMAP_MODE_REFRACTION"}switch(d.combine){case THREE.MultiplyOperation:u="ENVMAP_BLENDING_MULTIPLY";
break;case THREE.MixOperation:u="ENVMAP_BLENDING_MIX";break;case THREE.AddOperation:u="ENVMAP_BLENDING_ADD"}}var v=[];for(var w in g){var x=g[w];!1!==x&&(x="#define "+w+" "+x,v.push(x))}v=v.join("\n");g=f.createProgram();d instanceof THREE.RawShaderMaterial?a=d="":(d=["precision "+e.precision+" float;","precision "+e.precision+" int;",v,e.supportsVertexTextures?"#define VERTEX_TEXTURES":"",a.gammaInput?"#define GAMMA_INPUT":"",a.gammaOutput?"#define GAMMA_OUTPUT":"","#define MAX_DIR_LIGHTS "+e.maxDirLights,
"#define MAX_POINT_LIGHTS "+e.maxPointLights,"#define MAX_SPOT_LIGHTS "+e.maxSpotLights,"#define MAX_HEMI_LIGHTS "+e.maxHemiLights,"#define MAX_SHADOWS "+e.maxShadows,"#define MAX_BONES "+e.maxBones,e.map?"#define USE_MAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+t:"",e.lightMap?"#define USE_LIGHTMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.vertexColors?"#define USE_COLOR":
"",e.skinning?"#define USE_SKINNING":"",e.useVertexTexture?"#define BONE_TEXTURE":"",e.morphTargets?"#define USE_MORPHTARGETS":"",e.morphNormals?"#define USE_MORPHNORMALS":"",e.wrapAround?"#define WRAP_AROUND":"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+m:"",e.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",e.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",e.sizeAttenuation?"#define USE_SIZEATTENUATION":
"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\n\tattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\n\tattribute vec3 morphTarget0;\n\tattribute vec3 morphTarget1;\n\tattribute vec3 morphTarget2;\n\tattribute vec3 morphTarget3;\n\t#ifdef USE_MORPHNORMALS\n\t\tattribute vec3 morphNormal0;\n\t\tattribute vec3 morphNormal1;\n\t\tattribute vec3 morphNormal2;\n\t\tattribute vec3 morphNormal3;\n\t#else\n\t\tattribute vec3 morphTarget4;\n\t\tattribute vec3 morphTarget5;\n\t\tattribute vec3 morphTarget6;\n\t\tattribute vec3 morphTarget7;\n\t#endif\n#endif\n#ifdef USE_SKINNING\n\tattribute vec4 skinIndex;\n\tattribute vec4 skinWeight;\n#endif\n"].join("\n"),
a=["precision "+e.precision+" float;","precision "+e.precision+" int;",e.bumpMap||e.normalMap?"#extension GL_OES_standard_derivatives : enable":"",v,"#define MAX_DIR_LIGHTS "+e.maxDirLights,"#define MAX_POINT_LIGHTS "+e.maxPointLights,"#define MAX_SPOT_LIGHTS "+e.maxSpotLights,"#define MAX_HEMI_LIGHTS "+e.maxHemiLights,"#define MAX_SHADOWS "+e.maxShadows,e.alphaTest?"#define ALPHATEST "+e.alphaTest:"",a.gammaInput?"#define GAMMA_INPUT":"",a.gammaOutput?"#define GAMMA_OUTPUT":"",e.useFog&&e.fog?"#define USE_FOG":
"",e.useFog&&e.fogExp?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+r:"",e.envMap?"#define "+t:"",e.envMap?"#define "+u:"",e.lightMap?"#define USE_LIGHTMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.vertexColors?"#define USE_COLOR":"",e.metal?"#define METAL":"",e.wrapAround?"#define WRAP_AROUND":"",e.doubleSided?"#define DOUBLE_SIDED":
"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+m:"",e.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",e.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n"));l=new THREE.WebGLShader(f,f.VERTEX_SHADER,d+l);p=new THREE.WebGLShader(f,f.FRAGMENT_SHADER,a+p);f.attachShader(g,l);f.attachShader(g,p);void 0!==q&&f.bindAttribLocation(g,
0,q);f.linkProgram(g);!1===f.getProgramParameter(g,f.LINK_STATUS)&&(console.error("THREE.WebGLProgram: Could not initialise shader."),console.error("gl.VALIDATE_STATUS",f.getProgramParameter(g,f.VALIDATE_STATUS)),console.error("gl.getError()",f.getError()));""!==f.getProgramInfoLog(g)&&console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",f.getProgramInfoLog(g));f.deleteShader(l);f.deleteShader(p);q="viewMatrix modelViewMatrix projectionMatrix normalMatrix modelMatrix cameraPosition morphTargetInfluences bindMatrix bindMatrixInverse".split(" ");
e.useVertexTexture?(q.push("boneTexture"),q.push("boneTextureWidth"),q.push("boneTextureHeight")):q.push("boneGlobalMatrices");e.logarithmicDepthBuffer&&q.push("logDepthBufFC");for(var C in h)q.push(C);h=q;C={};q=0;for(a=h.length;q<a;q++)m=h[q],C[m]=f.getUniformLocation(g,m);this.uniforms=C;q="position normal uv uv2 tangent color skinIndex skinWeight lineDistance".split(" ");for(h=0;h<e.maxMorphTargets;h++)q.push("morphTarget"+h);for(h=0;h<e.maxMorphNormals;h++)q.push("morphNormal"+h);for(var y in k)q.push(y);
e=q;k={};y=0;for(h=e.length;y<h;y++)C=e[y],k[C]=f.getAttribLocation(g,C);this.attributes=k;this.attributesKeys=Object.keys(this.attributes);this.id=b++;this.code=c;this.usedTimes=1;this.program=g;this.vertexShader=l;this.fragmentShader=p;return this}}();
THREE.WebGLShader=function(){var b=function(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+": "+a[b];return a.join("\n")};return function(a,c,d){c=a.createShader(c);a.shaderSource(c,d);a.compileShader(c);!1===a.getShaderParameter(c,a.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile.");""!==a.getShaderInfoLog(c)&&(console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",a.getShaderInfoLog(c)),console.warn(b(d)));return c}}();
THREE.LensFlarePlugin=function(b,a){var c,d,e,f,g,h,k,l,p,q,m=b.context,r,t,u,v,w,x;this.render=function(C,y,R,P){if(0!==a.length){C=new THREE.Vector3;var A=P/R,M=.5*R,Q=.5*P,K=16/P,B=new THREE.Vector2(K*A,K),D=new THREE.Vector3(1,1,0),I=new THREE.Vector2(1,1);if(void 0===u){K=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]);var G=new Uint16Array([0,1,2,0,2,3]);r=m.createBuffer();t=m.createBuffer();m.bindBuffer(m.ARRAY_BUFFER,r);m.bufferData(m.ARRAY_BUFFER,K,m.STATIC_DRAW);m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,
t);m.bufferData(m.ELEMENT_ARRAY_BUFFER,G,m.STATIC_DRAW);w=m.createTexture();x=m.createTexture();m.bindTexture(m.TEXTURE_2D,w);m.texImage2D(m.TEXTURE_2D,0,m.RGB,16,16,0,m.RGB,m.UNSIGNED_BYTE,null);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.NEAREST);m.bindTexture(m.TEXTURE_2D,x);m.texImage2D(m.TEXTURE_2D,0,
m.RGBA,16,16,0,m.RGBA,m.UNSIGNED_BYTE,null);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.NEAREST);K=(v=0<m.getParameter(m.MAX_VERTEX_TEXTURE_IMAGE_UNITS))?{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility =        visibility.r / 9.0;\nvVisibility *= 1.0 - visibility.g / 9.0;\nvVisibility *=       visibility.b / 9.0;\nvVisibility *= 1.0 - visibility.a / 9.0;\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"}:{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"precision mediump float;\nuniform lowp int renderType;\nuniform sampler2D map;\nuniform sampler2D occlusionMap;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * visibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"};
G=m.createProgram();var H=m.createShader(m.FRAGMENT_SHADER),N=m.createShader(m.VERTEX_SHADER),L="precision "+b.getPrecision()+" float;\n";m.shaderSource(H,L+K.fragmentShader);m.shaderSource(N,L+K.vertexShader);m.compileShader(H);m.compileShader(N);m.attachShader(G,H);m.attachShader(G,N);m.linkProgram(G);u=G;p=m.getAttribLocation(u,"position");q=m.getAttribLocation(u,"uv");c=m.getUniformLocation(u,"renderType");d=m.getUniformLocation(u,"map");e=m.getUniformLocation(u,"occlusionMap");f=m.getUniformLocation(u,
"opacity");g=m.getUniformLocation(u,"color");h=m.getUniformLocation(u,"scale");k=m.getUniformLocation(u,"rotation");l=m.getUniformLocation(u,"screenPosition")}m.useProgram(u);m.enableVertexAttribArray(p);m.enableVertexAttribArray(q);m.uniform1i(e,0);m.uniform1i(d,1);m.bindBuffer(m.ARRAY_BUFFER,r);m.vertexAttribPointer(p,2,m.FLOAT,!1,16,0);m.vertexAttribPointer(q,2,m.FLOAT,!1,16,8);m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,t);m.disable(m.CULL_FACE);m.depthMask(!1);G=0;for(H=a.length;G<H;G++)if(K=16/P,B.set(K*
A,K),N=a[G],C.set(N.matrixWorld.elements[12],N.matrixWorld.elements[13],N.matrixWorld.elements[14]),C.applyMatrix4(y.matrixWorldInverse),C.applyProjection(y.projectionMatrix),D.copy(C),I.x=D.x*M+M,I.y=D.y*Q+Q,v||0<I.x&&I.x<R&&0<I.y&&I.y<P){m.activeTexture(m.TEXTURE1);m.bindTexture(m.TEXTURE_2D,w);m.copyTexImage2D(m.TEXTURE_2D,0,m.RGB,I.x-8,I.y-8,16,16,0);m.uniform1i(c,0);m.uniform2f(h,B.x,B.y);m.uniform3f(l,D.x,D.y,D.z);m.disable(m.BLEND);m.enable(m.DEPTH_TEST);m.drawElements(m.TRIANGLES,6,m.UNSIGNED_SHORT,
0);m.activeTexture(m.TEXTURE0);m.bindTexture(m.TEXTURE_2D,x);m.copyTexImage2D(m.TEXTURE_2D,0,m.RGBA,I.x-8,I.y-8,16,16,0);m.uniform1i(c,1);m.disable(m.DEPTH_TEST);m.activeTexture(m.TEXTURE1);m.bindTexture(m.TEXTURE_2D,w);m.drawElements(m.TRIANGLES,6,m.UNSIGNED_SHORT,0);N.positionScreen.copy(D);N.customUpdateCallback?N.customUpdateCallback(N):N.updateLensFlares();m.uniform1i(c,2);m.enable(m.BLEND);L=0;for(var T=N.lensFlares.length;L<T;L++){var ba=N.lensFlares[L];.001<ba.opacity&&.001<ba.scale&&(D.x=
ba.x,D.y=ba.y,D.z=ba.z,K=ba.size*ba.scale/P,B.x=K*A,B.y=K,m.uniform3f(l,D.x,D.y,D.z),m.uniform2f(h,B.x,B.y),m.uniform1f(k,ba.rotation),m.uniform1f(f,ba.opacity),m.uniform3f(g,ba.color.r,ba.color.g,ba.color.b),b.setBlending(ba.blending,ba.blendEquation,ba.blendSrc,ba.blendDst),b.setTexture(ba.texture,1),m.drawElements(m.TRIANGLES,6,m.UNSIGNED_SHORT,0))}}m.enable(m.CULL_FACE);m.enable(m.DEPTH_TEST);m.depthMask(!0);b.resetGLState()}}};
THREE.ShadowMapPlugin=function(b,a,c,d){function e(a,b,d){if(b.visible){var f=c[b.id];if(f&&b.castShadow&&(!1===b.frustumCulled||!0===g.intersectsObject(b)))for(var h=0,k=f.length;h<k;h++){var l=f[h];b._modelViewMatrix.multiplyMatrices(d.matrixWorldInverse,b.matrixWorld);q.push(l)}h=0;for(k=b.children.length;h<k;h++)e(a,b.children[h],d)}}var f=b.context,g=new THREE.Frustum,h=new THREE.Matrix4,k=new THREE.Vector3,l=new THREE.Vector3,p=new THREE.Vector3,q=[],m=THREE.ShaderLib.depthRGBA,r=THREE.UniformsUtils.clone(m.uniforms);
var t=new THREE.ShaderMaterial({uniforms:r,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader});var u=new THREE.ShaderMaterial({uniforms:r,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,morphTargets:!0});var v=new THREE.ShaderMaterial({uniforms:r,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,skinning:!0});var w=new THREE.ShaderMaterial({uniforms:r,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,morphTargets:!0,skinning:!0});t._shadowPass=!0;u._shadowPass=
!0;v._shadowPass=!0;w._shadowPass=!0;this.render=function(c,m){if(!1!==b.shadowMapEnabled){var r,x,C,A=[];var M=0;f.clearColor(1,1,1,1);f.disable(f.BLEND);f.enable(f.CULL_FACE);f.frontFace(f.CCW);b.shadowMapCullFace===THREE.CullFaceFront?f.cullFace(f.FRONT):f.cullFace(f.BACK);b.setDepthTest(!0);var Q=0;for(r=a.length;Q<r;Q++)if(x=a[Q],x.castShadow)if(x instanceof THREE.DirectionalLight&&x.shadowCascade)for(C=0;C<x.shadowCascadeCount;C++){if(x.shadowCascadeArray[C])var K=x.shadowCascadeArray[C];else{var B=
x;var D=C;K=new THREE.DirectionalLight;K.isVirtual=!0;K.onlyShadow=!0;K.castShadow=!0;K.shadowCameraNear=B.shadowCameraNear;K.shadowCameraFar=B.shadowCameraFar;K.shadowCameraLeft=B.shadowCameraLeft;K.shadowCameraRight=B.shadowCameraRight;K.shadowCameraBottom=B.shadowCameraBottom;K.shadowCameraTop=B.shadowCameraTop;K.shadowCameraVisible=B.shadowCameraVisible;K.shadowDarkness=B.shadowDarkness;K.shadowBias=B.shadowCascadeBias[D];K.shadowMapWidth=B.shadowCascadeWidth[D];K.shadowMapHeight=B.shadowCascadeHeight[D];
K.pointsWorld=[];K.pointsFrustum=[];var I=K.pointsWorld;var G=K.pointsFrustum;for(var H=0;8>H;H++)I[H]=new THREE.Vector3,G[H]=new THREE.Vector3;I=B.shadowCascadeNearZ[D];B=B.shadowCascadeFarZ[D];G[0].set(-1,-1,I);G[1].set(1,-1,I);G[2].set(-1,1,I);G[3].set(1,1,I);G[4].set(-1,-1,B);G[5].set(1,-1,B);G[6].set(-1,1,B);G[7].set(1,1,B);K.originalCamera=m;G=new THREE.Gyroscope;G.position.copy(x.shadowCascadeOffset);G.add(K);G.add(K.target);m.add(G);x.shadowCascadeArray[C]=K;console.log("Created virtualLight",
K)}D=x;I=C;B=D.shadowCascadeArray[I];B.position.copy(D.position);B.target.position.copy(D.target.position);B.lookAt(B.target);B.shadowCameraVisible=D.shadowCameraVisible;B.shadowDarkness=D.shadowDarkness;B.shadowBias=D.shadowCascadeBias[I];G=D.shadowCascadeNearZ[I];D=D.shadowCascadeFarZ[I];B=B.pointsFrustum;B[0].z=G;B[1].z=G;B[2].z=G;B[3].z=G;B[4].z=D;B[5].z=D;B[6].z=D;B[7].z=D;A[M]=K;M++}else A[M]=x,M++;Q=0;for(r=A.length;Q<r;Q++){x=A[Q];x.shadowMap||(C=THREE.LinearFilter,b.shadowMapType===THREE.PCFSoftShadowMap&&
(C=THREE.NearestFilter),x.shadowMap=new THREE.WebGLRenderTarget(x.shadowMapWidth,x.shadowMapHeight,{minFilter:C,magFilter:C,format:THREE.RGBAFormat}),x.shadowMapSize=new THREE.Vector2(x.shadowMapWidth,x.shadowMapHeight),x.shadowMatrix=new THREE.Matrix4);if(!x.shadowCamera){if(x instanceof THREE.SpotLight)x.shadowCamera=new THREE.PerspectiveCamera(x.shadowCameraFov,x.shadowMapWidth/x.shadowMapHeight,x.shadowCameraNear,x.shadowCameraFar);else if(x instanceof THREE.DirectionalLight)x.shadowCamera=new THREE.OrthographicCamera(x.shadowCameraLeft,
x.shadowCameraRight,x.shadowCameraTop,x.shadowCameraBottom,x.shadowCameraNear,x.shadowCameraFar);else{console.error("Unsupported light type for shadow");continue}c.add(x.shadowCamera);!0===c.autoUpdate&&c.updateMatrixWorld()}x.shadowCameraVisible&&!x.cameraHelper&&(x.cameraHelper=new THREE.CameraHelper(x.shadowCamera),c.add(x.cameraHelper));if(x.isVirtual&&K.originalCamera==m){C=m;M=x.shadowCamera;G=x.pointsFrustum;B=x.pointsWorld;k.set(Infinity,Infinity,Infinity);l.set(-Infinity,-Infinity,-Infinity);
for(D=0;8>D;D++)I=B[D],I.copy(G[D]),I.unproject(C),I.applyMatrix4(M.matrixWorldInverse),I.x<k.x&&(k.x=I.x),I.x>l.x&&(l.x=I.x),I.y<k.y&&(k.y=I.y),I.y>l.y&&(l.y=I.y),I.z<k.z&&(k.z=I.z),I.z>l.z&&(l.z=I.z);M.left=k.x;M.right=l.x;M.top=l.y;M.bottom=k.y;M.updateProjectionMatrix()}M=x.shadowMap;G=x.shadowMatrix;C=x.shadowCamera;C.position.setFromMatrixPosition(x.matrixWorld);p.setFromMatrixPosition(x.target.matrixWorld);C.lookAt(p);C.updateMatrixWorld();C.matrixWorldInverse.getInverse(C.matrixWorld);x.cameraHelper&&
(x.cameraHelper.visible=x.shadowCameraVisible);x.shadowCameraVisible&&x.cameraHelper.update();G.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);G.multiply(C.projectionMatrix);G.multiply(C.matrixWorldInverse);h.multiplyMatrices(C.projectionMatrix,C.matrixWorldInverse);g.setFromMatrix(h);b.setRenderTarget(M);b.clear();q.length=0;e(c,c,C);x=0;for(M=q.length;x<M;x++)B=q[x],G=B.object,B=B.buffer,D=G.material instanceof THREE.MeshFaceMaterial?G.material.materials[0]:G.material,I=void 0!==G.geometry.morphTargets&&
0<G.geometry.morphTargets.length&&D.morphTargets,H=G instanceof THREE.SkinnedMesh&&D.skinning,I=G.customDepthMaterial?G.customDepthMaterial:H?I?w:v:I?u:t,b.setMaterialFaces(D),B instanceof THREE.BufferGeometry?b.renderBufferDirect(C,a,null,I,B,G):b.renderBuffer(C,a,null,I,B,G);x=0;for(M=d.length;x<M;x++)B=d[x],G=B.object,G.visible&&G.castShadow&&(G._modelViewMatrix.multiplyMatrices(C.matrixWorldInverse,G.matrixWorld),b.renderImmediateObject(C,a,null,t,G))}Q=b.getClearColor();r=b.getClearAlpha();f.clearColor(Q.r,
Q.g,Q.b,r);f.enable(f.BLEND);b.shadowMapCullFace===THREE.CullFaceFront&&f.cullFace(f.BACK);b.resetGLState()}}};
THREE.SpritePlugin=function(b,a){function c(a,b){return a.z!==b.z?b.z-a.z:b.id-a.id}var d,e,f,g,h,k,l,p,q,m,r,t,u,v,w,x,C,y=b.context,R,P,A,M,Q=new THREE.Vector3,K=new THREE.Quaternion,B=new THREE.Vector3;this.render=function(D,I){if(0!==a.length){if(void 0===A){var G=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),H=new Uint16Array([0,1,2,0,2,3]);R=y.createBuffer();P=y.createBuffer();y.bindBuffer(y.ARRAY_BUFFER,R);y.bufferData(y.ARRAY_BUFFER,G,y.STATIC_DRAW);y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,
P);y.bufferData(y.ELEMENT_ARRAY_BUFFER,H,y.STATIC_DRAW);G=y.createProgram();H=y.createShader(y.VERTEX_SHADER);var N=y.createShader(y.FRAGMENT_SHADER);y.shaderSource(H,["precision "+b.getPrecision()+" float;","uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position * scale;\nvec2 rotatedPosition;\nrotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\nrotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\nvec4 finalPosition;\nfinalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition;\nfinalPosition = projectionMatrix * finalPosition;\ngl_Position = finalPosition;\n}"].join("\n"));
y.shaderSource(N,["precision "+b.getPrecision()+" float;","uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\nif ( texture.a < alphaTest ) discard;\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\nif ( fogType > 0 ) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = 0.0;\nif ( fogType == 1 ) {\nfogFactor = smoothstep( fogNear, fogFar, depth );\n} else {\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n}\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}\n}"].join("\n"));
y.compileShader(H);y.compileShader(N);y.attachShader(G,H);y.attachShader(G,N);y.linkProgram(G);A=G;x=y.getAttribLocation(A,"position");C=y.getAttribLocation(A,"uv");d=y.getUniformLocation(A,"uvOffset");e=y.getUniformLocation(A,"uvScale");f=y.getUniformLocation(A,"rotation");g=y.getUniformLocation(A,"scale");h=y.getUniformLocation(A,"color");k=y.getUniformLocation(A,"map");l=y.getUniformLocation(A,"opacity");p=y.getUniformLocation(A,"modelViewMatrix");q=y.getUniformLocation(A,"projectionMatrix");m=
y.getUniformLocation(A,"fogType");r=y.getUniformLocation(A,"fogDensity");t=y.getUniformLocation(A,"fogNear");u=y.getUniformLocation(A,"fogFar");v=y.getUniformLocation(A,"fogColor");w=y.getUniformLocation(A,"alphaTest");G=document.createElement("canvas");G.width=8;G.height=8;H=G.getContext("2d");H.fillStyle="white";H.fillRect(0,0,8,8);M=new THREE.Texture(G);M.needsUpdate=!0}y.useProgram(A);y.enableVertexAttribArray(x);y.enableVertexAttribArray(C);y.disable(y.CULL_FACE);y.enable(y.BLEND);y.bindBuffer(y.ARRAY_BUFFER,
R);y.vertexAttribPointer(x,2,y.FLOAT,!1,16,0);y.vertexAttribPointer(C,2,y.FLOAT,!1,16,8);y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,P);y.uniformMatrix4fv(q,!1,I.projectionMatrix.elements);y.activeTexture(y.TEXTURE0);y.uniform1i(k,0);H=G=0;(N=D.fog)?(y.uniform3f(v,N.color.r,N.color.g,N.color.b),N instanceof THREE.Fog?(y.uniform1f(t,N.near),y.uniform1f(u,N.far),y.uniform1i(m,1),H=G=1):N instanceof THREE.FogExp2&&(y.uniform1f(r,N.density),y.uniform1i(m,2),H=G=2)):(y.uniform1i(m,0),H=G=0);N=0;for(var L=a.length;N<
L;N++){var T=a[N];T._modelViewMatrix.multiplyMatrices(I.matrixWorldInverse,T.matrixWorld);T.z=-T._modelViewMatrix.elements[14]}a.sort(c);var ba=[];N=0;for(L=a.length;N<L;N++){T=a[N];var E=T.material;y.uniform1f(w,E.alphaTest);y.uniformMatrix4fv(p,!1,T._modelViewMatrix.elements);T.matrixWorld.decompose(Q,K,B);ba[0]=B.x;ba[1]=B.y;T=0;D.fog&&E.fog&&(T=H);G!==T&&(y.uniform1i(m,T),G=T);null!==E.map?(y.uniform2f(d,E.map.offset.x,E.map.offset.y),y.uniform2f(e,E.map.repeat.x,E.map.repeat.y)):(y.uniform2f(d,
0,0),y.uniform2f(e,1,1));y.uniform1f(l,E.opacity);y.uniform3f(h,E.color.r,E.color.g,E.color.b);y.uniform1f(f,E.rotation);y.uniform2fv(g,ba);b.setBlending(E.blending,E.blendEquation,E.blendSrc,E.blendDst);b.setDepthTest(E.depthTest);b.setDepthWrite(E.depthWrite);E.map&&E.map.image&&E.map.image.width?b.setTexture(E.map,0):b.setTexture(M,0);y.drawElements(y.TRIANGLES,6,y.UNSIGNED_SHORT,0)}y.enable(y.CULL_FACE);b.resetGLState()}}};
THREE.GeometryUtils={merge:function(b,a,c){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var d;a instanceof THREE.Mesh&&(a.matrixAutoUpdate&&a.updateMatrix(),d=a.matrix,a=a.geometry);b.merge(a,d,c)},center:function(b){console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.");return b.center()}};
THREE.ImageUtils={crossOrigin:void 0,loadTexture:function(b,a,c,d){var e=new THREE.ImageLoader;e.crossOrigin=this.crossOrigin;var f=new THREE.Texture(void 0,a);e.load(b,function(a){f.image=a;f.needsUpdate=!0;c&&c(f)},void 0,function(a){d&&d(a)});f.sourceFile=b;return f},loadTextureCube:function(b,a,c,d){var e=new THREE.ImageLoader;e.crossOrigin=this.crossOrigin;var f=new THREE.CubeTexture([],a);f.flipY=!1;var g=0;a=function(a){e.load(b[a],function(b){f.images[a]=b;g+=1;6===g&&(f.needsUpdate=!0,c&&
c(f))},void 0,d)};for(var h=0,k=b.length;h<k;++h)a(h);return f},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},getNormalMap:function(b,a){var c=function(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);return[a[0]/b,a[1]/b,a[2]/b]};a|=1;var d=b.width,e=b.height,f=document.createElement("canvas");
f.width=d;f.height=e;var g=f.getContext("2d");g.drawImage(b,0,0);for(var h=g.getImageData(0,0,d,e).data,k=g.createImageData(d,e),l=k.data,p=0;p<d;p++)for(var q=0;q<e;q++){var m=0>q-1?0:q-1,r=q+1>e-1?e-1:q+1,t=0>p-1?0:p-1,u=p+1>d-1?d-1:p+1,v=[],w=[0,0,h[4*(q*d+p)]/255*a];v.push([-1,0,h[4*(q*d+t)]/255*a]);v.push([-1,-1,h[4*(m*d+t)]/255*a]);v.push([0,-1,h[4*(m*d+p)]/255*a]);v.push([1,-1,h[4*(m*d+u)]/255*a]);v.push([1,0,h[4*(q*d+u)]/255*a]);v.push([1,1,h[4*(r*d+u)]/255*a]);v.push([0,1,h[4*(r*d+p)]/255*
a]);v.push([-1,1,h[4*(r*d+t)]/255*a]);m=[];t=v.length;for(r=0;r<t;r++){u=v[r];var x=v[(r+1)%t];u=[u[0]-w[0],u[1]-w[1],u[2]-w[2]];x=[x[0]-w[0],x[1]-w[1],x[2]-w[2]];m.push(c([u[1]*x[2]-u[2]*x[1],u[2]*x[0]-u[0]*x[2],u[0]*x[1]-u[1]*x[0]]))}v=[0,0,0];for(r=0;r<m.length;r++)v[0]+=m[r][0],v[1]+=m[r][1],v[2]+=m[r][2];v[0]/=m.length;v[1]/=m.length;v[2]/=m.length;w=4*(q*d+p);l[w]=(v[0]+1)/2*255|0;l[w+1]=(v[1]+1)/2*255|0;l[w+2]=255*v[2]|0;l[w+3]=255}g.putImageData(k,0,0);return f},generateDataTexture:function(b,
a,c){var d=b*a,e=new Uint8Array(3*d),f=Math.floor(255*c.r),g=Math.floor(255*c.g);c=Math.floor(255*c.b);for(var h=0;h<d;h++)e[3*h]=f,e[3*h+1]=g,e[3*h+2]=c;b=new THREE.DataTexture(e,b,a,THREE.RGBFormat);b.needsUpdate=!0;return b}};
THREE.SceneUtils={createMultiMaterialObject:function(b,a){for(var c=new THREE.Object3D,d=0,e=a.length;d<e;d++)c.add(new THREE.Mesh(b,a[d]));return c},detach:function(b,a,c){b.applyMatrix(a.matrixWorld);a.remove(b);c.add(b)},attach:function(b,a,c){var d=new THREE.Matrix4;d.getInverse(c.matrixWorld);b.applyMatrix(d);a.remove(b);c.add(b)}};
THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(b){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing.";}},loadFace:function(b){var a=b.familyName.toLowerCase();this.faces[a]=this.faces[a]||{};this.faces[a][b.cssFontWeight]=this.faces[a][b.cssFontWeight]||{};this.faces[a][b.cssFontWeight][b.cssFontStyle]=b;return this.faces[a][b.cssFontWeight][b.cssFontStyle]=
b},drawText:function(b){var a=this.getFace(),c=this.size/a.resolution,d=0,e=String(b).split(""),f=e.length,g=[];for(b=0;b<f;b++){var h=new THREE.Path;h=this.extractGlyphPoints(e[b],a,c,d,h);d+=h.offset;g.push(h.path)}return{paths:g,offset:d/2}},extractGlyphPoints:function(b,a,c,d,e){var f=[],g,h,k,l,p,q=a.glyphs[b]||a.glyphs["?"];if(q){if(q.o){a=q._cachedOutline||(q._cachedOutline=q.o.split(" "));var m=a.length;for(b=0;b<m;)switch(k=a[b++],k){case "m":k=a[b++]*c+d;var r=a[b++]*c;e.moveTo(k,r);break;
case "l":k=a[b++]*c+d;r=a[b++]*c;e.lineTo(k,r);break;case "q":k=a[b++]*c+d;r=a[b++]*c;var t=a[b++]*c+d;var u=a[b++]*c;e.quadraticCurveTo(t,u,k,r);if(g=f[f.length-1]){var v=g.x;var w=g.y;g=1;for(h=this.divisions;g<=h;g++){var x=g/h;THREE.Shape.Utils.b2(x,v,t,k);THREE.Shape.Utils.b2(x,w,u,r)}}break;case "b":if(k=a[b++]*c+d,r=a[b++]*c,t=a[b++]*c+d,u=a[b++]*c,l=a[b++]*c+d,p=a[b++]*c,e.bezierCurveTo(t,u,l,p,k,r),g=f[f.length-1])for(v=g.x,w=g.y,g=1,h=this.divisions;g<=h;g++)x=g/h,THREE.Shape.Utils.b3(x,
v,t,l,k),THREE.Shape.Utils.b3(x,w,u,p,r)}}return{offset:q.ha*c,path:e}}}};
THREE.FontUtils.generateShapes=function(b,a){a=a||{};var c=void 0!==a.curveSegments?a.curveSegments:4,d=void 0!==a.font?a.font:"helvetiker",e=void 0!==a.weight?a.weight:"normal",f=void 0!==a.style?a.style:"normal";THREE.FontUtils.size=void 0!==a.size?a.size:100;THREE.FontUtils.divisions=c;THREE.FontUtils.face=d;THREE.FontUtils.weight=e;THREE.FontUtils.style=f;c=THREE.FontUtils.drawText(b).paths;d=[];e=0;for(f=c.length;e<f;e++)Array.prototype.push.apply(d,c[e].toShapes());return d};
(function(b){var a=function(a){for(var b=a.length,c=0,f=b-1,g=0;g<b;f=g++)c+=a[f].x*a[g].y-a[g].x*a[f].y;return.5*c};b.Triangulate=function(b,d){var c=b.length;if(3>c)return null;var f=[],g=[],h=[],k;if(0<a(b))for(k=0;k<c;k++)g[k]=k;else for(k=0;k<c;k++)g[k]=c-1-k;var l=2*c;for(k=c-1;2<c;){if(0>=l--){console.log("Warning, unable to triangulate polygon!");break}var p=k;c<=p&&(p=0);k=p+1;c<=k&&(k=0);var q=k+1;c<=q&&(q=0);a:{var m,r;var t=b[g[p]].x;var u=b[g[p]].y;var v=b[g[k]].x;var w=b[g[k]].y;var x=
b[g[q]].x;var C=b[g[q]].y;if(1E-10>(v-t)*(C-u)-(w-u)*(x-t))var y=!1;else{var R,P,A=void 0;var M=P=R=r=m=void 0;var Q=x-v;var K=C-w;var B=t-x;var D=u-C;var I=v-t;var G=w-u;for(y=0;y<c;y++)if(m=b[g[y]].x,r=b[g[y]].y,!(m===t&&r===u||m===v&&r===w||m===x&&r===C)&&(R=m-t,P=r-u,M=m-v,A=r-w,m-=x,r-=C,M=Q*A-K*M,R=I*P-G*R,P=B*r-D*m,-1E-10<=M&&-1E-10<=P&&-1E-10<=R)){y=!1;break a}y=!0}}if(y){f.push([b[g[p]],b[g[k]],b[g[q]]]);h.push([g[p],g[k],g[q]]);p=k;for(q=k+1;q<c;p++,q++)g[p]=g[q];c--;l=2*c}}return d?h:f};
b.Triangulate.area=a;return b})(THREE.FontUtils);self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace};THREE.typeface_js=self._typeface_js;THREE.Audio=function(b){THREE.Object3D.call(this);this.type="Audio";this.context=b.context;this.source=this.context.createBufferSource();this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.panner=this.context.createPanner();this.panner.connect(this.gain)};THREE.Audio.prototype=Object.create(THREE.Object3D.prototype);
THREE.Audio.prototype.constructor=THREE.Audio;THREE.Audio.prototype.load=function(b){var a=this,c=new XMLHttpRequest;c.open("GET",b,!0);c.responseType="arraybuffer";c.onload=function(b){a.context.decodeAudioData(this.response,function(b){a.source.buffer=b;a.source.connect(a.panner);a.source.start(0)})};c.send();return this};THREE.Audio.prototype.setLoop=function(b){this.source.loop=b};THREE.Audio.prototype.setRefDistance=function(b){this.panner.refDistance=b};
THREE.Audio.prototype.setRolloffFactor=function(b){this.panner.rolloffFactor=b};THREE.Audio.prototype.updateMatrixWorld=function(){var b=new THREE.Vector3;return function(a){THREE.Object3D.prototype.updateMatrixWorld.call(this,a);b.setFromMatrixPosition(this.matrixWorld);this.panner.setPosition(b.x,b.y,b.z)}}();THREE.AudioListener=function(){THREE.Object3D.call(this);this.type="AudioListener";this.context=new (window.AudioContext||window.webkitAudioContext)};THREE.AudioListener.prototype=Object.create(THREE.Object3D.prototype);
THREE.AudioListener.prototype.constructor=THREE.AudioListener;
THREE.AudioListener.prototype.updateMatrixWorld=function(){var b=new THREE.Vector3,a=new THREE.Quaternion,c=new THREE.Vector3,d=new THREE.Vector3,e=new THREE.Vector3,f=new THREE.Vector3;return function(g){THREE.Object3D.prototype.updateMatrixWorld.call(this,g);g=this.context.listener;var h=this.up;this.matrixWorld.decompose(b,a,c);d.set(0,0,-1).applyQuaternion(a);e.subVectors(b,f);g.setPosition(b.x,b.y,b.z);g.setOrientation(d.x,d.y,d.z,h.x,h.y,h.z);g.setVelocity(e.x,e.y,e.z);f.copy(b)}}();
THREE.Curve=function(){};THREE.Curve.prototype.getPoint=function(b){console.log("Warning, getPoint() not implemented!");return null};THREE.Curve.prototype.getPointAt=function(b){b=this.getUtoTmapping(b);return this.getPoint(b)};THREE.Curve.prototype.getPoints=function(b){b||(b=5);var a,c=[];for(a=0;a<=b;a++)c.push(this.getPoint(a/b));return c};THREE.Curve.prototype.getSpacedPoints=function(b){b||(b=5);var a,c=[];for(a=0;a<=b;a++)c.push(this.getPointAt(a/b));return c};
THREE.Curve.prototype.getLength=function(){var b=this.getLengths();return b[b.length-1]};THREE.Curve.prototype.getLengths=function(b){b||(b=this.__arcLengthDivisions?this.__arcLengthDivisions:200);if(this.cacheArcLengths&&this.cacheArcLengths.length==b+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var a=[],c=this.getPoint(0),d,e=0;a.push(0);for(d=1;d<=b;d++){var f=this.getPoint(d/b);e+=f.distanceTo(c);a.push(e);c=f}return this.cacheArcLengths=a};
THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0;this.getLengths()};THREE.Curve.prototype.getUtoTmapping=function(b,a){var c=this.getLengths(),d=0,e=c.length;var f=a?a:b*c[e-1];for(var g=0,h=e-1,k;g<=h;)if(d=Math.floor(g+(h-g)/2),k=c[d]-f,0>k)g=d+1;else if(0<k)h=d-1;else{h=d;break}d=h;if(c[d]==f)return d/(e-1);g=c[d];return(d+(f-g)/(c[d+1]-g))/(e-1)};THREE.Curve.prototype.getTangent=function(b){var a=b-1E-4;b+=1E-4;0>a&&(a=0);1<b&&(b=1);a=this.getPoint(a);return this.getPoint(b).clone().sub(a).normalize()};
THREE.Curve.prototype.getTangentAt=function(b){b=this.getUtoTmapping(b);return this.getTangent(b)};
THREE.Curve.Utils={tangentQuadraticBezier:function(b,a,c,d){return 2*(1-b)*(c-a)+2*b*(d-c)},tangentCubicBezier:function(b,a,c,d,e){return-3*a*(1-b)*(1-b)+3*c*(1-b)*(1-b)-6*b*c*(1-b)+6*b*d*(1-b)-3*b*b*d+3*b*b*e},tangentSpline:function(b,a,c,d,e){return 6*b*b-6*b+(3*b*b-4*b+1)+(-6*b*b+6*b)+(3*b*b-2*b)},interpolate:function(b,a,c,d,e){b=.5*(c-b);d=.5*(d-a);var f=e*e;return(2*a-2*c+b+d)*e*f+(-3*a+3*c-2*b-d)*f+b*e+a}};
THREE.Curve.create=function(b,a){b.prototype=Object.create(THREE.Curve.prototype);b.prototype.constructor=b;b.prototype.getPoint=a;return b};THREE.CurvePath=function(){this.curves=[];this.bends=[];this.autoClose=!1};THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype);THREE.CurvePath.prototype.constructor=THREE.CurvePath;THREE.CurvePath.prototype.add=function(b){this.curves.push(b)};THREE.CurvePath.prototype.checkConnection=function(){};
THREE.CurvePath.prototype.closePath=function(){var b=this.curves[0].getPoint(0),a=this.curves[this.curves.length-1].getPoint(1);b.equals(a)||this.curves.push(new THREE.LineCurve(a,b))};THREE.CurvePath.prototype.getPoint=function(b){var a=b*this.getLength(),c=this.getCurveLengths();for(b=0;b<c.length;){if(c[b]>=a)return a=c[b]-a,b=this.curves[b],a=1-a/b.getLength(),b.getPointAt(a);b++}return null};THREE.CurvePath.prototype.getLength=function(){var b=this.getCurveLengths();return b[b.length-1]};
THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var b=[],a=0,c,d=this.curves.length;for(c=0;c<d;c++)a+=this.curves[c].getLength(),b.push(a);return this.cacheLengths=b};
THREE.CurvePath.prototype.getBoundingBox=function(){var b=this.getPoints(),a,c,d,e;var f=a=Number.NEGATIVE_INFINITY;var g=d=Number.POSITIVE_INFINITY;var h,k=b[0]instanceof THREE.Vector3;var l=k?new THREE.Vector3:new THREE.Vector2;var p=0;for(h=b.length;p<h;p++){var q=b[p];q.x>f?f=q.x:q.x<g&&(g=q.x);q.y>a?a=q.y:q.y<d&&(d=q.y);k&&(q.z>c?c=q.z:q.z<e&&(e=q.z));l.add(q)}b={minX:g,minY:d,maxX:f,maxY:a};k&&(b.maxZ=c,b.minZ=e);return b};
THREE.CurvePath.prototype.createPointsGeometry=function(b){b=this.getPoints(b,!0);return this.createGeometry(b)};THREE.CurvePath.prototype.createSpacedPointsGeometry=function(b){b=this.getSpacedPoints(b,!0);return this.createGeometry(b)};THREE.CurvePath.prototype.createGeometry=function(b){for(var a=new THREE.Geometry,c=0;c<b.length;c++)a.vertices.push(new THREE.Vector3(b[c].x,b[c].y,b[c].z||0));return a};THREE.CurvePath.prototype.addWrapPath=function(b){this.bends.push(b)};
THREE.CurvePath.prototype.getTransformedPoints=function(b,a){var c=this.getPoints(b),d;a||(a=this.bends);var e=0;for(d=a.length;e<d;e++)c=this.getWrapPoints(c,a[e]);return c};THREE.CurvePath.prototype.getTransformedSpacedPoints=function(b,a){var c=this.getSpacedPoints(b),d;a||(a=this.bends);var e=0;for(d=a.length;e<d;e++)c=this.getWrapPoints(c,a[e]);return c};
THREE.CurvePath.prototype.getWrapPoints=function(b,a){var c=this.getBoundingBox(),d;var e=0;for(d=b.length;e<d;e++){var f=b[e];var g=f.x;var h=f.y;var k=g/c.maxX;k=a.getUtoTmapping(k,g);g=a.getPoint(k);k=a.getTangent(k);k.set(-k.y,k.x).multiplyScalar(h);f.x=g.x+k.x;f.y=g.y+k.y}return b};THREE.Gyroscope=function(){THREE.Object3D.call(this)};THREE.Gyroscope.prototype=Object.create(THREE.Object3D.prototype);THREE.Gyroscope.prototype.constructor=THREE.Gyroscope;
THREE.Gyroscope.prototype.updateMatrixWorld=function(){var b=new THREE.Vector3,a=new THREE.Quaternion,c=new THREE.Vector3,d=new THREE.Vector3,e=new THREE.Quaternion,f=new THREE.Vector3;return function(g){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||g)this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(d,e,f),this.matrix.decompose(b,a,c),this.matrixWorld.compose(d,a,f)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=
!1,g=!0;for(var h=0,k=this.children.length;h<k;h++)this.children[h].updateMatrixWorld(g)}}();THREE.Path=function(b){THREE.CurvePath.call(this);this.actions=[];b&&this.fromPoints(b)};THREE.Path.prototype=Object.create(THREE.CurvePath.prototype);THREE.Path.prototype.constructor=THREE.Path;THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"};
THREE.Path.prototype.fromPoints=function(b){this.moveTo(b[0].x,b[0].y);for(var a=1,c=b.length;a<c;a++)this.lineTo(b[a].x,b[a].y)};THREE.Path.prototype.moveTo=function(b,a){var c=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:c})};
THREE.Path.prototype.lineTo=function(b,a){var c=Array.prototype.slice.call(arguments),d=this.actions[this.actions.length-1].args;d=new THREE.LineCurve(new THREE.Vector2(d[d.length-2],d[d.length-1]),new THREE.Vector2(b,a));this.curves.push(d);this.actions.push({action:THREE.PathActions.LINE_TO,args:c})};
THREE.Path.prototype.quadraticCurveTo=function(b,a,c,d){var e=Array.prototype.slice.call(arguments),f=this.actions[this.actions.length-1].args;f=new THREE.QuadraticBezierCurve(new THREE.Vector2(f[f.length-2],f[f.length-1]),new THREE.Vector2(b,a),new THREE.Vector2(c,d));this.curves.push(f);this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:e})};
THREE.Path.prototype.bezierCurveTo=function(b,a,c,d,e,f){var g=Array.prototype.slice.call(arguments),h=this.actions[this.actions.length-1].args;h=new THREE.CubicBezierCurve(new THREE.Vector2(h[h.length-2],h[h.length-1]),new THREE.Vector2(b,a),new THREE.Vector2(c,d),new THREE.Vector2(e,f));this.curves.push(h);this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:g})};
THREE.Path.prototype.splineThru=function(b){var a=Array.prototype.slice.call(arguments),c=this.actions[this.actions.length-1].args;c=[new THREE.Vector2(c[c.length-2],c[c.length-1])];Array.prototype.push.apply(c,b);c=new THREE.SplineCurve(c);this.curves.push(c);this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:a})};THREE.Path.prototype.arc=function(b,a,c,d,e,f){var g=this.actions[this.actions.length-1].args;this.absarc(b+g[g.length-2],a+g[g.length-1],c,d,e,f)};
THREE.Path.prototype.absarc=function(b,a,c,d,e,f){this.absellipse(b,a,c,c,d,e,f)};THREE.Path.prototype.ellipse=function(b,a,c,d,e,f,g){var h=this.actions[this.actions.length-1].args;this.absellipse(b+h[h.length-2],a+h[h.length-1],c,d,e,f,g)};THREE.Path.prototype.absellipse=function(b,a,c,d,e,f,g){var h=Array.prototype.slice.call(arguments),k=new THREE.EllipseCurve(b,a,c,d,e,f,g);this.curves.push(k);k=k.getPoint(1);h.push(k.x);h.push(k.y);this.actions.push({action:THREE.PathActions.ELLIPSE,args:h})};
THREE.Path.prototype.getSpacedPoints=function(b,a){b||(b=40);for(var c=[],d=0;d<b;d++)c.push(this.getPoint(d/b));return c};
THREE.Path.prototype.getPoints=function(b,a){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(b,a);b=b||12;var c=[],d,e,f,g,h;var k=0;for(d=this.actions.length;k<d;k++)switch(e=this.actions[k],f=e.action,e=e.args,f){case THREE.PathActions.MOVE_TO:c.push(new THREE.Vector2(e[0],e[1]));break;case THREE.PathActions.LINE_TO:c.push(new THREE.Vector2(e[0],e[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:var l=e[2];var p=e[3];var q=e[0];var m=e[1];0<c.length?(f=c[c.length-1],
g=f.x,h=f.y):(f=this.actions[k-1].args,g=f[f.length-2],h=f[f.length-1]);for(e=1;e<=b;e++){var r=e/b;f=THREE.Shape.Utils.b2(r,g,q,l);r=THREE.Shape.Utils.b2(r,h,m,p);c.push(new THREE.Vector2(f,r))}break;case THREE.PathActions.BEZIER_CURVE_TO:l=e[4];p=e[5];q=e[0];m=e[1];var t=e[2];var u=e[3];0<c.length?(f=c[c.length-1],g=f.x,h=f.y):(f=this.actions[k-1].args,g=f[f.length-2],h=f[f.length-1]);for(e=1;e<=b;e++)r=e/b,f=THREE.Shape.Utils.b3(r,g,q,t,l),r=THREE.Shape.Utils.b3(r,h,m,u,p),c.push(new THREE.Vector2(f,
r));break;case THREE.PathActions.CSPLINE_THRU:f=this.actions[k-1].args;r=[new THREE.Vector2(f[f.length-2],f[f.length-1])];f=b*e[0].length;r=r.concat(e[0]);r=new THREE.SplineCurve(r);for(e=1;e<=f;e++)c.push(r.getPointAt(e/f));break;case THREE.PathActions.ARC:l=e[0];p=e[1];m=e[2];t=e[3];f=e[4];q=!!e[5];g=f-t;h=2*b;for(e=1;e<=h;e++)r=e/h,q||(r=1-r),r=t+r*g,f=l+m*Math.cos(r),r=p+m*Math.sin(r),c.push(new THREE.Vector2(f,r));break;case THREE.PathActions.ELLIPSE:for(l=e[0],p=e[1],m=e[2],u=e[3],t=e[4],f=
e[5],q=!!e[6],g=f-t,h=2*b,e=1;e<=h;e++)r=e/h,q||(r=1-r),r=t+r*g,f=l+m*Math.cos(r),r=p+u*Math.sin(r),c.push(new THREE.Vector2(f,r))}k=c[c.length-1];1E-10>Math.abs(k.x-c[0].x)&&1E-10>Math.abs(k.y-c[0].y)&&c.splice(c.length-1,1);a&&c.push(c[0]);return c};
THREE.Path.prototype.toShapes=function(b,a){function c(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=a[c],f=new THREE.Shape;f.actions=e.actions;f.curves=e.curves;b.push(f)}return b}function d(a,b){for(var c=b.length,d=!1,e=c-1,f=0;f<c;e=f++){var g=b[e],h=b[f],k=h.x-g.x,l=h.y-g.y;if(1E-10<Math.abs(l)){if(0>l&&(g=b[f],k=-k,h=b[e],l=-l),!(a.y<g.y||a.y>h.y))if(a.y==g.y){if(a.x==g.x)return!0}else{e=l*(a.x-g.x)-k*(a.y-g.y);if(0==e)return!0;0>e||(d=!d)}}else if(a.y==g.y&&(h.x<=a.x&&a.x<=g.x||g.x<=a.x&&a.x<=
h.x))return!0}return d}var e=function(a){var b,c=[],d=new THREE.Path;var e=0;for(b=a.length;e<b;e++){var f=a[e];var g=f.args;f=f.action;f==THREE.PathActions.MOVE_TO&&0!=d.actions.length&&(c.push(d),d=new THREE.Path);d[f].apply(d,g)}0!=d.actions.length&&c.push(d);return c}(this.actions);if(0==e.length)return[];if(!0===a)return c(e);var f,g,h=[];if(1==e.length)return f=e[0],g=new THREE.Shape,g.actions=f.actions,g.curves=f.curves,h.push(g),h;var k=!THREE.Shape.Utils.isClockWise(e[0].getPoints());k=b?
!k:k;g=[];var l=[],p=[],q=0;l[q]=void 0;p[q]=[];var m;var r=0;for(m=e.length;r<m;r++){f=e[r];var t=f.getPoints();var u=THREE.Shape.Utils.isClockWise(t);(u=b?!u:u)?(!k&&l[q]&&q++,l[q]={s:new THREE.Shape,p:t},l[q].s.actions=f.actions,l[q].s.curves=f.curves,k&&q++,p[q]=[]):p[q].push({h:f,p:t[0]})}if(!l[0])return c(e);if(1<l.length){r=!1;m=[];f=0;for(e=l.length;f<e;f++)g[f]=[];f=0;for(e=l.length;f<e;f++)for(u=p[f],k=0;k<u.length;k++){q=u[k];t=!0;for(var v=0;v<l.length;v++)d(q.p,l[v].p)&&(f!=v&&m.push({froms:f,
tos:v,hole:k}),t?(t=!1,g[v].push(q)):r=!0);t&&g[f].push(q)}0<m.length&&(r||(p=g))}r=0;for(m=l.length;r<m;r++)for(g=l[r].s,h.push(g),f=p[r],e=0,u=f.length;e<u;e++)g.holes.push(f[e].h);return h};THREE.Shape=function(){THREE.Path.apply(this,arguments);this.holes=[]};THREE.Shape.prototype=Object.create(THREE.Path.prototype);THREE.Shape.prototype.constructor=THREE.Shape;THREE.Shape.prototype.extrude=function(b){return new THREE.ExtrudeGeometry(this,b)};
THREE.Shape.prototype.makeGeometry=function(b){return new THREE.ShapeGeometry(this,b)};THREE.Shape.prototype.getPointsHoles=function(b){var a,c=this.holes.length,d=[];for(a=0;a<c;a++)d[a]=this.holes[a].getTransformedPoints(b,this.bends);return d};THREE.Shape.prototype.getSpacedPointsHoles=function(b){var a,c=this.holes.length,d=[];for(a=0;a<c;a++)d[a]=this.holes[a].getTransformedSpacedPoints(b,this.bends);return d};
THREE.Shape.prototype.extractAllPoints=function(b){return{shape:this.getTransformedPoints(b),holes:this.getPointsHoles(b)}};THREE.Shape.prototype.extractPoints=function(b){return this.useSpacedPoints?this.extractAllSpacedPoints(b):this.extractAllPoints(b)};THREE.Shape.prototype.extractAllSpacedPoints=function(b){return{shape:this.getTransformedSpacedPoints(b),holes:this.getSpacedPointsHoles(b)}};
THREE.Shape.Utils={triangulateShape:function(b,a){function c(a,b,c){return a.x!=b.x?a.x<b.x?a.x<=c.x&&c.x<=b.x:b.x<=c.x&&c.x<=a.x:a.y<b.y?a.y<=c.y&&c.y<=b.y:b.y<=c.y&&c.y<=a.y}function d(a,b,d,e,f){var g=b.x-a.x,h=b.y-a.y,k=e.x-d.x,l=e.y-d.y,m=a.x-d.x,p=a.y-d.y,q=h*k-g*l,r=h*m-g*p;if(1E-10<Math.abs(q)){if(0<q){if(0>r||r>q)return[];k=l*m-k*p;if(0>k||k>q)return[]}else{if(0<r||r<q)return[];k=l*m-k*p;if(0<k||k<q)return[]}if(0==k)return!f||0!=r&&r!=q?[a]:[];if(k==q)return!f||0!=r&&r!=q?[b]:[];if(0==r)return[d];
if(r==q)return[e];f=k/q;return[{x:a.x+f*g,y:a.y+f*h}]}if(0!=r||l*m!=k*p)return[];h=0==g&&0==h;k=0==k&&0==l;if(h&&k)return a.x!=d.x||a.y!=d.y?[]:[a];if(h)return c(d,e,a)?[a]:[];if(k)return c(a,b,d)?[d]:[];0!=g?(a.x<b.x?(g=a,k=a.x,h=b,a=b.x):(g=b,k=b.x,h=a,a=a.x),d.x<e.x?(b=d,q=d.x,l=e,d=e.x):(b=e,q=e.x,l=d,d=d.x)):(a.y<b.y?(g=a,k=a.y,h=b,a=b.y):(g=b,k=b.y,h=a,a=a.y),d.y<e.y?(b=d,q=d.y,l=e,d=e.y):(b=e,q=e.y,l=d,d=d.y));return k<=q?a<q?[]:a==q?f?[]:[b]:a<=d?[b,h]:[b,l]:k>d?[]:k==d?f?[]:[g]:a<=d?[g,h]:
[g,l]}function e(a,b,c,d){var e=b.x-a.x,f=b.y-a.y;b=c.x-a.x;c=c.y-a.y;var g=d.x-a.x;d=d.y-a.y;a=e*c-f*b;e=e*d-f*g;return 1E-10<Math.abs(a)?(b=g*c-d*b,0<a?0<=e&&0<=b:0<=e||0<=b):0<e}var f,g={};var h=b.concat();var k=0;for(f=a.length;k<f;k++)Array.prototype.push.apply(h,a[k]);k=0;for(f=h.length;k<f;k++){var l=h[k].x+":"+h[k].y;void 0!==g[l]&&console.log("Duplicate point",l);g[l]=k}k=function(a,b){function c(a,b){var c=h.length-1,d=a-1;0>d&&(d=c);var f=a+1;f>c&&(f=0);c=e(h[a],h[d],h[f],I[b]);if(!c)return!1;
c=I.length-1;d=b-1;0>d&&(d=c);f=b+1;f>c&&(f=0);return e(I[b],I[d],I[f],h[a])?!0:!1}function f(a,b){var c,e;for(c=0;c<h.length;c++)if(e=c+1,e%=h.length,e=d(a,b,h[c],h[e],!0),0<e.length)return!0;return!1}function g(a,c){var e,f,g;for(e=0;e<k.length;e++){var h=b[k[e]];for(f=0;f<h.length;f++)if(g=f+1,g%=h.length,g=d(a,c,h[f],h[g],!0),0<g.length)return!0}return!1}var h=a.concat(),k=[],l,m,p,q,r=[],M,Q=0;for(l=b.length;Q<l;Q++)k.push(Q);var K=0;for(var B=2*k.length;0<k.length;){B--;if(0>B){console.log("Infinite Loop! Holes left:"+
k.length+", Probably Hole outside Shape!");break}for(m=K;m<h.length;m++){var D=h[m];l=-1;for(Q=0;Q<k.length;Q++)if(p=k[Q],q=D.x+":"+D.y+":"+p,void 0===r[q]){var I=b[p];for(M=0;M<I.length;M++)if(p=I[M],c(m,M)&&!f(D,p)&&!g(D,p)){l=M;k.splice(Q,1);K=h.slice(0,m+1);p=h.slice(m);M=I.slice(l);var G=I.slice(0,l+1);h=K.concat(M).concat(G).concat(p);K=m;break}if(0<=l)break;r[q]=!0}if(0<=l)break}}return h}(b,a);var p=THREE.FontUtils.Triangulate(k,!1);k=0;for(f=p.length;k<f;k++){var q=p[k];for(h=0;3>h;h++)l=
q[h].x+":"+q[h].y,l=g[l],void 0!==l&&(q[h]=l)}return p.concat()},isClockWise:function(b){return 0>THREE.FontUtils.Triangulate.area(b)},b2p0:function(b,a){var c=1-b;return c*c*a},b2p1:function(b,a){return 2*(1-b)*b*a},b2p2:function(b,a){return b*b*a},b2:function(b,a,c,d){return this.b2p0(b,a)+this.b2p1(b,c)+this.b2p2(b,d)},b3p0:function(b,a){var c=1-b;return c*c*c*a},b3p1:function(b,a){var c=1-b;return 3*c*c*b*a},b3p2:function(b,a){return 3*(1-b)*b*b*a},b3p3:function(b,a){return b*b*b*a},b3:function(b,
a,c,d,e){return this.b3p0(b,a)+this.b3p1(b,c)+this.b3p2(b,d)+this.b3p3(b,e)}};THREE.LineCurve=function(b,a){this.v1=b;this.v2=a};THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.LineCurve.prototype.constructor=THREE.LineCurve;THREE.LineCurve.prototype.getPoint=function(b){var a=this.v2.clone().sub(this.v1);a.multiplyScalar(b).add(this.v1);return a};THREE.LineCurve.prototype.getPointAt=function(b){return this.getPoint(b)};THREE.LineCurve.prototype.getTangent=function(b){return this.v2.clone().sub(this.v1).normalize()};
THREE.QuadraticBezierCurve=function(b,a,c){this.v0=b;this.v1=a;this.v2=c};THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.QuadraticBezierCurve.prototype.constructor=THREE.QuadraticBezierCurve;THREE.QuadraticBezierCurve.prototype.getPoint=function(b){var a=new THREE.Vector2;a.x=THREE.Shape.Utils.b2(b,this.v0.x,this.v1.x,this.v2.x);a.y=THREE.Shape.Utils.b2(b,this.v0.y,this.v1.y,this.v2.y);return a};
THREE.QuadraticBezierCurve.prototype.getTangent=function(b){var a=new THREE.Vector2;a.x=THREE.Curve.Utils.tangentQuadraticBezier(b,this.v0.x,this.v1.x,this.v2.x);a.y=THREE.Curve.Utils.tangentQuadraticBezier(b,this.v0.y,this.v1.y,this.v2.y);return a.normalize()};THREE.CubicBezierCurve=function(b,a,c,d){this.v0=b;this.v1=a;this.v2=c;this.v3=d};THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.CubicBezierCurve.prototype.constructor=THREE.CubicBezierCurve;
THREE.CubicBezierCurve.prototype.getPoint=function(b){var a=THREE.Shape.Utils.b3(b,this.v0.x,this.v1.x,this.v2.x,this.v3.x);b=THREE.Shape.Utils.b3(b,this.v0.y,this.v1.y,this.v2.y,this.v3.y);return new THREE.Vector2(a,b)};THREE.CubicBezierCurve.prototype.getTangent=function(b){var a=THREE.Curve.Utils.tangentCubicBezier(b,this.v0.x,this.v1.x,this.v2.x,this.v3.x);b=THREE.Curve.Utils.tangentCubicBezier(b,this.v0.y,this.v1.y,this.v2.y,this.v3.y);a=new THREE.Vector2(a,b);a.normalize();return a};
THREE.SplineCurve=function(b){this.points=void 0==b?[]:b};THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.SplineCurve.prototype.constructor=THREE.SplineCurve;
THREE.SplineCurve.prototype.getPoint=function(b){var a=this.points;b*=a.length-1;var c=Math.floor(b);b-=c;var d=a[0==c?c:c-1],e=a[c],f=a[c>a.length-2?a.length-1:c+1];a=a[c>a.length-3?a.length-1:c+2];c=new THREE.Vector2;c.x=THREE.Curve.Utils.interpolate(d.x,e.x,f.x,a.x,b);c.y=THREE.Curve.Utils.interpolate(d.y,e.y,f.y,a.y,b);return c};THREE.EllipseCurve=function(b,a,c,d,e,f,g){this.aX=b;this.aY=a;this.xRadius=c;this.yRadius=d;this.aStartAngle=e;this.aEndAngle=f;this.aClockwise=g};
THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype);THREE.EllipseCurve.prototype.constructor=THREE.EllipseCurve;THREE.EllipseCurve.prototype.getPoint=function(b){var a=this.aEndAngle-this.aStartAngle;0>a&&(a+=2*Math.PI);a>2*Math.PI&&(a-=2*Math.PI);b=!0===this.aClockwise?this.aEndAngle+(1-b)*(2*Math.PI-a):this.aStartAngle+b*a;a=new THREE.Vector2;a.x=this.aX+this.xRadius*Math.cos(b);a.y=this.aY+this.yRadius*Math.sin(b);return a};
THREE.ArcCurve=function(b,a,c,d,e,f){THREE.EllipseCurve.call(this,b,a,c,c,d,e,f)};THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype);THREE.ArcCurve.prototype.constructor=THREE.ArcCurve;THREE.LineCurve3=THREE.Curve.create(function(b,a){this.v1=b;this.v2=a},function(b){var a=new THREE.Vector3;a.subVectors(this.v2,this.v1);a.multiplyScalar(b);a.add(this.v1);return a});
THREE.QuadraticBezierCurve3=THREE.Curve.create(function(b,a,c){this.v0=b;this.v1=a;this.v2=c},function(b){var a=new THREE.Vector3;a.x=THREE.Shape.Utils.b2(b,this.v0.x,this.v1.x,this.v2.x);a.y=THREE.Shape.Utils.b2(b,this.v0.y,this.v1.y,this.v2.y);a.z=THREE.Shape.Utils.b2(b,this.v0.z,this.v1.z,this.v2.z);return a});
THREE.CubicBezierCurve3=THREE.Curve.create(function(b,a,c,d){this.v0=b;this.v1=a;this.v2=c;this.v3=d},function(b){var a=new THREE.Vector3;a.x=THREE.Shape.Utils.b3(b,this.v0.x,this.v1.x,this.v2.x,this.v3.x);a.y=THREE.Shape.Utils.b3(b,this.v0.y,this.v1.y,this.v2.y,this.v3.y);a.z=THREE.Shape.Utils.b3(b,this.v0.z,this.v1.z,this.v2.z,this.v3.z);return a});
THREE.SplineCurve3=THREE.Curve.create(function(b){this.points=void 0==b?[]:b},function(b){var a=this.points;b*=a.length-1;var c=Math.floor(b);b-=c;var d=a[0==c?c:c-1],e=a[c],f=a[c>a.length-2?a.length-1:c+1];a=a[c>a.length-3?a.length-1:c+2];c=new THREE.Vector3;c.x=THREE.Curve.Utils.interpolate(d.x,e.x,f.x,a.x,b);c.y=THREE.Curve.Utils.interpolate(d.y,e.y,f.y,a.y,b);c.z=THREE.Curve.Utils.interpolate(d.z,e.z,f.z,a.z,b);return c});
THREE.ClosedSplineCurve3=THREE.Curve.create(function(b){this.points=void 0==b?[]:b},function(b){var a=this.points;b*=a.length-0;var c=Math.floor(b);b-=c;c+=0<c?0:(Math.floor(Math.abs(c)/a.length)+1)*a.length;var d=a[(c-1)%a.length],e=a[c%a.length],f=a[(c+1)%a.length];a=a[(c+2)%a.length];c=new THREE.Vector3;c.x=THREE.Curve.Utils.interpolate(d.x,e.x,f.x,a.x,b);c.y=THREE.Curve.Utils.interpolate(d.y,e.y,f.y,a.y,b);c.z=THREE.Curve.Utils.interpolate(d.z,e.z,f.z,a.z,b);return c});
THREE.AnimationHandler={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2,add:function(){console.warn("THREE.AnimationHandler.add() has been deprecated.")},get:function(){console.warn("THREE.AnimationHandler.get() has been deprecated.")},remove:function(){console.warn("THREE.AnimationHandler.remove() has been deprecated.")},animations:[],init:function(b){if(!0===b.initialized)return b;for(var a=0;a<b.hierarchy.length;a++){for(var c=0;c<b.hierarchy[a].keys.length;c++)if(0>b.hierarchy[a].keys[c].time&&(b.hierarchy[a].keys[c].time=
0),void 0!==b.hierarchy[a].keys[c].rot&&!(b.hierarchy[a].keys[c].rot instanceof THREE.Quaternion)){var d=b.hierarchy[a].keys[c].rot;b.hierarchy[a].keys[c].rot=(new THREE.Quaternion).fromArray(d)}if(b.hierarchy[a].keys.length&&void 0!==b.hierarchy[a].keys[0].morphTargets){d={};for(c=0;c<b.hierarchy[a].keys.length;c++)for(var e=0;e<b.hierarchy[a].keys[c].morphTargets.length;e++){var f=b.hierarchy[a].keys[c].morphTargets[e];d[f]=-1}b.hierarchy[a].usedMorphTargets=d;for(c=0;c<b.hierarchy[a].keys.length;c++){var g=
{};for(f in d){for(e=0;e<b.hierarchy[a].keys[c].morphTargets.length;e++)if(b.hierarchy[a].keys[c].morphTargets[e]===f){g[f]=b.hierarchy[a].keys[c].morphTargetsInfluences[e];break}e===b.hierarchy[a].keys[c].morphTargets.length&&(g[f]=0)}b.hierarchy[a].keys[c].morphTargetsInfluences=g}}for(c=1;c<b.hierarchy[a].keys.length;c++)b.hierarchy[a].keys[c].time===b.hierarchy[a].keys[c-1].time&&(b.hierarchy[a].keys.splice(c,1),c--);for(c=0;c<b.hierarchy[a].keys.length;c++)b.hierarchy[a].keys[c].index=c}b.initialized=
!0;return b},parse:function(b){var a=function(b,c){c.push(b);for(var d=0;d<b.children.length;d++)a(b.children[d],c)},c=[];if(b instanceof THREE.SkinnedMesh)for(var d=0;d<b.skeleton.bones.length;d++)c.push(b.skeleton.bones[d]);else a(b,c);return c},play:function(b){-1===this.animations.indexOf(b)&&this.animations.push(b)},stop:function(b){b=this.animations.indexOf(b);-1!==b&&this.animations.splice(b,1)},update:function(b){for(var a=0;a<this.animations.length;a++)this.animations[a].resetBlendWeights();
for(a=0;a<this.animations.length;a++)this.animations[a].update(b)}};THREE.Animation=function(b,a){this.root=b;this.data=THREE.AnimationHandler.init(a);this.hierarchy=THREE.AnimationHandler.parse(b);this.currentTime=0;this.timeScale=1;this.isPlaying=!1;this.loop=!0;this.weight=0;this.interpolationType=THREE.AnimationHandler.LINEAR};THREE.Animation.prototype.keyTypes=["pos","rot","scl"];
THREE.Animation.prototype.play=function(b,a){this.currentTime=void 0!==b?b:0;this.weight=void 0!==a?a:1;this.isPlaying=!0;this.reset();THREE.AnimationHandler.play(this)};THREE.Animation.prototype.stop=function(){this.isPlaying=!1;THREE.AnimationHandler.stop(this)};
THREE.Animation.prototype.reset=function(){for(var b=0,a=this.hierarchy.length;b<a;b++){var c=this.hierarchy[b];void 0===c.animationCache&&(c.animationCache={animations:{},blending:{positionWeight:0,quaternionWeight:0,scaleWeight:0}});void 0===c.animationCache.animations[this.data.name]&&(c.animationCache.animations[this.data.name]={},c.animationCache.animations[this.data.name].prevKey={pos:0,rot:0,scl:0},c.animationCache.animations[this.data.name].nextKey={pos:0,rot:0,scl:0},c.animationCache.animations[this.data.name].originalMatrix=
c.matrix);c=c.animationCache.animations[this.data.name];for(var d=0;3>d;d++){for(var e=this.keyTypes[d],f=this.data.hierarchy[b].keys[0],g=this.getNextKeyWith(e,b,1);g.time<this.currentTime&&g.index>f.index;)f=g,g=this.getNextKeyWith(e,b,g.index+1);c.prevKey[e]=f;c.nextKey[e]=g}}};
THREE.Animation.prototype.resetBlendWeights=function(){for(var b=0,a=this.hierarchy.length;b<a;b++){var c=this.hierarchy[b];void 0!==c.animationCache&&(c.animationCache.blending.positionWeight=0,c.animationCache.blending.quaternionWeight=0,c.animationCache.blending.scaleWeight=0)}};
THREE.Animation.prototype.update=function(){var b=[],a=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Quaternion,e=function(a,b){var c=[],d=[];var e=(a.length-1)*b;var g=Math.floor(e);e-=g;c[0]=0===g?g:g-1;c[1]=g;c[2]=g>a.length-2?g:g+1;c[3]=g>a.length-3?g:g+2;g=a[c[0]];var h=a[c[1]];var r=a[c[2]];var t=a[c[3]];c=e*e;var u=e*c;d[0]=f(g[0],h[0],r[0],t[0],e,c,u);d[1]=f(g[1],h[1],r[1],t[1],e,c,u);d[2]=f(g[2],h[2],r[2],t[2],e,c,u);return d},f=function(a,b,c,d,e,f,m){a=.5*(c-a);d=.5*(d-b);return(2*
(b-c)+a+d)*m+(-3*(b-c)-2*a-d)*f+a*e+b};return function(f){if(!1!==this.isPlaying&&(this.currentTime+=f*this.timeScale,0!==this.weight)){f=this.data.length;if(this.currentTime>f||0>this.currentTime)this.loop?(this.currentTime%=f,0>this.currentTime&&(this.currentTime+=f),this.reset()):this.stop();f=0;for(var g=this.hierarchy.length;f<g;f++)for(var k=this.hierarchy[f],l=k.animationCache.animations[this.data.name],p=k.animationCache.blending,q=0;3>q;q++){var m=this.keyTypes[q],r=l.prevKey[m],t=l.nextKey[m];
if(0<this.timeScale&&t.time<=this.currentTime||0>this.timeScale&&r.time>=this.currentTime){r=this.data.hierarchy[f].keys[0];for(t=this.getNextKeyWith(m,f,1);t.time<this.currentTime&&t.index>r.index;)r=t,t=this.getNextKeyWith(m,f,t.index+1);l.prevKey[m]=r;l.nextKey[m]=t}var u=(this.currentTime-r.time)/(t.time-r.time),v=r[m],w=t[m];0>u&&(u=0);1<u&&(u=1);if("pos"===m)if(this.interpolationType===THREE.AnimationHandler.LINEAR)c.x=v[0]+(w[0]-v[0])*u,c.y=v[1]+(w[1]-v[1])*u,c.z=v[2]+(w[2]-v[2])*u,r=this.weight/
(this.weight+p.positionWeight),k.position.lerp(c,r),p.positionWeight+=this.weight;else{if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)b[0]=this.getPrevKeyWith("pos",f,r.index-1).pos,b[1]=v,b[2]=w,b[3]=this.getNextKeyWith("pos",f,t.index+1).pos,u=.33*u+.33,t=e(b,u),r=this.weight/(this.weight+p.positionWeight),p.positionWeight+=this.weight,m=k.position,m.x+=(t[0]-m.x)*r,m.y+=(t[1]-m.y)*r,m.z+=(t[2]-m.z)*r,this.interpolationType===
THREE.AnimationHandler.CATMULLROM_FORWARD&&(u=e(b,1.01*u),a.set(u[0],u[1],u[2]),a.sub(m),a.y=0,a.normalize(),u=Math.atan2(a.x,a.z),k.rotation.set(0,u,0))}else"rot"===m?(THREE.Quaternion.slerp(v,w,d,u),0===p.quaternionWeight?(k.quaternion.copy(d),p.quaternionWeight=this.weight):(r=this.weight/(this.weight+p.quaternionWeight),THREE.Quaternion.slerp(k.quaternion,d,k.quaternion,r),p.quaternionWeight+=this.weight)):"scl"===m&&(c.x=v[0]+(w[0]-v[0])*u,c.y=v[1]+(w[1]-v[1])*u,c.z=v[2]+(w[2]-v[2])*u,r=this.weight/
(this.weight+p.scaleWeight),k.scale.lerp(c,r),p.scaleWeight+=this.weight)}return!0}}}();THREE.Animation.prototype.getNextKeyWith=function(b,a,c){var d=this.data.hierarchy[a].keys;for(c=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?c<d.length-1?c:d.length-1:c%d.length;c<d.length;c++)if(void 0!==d[c][b])return d[c];return this.data.hierarchy[a].keys[0]};
THREE.Animation.prototype.getPrevKeyWith=function(b,a,c){var d=this.data.hierarchy[a].keys;for(c=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?0<c?c:0:0<=c?c:c+d.length;0<=c;c--)if(void 0!==d[c][b])return d[c];return this.data.hierarchy[a].keys[d.length-1]};
THREE.KeyFrameAnimation=function(b){this.root=b.node;this.data=THREE.AnimationHandler.init(b);this.hierarchy=THREE.AnimationHandler.parse(this.root);this.currentTime=0;this.timeScale=.001;this.isPlaying=!1;this.loop=this.isPaused=!0;b=0;for(var a=this.hierarchy.length;b<a;b++){var c=this.data.hierarchy[b].sids,d=this.hierarchy[b];if(this.data.hierarchy[b].keys.length&&c){for(var e=0;e<c.length;e++){var f=c[e],g=this.getNextKeyWith(f,b,0);g&&g.apply(f)}d.matrixAutoUpdate=!1;this.data.hierarchy[b].node.updateMatrix();
d.matrixWorldNeedsUpdate=!0}}};
THREE.KeyFrameAnimation.prototype.play=function(b){this.currentTime=void 0!==b?b:0;if(!1===this.isPlaying){this.isPlaying=!0;var a=this.hierarchy.length;for(b=0;b<a;b++){var c=this.hierarchy[b];var d=this.data.hierarchy[b];void 0===d.animationCache&&(d.animationCache={},d.animationCache.prevKey=null,d.animationCache.nextKey=null,d.animationCache.originalMatrix=c.matrix);c=this.data.hierarchy[b].keys;c.length&&(d.animationCache.prevKey=c[0],d.animationCache.nextKey=c[1],this.startTime=Math.min(c[0].time,
this.startTime),this.endTime=Math.max(c[c.length-1].time,this.endTime))}this.update(0)}this.isPaused=!1;THREE.AnimationHandler.play(this)};THREE.KeyFrameAnimation.prototype.stop=function(){this.isPaused=this.isPlaying=!1;THREE.AnimationHandler.stop(this);for(var b=0;b<this.data.hierarchy.length;b++){var a=this.hierarchy[b],c=this.data.hierarchy[b];if(void 0!==c.animationCache){var d=c.animationCache.originalMatrix;d.copy(a.matrix);a.matrix=d;delete c.animationCache}}};
THREE.KeyFrameAnimation.prototype.update=function(b){if(!1!==this.isPlaying){this.currentTime+=b*this.timeScale;b=this.data.length;!0===this.loop&&this.currentTime>b&&(this.currentTime%=b);this.currentTime=Math.min(this.currentTime,b);b=0;for(var a=this.hierarchy.length;b<a;b++){var c=this.hierarchy[b],d=this.data.hierarchy[b],e=d.keys;d=d.animationCache;if(e.length){var f=d.prevKey,g=d.nextKey;if(g.time<=this.currentTime){for(;g.time<this.currentTime&&g.index>f.index;)f=g,g=e[f.index+1];d.prevKey=
f;d.nextKey=g}g.time>=this.currentTime?f.interpolate(g,this.currentTime):f.interpolate(g,g.time);this.data.hierarchy[b].node.updateMatrix();c.matrixWorldNeedsUpdate=!0}}}};THREE.KeyFrameAnimation.prototype.getNextKeyWith=function(b,a,c){a=this.data.hierarchy[a].keys;for(c%=a.length;c<a.length;c++)if(a[c].hasTarget(b))return a[c];return a[0]};
THREE.KeyFrameAnimation.prototype.getPrevKeyWith=function(b,a,c){a=this.data.hierarchy[a].keys;for(c=0<=c?c:c+a.length;0<=c;c--)if(a[c].hasTarget(b))return a[c];return a[a.length-1]};THREE.MorphAnimation=function(b){this.mesh=b;this.frames=b.morphTargetInfluences.length;this.currentTime=0;this.duration=1E3;this.loop=!0;this.currentFrame=this.lastFrame=0;this.isPlaying=!1};
THREE.MorphAnimation.prototype={constructor:THREE.MorphAnimation,play:function(){this.isPlaying=!0},pause:function(){this.isPlaying=!1},update:function(b){if(!1!==this.isPlaying){this.currentTime+=b;!0===this.loop&&this.currentTime>this.duration&&(this.currentTime%=this.duration);this.currentTime=Math.min(this.currentTime,this.duration);b=this.duration/this.frames;var a=Math.floor(this.currentTime/b);a!=this.currentFrame&&(this.mesh.morphTargetInfluences[this.lastFrame]=0,this.mesh.morphTargetInfluences[this.currentFrame]=
1,this.mesh.morphTargetInfluences[a]=0,this.lastFrame=this.currentFrame,this.currentFrame=a);this.mesh.morphTargetInfluences[a]=this.currentTime%b/b;this.mesh.morphTargetInfluences[this.lastFrame]=1-this.mesh.morphTargetInfluences[a]}}};
THREE.BoxGeometry=function(b,a,c,d,e,f){function g(a,b,c,d,e,f,g,u){var k=h.widthSegments,l=h.heightSegments,m=e/2,p=f/2,q=h.vertices.length;if("x"===a&&"y"===b||"y"===a&&"x"===b)var r="z";else if("x"===a&&"z"===b||"z"===a&&"x"===b)r="y",l=h.depthSegments;else if("z"===a&&"y"===b||"y"===a&&"z"===b)r="x",k=h.depthSegments;var t=k+1,A=l+1,M=e/k,Q=f/l,K=new THREE.Vector3;K[r]=0<g?1:-1;for(e=0;e<A;e++)for(f=0;f<t;f++){var B=new THREE.Vector3;B[a]=(f*M-m)*c;B[b]=(e*Q-p)*d;B[r]=g;h.vertices.push(B)}for(e=
0;e<l;e++)for(f=0;f<k;f++)p=f+t*e,a=f+t*(e+1),b=f+1+t*(e+1),c=f+1+t*e,d=new THREE.Vector2(f/k,1-e/l),g=new THREE.Vector2(f/k,1-(e+1)/l),r=new THREE.Vector2((f+1)/k,1-(e+1)/l),m=new THREE.Vector2((f+1)/k,1-e/l),p=new THREE.Face3(p+q,a+q,c+q),p.normal.copy(K),p.vertexNormals.push(K.clone(),K.clone(),K.clone()),p.materialIndex=u,h.faces.push(p),h.faceVertexUvs[0].push([d,g,m]),p=new THREE.Face3(a+q,b+q,c+q),p.normal.copy(K),p.vertexNormals.push(K.clone(),K.clone(),K.clone()),p.materialIndex=u,h.faces.push(p),
h.faceVertexUvs[0].push([g.clone(),r,m.clone()])}THREE.Geometry.call(this);this.type="BoxGeometry";this.parameters={width:b,height:a,depth:c,widthSegments:d,heightSegments:e,depthSegments:f};this.widthSegments=d||1;this.heightSegments=e||1;this.depthSegments=f||1;var h=this;d=b/2;e=a/2;f=c/2;g("z","y",-1,-1,c,a,d,0);g("z","y",1,-1,c,a,-d,1);g("x","z",1,1,b,c,e,2);g("x","z",1,-1,b,c,-e,3);g("x","y",1,-1,b,a,f,4);g("x","y",-1,-1,b,a,-f,5);this.mergeVertices()};THREE.BoxGeometry.prototype=Object.create(THREE.Geometry.prototype);
THREE.BoxGeometry.prototype.constructor=THREE.BoxGeometry;
THREE.CircleGeometry=function(b,a,c,d){THREE.Geometry.call(this);this.type="CircleGeometry";this.parameters={radius:b,segments:a,thetaStart:c,thetaLength:d};b=b||50;a=void 0!==a?Math.max(3,a):8;c=void 0!==c?c:0;d=void 0!==d?d:2*Math.PI;var e=[];var f=new THREE.Vector3;var g=new THREE.Vector2(.5,.5);this.vertices.push(f);e.push(g);for(f=0;f<=a;f++){var h=new THREE.Vector3,k=c+f/a*d;h.x=b*Math.cos(k);h.y=b*Math.sin(k);this.vertices.push(h);e.push(new THREE.Vector2((h.x/b+1)/2,(h.y/b+1)/2))}c=new THREE.Vector3(0,
0,1);for(f=1;f<=a;f++)this.faces.push(new THREE.Face3(f,f+1,0,[c.clone(),c.clone(),c.clone()])),this.faceVertexUvs[0].push([e[f].clone(),e[f+1].clone(),g.clone()]);this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,b)};THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CircleGeometry.prototype.constructor=THREE.CircleGeometry;
THREE.CubeGeometry=function(b,a,c,d,e,f){console.warn("THREE.CubeGeometry has been renamed to THREE.BoxGeometry.");return new THREE.BoxGeometry(b,a,c,d,e,f)};
THREE.CylinderGeometry=function(b,a,c,d,e,f,g,h){THREE.Geometry.call(this);this.type="CylinderGeometry";this.parameters={radiusTop:b,radiusBottom:a,height:c,radialSegments:d,heightSegments:e,openEnded:f,thetaStart:g,thetaLength:h};b=void 0!==b?b:20;a=void 0!==a?a:20;c=void 0!==c?c:100;d=d||8;e=e||1;f=void 0!==f?f:!1;g=void 0!==g?g:0;h=void 0!==h?h:2*Math.PI;var k=c/2,l,p,q=[],m=[];for(p=0;p<=e;p++){var r=[],t=[],u=p/e,v=u*(a-b)+b;for(l=0;l<=d;l++){var w=l/d,x=new THREE.Vector3;x.x=v*Math.sin(w*h+
g);x.y=-u*c+k;x.z=v*Math.cos(w*h+g);this.vertices.push(x);r.push(this.vertices.length-1);t.push(new THREE.Vector2(w,1-u))}q.push(r);m.push(t)}c=(a-b)/c;for(l=0;l<d;l++)for(0!==b?(g=this.vertices[q[0][l]].clone(),h=this.vertices[q[0][l+1]].clone()):(g=this.vertices[q[1][l]].clone(),h=this.vertices[q[1][l+1]].clone()),g.setY(Math.sqrt(g.x*g.x+g.z*g.z)*c).normalize(),h.setY(Math.sqrt(h.x*h.x+h.z*h.z)*c).normalize(),p=0;p<e;p++){r=q[p][l];t=q[p+1][l];u=q[p+1][l+1];v=q[p][l+1];w=g.clone();x=g.clone();
var C=h.clone(),y=h.clone(),R=m[p][l].clone(),P=m[p+1][l].clone(),A=m[p+1][l+1].clone(),M=m[p][l+1].clone();this.faces.push(new THREE.Face3(r,t,v,[w,x,y]));this.faceVertexUvs[0].push([R,P,M]);this.faces.push(new THREE.Face3(t,u,v,[x.clone(),C,y.clone()]));this.faceVertexUvs[0].push([P.clone(),A,M.clone()])}if(!1===f&&0<b)for(this.vertices.push(new THREE.Vector3(0,k,0)),l=0;l<d;l++)r=q[0][l],t=q[0][l+1],u=this.vertices.length-1,w=new THREE.Vector3(0,1,0),x=new THREE.Vector3(0,1,0),C=new THREE.Vector3(0,
1,0),R=m[0][l].clone(),P=m[0][l+1].clone(),A=new THREE.Vector2(P.x,0),this.faces.push(new THREE.Face3(r,t,u,[w,x,C])),this.faceVertexUvs[0].push([R,P,A]);if(!1===f&&0<a)for(this.vertices.push(new THREE.Vector3(0,-k,0)),l=0;l<d;l++)r=q[e][l+1],t=q[e][l],u=this.vertices.length-1,w=new THREE.Vector3(0,-1,0),x=new THREE.Vector3(0,-1,0),C=new THREE.Vector3(0,-1,0),R=m[e][l+1].clone(),P=m[e][l].clone(),A=new THREE.Vector2(P.x,1),this.faces.push(new THREE.Face3(r,t,u,[w,x,C])),this.faceVertexUvs[0].push([R,
P,A]);this.computeFaceNormals()};THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CylinderGeometry.prototype.constructor=THREE.CylinderGeometry;THREE.ExtrudeGeometry=function(b,a){"undefined"!==typeof b&&(THREE.Geometry.call(this),this.type="ExtrudeGeometry",b=b instanceof Array?b:[b],this.addShapeList(b,a),this.computeFaceNormals())};THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry.prototype.constructor=THREE.ExtrudeGeometry;
THREE.ExtrudeGeometry.prototype.addShapeList=function(b,a){for(var c=b.length,d=0;d<c;d++)this.addShape(b[d],a)};
THREE.ExtrudeGeometry.prototype.addShape=function(b,a){function c(a,b,c){b||console.log("die");return b.clone().multiplyScalar(c).add(a)}function d(a,b,c){var d=a.x-b.x;var e=a.y-b.y,f=c.x-a.x,g=c.y-a.y,h=d*d+e*e;if(1E-10<Math.abs(d*g-e*f)){var k=Math.sqrt(h),l=Math.sqrt(f*f+g*g);h=b.x-e/k;b=b.y+d/k;f=((c.x-g/l-h)*g-(c.y+f/l-b)*f)/(d*g-e*f);c=h+d*f-a.x;a=b+e*f-a.y;d=c*c+a*a;if(2>=d)return new THREE.Vector2(c,a);d=Math.sqrt(d/2)}else a=!1,1E-10<d?1E-10<f&&(a=!0):-1E-10>d?-1E-10>f&&(a=!0):Math.sign(e)==
Math.sign(g)&&(a=!0),a?(c=-e,a=d,d=Math.sqrt(h)):(c=d,a=e,d=Math.sqrt(h/2));return new THREE.Vector2(c/d,a/d)}function e(a,b){for(E=a.length;0<=--E;){var c=E;var d=E-1;0>d&&(d=a.length-1);var e,f=r+2*p;for(e=0;e<f;e++){var g=L*e,h=L*(e+1),k=b+c+g;g=b+d+g;var l=b+d+h;h=b+c+h;k+=K;g+=K;l+=K;h+=K;Q.faces.push(new THREE.Face3(k,g,h,null,null,x));Q.faces.push(new THREE.Face3(g,l,h,null,null,x));k=C.generateSideWallUV(Q,k,g,l,h);Q.faceVertexUvs[0].push([k[0],k[1],k[3]]);Q.faceVertexUvs[0].push([k[1],k[2],
k[3]])}}}function f(a,b,c){Q.vertices.push(new THREE.Vector3(a,b,c))}function g(a,b,c){a+=K;b+=K;c+=K;Q.faces.push(new THREE.Face3(a,b,c,null,null,w));a=C.generateTopUV(Q,a,b,c);Q.faceVertexUvs[0].push(a)}var h=void 0!==a.amount?a.amount:100,k=void 0!==a.bevelThickness?a.bevelThickness:6,l=void 0!==a.bevelSize?a.bevelSize:k-2,p=void 0!==a.bevelSegments?a.bevelSegments:3,q=void 0!==a.bevelEnabled?a.bevelEnabled:!0,m=void 0!==a.curveSegments?a.curveSegments:12,r=void 0!==a.steps?a.steps:1,t=a.extrudePath,
u,v=!1,w=a.material,x=a.extrudeMaterial,C=void 0!==a.UVGenerator?a.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator,y,R,P,A;t&&(u=t.getSpacedPoints(r),v=!0,q=!1,y=void 0!==a.frames?a.frames:new THREE.TubeGeometry.FrenetFrames(t,r,!1),R=new THREE.Vector3,P=new THREE.Vector3,A=new THREE.Vector3);q||(l=k=p=0);var M,Q=this,K=this.vertices.length;t=b.extractPoints(m);m=t.shape;var B=t.holes;if(t=!THREE.Shape.Utils.isClockWise(m)){m=m.reverse();var D=0;for(M=B.length;D<M;D++){var I=B[D];THREE.Shape.Utils.isClockWise(I)&&
(B[D]=I.reverse())}t=!1}var G=THREE.Shape.Utils.triangulateShape(m,B),H=m;D=0;for(M=B.length;D<M;D++)I=B[D],m=m.concat(I);var N,L=m.length,T,ba=G.length;t=[];var E=0;var V=H.length;var da=V-1;for(N=E+1;E<V;E++,da++,N++)da===V&&(da=0),N===V&&(N=0),t[E]=d(H[E],H[da],H[N]);var Da=[],Ia=t.concat();D=0;for(M=B.length;D<M;D++){I=B[D];var Ea=[];E=0;V=I.length;da=V-1;for(N=E+1;E<V;E++,da++,N++)da===V&&(da=0),N===V&&(N=0),Ea[E]=d(I[E],I[da],I[N]);Da.push(Ea);Ia=Ia.concat(Ea)}for(da=0;da<p;da++){V=da/p;var ia=
k*(1-V);N=l*Math.sin(V*Math.PI/2);E=0;for(V=H.length;E<V;E++){var Z=c(H[E],t[E],N);f(Z.x,Z.y,-ia)}D=0;for(M=B.length;D<M;D++)for(I=B[D],Ea=Da[D],E=0,V=I.length;E<V;E++)Z=c(I[E],Ea[E],N),f(Z.x,Z.y,-ia)}N=l;for(E=0;E<L;E++)Z=q?c(m[E],Ia[E],N):m[E],v?(P.copy(y.normals[0]).multiplyScalar(Z.x),R.copy(y.binormals[0]).multiplyScalar(Z.y),A.copy(u[0]).add(P).add(R),f(A.x,A.y,A.z)):f(Z.x,Z.y,0);for(V=1;V<=r;V++)for(E=0;E<L;E++)Z=q?c(m[E],Ia[E],N):m[E],v?(P.copy(y.normals[V]).multiplyScalar(Z.x),R.copy(y.binormals[V]).multiplyScalar(Z.y),
A.copy(u[V]).add(P).add(R),f(A.x,A.y,A.z)):f(Z.x,Z.y,h/r*V);for(da=p-1;0<=da;da--){V=da/p;ia=k*(1-V);N=l*Math.sin(V*Math.PI/2);E=0;for(V=H.length;E<V;E++)Z=c(H[E],t[E],N),f(Z.x,Z.y,h+ia);D=0;for(M=B.length;D<M;D++)for(I=B[D],Ea=Da[D],E=0,V=I.length;E<V;E++)Z=c(I[E],Ea[E],N),v?f(Z.x,Z.y+u[r-1].y,u[r-1].x+ia):f(Z.x,Z.y,h+ia)}(function(){if(q){var a=0*L;for(E=0;E<ba;E++)T=G[E],g(T[2]+a,T[1]+a,T[0]+a);a=r+2*p;a*=L;for(E=0;E<ba;E++)T=G[E],g(T[0]+a,T[1]+a,T[2]+a)}else{for(E=0;E<ba;E++)T=G[E],g(T[2],T[1],
T[0]);for(E=0;E<ba;E++)T=G[E],g(T[0]+L*r,T[1]+L*r,T[2]+L*r)}})();(function(){var a=0;e(H,a);a+=H.length;D=0;for(M=B.length;D<M;D++)I=B[D],e(I,a),a+=I.length})()};
THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(b,a,c,d){b=b.vertices;a=b[a];c=b[c];d=b[d];return[new THREE.Vector2(a.x,a.y),new THREE.Vector2(c.x,c.y),new THREE.Vector2(d.x,d.y)]},generateSideWallUV:function(b,a,c,d,e){b=b.vertices;a=b[a];c=b[c];d=b[d];e=b[e];return.01>Math.abs(a.y-c.y)?[new THREE.Vector2(a.x,1-a.z),new THREE.Vector2(c.x,1-c.z),new THREE.Vector2(d.x,1-d.z),new THREE.Vector2(e.x,1-e.z)]:[new THREE.Vector2(a.y,1-a.z),new THREE.Vector2(c.y,1-c.z),new THREE.Vector2(d.y,
1-d.z),new THREE.Vector2(e.y,1-e.z)]}};THREE.ShapeGeometry=function(b,a){THREE.Geometry.call(this);this.type="ShapeGeometry";!1===b instanceof Array&&(b=[b]);this.addShapeList(b,a);this.computeFaceNormals()};THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ShapeGeometry.prototype.constructor=THREE.ShapeGeometry;THREE.ShapeGeometry.prototype.addShapeList=function(b,a){for(var c=0,d=b.length;c<d;c++)this.addShape(b[c],a);return this};
THREE.ShapeGeometry.prototype.addShape=function(b,a){void 0===a&&(a={});var c=a.material,d=void 0===a.UVGenerator?THREE.ExtrudeGeometry.WorldUVGenerator:a.UVGenerator,e,f=this.vertices.length;var g=b.extractPoints(void 0!==a.curveSegments?a.curveSegments:12);var h=g.shape,k=g.holes;if(!THREE.Shape.Utils.isClockWise(h))for(h=h.reverse(),g=0,e=k.length;g<e;g++){var l=k[g];THREE.Shape.Utils.isClockWise(l)&&(k[g]=l.reverse())}var p=THREE.Shape.Utils.triangulateShape(h,k);g=0;for(e=k.length;g<e;g++)l=
k[g],h=h.concat(l);k=h.length;e=p.length;for(g=0;g<k;g++)l=h[g],this.vertices.push(new THREE.Vector3(l.x,l.y,0));for(g=0;g<e;g++)k=p[g],h=k[0]+f,l=k[1]+f,k=k[2]+f,this.faces.push(new THREE.Face3(h,l,k,null,null,c)),this.faceVertexUvs[0].push(d.generateTopUV(this,h,l,k))};
THREE.LatheGeometry=function(b,a,c,d){THREE.Geometry.call(this);this.type="LatheGeometry";this.parameters={points:b,segments:a,phiStart:c,phiLength:d};a=a||12;c=c||0;d=d||2*Math.PI;for(var e=1/(b.length-1),f=1/a,g=0,h=a;g<=h;g++){var k=c+g*f*d,l=Math.cos(k),p=Math.sin(k);k=0;for(var q=b.length;k<q;k++){var m=b[k],r=new THREE.Vector3;r.x=l*m.x-p*m.y;r.y=p*m.x+l*m.y;r.z=m.z;this.vertices.push(r)}}c=b.length;g=0;for(h=a;g<h;g++)for(k=0,q=b.length-1;k<q;k++){a=p=k+c*g;d=p+c;l=p+1+c;p+=1;m=g*f;r=k*e;var t=
m+f,u=r+e;this.faces.push(new THREE.Face3(a,d,p));this.faceVertexUvs[0].push([new THREE.Vector2(m,r),new THREE.Vector2(t,r),new THREE.Vector2(m,u)]);this.faces.push(new THREE.Face3(d,l,p));this.faceVertexUvs[0].push([new THREE.Vector2(t,r),new THREE.Vector2(t,u),new THREE.Vector2(m,u)])}this.mergeVertices();this.computeFaceNormals();this.computeVertexNormals()};THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.LatheGeometry.prototype.constructor=THREE.LatheGeometry;
THREE.PlaneGeometry=function(b,a,c,d){console.info("THREE.PlaneGeometry: Consider using THREE.PlaneBufferGeometry for lower memory footprint.");THREE.Geometry.call(this);this.type="PlaneGeometry";this.parameters={width:b,height:a,widthSegments:c,heightSegments:d};this.fromBufferGeometry(new THREE.PlaneBufferGeometry(b,a,c,d))};THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.PlaneGeometry.prototype.constructor=THREE.PlaneGeometry;
THREE.PlaneBufferGeometry=function(b,a,c,d){THREE.BufferGeometry.call(this);this.type="PlaneBufferGeometry";this.parameters={width:b,height:a,widthSegments:c,heightSegments:d};var e=b/2,f=a/2;c=c||1;d=d||1;var g=c+1,h=d+1,k=b/c,l=a/d;a=new Float32Array(g*h*3);b=new Float32Array(g*h*3);for(var p=new Float32Array(g*h*2),q=0,m=0,r=0;r<h;r++)for(var t=r*l-f,u=0;u<g;u++)a[q]=u*k-e,a[q+1]=-t,b[q+2]=1,p[m]=u/c,p[m+1]=1-r/d,q+=3,m+=2;q=0;e=new (65535<a.length/3?Uint32Array:Uint16Array)(c*d*6);for(r=0;r<d;r++)for(u=
0;u<c;u++)f=u+g*(r+1),h=u+1+g*(r+1),k=u+1+g*r,e[q]=u+g*r,e[q+1]=f,e[q+2]=k,e[q+3]=f,e[q+4]=h,e[q+5]=k,q+=6;this.addAttribute("index",new THREE.BufferAttribute(e,1));this.addAttribute("position",new THREE.BufferAttribute(a,3));this.addAttribute("normal",new THREE.BufferAttribute(b,3));this.addAttribute("uv",new THREE.BufferAttribute(p,2))};THREE.PlaneBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.PlaneBufferGeometry.prototype.constructor=THREE.PlaneBufferGeometry;
THREE.RingGeometry=function(b,a,c,d,e,f){THREE.Geometry.call(this);this.type="RingGeometry";this.parameters={innerRadius:b,outerRadius:a,thetaSegments:c,phiSegments:d,thetaStart:e,thetaLength:f};b=b||0;a=a||50;e=void 0!==e?e:0;f=void 0!==f?f:2*Math.PI;c=void 0!==c?Math.max(3,c):8;d=void 0!==d?Math.max(1,d):8;var g,h=[],k=b,l=(a-b)/d;for(b=0;b<d+1;b++){for(g=0;g<c+1;g++){var p=new THREE.Vector3,q=e+g/c*f;p.x=k*Math.cos(q);p.y=k*Math.sin(q);this.vertices.push(p);h.push(new THREE.Vector2((p.x/a+1)/2,
(p.y/a+1)/2))}k+=l}a=new THREE.Vector3(0,0,1);for(b=0;b<d;b++)for(e=b*(c+1),g=0;g<c;g++)f=q=g+e,l=q+c+1,p=q+c+2,this.faces.push(new THREE.Face3(f,l,p,[a.clone(),a.clone(),a.clone()])),this.faceVertexUvs[0].push([h[f].clone(),h[l].clone(),h[p].clone()]),f=q,l=q+c+2,p=q+1,this.faces.push(new THREE.Face3(f,l,p,[a.clone(),a.clone(),a.clone()])),this.faceVertexUvs[0].push([h[f].clone(),h[l].clone(),h[p].clone()]);this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,k)};
THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.RingGeometry.prototype.constructor=THREE.RingGeometry;
THREE.SphereGeometry=function(b,a,c,d,e,f,g){THREE.Geometry.call(this);this.type="SphereGeometry";this.parameters={radius:b,widthSegments:a,heightSegments:c,phiStart:d,phiLength:e,thetaStart:f,thetaLength:g};b=b||50;a=Math.max(3,Math.floor(a)||8);c=Math.max(2,Math.floor(c)||6);d=void 0!==d?d:0;e=void 0!==e?e:2*Math.PI;f=void 0!==f?f:0;g=void 0!==g?g:Math.PI;var h,k,l=[],p=[];for(k=0;k<=c;k++){var q=[],m=[];for(h=0;h<=a;h++){var r=h/a,t=k/c,u=new THREE.Vector3;u.x=-b*Math.cos(d+r*e)*Math.sin(f+t*g);
u.y=b*Math.cos(f+t*g);u.z=b*Math.sin(d+r*e)*Math.sin(f+t*g);this.vertices.push(u);q.push(this.vertices.length-1);m.push(new THREE.Vector2(r,1-t))}l.push(q);p.push(m)}for(k=0;k<c;k++)for(h=0;h<a;h++){d=l[k][h+1];e=l[k][h];f=l[k+1][h];g=l[k+1][h+1];q=this.vertices[d].clone().normalize();m=this.vertices[e].clone().normalize();r=this.vertices[f].clone().normalize();t=this.vertices[g].clone().normalize();u=p[k][h+1].clone();var v=p[k][h].clone(),w=p[k+1][h].clone(),x=p[k+1][h+1].clone();Math.abs(this.vertices[d].y)===
b?(u.x=(u.x+v.x)/2,this.faces.push(new THREE.Face3(d,f,g,[q,r,t])),this.faceVertexUvs[0].push([u,w,x])):Math.abs(this.vertices[f].y)===b?(w.x=(w.x+x.x)/2,this.faces.push(new THREE.Face3(d,e,f,[q,m,r])),this.faceVertexUvs[0].push([u,v,w])):(this.faces.push(new THREE.Face3(d,e,g,[q,m,t])),this.faceVertexUvs[0].push([u,v,x]),this.faces.push(new THREE.Face3(e,f,g,[m.clone(),r,t.clone()])),this.faceVertexUvs[0].push([v.clone(),w,x.clone()]))}this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,
b)};THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.SphereGeometry.prototype.constructor=THREE.SphereGeometry;THREE.TextGeometry=function(b,a){a=a||{};var c=THREE.FontUtils.generateShapes(b,a);a.amount=void 0!==a.height?a.height:50;void 0===a.bevelThickness&&(a.bevelThickness=10);void 0===a.bevelSize&&(a.bevelSize=8);void 0===a.bevelEnabled&&(a.bevelEnabled=!1);THREE.ExtrudeGeometry.call(this,c,a);this.type="TextGeometry"};THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype);
THREE.TextGeometry.prototype.constructor=THREE.TextGeometry;
THREE.TorusGeometry=function(b,a,c,d,e){THREE.Geometry.call(this);this.type="TorusGeometry";this.parameters={radius:b,tube:a,radialSegments:c,tubularSegments:d,arc:e};b=b||100;a=a||40;c=c||8;d=d||6;e=e||2*Math.PI;for(var f=new THREE.Vector3,g=[],h=[],k=0;k<=c;k++)for(var l=0;l<=d;l++){var p=l/d*e,q=k/c*Math.PI*2;f.x=b*Math.cos(p);f.y=b*Math.sin(p);var m=new THREE.Vector3;m.x=(b+a*Math.cos(q))*Math.cos(p);m.y=(b+a*Math.cos(q))*Math.sin(p);m.z=a*Math.sin(q);this.vertices.push(m);g.push(new THREE.Vector2(l/
d,k/c));h.push(m.clone().sub(f).normalize())}for(k=1;k<=c;k++)for(l=1;l<=d;l++)b=(d+1)*k+l-1,a=(d+1)*(k-1)+l-1,e=(d+1)*(k-1)+l,f=(d+1)*k+l,p=new THREE.Face3(b,a,f,[h[b].clone(),h[a].clone(),h[f].clone()]),this.faces.push(p),this.faceVertexUvs[0].push([g[b].clone(),g[a].clone(),g[f].clone()]),p=new THREE.Face3(a,e,f,[h[a].clone(),h[e].clone(),h[f].clone()]),this.faces.push(p),this.faceVertexUvs[0].push([g[a].clone(),g[e].clone(),g[f].clone()]);this.computeFaceNormals()};
THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TorusGeometry.prototype.constructor=THREE.TorusGeometry;
THREE.TorusKnotGeometry=function(b,a,c,d,e,f,g){function h(a,b,c,d,e){var f=Math.cos(a),g=Math.sin(a);a*=b/c;b=Math.cos(a);f*=d*(2+b)*.5;g=d*(2+b)*g*.5;d=e*d*Math.sin(a)*.5;return new THREE.Vector3(f,g,d)}THREE.Geometry.call(this);this.type="TorusKnotGeometry";this.parameters={radius:b,tube:a,radialSegments:c,tubularSegments:d,p:e,q:f,heightScale:g};b=b||100;a=a||40;c=c||64;d=d||8;e=e||2;f=f||3;g=g||1;for(var k=Array(c),l=new THREE.Vector3,p=new THREE.Vector3,q=new THREE.Vector3,m=0;m<c;++m){k[m]=
Array(d);var r=m/c*2*e*Math.PI,t=h(r,f,e,b,g);r=h(r+.01,f,e,b,g);l.subVectors(r,t);p.addVectors(r,t);q.crossVectors(l,p);p.crossVectors(q,l);q.normalize();p.normalize();for(r=0;r<d;++r){var u=r/d*2*Math.PI,v=-a*Math.cos(u);u=a*Math.sin(u);var w=new THREE.Vector3;w.x=t.x+v*p.x+u*q.x;w.y=t.y+v*p.y+u*q.y;w.z=t.z+v*p.z+u*q.z;k[m][r]=this.vertices.push(w)-1}}for(m=0;m<c;++m)for(r=0;r<d;++r)e=(m+1)%c,f=(r+1)%d,b=k[m][r],a=k[e][r],e=k[e][f],f=k[m][f],g=new THREE.Vector2(m/c,r/d),l=new THREE.Vector2((m+1)/
c,r/d),p=new THREE.Vector2((m+1)/c,(r+1)/d),q=new THREE.Vector2(m/c,(r+1)/d),this.faces.push(new THREE.Face3(b,a,f)),this.faceVertexUvs[0].push([g,l,q]),this.faces.push(new THREE.Face3(a,e,f)),this.faceVertexUvs[0].push([l.clone(),p,q.clone()]);this.computeFaceNormals();this.computeVertexNormals()};THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TorusKnotGeometry.prototype.constructor=THREE.TorusKnotGeometry;
THREE.TubeGeometry=function(b,a,c,d,e,f){THREE.Geometry.call(this);this.type="TubeGeometry";this.parameters={path:b,segments:a,radius:c,radialSegments:d,closed:e};a=a||64;c=c||1;d=d||8;e=e||!1;f=f||THREE.TubeGeometry.NoTaper;var g=[],h=a+1,k=new THREE.Vector3;var l=new THREE.TubeGeometry.FrenetFrames(b,a,e);var p=l.normals;var q=l.binormals;this.tangents=l.tangents;this.normals=p;this.binormals=q;for(l=0;l<h;l++){g[l]=[];var m=l/(h-1);var r=b.getPointAt(m);var t=p[l];var u=q[l];var v=c*f(m);for(m=
0;m<d;m++){var w=m/d*2*Math.PI;var x=-v*Math.cos(w);w=v*Math.sin(w);k.copy(r);k.x+=x*t.x+w*u.x;k.y+=x*t.y+w*u.y;k.z+=x*t.z+w*u.z;g[l][m]=this.vertices.push(new THREE.Vector3(k.x,k.y,k.z))-1}}for(l=0;l<a;l++)for(m=0;m<d;m++)f=e?(l+1)%a:l+1,h=(m+1)%d,b=g[l][m],c=g[f][m],f=g[f][h],h=g[l][h],k=new THREE.Vector2(l/a,m/d),p=new THREE.Vector2((l+1)/a,m/d),q=new THREE.Vector2((l+1)/a,(m+1)/d),t=new THREE.Vector2(l/a,(m+1)/d),this.faces.push(new THREE.Face3(b,c,h)),this.faceVertexUvs[0].push([k,p,t]),this.faces.push(new THREE.Face3(c,
f,h)),this.faceVertexUvs[0].push([p.clone(),q,t.clone()]);this.computeFaceNormals();this.computeVertexNormals()};THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TubeGeometry.prototype.constructor=THREE.TubeGeometry;THREE.TubeGeometry.NoTaper=function(b){return 1};THREE.TubeGeometry.SinusoidalTaper=function(b){return Math.sin(Math.PI*b)};
THREE.TubeGeometry.FrenetFrames=function(b,a,c){new THREE.Vector3;var d=new THREE.Vector3;new THREE.Vector3;var e=[],f=[],g=[],h=new THREE.Vector3,k=new THREE.Matrix4;a+=1;var l;this.tangents=e;this.normals=f;this.binormals=g;for(l=0;l<a;l++){var p=l/(a-1);e[l]=b.getTangentAt(p);e[l].normalize()}f[0]=new THREE.Vector3;g[0]=new THREE.Vector3;b=Number.MAX_VALUE;l=Math.abs(e[0].x);p=Math.abs(e[0].y);var q=Math.abs(e[0].z);l<=b&&(b=l,d.set(1,0,0));p<=b&&(b=p,d.set(0,1,0));q<=b&&d.set(0,0,1);h.crossVectors(e[0],
d).normalize();f[0].crossVectors(e[0],h);g[0].crossVectors(e[0],f[0]);for(l=1;l<a;l++)f[l]=f[l-1].clone(),g[l]=g[l-1].clone(),h.crossVectors(e[l-1],e[l]),1E-4<h.length()&&(h.normalize(),d=Math.acos(THREE.Math.clamp(e[l-1].dot(e[l]),-1,1)),f[l].applyMatrix4(k.makeRotationAxis(h,d))),g[l].crossVectors(e[l],f[l]);if(c)for(d=Math.acos(THREE.Math.clamp(f[0].dot(f[a-1]),-1,1)),d/=a-1,0<e[0].dot(h.crossVectors(f[0],f[a-1]))&&(d=-d),l=1;l<a;l++)f[l].applyMatrix4(k.makeRotationAxis(e[l],d*l)),g[l].crossVectors(e[l],
f[l])};
THREE.PolyhedronGeometry=function(b,a,c,d){function e(a){var b=a.normalize().clone();b.index=k.vertices.push(b)-1;var c=Math.atan2(a.z,-a.x)/2/Math.PI+.5;a=Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))/Math.PI+.5;b.uv=new THREE.Vector2(c,1-a);return b}function f(a,b,c){var d=new THREE.Face3(a.index,b.index,c.index,[a.clone(),b.clone(),c.clone()]);k.faces.push(d);v.copy(a).add(b).add(c).divideScalar(3);d=Math.atan2(v.z,-v.x);k.faceVertexUvs[0].push([h(a.uv,a,d),h(b.uv,b,d),h(c.uv,c,d)])}function g(a,b){var c=
Math.pow(2,b);Math.pow(4,b);for(var d=e(k.vertices[a.a]),g=e(k.vertices[a.b]),h=e(k.vertices[a.c]),l=[],m=0;m<=c;m++){l[m]=[];for(var p=e(d.clone().lerp(h,m/c)),q=e(g.clone().lerp(h,m/c)),r=c-m,t=0;t<=r;t++)l[m][t]=0==t&&m==c?p:e(p.clone().lerp(q,t/r))}for(m=0;m<c;m++)for(t=0;t<2*(c-m)-1;t++)d=Math.floor(t/2),0==t%2?f(l[m][d+1],l[m+1][d],l[m][d]):f(l[m][d+1],l[m+1][d+1],l[m+1][d])}function h(a,b,c){0>c&&1===a.x&&(a=new THREE.Vector2(a.x-1,a.y));0===b.x&&0===b.z&&(a=new THREE.Vector2(c/2/Math.PI+.5,
a.y));return a.clone()}THREE.Geometry.call(this);this.type="PolyhedronGeometry";this.parameters={vertices:b,indices:a,radius:c,detail:d};c=c||1;d=d||0;for(var k=this,l=0,p=b.length;l<p;l+=3)e(new THREE.Vector3(b[l],b[l+1],b[l+2]));b=this.vertices;var q=[],m=l=0;for(p=a.length;l<p;l+=3,m++){var r=b[a[l]],t=b[a[l+1]],u=b[a[l+2]];q[m]=new THREE.Face3(r.index,t.index,u.index,[r.clone(),t.clone(),u.clone()])}var v=new THREE.Vector3;l=0;for(p=q.length;l<p;l++)g(q[l],d);l=0;for(p=this.faceVertexUvs[0].length;l<
p;l++)a=this.faceVertexUvs[0][l],d=a[0].x,b=a[1].x,q=a[2].x,m=Math.max(d,Math.max(b,q)),r=Math.min(d,Math.min(b,q)),.9<m&&.1>r&&(.2>d&&(a[0].x+=1),.2>b&&(a[1].x+=1),.2>q&&(a[2].x+=1));l=0;for(p=this.vertices.length;l<p;l++)this.vertices[l].multiplyScalar(c);this.mergeVertices();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,c)};THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.PolyhedronGeometry.prototype.constructor=THREE.PolyhedronGeometry;
THREE.DodecahedronGeometry=function(b,a){this.parameters={radius:b,detail:a};var c=(1+Math.sqrt(5))/2,d=1/c;THREE.PolyhedronGeometry.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-d,-c,0,-d,c,0,d,-c,0,d,c,-d,-c,0,-d,c,0,d,-c,0,d,c,0,-c,0,-d,c,0,-d,-c,0,d,c,0,d],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,
11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],b,a)};THREE.DodecahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.DodecahedronGeometry.prototype.constructor=THREE.DodecahedronGeometry;
THREE.IcosahedronGeometry=function(b,a){var c=(1+Math.sqrt(5))/2;THREE.PolyhedronGeometry.call(this,[-1,c,0,1,c,0,-1,-c,0,1,-c,0,0,-1,c,0,1,c,0,-1,-c,0,1,-c,c,0,-1,c,0,1,-c,0,-1,-c,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],b,a);this.type="IcosahedronGeometry";this.parameters={radius:b,detail:a}};THREE.IcosahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);
THREE.IcosahedronGeometry.prototype.constructor=THREE.IcosahedronGeometry;THREE.OctahedronGeometry=function(b,a){this.parameters={radius:b,detail:a};THREE.PolyhedronGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],b,a);this.type="OctahedronGeometry";this.parameters={radius:b,detail:a}};THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.OctahedronGeometry.prototype.constructor=THREE.OctahedronGeometry;
THREE.TetrahedronGeometry=function(b,a){THREE.PolyhedronGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],b,a);this.type="TetrahedronGeometry";this.parameters={radius:b,detail:a}};THREE.TetrahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TetrahedronGeometry.prototype.constructor=THREE.TetrahedronGeometry;
THREE.ParametricGeometry=function(b,a,c){THREE.Geometry.call(this);this.type="ParametricGeometry";this.parameters={func:b,slices:a,stacks:c};var d=this.vertices,e=this.faces,f=this.faceVertexUvs[0],g,h,k=a+1;for(g=0;g<=c;g++){var l=g/c;for(h=0;h<=a;h++){var p=h/a;p=b(p,l);d.push(p)}}for(g=0;g<c;g++)for(h=0;h<a;h++){b=g*k+h;d=g*k+h+1;l=(g+1)*k+h+1;p=(g+1)*k+h;var q=new THREE.Vector2(h/a,g/c);var m=new THREE.Vector2((h+1)/a,g/c);var r=new THREE.Vector2((h+1)/a,(g+1)/c);var t=new THREE.Vector2(h/a,(g+
1)/c);e.push(new THREE.Face3(b,d,p));f.push([q,m,t]);e.push(new THREE.Face3(d,l,p));f.push([m.clone(),r,t.clone()])}this.computeFaceNormals();this.computeVertexNormals()};THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ParametricGeometry.prototype.constructor=THREE.ParametricGeometry;
THREE.AxisHelper=function(b){b=b||1;var a=new Float32Array([0,0,0,b,0,0,0,0,0,0,b,0,0,0,0,0,0,b]),c=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]);b=new THREE.BufferGeometry;b.addAttribute("position",new THREE.BufferAttribute(a,3));b.addAttribute("color",new THREE.BufferAttribute(c,3));a=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.Line.call(this,b,a,THREE.LinePieces)};THREE.AxisHelper.prototype=Object.create(THREE.Line.prototype);
THREE.AxisHelper.prototype.constructor=THREE.AxisHelper;
THREE.ArrowHelper=function(){var b=new THREE.Geometry;b.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0));var a=new THREE.CylinderGeometry(0,.5,1,5,1);a.applyMatrix((new THREE.Matrix4).makeTranslation(0,-.5,0));return function(c,d,e,f,g,h){THREE.Object3D.call(this);void 0===f&&(f=16776960);void 0===e&&(e=1);void 0===g&&(g=.2*e);void 0===h&&(h=.2*g);this.position.copy(d);this.line=new THREE.Line(b,new THREE.LineBasicMaterial({color:f}));this.line.matrixAutoUpdate=!1;this.add(this.line);
this.cone=new THREE.Mesh(a,new THREE.MeshBasicMaterial({color:f}));this.cone.matrixAutoUpdate=!1;this.add(this.cone);this.setDirection(c);this.setLength(e,g,h)}}();THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.ArrowHelper.prototype.constructor=THREE.ArrowHelper;
THREE.ArrowHelper.prototype.setDirection=function(){var b=new THREE.Vector3,a;return function(c){.99999<c.y?this.quaternion.set(0,0,0,1):-.99999>c.y?this.quaternion.set(1,0,0,0):(b.set(c.z,0,-c.x).normalize(),a=Math.acos(c.y),this.quaternion.setFromAxisAngle(b,a))}}();THREE.ArrowHelper.prototype.setLength=function(b,a,c){void 0===a&&(a=.2*b);void 0===c&&(c=.2*a);this.line.scale.set(1,b-a,1);this.line.updateMatrix();this.cone.scale.set(c,a,c);this.cone.position.y=b;this.cone.updateMatrix()};
THREE.ArrowHelper.prototype.setColor=function(b){this.line.material.color.set(b);this.cone.material.color.set(b)};THREE.BoxHelper=function(b){var a=new THREE.BufferGeometry;a.addAttribute("position",new THREE.BufferAttribute(new Float32Array(72),3));THREE.Line.call(this,a,new THREE.LineBasicMaterial({color:16776960}),THREE.LinePieces);void 0!==b&&this.update(b)};THREE.BoxHelper.prototype=Object.create(THREE.Line.prototype);THREE.BoxHelper.prototype.constructor=THREE.BoxHelper;
THREE.BoxHelper.prototype.update=function(b){var a=b.geometry;null===a.boundingBox&&a.computeBoundingBox();var c=a.boundingBox.min;a=a.boundingBox.max;var d=this.geometry.attributes.position.array;d[0]=a.x;d[1]=a.y;d[2]=a.z;d[3]=c.x;d[4]=a.y;d[5]=a.z;d[6]=c.x;d[7]=a.y;d[8]=a.z;d[9]=c.x;d[10]=c.y;d[11]=a.z;d[12]=c.x;d[13]=c.y;d[14]=a.z;d[15]=a.x;d[16]=c.y;d[17]=a.z;d[18]=a.x;d[19]=c.y;d[20]=a.z;d[21]=a.x;d[22]=a.y;d[23]=a.z;d[24]=a.x;d[25]=a.y;d[26]=c.z;d[27]=c.x;d[28]=a.y;d[29]=c.z;d[30]=c.x;d[31]=
a.y;d[32]=c.z;d[33]=c.x;d[34]=c.y;d[35]=c.z;d[36]=c.x;d[37]=c.y;d[38]=c.z;d[39]=a.x;d[40]=c.y;d[41]=c.z;d[42]=a.x;d[43]=c.y;d[44]=c.z;d[45]=a.x;d[46]=a.y;d[47]=c.z;d[48]=a.x;d[49]=a.y;d[50]=a.z;d[51]=a.x;d[52]=a.y;d[53]=c.z;d[54]=c.x;d[55]=a.y;d[56]=a.z;d[57]=c.x;d[58]=a.y;d[59]=c.z;d[60]=c.x;d[61]=c.y;d[62]=a.z;d[63]=c.x;d[64]=c.y;d[65]=c.z;d[66]=a.x;d[67]=c.y;d[68]=a.z;d[69]=a.x;d[70]=c.y;d[71]=c.z;this.geometry.attributes.position.needsUpdate=!0;this.geometry.computeBoundingSphere();this.matrix=
b.matrixWorld;this.matrixAutoUpdate=!1};THREE.BoundingBoxHelper=function(b,a){var c=void 0!==a?a:8947848;this.object=b;this.box=new THREE.Box3;THREE.Mesh.call(this,new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({color:c,wireframe:!0}))};THREE.BoundingBoxHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.BoundingBoxHelper.prototype.constructor=THREE.BoundingBoxHelper;
THREE.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object);this.box.size(this.scale);this.box.center(this.position)};
THREE.CameraHelper=function(b){function a(a,b,d){c(a,d);c(b,d)}function c(a,b){d.vertices.push(new THREE.Vector3);d.colors.push(new THREE.Color(b));void 0===f[a]&&(f[a]=[]);f[a].push(d.vertices.length-1)}var d=new THREE.Geometry,e=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),f={};a("n1","n2",16755200);a("n2","n4",16755200);a("n4","n3",16755200);a("n3","n1",16755200);a("f1","f2",16755200);a("f2","f4",16755200);a("f4","f3",16755200);a("f3","f1",16755200);a("n1","f1",16755200);
a("n2","f2",16755200);a("n3","f3",16755200);a("n4","f4",16755200);a("p","n1",16711680);a("p","n2",16711680);a("p","n3",16711680);a("p","n4",16711680);a("u1","u2",43775);a("u2","u3",43775);a("u3","u1",43775);a("c","t",16777215);a("p","c",3355443);a("cn1","cn2",3355443);a("cn3","cn4",3355443);a("cf1","cf2",3355443);a("cf3","cf4",3355443);THREE.Line.call(this,d,e,THREE.LinePieces);this.camera=b;this.matrix=b.matrixWorld;this.matrixAutoUpdate=!1;this.pointMap=f;this.update()};
THREE.CameraHelper.prototype=Object.create(THREE.Line.prototype);THREE.CameraHelper.prototype.constructor=THREE.CameraHelper;
THREE.CameraHelper.prototype.update=function(){var b,a,c=new THREE.Vector3,d=new THREE.Camera,e=function(e,g,h,k){c.set(g,h,k).unproject(d);e=a[e];if(void 0!==e)for(g=0,h=e.length;g<h;g++)b.vertices[e[g]].copy(c)};return function(){b=this.geometry;a=this.pointMap;d.projectionMatrix.copy(this.camera.projectionMatrix);e("c",0,0,-1);e("t",0,0,1);e("n1",-1,-1,-1);e("n2",1,-1,-1);e("n3",-1,1,-1);e("n4",1,1,-1);e("f1",-1,-1,1);e("f2",1,-1,1);e("f3",-1,1,1);e("f4",1,1,1);e("u1",.7,1.1,-1);e("u2",-.7,1.1,
-1);e("u3",0,2,-1);e("cf1",-1,0,1);e("cf2",1,0,1);e("cf3",0,-1,1);e("cf4",0,1,1);e("cn1",-1,0,-1);e("cn2",1,0,-1);e("cn3",0,-1,-1);e("cn4",0,1,-1);b.verticesNeedUpdate=!0}}();
THREE.DirectionalLightHelper=function(b,a){THREE.Object3D.call(this);this.light=b;this.light.updateMatrixWorld();this.matrix=b.matrixWorld;this.matrixAutoUpdate=!1;a=a||1;var c=new THREE.Geometry;c.vertices.push(new THREE.Vector3(-a,a,0),new THREE.Vector3(a,a,0),new THREE.Vector3(a,-a,0),new THREE.Vector3(-a,-a,0),new THREE.Vector3(-a,a,0));var d=new THREE.LineBasicMaterial({fog:!1});d.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.lightPlane=new THREE.Line(c,d);this.add(this.lightPlane);
c=new THREE.Geometry;c.vertices.push(new THREE.Vector3,new THREE.Vector3);d=new THREE.LineBasicMaterial({fog:!1});d.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine=new THREE.Line(c,d);this.add(this.targetLine);this.update()};THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.DirectionalLightHelper.prototype.constructor=THREE.DirectionalLightHelper;
THREE.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose();this.lightPlane.material.dispose();this.targetLine.geometry.dispose();this.targetLine.material.dispose()};
THREE.DirectionalLightHelper.prototype.update=function(){var b=new THREE.Vector3,a=new THREE.Vector3,c=new THREE.Vector3;return function(){b.setFromMatrixPosition(this.light.matrixWorld);a.setFromMatrixPosition(this.light.target.matrixWorld);c.subVectors(a,b);this.lightPlane.lookAt(c);this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine.geometry.vertices[1].copy(c);this.targetLine.geometry.verticesNeedUpdate=!0;this.targetLine.material.color.copy(this.lightPlane.material.color)}}();
THREE.EdgesHelper=function(b,a){var c=void 0!==a?a:16777215,d=[0,0],e={},f=function(a,b){return a-b},g=["a","b","c"],h=new THREE.BufferGeometry,k=b.geometry.clone();k.mergeVertices();k.computeFaceNormals();var l=k.vertices;k=k.faces;for(var p=0,q=0,m=k.length;q<m;q++)for(var r=k[q],t=0;3>t;t++){d[0]=r[g[t]];d[1]=r[g[(t+1)%3]];d.sort(f);var u=d.toString();void 0===e[u]?(e[u]={vert1:d[0],vert2:d[1],face1:q,face2:void 0},p++):e[u].face2=q}d=new Float32Array(6*p);f=0;for(u in e)if(g=e[u],void 0===g.face2||
.9999>k[g.face1].normal.dot(k[g.face2].normal))p=l[g.vert1],d[f++]=p.x,d[f++]=p.y,d[f++]=p.z,p=l[g.vert2],d[f++]=p.x,d[f++]=p.y,d[f++]=p.z;h.addAttribute("position",new THREE.BufferAttribute(d,3));THREE.Line.call(this,h,new THREE.LineBasicMaterial({color:c}),THREE.LinePieces);this.matrix=b.matrixWorld;this.matrixAutoUpdate=!1};THREE.EdgesHelper.prototype=Object.create(THREE.Line.prototype);THREE.EdgesHelper.prototype.constructor=THREE.EdgesHelper;
THREE.FaceNormalsHelper=function(b,a,c,d){this.object=b;this.size=void 0!==a?a:1;b=void 0!==c?c:16776960;d=void 0!==d?d:1;a=new THREE.Geometry;c=0;for(var e=this.object.geometry.faces.length;c<e;c++)a.vertices.push(new THREE.Vector3,new THREE.Vector3);THREE.Line.call(this,a,new THREE.LineBasicMaterial({color:b,linewidth:d}),THREE.LinePieces);this.matrixAutoUpdate=!1;this.normalMatrix=new THREE.Matrix3;this.update()};THREE.FaceNormalsHelper.prototype=Object.create(THREE.Line.prototype);
THREE.FaceNormalsHelper.prototype.constructor=THREE.FaceNormalsHelper;
THREE.FaceNormalsHelper.prototype.update=function(){var b=this.geometry.vertices,a=this.object,c=a.geometry.vertices,d=a.geometry.faces,e=a.matrixWorld;a.updateMatrixWorld(!0);this.normalMatrix.getNormalMatrix(e);for(var f=a=0,g=d.length;a<g;a++,f+=2){var h=d[a];b[f].copy(c[h.a]).add(c[h.b]).add(c[h.c]).divideScalar(3).applyMatrix4(e);b[f+1].copy(h.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size).add(b[f])}this.geometry.verticesNeedUpdate=!0;return this};
THREE.GridHelper=function(b,a){var c=new THREE.Geometry,d=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});this.color1=new THREE.Color(4473924);this.color2=new THREE.Color(8947848);for(var e=-b;e<=b;e+=a){c.vertices.push(new THREE.Vector3(-b,0,e),new THREE.Vector3(b,0,e),new THREE.Vector3(e,0,-b),new THREE.Vector3(e,0,b));var f=0===e?this.color1:this.color2;c.colors.push(f,f,f,f)}THREE.Line.call(this,c,d,THREE.LinePieces)};THREE.GridHelper.prototype=Object.create(THREE.Line.prototype);
THREE.GridHelper.prototype.constructor=THREE.GridHelper;THREE.GridHelper.prototype.setColors=function(b,a){this.color1.set(b);this.color2.set(a);this.geometry.colorsNeedUpdate=!0};
THREE.HemisphereLightHelper=function(b,a,c,d){THREE.Object3D.call(this);this.light=b;this.light.updateMatrixWorld();this.matrix=b.matrixWorld;this.matrixAutoUpdate=!1;this.colors=[new THREE.Color,new THREE.Color];b=new THREE.SphereGeometry(a,4,2);b.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));for(a=0;8>a;a++)b.faces[a].color=this.colors[4>a?0:1];a=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:!0});this.lightSphere=new THREE.Mesh(b,a);this.add(this.lightSphere);
this.update()};THREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.HemisphereLightHelper.prototype.constructor=THREE.HemisphereLightHelper;THREE.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose();this.lightSphere.material.dispose()};
THREE.HemisphereLightHelper.prototype.update=function(){var b=new THREE.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);this.lightSphere.lookAt(b.setFromMatrixPosition(this.light.matrixWorld).negate());this.lightSphere.geometry.colorsNeedUpdate=!0}}();
THREE.PointLightHelper=function(b,a){this.light=b;this.light.updateMatrixWorld();var c=new THREE.SphereGeometry(a,4,2),d=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});d.color.copy(this.light.color).multiplyScalar(this.light.intensity);THREE.Mesh.call(this,c,d);this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=!1};THREE.PointLightHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.PointLightHelper.prototype.constructor=THREE.PointLightHelper;
THREE.PointLightHelper.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};THREE.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};
THREE.SkeletonHelper=function(b){this.bones=this.getBoneList(b);for(var a=new THREE.Geometry,c=0;c<this.bones.length;c++)this.bones[c].parent instanceof THREE.Bone&&(a.vertices.push(new THREE.Vector3),a.vertices.push(new THREE.Vector3),a.colors.push(new THREE.Color(0,0,1)),a.colors.push(new THREE.Color(0,1,0)));c=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});THREE.Line.call(this,a,c,THREE.LinePieces);this.root=b;this.matrix=b.matrixWorld;
this.matrixAutoUpdate=!1;this.update()};THREE.SkeletonHelper.prototype=Object.create(THREE.Line.prototype);THREE.SkeletonHelper.prototype.constructor=THREE.SkeletonHelper;THREE.SkeletonHelper.prototype.getBoneList=function(b){var a=[];b instanceof THREE.Bone&&a.push(b);for(var c=0;c<b.children.length;c++)a.push.apply(a,this.getBoneList(b.children[c]));return a};
THREE.SkeletonHelper.prototype.update=function(){for(var b=this.geometry,a=(new THREE.Matrix4).getInverse(this.root.matrixWorld),c=new THREE.Matrix4,d=0,e=0;e<this.bones.length;e++){var f=this.bones[e];f.parent instanceof THREE.Bone&&(c.multiplyMatrices(a,f.matrixWorld),b.vertices[d].setFromMatrixPosition(c),c.multiplyMatrices(a,f.parent.matrixWorld),b.vertices[d+1].setFromMatrixPosition(c),d+=2)}b.verticesNeedUpdate=!0;b.computeBoundingSphere()};
THREE.SpotLightHelper=function(b){THREE.Object3D.call(this);this.light=b;this.light.updateMatrixWorld();this.matrix=b.matrixWorld;this.matrixAutoUpdate=!1;b=new THREE.CylinderGeometry(0,1,1,8,1,!0);b.applyMatrix((new THREE.Matrix4).makeTranslation(0,-.5,0));b.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));var a=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new THREE.Mesh(b,a);this.add(this.cone);this.update()};THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype);
THREE.SpotLightHelper.prototype.constructor=THREE.SpotLightHelper;THREE.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};
THREE.SpotLightHelper.prototype.update=function(){var b=new THREE.Vector3,a=new THREE.Vector3;return function(){var c=this.light.distance?this.light.distance:1E4,d=c*Math.tan(this.light.angle);this.cone.scale.set(d,d,c);b.setFromMatrixPosition(this.light.matrixWorld);a.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(a.sub(b));this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}();
THREE.VertexNormalsHelper=function(b,a,c,d){this.object=b;this.size=void 0!==a?a:1;a=void 0!==c?c:16711680;d=void 0!==d?d:1;c=new THREE.Geometry;b=b.geometry.faces;for(var e=0,f=b.length;e<f;e++)for(var g=0,h=b[e].vertexNormals.length;g<h;g++)c.vertices.push(new THREE.Vector3,new THREE.Vector3);THREE.Line.call(this,c,new THREE.LineBasicMaterial({color:a,linewidth:d}),THREE.LinePieces);this.matrixAutoUpdate=!1;this.normalMatrix=new THREE.Matrix3;this.update()};THREE.VertexNormalsHelper.prototype=Object.create(THREE.Line.prototype);
THREE.VertexNormalsHelper.prototype.constructor=THREE.VertexNormalsHelper;
THREE.VertexNormalsHelper.prototype.update=function(b){var a=new THREE.Vector3;return function(b){b=["a","b","c","d"];this.object.updateMatrixWorld(!0);this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var c=this.geometry.vertices,e=this.object.geometry.vertices,f=this.object.geometry.faces,g=this.object.matrixWorld,h=0,k=0,l=f.length;k<l;k++)for(var p=f[k],q=0,m=p.vertexNormals.length;q<m;q++){var r=p.vertexNormals[q];c[h].copy(e[p[b[q]]]).applyMatrix4(g);a.copy(r).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size);
a.add(c[h]);h+=1;c[h].copy(a);h+=1}this.geometry.verticesNeedUpdate=!0;return this}}();
THREE.VertexTangentsHelper=function(b,a,c,d){this.object=b;this.size=void 0!==a?a:1;a=void 0!==c?c:255;d=void 0!==d?d:1;c=new THREE.Geometry;b=b.geometry.faces;for(var e=0,f=b.length;e<f;e++)for(var g=0,h=b[e].vertexTangents.length;g<h;g++)c.vertices.push(new THREE.Vector3),c.vertices.push(new THREE.Vector3);THREE.Line.call(this,c,new THREE.LineBasicMaterial({color:a,linewidth:d}),THREE.LinePieces);this.matrixAutoUpdate=!1;this.update()};THREE.VertexTangentsHelper.prototype=Object.create(THREE.Line.prototype);
THREE.VertexTangentsHelper.prototype.constructor=THREE.VertexTangentsHelper;
THREE.VertexTangentsHelper.prototype.update=function(b){var a=new THREE.Vector3;return function(b){b=["a","b","c","d"];this.object.updateMatrixWorld(!0);for(var c=this.geometry.vertices,e=this.object.geometry.vertices,f=this.object.geometry.faces,g=this.object.matrixWorld,h=0,k=0,l=f.length;k<l;k++)for(var p=f[k],q=0,m=p.vertexTangents.length;q<m;q++){var r=p.vertexTangents[q];c[h].copy(e[p[b[q]]]).applyMatrix4(g);a.copy(r).transformDirection(g).multiplyScalar(this.size);a.add(c[h]);h+=1;c[h].copy(a);
h+=1}this.geometry.verticesNeedUpdate=!0;return this}}();
THREE.WireframeHelper=function(b,a){var c=void 0!==a?a:16777215,d=[0,0],e={},f=function(a,b){return a-b},g=["a","b","c"],h=new THREE.BufferGeometry;if(b.geometry instanceof THREE.Geometry){for(var k=b.geometry.vertices,l=b.geometry.faces,p=0,q=new Uint32Array(6*l.length),m=0,r=l.length;m<r;m++)for(var t=l[m],u=0;3>u;u++){d[0]=t[g[u]];d[1]=t[g[(u+1)%3]];d.sort(f);var v=d.toString();void 0===e[v]&&(q[2*p]=d[0],q[2*p+1]=d[1],e[v]=!0,p++)}d=new Float32Array(6*p);m=0;for(r=p;m<r;m++)for(u=0;2>u;u++)p=
k[q[2*m+u]],g=6*m+3*u,d[g+0]=p.x,d[g+1]=p.y,d[g+2]=p.z;h.addAttribute("position",new THREE.BufferAttribute(d,3))}else if(b.geometry instanceof THREE.BufferGeometry){if(void 0!==b.geometry.attributes.index){k=b.geometry.attributes.position.array;r=b.geometry.attributes.index.array;l=b.geometry.drawcalls;p=0;0===l.length&&(l=[{count:r.length,index:0,start:0}]);q=new Uint32Array(2*r.length);t=0;for(var w=l.length;t<w;++t){u=l[t].start;v=l[t].count;g=l[t].index;m=u;for(var x=u+v;m<x;m+=3)for(u=0;3>u;u++)d[0]=
g+r[m+u],d[1]=g+r[m+(u+1)%3],d.sort(f),v=d.toString(),void 0===e[v]&&(q[2*p]=d[0],q[2*p+1]=d[1],e[v]=!0,p++)}d=new Float32Array(6*p);m=0;for(r=p;m<r;m++)for(u=0;2>u;u++)g=6*m+3*u,p=3*q[2*m+u],d[g+0]=k[p],d[g+1]=k[p+1],d[g+2]=k[p+2]}else for(k=b.geometry.attributes.position.array,p=k.length/3,q=p/3,d=new Float32Array(6*p),m=0,r=q;m<r;m++)for(u=0;3>u;u++)g=18*m+6*u,q=9*m+3*u,d[g+0]=k[q],d[g+1]=k[q+1],d[g+2]=k[q+2],p=9*m+(u+1)%3*3,d[g+3]=k[p],d[g+4]=k[p+1],d[g+5]=k[p+2];h.addAttribute("position",new THREE.BufferAttribute(d,
3))}THREE.Line.call(this,h,new THREE.LineBasicMaterial({color:c}),THREE.LinePieces);this.matrix=b.matrixWorld;this.matrixAutoUpdate=!1};THREE.WireframeHelper.prototype=Object.create(THREE.Line.prototype);THREE.WireframeHelper.prototype.constructor=THREE.WireframeHelper;THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this);this.render=function(b){}};THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype);THREE.ImmediateRenderObject.prototype.constructor=THREE.ImmediateRenderObject;
THREE.MorphBlendMesh=function(b,a){THREE.Mesh.call(this,b,a);this.animationsMap={};this.animationsList=[];var c=this.geometry.morphTargets.length;this.createAnimation("__default",0,c-1,c/1);this.setAnimationWeight("__default",1)};THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.MorphBlendMesh.prototype.constructor=THREE.MorphBlendMesh;
THREE.MorphBlendMesh.prototype.createAnimation=function(b,a,c,d){a={startFrame:a,endFrame:c,length:c-a+1,fps:d,duration:(c-a)/d,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[b]=a;this.animationsList.push(a)};
THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(b){for(var a=/([a-z]+)_?(\d+)/,c,d={},e=this.geometry,f=0,g=e.morphTargets.length;f<g;f++){var h=e.morphTargets[f].name.match(a);if(h&&1<h.length){var k=h[1];d[k]||(d[k]={start:Infinity,end:-Infinity});h=d[k];f<h.start&&(h.start=f);f>h.end&&(h.end=f);c||(c=k)}}for(k in d)h=d[k],this.createAnimation(k,h.start,h.end,b);this.firstAnimation=c};
THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(b){if(b=this.animationsMap[b])b.direction=1,b.directionBackwards=!1};THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(b){if(b=this.animationsMap[b])b.direction=-1,b.directionBackwards=!0};THREE.MorphBlendMesh.prototype.setAnimationFPS=function(b,a){var c=this.animationsMap[b];c&&(c.fps=a,c.duration=(c.end-c.start)/c.fps)};
THREE.MorphBlendMesh.prototype.setAnimationDuration=function(b,a){var c=this.animationsMap[b];c&&(c.duration=a,c.fps=(c.end-c.start)/c.duration)};THREE.MorphBlendMesh.prototype.setAnimationWeight=function(b,a){var c=this.animationsMap[b];c&&(c.weight=a)};THREE.MorphBlendMesh.prototype.setAnimationTime=function(b,a){var c=this.animationsMap[b];c&&(c.time=a)};THREE.MorphBlendMesh.prototype.getAnimationTime=function(b){var a=0;if(b=this.animationsMap[b])a=b.time;return a};
THREE.MorphBlendMesh.prototype.getAnimationDuration=function(b){var a=-1;if(b=this.animationsMap[b])a=b.duration;return a};THREE.MorphBlendMesh.prototype.playAnimation=function(b){var a=this.animationsMap[b];a?(a.time=0,a.active=!0):console.warn("animation["+b+"] undefined")};THREE.MorphBlendMesh.prototype.stopAnimation=function(b){if(b=this.animationsMap[b])b.active=!1};
THREE.MorphBlendMesh.prototype.update=function(b){for(var a=0,c=this.animationsList.length;a<c;a++){var d=this.animationsList[a];if(d.active){var e=d.duration/d.length;d.time+=d.direction*b;if(d.mirroredLoop){if(d.time>d.duration||0>d.time)d.direction*=-1,d.time>d.duration&&(d.time=d.duration,d.directionBackwards=!0),0>d.time&&(d.time=0,d.directionBackwards=!1)}else d.time%=d.duration,0>d.time&&(d.time+=d.duration);var f=d.startFrame+THREE.Math.clamp(Math.floor(d.time/e),0,d.length-1),g=d.weight;
f!==d.currentFrame&&(this.morphTargetInfluences[d.lastFrame]=0,this.morphTargetInfluences[d.currentFrame]=1*g,this.morphTargetInfluences[f]=0,d.lastFrame=d.currentFrame,d.currentFrame=f);e=d.time%e/e;d.directionBackwards&&(e=1-e);this.morphTargetInfluences[d.currentFrame]=e*g;this.morphTargetInfluences[d.lastFrame]=(1-e)*g}}};
!function(b,a){"function"==typeof define&&define.amd?define(function(){return a()}):"object"==typeof module?module.exports=a():b.Tone=a()}(this,function(){var b=function(){function a(a){return"undefined"==typeof a}function b(a){return"function"==typeof a}var d,e,f,g;if(a(window.AudioContext)&&(window.AudioContext=window.webkitAudioContext),a(window.OfflineAudioContext)&&(window.OfflineAudioContext=window.webkitOfflineAudioContext),a(AudioContext))throw Error("Web Audio is not supported in this browser");
return d=new AudioContext,b(AudioContext.prototype.createGain)||(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),b(AudioContext.prototype.createDelay)||(AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode),b(AudioContext.prototype.createPeriodicWave)||(AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable),b(AudioBufferSourceNode.prototype.start)||(AudioBufferSourceNode.prototype.start=AudioBufferSourceNode.prototype.noteGrainOn),
b(AudioBufferSourceNode.prototype.stop)||(AudioBufferSourceNode.prototype.stop=AudioBufferSourceNode.prototype.noteOff),b(OscillatorNode.prototype.start)||(OscillatorNode.prototype.start=OscillatorNode.prototype.noteOn),b(OscillatorNode.prototype.stop)||(OscillatorNode.prototype.stop=OscillatorNode.prototype.noteOff),b(OscillatorNode.prototype.setPeriodicWave)||(OscillatorNode.prototype.setPeriodicWave=OscillatorNode.prototype.setWaveTable),a(AudioNode.prototype._nativeConnect)&&(AudioNode.prototype._nativeConnect=
AudioNode.prototype.connect,AudioNode.prototype.connect=function(b,c,d){if(b.input)Array.isArray(b.input)?(a(d)&&(d=0),this.connect(b.input[d])):this.connect(b.input,c,d);else try{b instanceof AudioNode?this._nativeConnect(b,c,d):this._nativeConnect(b,c)}catch(p){throw Error("error connecting to node: "+b);}}),e=function(b,c){a(b)||1===b?this.input=this.context.createGain():1<b&&(this.input=Array(b));a(c)||1===c?this.output=this.context.createGain():1<c&&(this.output=Array(b))},e.prototype.set=function(b,
c,d){var f,g;this.isObject(b)?d=c:this.isString(b)&&(f={},f[b]=c,b=f);a:for(k in b){if(c=b[k],f=this,-1!==k.indexOf(".")){var h=k.split(".");for(g=0;g<h.length-1;g++)if(f=f[h[g]],f instanceof e){h.splice(0,g+1);h=h.join(".");f.set(h,c);continue a}var k=h[h.length-1]}h=f[k];a(h)||(e.Signal&&h instanceof e.Signal||e.Param&&h instanceof e.Param?h.value!==c&&(a(d)?h.value=c:h.rampTo(c,d)):h instanceof AudioParam?h.value!==c&&(h.value=c):h instanceof e?h.set(c):h!==c&&(f[k]=c))}return this},e.prototype.get=
function(c){var d,f,g,h,m;a(c)?c=this._collectDefaults(this.constructor):this.isString(c)&&(c=[c]);var r={};for(d=0;d<c.length;d++){if(f=c[d],g=this,h=r,-1!==f.indexOf(".")){f=f.split(".");for(m=0;m<f.length-1;m++){var t=f[m];h[t]=h[t]||{};h=h[t];g=g[t]}f=f[f.length-1]}g=g[f];this.isObject(c[f])?h[f]=g.get():e.Signal&&g instanceof e.Signal?h[f]=g.value:e.Param&&g instanceof e.Param?h[f]=g.value:g instanceof AudioParam?h[f]=g.value:g instanceof e?h[f]=g.get():b(g)||a(g)||(h[f]=g)}return r},e.prototype._collectDefaults=
function(b){var c,d=[];if(a(b.defaults)||(d=Object.keys(b.defaults)),!a(b._super))for(b=this._collectDefaults(b._super),c=0;c<b.length;c++)-1===d.indexOf(b[c])&&d.push(b[c]);return d},e.prototype.toString=function(){var a,c,d;for(a in e)if(c=a[0].match(/^[A-Z]$/),d=e[a]===this.constructor,b(e[a])&&c&&d)return a;return"Tone"},e.context=d,e.prototype.context=e.context,e.prototype.bufferSize=2048,e.prototype.blockTime=128/e.context.sampleRate,e.prototype.sampleTime=1/e.context.sampleRate,Object.defineProperty(e.prototype,
"numberOfInputs",{get:function(){return this.input?this.isArray(this.input)?this.input.length:1:0}}),Object.defineProperty(e.prototype,"numberOfOutputs",{get:function(){return this.output?this.isArray(this.output)?this.output.length:1:0}}),e.prototype.dispose=function(){return this.isUndef(this.input)||(this.input instanceof AudioNode&&this.input.disconnect(),this.input=null),this.isUndef(this.output)||(this.output instanceof AudioNode&&this.output.disconnect(),this.output=null),this},f=null,e.prototype.noGC=
function(){return this.output.connect(f),this},AudioNode.prototype.noGC=function(){return this.connect(f),this},e.prototype.connect=function(a,b,c){return Array.isArray(this.output)?(b=this.defaultArg(b,0),this.output[b].connect(a,0,c)):this.output.connect(a,b,c),this},e.prototype.disconnect=function(a){return Array.isArray(this.output)?(a=this.defaultArg(a,0),this.output[a].disconnect()):this.isUndef(a)?this.output.disconnect():this.output.disconnect(a),this},e.prototype.connectSeries=function(){var a;
if(1<arguments.length){var b=arguments[0];for(a=1;a<arguments.length;a++){var c=arguments[a];b.connect(c);b=c}}return this},e.prototype.chain=function(){var a;if(0<arguments.length){var b=this;for(a=0;a<arguments.length;a++){var c=arguments[a];b.connect(c);b=c}}return this},e.prototype.fan=function(){if(0<arguments.length)for(var a=0;a<arguments.length;a++)this.connect(arguments[a]);return this},AudioNode.prototype.chain=e.prototype.chain,AudioNode.prototype.fan=e.prototype.fan,e.prototype.defaultArg=
function(b,c){var d,e;if(this.isObject(b)&&this.isObject(c)){var f={};for(d in b)f[d]=this.defaultArg(c[d],b[d]);for(e in c)f[e]=this.defaultArg(b[e],c[e]);return f}return a(b)?c:b},e.prototype.optionsObject=function(a,b,c){var d,e={};if(1===a.length&&this.isObject(a[0]))e=a[0];else for(d=0;d<b.length;d++)e[b[d]]=a[d];return this.isUndef(c)?e:this.defaultArg(e,c)},e.prototype.isUndef=a,e.prototype.isFunction=b,e.prototype.isNumber=function(a){return"number"==typeof a},e.prototype.isObject=function(a){return"[object Object]"===
Object.prototype.toString.call(a)&&a.constructor===Object},e.prototype.isBoolean=function(a){return"boolean"==typeof a},e.prototype.isArray=function(a){return Array.isArray(a)},e.prototype.isString=function(a){return"string"==typeof a},e.noOp=function(){},e.prototype._readOnly=function(a){if(Array.isArray(a))for(var b=0;b<a.length;b++)this._readOnly(a[b]);else Object.defineProperty(this,a,{writable:!1,enumerable:!0})},e.prototype._writable=function(a){if(Array.isArray(a))for(var b=0;b<a.length;b++)this._writable(a[b]);
else Object.defineProperty(this,a,{writable:!0})},e.State={Started:"started",Stopped:"stopped",Paused:"paused"},e.prototype.equalPowerScale=function(a){return Math.sin(.5*a*Math.PI)},e.prototype.dbToGain=function(a){return Math.pow(2,a/6)},e.prototype.gainToDb=function(a){return Math.log(a)/Math.LN10*20},e.prototype.intervalToFrequencyRatio=function(a){return Math.pow(2,a/12)},e.prototype.now=function(){return this.context.currentTime},e.now=function(){return e.context.currentTime},e.extend=function(b,
c){function d(){}a(c)&&(c=e);d.prototype=c.prototype;b.prototype=new d;b.prototype.constructor=b;b._super=c},g=[],e._initAudioContext=function(a){a(e.context);g.push(a)},e.setContext=function(a){e.prototype.context=a;e.context=a;for(var b=0;b<g.length;b++)g[b](a)},e._initAudioContext(function(a){e.prototype.blockTime=128/a.sampleRate;e.prototype.sampleTime=1/a.sampleRate;f=a.createGain();f.gain.value=0;f.connect(a.destination)}),e.version="r9",window.TONE_SILENCE_VERSION_LOGGING||console.log("%c * Tone.js "+
e.version+" * ","background: #000; color: #fff"),e}();(function(a){return a.SignalBase=function(){},a.extend(a.SignalBase),a.SignalBase.prototype.connect=function(b,d,e){return a.Signal&&a.Signal===b.constructor||a.Param&&a.Param===b.constructor||a.TimelineSignal&&a.TimelineSignal===b.constructor?(b._param.cancelScheduledValues(0),b._param.value=0,b.overridden=!0):b instanceof AudioParam&&(b.cancelScheduledValues(0),b.value=0),a.prototype.connect.call(this,b,d,e),this},a.SignalBase})(b);(function(a){return a.WaveShaper=
function(a,b){this._shaper=this.input=this.output=this.context.createWaveShaper();this._curve=null;Array.isArray(a)?this.curve=a:isFinite(a)||this.isUndef(a)?this._curve=new Float32Array(this.defaultArg(a,1024)):this.isFunction(a)&&(this._curve=new Float32Array(this.defaultArg(b,1024)),this.setMap(a))},a.extend(a.WaveShaper,a.SignalBase),a.WaveShaper.prototype.setMap=function(a){var b;var c=0;for(b=this._curve.length;c<b;c++){var f=c/(b-1)*2-1;this._curve[c]=a(f,c)}return this._shaper.curve=this._curve,
this},Object.defineProperty(a.WaveShaper.prototype,"curve",{get:function(){return this._shaper.curve},set:function(a){this._curve=new Float32Array(a);this._shaper.curve=this._curve}}),Object.defineProperty(a.WaveShaper.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(a){if(-1===["none","2x","4x"].indexOf(a))throw new RangeError("Tone.WaveShaper: oversampling must be either 'none', '2x', or '4x'");this._shaper.oversample=a}}),a.WaveShaper.prototype.dispose=function(){return a.prototype.dispose.call(this),
this._shaper.disconnect(),this._shaper=null,this._curve=null,this},a.WaveShaper})(b);(function(a){return a.TimeBase=function(b,d){if(!(this instanceof a.TimeBase))return new a.TimeBase(b,d);(this._expr=this._noOp,b instanceof a.TimeBase)?this.copy(b):!this.isUndef(d)||this.isNumber(b)?(d=this.defaultArg(d,this._defaultUnits),this._expr=this._primaryExpressions[d].method.bind(this,b)):this.isString(b)?this.set(b):this.isUndef(b)&&(this._expr=this._defaultExpr())},a.extend(a.TimeBase),a.TimeBase.prototype.set=
function(a){return this._expr=this._parseExprString(a),this},a.TimeBase.prototype.clone=function(){var a=new this.constructor;return a.copy(this),a},a.TimeBase.prototype.copy=function(a){a=a._expr();return this.set(a)},a.TimeBase.prototype._primaryExpressions={n:{regexp:/^(\d+)n/i,method:function(a){return a=parseInt(a),1===a?this._beatsToUnits(this._timeSignature()):this._beatsToUnits(4/a)}},t:{regexp:/^(\d+)t/i,method:function(a){return a=parseInt(a),this._beatsToUnits(8/(3*parseInt(a)))}},m:{regexp:/^(\d+)m/i,
method:function(a){return this._beatsToUnits(parseInt(a)*this._timeSignature())}},i:{regexp:/^(\d+)i/i,method:function(a){return this._ticksToUnits(parseInt(a))}},hz:{regexp:/^(\d+(?:\.\d+)?)hz/i,method:function(a){return this._frequencyToUnits(parseFloat(a))}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method:function(a,b,e){var c=0;return a&&"0"!==a&&(c+=this._beatsToUnits(this._timeSignature()*parseFloat(a))),b&&"0"!==b&&(c+=this._beatsToUnits(parseFloat(b))),e&&"0"!==e&&(c+=
this._beatsToUnits(parseFloat(e)/4)),c}},s:{regexp:/^(\d+(?:\.\d+)?s)/,method:function(a){return this._secondsToUnits(parseFloat(a))}},samples:{regexp:/^(\d+)samples/,method:function(a){return parseInt(a)/this.context.sampleRate}},"default":{regexp:/^(\d+(?:\.\d+)?)/,method:function(a){return this._primaryExpressions[this._defaultUnits].method.call(this,a)}}},a.TimeBase.prototype._binaryExpressions={"+":{regexp:/^\+/,precedence:2,method:function(a,b){return a()+b()}},"-":{regexp:/^\-/,precedence:2,
method:function(a,b){return a()-b()}},"*":{regexp:/^\*/,precedence:1,method:function(a,b){return a()*b()}},"/":{regexp:/^\//,precedence:1,method:function(a,b){return a()/b()}}},a.TimeBase.prototype._unaryExpressions={neg:{regexp:/^\-/,method:function(a){return-a()}}},a.TimeBase.prototype._syntaxGlue={"(":{regexp:/^\(/},")":{regexp:/^\)/}},a.TimeBase.prototype._tokenize=function(a){function b(a,b){var c,d,e,f,g,h=["_binaryExpressions","_unaryExpressions","_primaryExpressions","_syntaxGlue"];for(c=
0;c<h.length;c++){var k=b[h[c]];for(d in k)if(e=k[d],f=e.regexp,g=a.match(f),null!==g)return{method:e.method,precedence:e.precedence,regexp:e.regexp,value:g[0]}}throw new SyntaxError("Tone.TimeBase: Unexpected token "+a);}for(var c,f=-1,g=[];0<a.length;)a=a.trim(),c=b(a,this),g.push(c),a=a.substr(c.value.length);return{next:function(){return g[++f]},peek:function(){return g[f+1]}}},a.TimeBase.prototype._matchGroup=function(a,b,e){var c,d;if(!this.isUndef(a))for(c in b)if(d=b[c],d.regexp.test(a.value))if(this.isUndef(e)||
d.precedence===e)return d;return!1},a.TimeBase.prototype._parseBinary=function(a,b){var c;this.isUndef(b)&&(b=2);var d=0>b?this._parseUnary(a):this._parseBinary(a,b-1);for(c=a.peek();c&&this._matchGroup(c,this._binaryExpressions,b);)c=a.next(),d=c.method.bind(this,d,this._parseBinary(a,b-1)),c=a.peek();return d},a.TimeBase.prototype._parseUnary=function(a){var b,c=a.peek();return(c=this._matchGroup(c,this._unaryExpressions))?(a.next(),b=this._parseUnary(a),c.method.bind(this,b)):this._parsePrimary(a)},
a.TimeBase.prototype._parsePrimary=function(a){var b,c=a.peek();if(this.isUndef(c))throw new SyntaxError("Tone.TimeBase: Unexpected end of expression");if(this._matchGroup(c,this._primaryExpressions))return c=a.next(),b=c.value.match(c.regexp),c.method.bind(this,b[1],b[2],b[3]);if(c&&"("===c.value){if(a.next(),b=this._parseBinary(a),c=a.next(),!c||")"!==c.value)throw new SyntaxError("Expected )");return b}throw new SyntaxError("Tone.TimeBase: Cannot process token "+c.value);},a.TimeBase.prototype._parseExprString=
function(a){var b;return this.isString(a)||(a=a.toString()),b=this._tokenize(a),this._parseBinary(b)},a.TimeBase.prototype._noOp=function(){return 0},a.TimeBase.prototype._defaultExpr=function(){return this._noOp},a.TimeBase.prototype._defaultUnits="s",a.TimeBase.prototype._frequencyToUnits=function(a){return 1/a},a.TimeBase.prototype._beatsToUnits=function(b){return 60/a.Transport.bpm.value*b},a.TimeBase.prototype._secondsToUnits=function(a){return a},a.TimeBase.prototype._ticksToUnits=function(b){return b*
(this._beatsToUnits(1)/a.Transport.PPQ)},a.TimeBase.prototype._timeSignature=function(){return a.Transport.timeSignature},a.TimeBase.prototype._pushExpr=function(b,d,e){return b instanceof a.TimeBase||(b=new this.constructor(b,e)),this._expr=this._binaryExpressions[d].method.bind(this,this._expr,b._expr),this},a.TimeBase.prototype.add=function(a,b){return this._pushExpr(a,"+",b)},a.TimeBase.prototype.sub=function(a,b){return this._pushExpr(a,"-",b)},a.TimeBase.prototype.mult=function(a,b){return this._pushExpr(a,
"*",b)},a.TimeBase.prototype.div=function(a,b){return this._pushExpr(a,"/",b)},a.TimeBase.prototype.eval=function(){return this._expr()},a.TimeBase.prototype.dispose=function(){this._expr=null},a.TimeBase})(b);(function(a){return a.Time=function(b,d){return this instanceof a.Time?(this._plusNow=!1,void a.TimeBase.call(this,b,d)):new a.Time(b,d)},a.extend(a.Time,a.TimeBase),a.Time.prototype._unaryExpressions=Object.create(a.TimeBase.prototype._unaryExpressions),a.Time.prototype._unaryExpressions.quantize=
{regexp:/^@/,method:function(b){return a.Transport.nextSubdivision(b())}},a.Time.prototype._unaryExpressions.now={regexp:/^\+/,method:function(a){return this._plusNow=!0,a()}},a.Time.prototype.quantize=function(a,b){return b=this.defaultArg(b,1),this._expr=function(a,b,c){var d,e,f;return a=a(),b=b.toSeconds(),d=Math.round(a/b),e=d*b,f=e-a,a+f*c}.bind(this,this._expr,new this.constructor(a),b),this},a.Time.prototype.addNow=function(){return this._plusNow=!0,this},a.Time.prototype._defaultExpr=function(){return this._plusNow=
!0,this._noOp},a.Time.prototype.copy=function(b){return a.TimeBase.prototype.copy.call(this,b),this._plusNow=b._plusNow,this},a.Time.prototype.toNotation=function(){var a=this.toSeconds(),b=this._toNotationHelper(a,"1m 2n 4n 8n 16n 32n 64n 128n".split(" "));a=this._toNotationHelper(a,"1m 2n 2t 4n 4t 8n 8t 16n 16t 32n 32t 64n 64t 128n".split(" "));return a.split("+").length<b.split("+").length?a:b},a.Time.prototype._toNotationHelper=function(a,b){var c,d,g,h=this._notationToUnits(b[b.length-1]),k=
"";for(c=0;c<b.length;c++)if(d=this._notationToUnits(b[c]),g=a/d,1E-6>1-g%1&&(g+=1E-6),g=Math.floor(g),0<g){if(k+=1===g?b[c]:g.toString()+"*"+b[c],a-=g*d,a<h)break;k+=" + "}return""===k&&(k="0"),k},a.Time.prototype._notationToUnits=function(a){var b,c;var f=this._primaryExpressions;var g=[f.n,f.t,f.m];for(f=0;f<g.length;f++)if(b=g[f],c=a.match(b.regexp))return b.method.call(this,c[1])},a.Time.prototype.toBarsBeatsSixteenths=function(){var a,b=this._beatsToUnits(1);b=this.toSeconds()/b;var e=Math.floor(b/
this._timeSignature()),f=b%1*4;return b=Math.floor(b)%this._timeSignature(),f=f.toString(),3<f.length&&(f=parseFloat(f).toFixed(3)),a=[e,b,f],a.join(":")},a.Time.prototype.toTicks=function(){var b=this._beatsToUnits(1);b=this.eval()/b;return Math.floor(b*a.Transport.PPQ)},a.Time.prototype.toSamples=function(){return this.toSeconds()*this.context.sampleRate},a.Time.prototype.toFrequency=function(){return 1/this.toSeconds()},a.Time.prototype.toSeconds=function(){return this.eval()},a.Time.prototype.toMilliseconds=
function(){return 1E3*this.toSeconds()},a.Time.prototype.eval=function(){return this._expr()+(this._plusNow?this.now():0)},a.Time})(b);(function(a){var b,d;return a.Frequency=function(b,c){return this instanceof a.Frequency?void a.TimeBase.call(this,b,c):new a.Frequency(b,c)},a.extend(a.Frequency,a.TimeBase),a.Frequency.prototype._primaryExpressions=Object.create(a.TimeBase.prototype._primaryExpressions),a.Frequency.prototype._primaryExpressions.midi={regexp:/^(\d+(?:\.\d+)?midi)/,method:function(a){return this.midiToFrequency(a)}},
a.Frequency.prototype._primaryExpressions.note={regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method:function(a,c){var d=b[a.toLowerCase()]+12*(parseInt(c)+1);return this.midiToFrequency(d)}},a.Frequency.prototype._primaryExpressions.tr={regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method:function(a,b,c){var d=1;return a&&"0"!==a&&(d*=this._beatsToUnits(this._timeSignature()*parseFloat(a))),b&&"0"!==b&&(d*=this._beatsToUnits(parseFloat(b))),c&&"0"!==c&&(d*=this._beatsToUnits(parseFloat(c)/
4)),d}},a.Frequency.prototype.transpose=function(a){return this._expr=function(a,b){return a()*this.intervalToFrequencyRatio(b)}.bind(this,this._expr,a),this},a.Frequency.prototype.harmonize=function(a){return this._expr=function(a,b){var c,d=a(),e=[];for(c=0;c<b.length;c++)e[c]=d*this.intervalToFrequencyRatio(b[c]);return e}.bind(this,this._expr,a),this},a.Frequency.prototype.toMidi=function(){return this.frequencyToMidi(this.eval())},a.Frequency.prototype.toNote=function(){var b,c=this.eval();c=
Math.round(Math.log(c/a.Frequency.A4)/Math.LN2*12)+57;var g=Math.floor(c/12);return 0>g&&(c+=-12*g),b=d[c%12],b+g.toString()},a.Frequency.prototype.toSeconds=function(){return 1/this.eval()},a.Frequency.prototype.toFrequency=function(){return this.eval()},a.Frequency.prototype.toTicks=function(){var b=this._beatsToUnits(1);b=this.eval()/b;return Math.floor(b*a.Transport.PPQ)},a.Frequency.prototype._frequencyToUnits=function(a){return a},a.Frequency.prototype._ticksToUnits=function(b){return 1/(60*
b/(a.Transport.bpm.value*a.Transport.PPQ))},a.Frequency.prototype._beatsToUnits=function(b){return 1/a.TimeBase.prototype._beatsToUnits.call(this,b)},a.Frequency.prototype._secondsToUnits=function(a){return 1/a},a.Frequency.prototype._defaultUnits="hz",b={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},d="C C# D D# E F F# G G# A A# B".split(" "),a.Frequency.A4=
440,a.Frequency.prototype.midiToFrequency=function(b){return a.Frequency.A4*Math.pow(2,(b-69)/12)},a.Frequency.prototype.frequencyToMidi=function(b){return 69+12*Math.log(b/a.Frequency.A4)/Math.LN2},a.Frequency})(b);(function(a){return a.TransportTime=function(b,d){return this instanceof a.TransportTime?void a.Time.call(this,b,d):new a.TransportTime(b,d)},a.extend(a.TransportTime,a.Time),a.TransportTime.prototype._unaryExpressions=Object.create(a.Time.prototype._unaryExpressions),a.TransportTime.prototype._unaryExpressions.quantize=
{regexp:/^@/,method:function(b){b=this._secondsToTicks(b());return this._ticksToUnits(Math.ceil(a.Transport.ticks/b)*b)}},a.TransportTime.prototype._secondsToTicks=function(b){var c=this._beatsToUnits(1);return Math.round(b/c*a.Transport.PPQ)},a.TransportTime.prototype.eval=function(){return this._secondsToTicks(this._expr())+(this._plusNow?a.Transport.ticks:0)},a.TransportTime.prototype.toTicks=function(){return this.eval()},a.TransportTime.prototype.toSeconds=function(){return this._expr()+(this._plusNow?
a.Transport.seconds:0)},a.TransportTime.prototype.toFrequency=function(){return 1/this.toSeconds()},a.TransportTime})(b);(function(a){return a.Type={Default:"number",Time:"time",Frequency:"frequency",TransportTime:"transportTime",Ticks:"ticks",NormalRange:"normalRange",AudioRange:"audioRange",Decibels:"db",Interval:"interval",BPM:"bpm",Positive:"positive",Cents:"cents",Degrees:"degrees",MIDI:"midi",BarsBeatsSixteenths:"barsBeatsSixteenths",Samples:"samples",Hertz:"hertz",Note:"note",Milliseconds:"milliseconds",
Seconds:"seconds",Notation:"notation"},a.prototype.toSeconds=function(b){return this.isNumber(b)?b:this.isUndef(b)?this.now():this.isString(b)?(new a.Time(b)).toSeconds():b instanceof a.TimeBase?b.toSeconds():void 0},a.prototype.toFrequency=function(b){return this.isNumber(b)?b:this.isString(b)||this.isUndef(b)?(new a.Frequency(b)).eval():b instanceof a.TimeBase?b.toFrequency():void 0},a.prototype.toTicks=function(b){return this.isNumber(b)||this.isString(b)?(new a.TransportTime(b)).toTicks():this.isUndef(b)?
a.Transport.ticks:b instanceof a.TimeBase?b.toTicks():void 0},a})(b);(function(a){return a.Param=function(){var b=this.optionsObject(arguments,["param","units","convert"],a.Param.defaults);this._param=this.input=b.param;this.units=b.units;this.convert=b.convert;this.overridden=!1;this._lfo=null;this.isObject(b.lfo)?this.value=b.lfo:this.isUndef(b.value)||(this.value=b.value)},a.extend(a.Param),a.Param.defaults={units:a.Type.Default,convert:!0,param:void 0},Object.defineProperty(a.Param.prototype,
"value",{get:function(){return this._toUnits(this._param.value)},set:function(b){if(this.isObject(b)){if(this.isUndef(a.LFO))throw Error("Include 'Tone.LFO' to use an LFO as a Param value.");this._lfo&&this._lfo.dispose();this._lfo=(new a.LFO(b)).start();this._lfo.connect(this.input)}else b=this._fromUnits(b),this._param.cancelScheduledValues(0),this._param.value=b}}),a.Param.prototype._fromUnits=function(b){if(!this.convert&&!this.isUndef(this.convert))return b;switch(this.units){case a.Type.Time:return this.toSeconds(b);
case a.Type.Frequency:return this.toFrequency(b);case a.Type.Decibels:return this.dbToGain(b);case a.Type.NormalRange:return Math.min(Math.max(b,0),1);case a.Type.AudioRange:return Math.min(Math.max(b,-1),1);case a.Type.Positive:return Math.max(b,0);default:return b}},a.Param.prototype._toUnits=function(b){if(!this.convert&&!this.isUndef(this.convert))return b;switch(this.units){case a.Type.Decibels:return this.gainToDb(b);default:return b}},a.Param.prototype._minOutput=1E-5,a.Param.prototype.setValueAtTime=
function(a,b){return a=this._fromUnits(a),b=this.toSeconds(b),b<=this.now()+this.blockTime?this._param.value=a:this._param.setValueAtTime(a,b),this},a.Param.prototype.setRampPoint=function(a){a=this.defaultArg(a,this.now());var b=this._param.value;return 0===b&&(b=this._minOutput),this._param.setValueAtTime(b,a),this},a.Param.prototype.linearRampToValueAtTime=function(a,b){return a=this._fromUnits(a),this._param.linearRampToValueAtTime(a,this.toSeconds(b)),this},a.Param.prototype.exponentialRampToValueAtTime=
function(a,b){return a=this._fromUnits(a),a=Math.max(this._minOutput,a),this._param.exponentialRampToValueAtTime(a,this.toSeconds(b)),this},a.Param.prototype.exponentialRampToValue=function(a,b,e){return e=this.toSeconds(e),this.setRampPoint(e),this.exponentialRampToValueAtTime(a,e+this.toSeconds(b)),this},a.Param.prototype.linearRampToValue=function(a,b,e){return e=this.toSeconds(e),this.setRampPoint(e),this.linearRampToValueAtTime(a,e+this.toSeconds(b)),this},a.Param.prototype.setTargetAtTime=function(a,
b,e){return a=this._fromUnits(a),a=Math.max(this._minOutput,a),e=Math.max(this._minOutput,e),this._param.setTargetAtTime(a,this.toSeconds(b),e),this},a.Param.prototype.setValueCurveAtTime=function(a,b,e){for(var c=0;c<a.length;c++)a[c]=this._fromUnits(a[c]);return this._param.setValueCurveAtTime(a,this.toSeconds(b),this.toSeconds(e)),this},a.Param.prototype.cancelScheduledValues=function(a){return this._param.cancelScheduledValues(this.toSeconds(a)),this},a.Param.prototype.rampTo=function(b,d,e){return d=
this.defaultArg(d,0),this.units===a.Type.Frequency||this.units===a.Type.BPM?this.exponentialRampToValue(b,d,e):this.linearRampToValue(b,d,e),this},Object.defineProperty(a.Param.prototype,"lfo",{get:function(){return this._lfo}}),a.Param.prototype.dispose=function(){return a.prototype.dispose.call(this),this._param=null,this._lfo&&(this._lfo.dispose(),this._lfo=null),this},a.Param})(b);(function(a){return a.Gain=function(){var b=this.optionsObject(arguments,["gain","units"],a.Gain.defaults);this.input=
this.output=this._gainNode=this.context.createGain();this.gain=new a.Param({param:this._gainNode.gain,units:b.units,value:b.gain,convert:b.convert});this._readOnly("gain")},a.extend(a.Gain),a.Gain.defaults={gain:1,convert:!0},a.Gain.prototype.dispose=function(){a.Param.prototype.dispose.call(this);this._gainNode.disconnect();this._gainNode=null;this._writable("gain");this.gain.dispose();this.gain=null},a.prototype.createInsOuts=function(b,d){1===b?this.input=new a.Gain:1<b&&(this.input=Array(b));
1===d?this.output=new a.Gain:1<d&&(this.output=Array(b))},a.Gain})(b);(function(a){return a.Signal=function(){var b=this.optionsObject(arguments,["value","units"],a.Signal.defaults);this.output=this._gain=this.context.createGain();b.param=this._gain.gain;a.Param.call(this,b);this.input=this._param=this._gain.gain;a.Signal._constant.chain(this._gain)},a.extend(a.Signal,a.Param),a.Signal.defaults={value:0,units:a.Type.Default,convert:!0},a.Signal.prototype.connect=a.SignalBase.prototype.connect,a.Signal.prototype.dispose=
function(){return a.Param.prototype.dispose.call(this),this._param=null,this._gain.disconnect(),this._gain=null,this},a.Signal._constant=null,a._initAudioContext(function(b){var c,e=b.createBuffer(1,128,b.sampleRate),f=e.getChannelData(0);for(c=0;c<f.length;c++)f[c]=1;a.Signal._constant=b.createBufferSource();a.Signal._constant.channelCount=1;a.Signal._constant.channelCountMode="explicit";a.Signal._constant.buffer=e;a.Signal._constant.loop=!0;a.Signal._constant.start(0);a.Signal._constant.noGC()}),
a.Signal})(b);(function(a){return a.Timeline=function(){var b=this.optionsObject(arguments,["memory"],a.Timeline.defaults);this._timeline=[];this._toRemove=[];this._iterating=!1;this.memory=b.memory},a.extend(a.Timeline),a.Timeline.defaults={memory:1/0},Object.defineProperty(a.Timeline.prototype,"length",{get:function(){return this._timeline.length}}),a.Timeline.prototype.add=function(a){var b,c;if(this.isUndef(a.time))throw Error("Tone.Timeline: events must have a time attribute");return this._timeline.length?
(b=this._search(a.time),this._timeline.splice(b+1,0,a)):this._timeline.push(a),this.length>this.memory&&(c=this.length-this.memory,this._timeline.splice(0,c)),this},a.Timeline.prototype.remove=function(a){this._iterating?this._toRemove.push(a):(a=this._timeline.indexOf(a),-1!==a&&this._timeline.splice(a,1));return this},a.Timeline.prototype.get=function(a){a=this._search(a);return-1!==a?this._timeline[a]:null},a.Timeline.prototype.peek=function(){return this._timeline[0]},a.Timeline.prototype.shift=
function(){return this._timeline.shift()},a.Timeline.prototype.getAfter=function(a){a=this._search(a);return a+1<this._timeline.length?this._timeline[a+1]:null},a.Timeline.prototype.getBefore=function(a){var b,c=this._timeline.length;return 0<c&&this._timeline[c-1].time<a?this._timeline[c-1]:(b=this._search(a),0<=b-1?this._timeline[b-1]:null)},a.Timeline.prototype.cancel=function(a){var b,c;if(1<this._timeline.length)if(b=this._search(a),0<=b)if(this._timeline[b].time===a){for(c=b;0<=c&&this._timeline[c].time===
a;c--)b=c;this._timeline=this._timeline.slice(0,b)}else this._timeline=this._timeline.slice(0,b+1);else this._timeline=[];else 1===this._timeline.length&&this._timeline[0].time>=a&&(this._timeline=[]);return this},a.Timeline.prototype.cancelBefore=function(a){this._timeline.length&&(a=this._search(a),0<=a&&(this._timeline=this._timeline.slice(a+1)));return this},a.Timeline.prototype._search=function(a){var b,c,f;var g=0;var h=f=this._timeline.length;if(0<f&&this._timeline[f-1].time<=a)return f-1;
for(;g<h;){if(b=Math.floor(g+(h-g)/2),c=this._timeline[b],f=this._timeline[b+1],c.time===a){for(c=b;c<this._timeline.length;c++)g=this._timeline[c],g.time===a&&(b=c);return b}if(c.time<a&&f.time>a)return b;c.time>a?h=b:c.time<a&&(g=b+1)}return-1},a.Timeline.prototype._iterate=function(a,b,e){this._iterating=!0;b=this.defaultArg(b,0);for(e=this.defaultArg(e,this._timeline.length-1);b<=e;b++)a(this._timeline[b]);if(this._iterating=!1,0<this._toRemove.length){for(a=0;a<this._toRemove.length;a++)e=this._timeline.indexOf(this._toRemove[a]),
-1!==e&&this._timeline.splice(e,1);this._toRemove=[]}},a.Timeline.prototype.forEach=function(a){return this._iterate(a),this},a.Timeline.prototype.forEachBefore=function(a,b){var c=this._search(a);return-1!==c&&this._iterate(b,0,c),this},a.Timeline.prototype.forEachAfter=function(a,b){var c=this._search(a);return this._iterate(b,c+1),this},a.Timeline.prototype.forEachFrom=function(a,b){for(var c=this._search(a);0<=c&&this._timeline[c].time>=a;)c--;return this._iterate(b,c+1),this},a.Timeline.prototype.forEachAtTime=
function(a,b){var c=this._search(a);return-1!==c&&this._iterate(function(c){c.time===a&&b(c)},0,c),this},a.Timeline.prototype.dispose=function(){a.prototype.dispose.call(this);this._toRemove=this._timeline=null},a.Timeline})(b);(function(a){return a.TimelineSignal=function(){var b=this.optionsObject(arguments,["value","units"],a.Signal.defaults);this._events=new a.Timeline(10);a.Signal.apply(this,b);b.param=this._param;a.Param.call(this,b);this._initial=this._fromUnits(this._param.value)},a.extend(a.TimelineSignal,
a.Param),a.TimelineSignal.Type={Linear:"linear",Exponential:"exponential",Target:"target",Curve:"curve",Set:"set"},Object.defineProperty(a.TimelineSignal.prototype,"value",{get:function(){var a=this.now();a=this.getValueAtTime(a);return this._toUnits(a)},set:function(a){this._initial=a=this._fromUnits(a);this.cancelScheduledValues();this._param.value=a}}),a.TimelineSignal.prototype.setValueAtTime=function(b,d){return b=this._fromUnits(b),d=this.toSeconds(d),this._events.add({type:a.TimelineSignal.Type.Set,
value:b,time:d}),this._param.setValueAtTime(b,d),this},a.TimelineSignal.prototype.linearRampToValueAtTime=function(b,d){return b=this._fromUnits(b),d=this.toSeconds(d),this._events.add({type:a.TimelineSignal.Type.Linear,value:b,time:d}),this._param.linearRampToValueAtTime(b,d),this},a.TimelineSignal.prototype.exponentialRampToValueAtTime=function(b,d){var c,f;return d=this.toSeconds(d),c=this._searchBefore(d),c&&0===c.value&&this.setValueAtTime(this._minOutput,c.time),b=this._fromUnits(b),f=Math.max(b,
this._minOutput),this._events.add({type:a.TimelineSignal.Type.Exponential,value:f,time:d}),b<this._minOutput?(this._param.exponentialRampToValueAtTime(this._minOutput,d-this.sampleTime),this.setValueAtTime(0,d)):this._param.exponentialRampToValueAtTime(b,d),this},a.TimelineSignal.prototype.setTargetAtTime=function(b,d,e){return b=this._fromUnits(b),b=Math.max(this._minOutput,b),e=Math.max(this._minOutput,e),d=this.toSeconds(d),this._events.add({type:a.TimelineSignal.Type.Target,value:b,time:d,constant:e}),
this._param.setTargetAtTime(b,d,e),this},a.TimelineSignal.prototype.setValueCurveAtTime=function(b,d,e,f){var c;f=this.defaultArg(f,1);var h=Array(b.length);for(c=0;c<h.length;c++)h[c]=this._fromUnits(b[c])*f;d=this.toSeconds(d);e=this.toSeconds(e);this._events.add({type:a.TimelineSignal.Type.Curve,value:h,time:d,duration:e});this._param.setValueAtTime(h[0],d);for(b=1;b<h.length;b++)f=d+b/(h.length-1)*e,this._param.linearRampToValueAtTime(h[b],f);return this},a.TimelineSignal.prototype.cancelScheduledValues=
function(a){return a=this.toSeconds(a),this._events.cancel(a),this._param.cancelScheduledValues(a),this},a.TimelineSignal.prototype.setRampPoint=function(b){var c,e,f;return b=this.toSeconds(b),c=this._toUnits(this.getValueAtTime(b)),e=this._searchBefore(b),e&&e.time===b?this.cancelScheduledValues(b+this.sampleTime):e&&e.type===a.TimelineSignal.Type.Curve&&e.time+e.duration>b?(this.cancelScheduledValues(b),this.linearRampToValueAtTime(c,b)):(f=this._searchAfter(b),f&&(this.cancelScheduledValues(b),
f.type===a.TimelineSignal.Type.Linear?this.linearRampToValueAtTime(c,b):f.type===a.TimelineSignal.Type.Exponential&&this.exponentialRampToValueAtTime(c,b)),this.setValueAtTime(c,b)),this},a.TimelineSignal.prototype.linearRampToValueBetween=function(a,b,e){return this.setRampPoint(b),this.linearRampToValueAtTime(a,e),this},a.TimelineSignal.prototype.exponentialRampToValueBetween=function(a,b,e){return this.setRampPoint(b),this.exponentialRampToValueAtTime(a,e),this},a.TimelineSignal.prototype._searchBefore=
function(a){return this._events.get(a)},a.TimelineSignal.prototype._searchAfter=function(a){return this._events.getAfter(a)},a.TimelineSignal.prototype.getValueAtTime=function(b){var c,e,f,g,h;return b=this.toSeconds(b),c=this._searchAfter(b),e=this._searchBefore(b),null===e?f=this._initial:e.type===a.TimelineSignal.Type.Target?(g=this._events.getBefore(e.time),h=null===g?this._initial:g.value,f=this._exponentialApproach(e.time,h,e.value,e.constant,b)):f=e.type===a.TimelineSignal.Type.Curve?this._curveInterpolate(e.time,
e.value,e.duration,b):null===c?e.value:c.type===a.TimelineSignal.Type.Linear?this._linearInterpolate(e.time,e.value,c.time,c.value,b):c.type===a.TimelineSignal.Type.Exponential?this._exponentialInterpolate(e.time,e.value,c.time,c.value,b):e.value,f},a.TimelineSignal.prototype.connect=a.SignalBase.prototype.connect,a.TimelineSignal.prototype._exponentialApproach=function(a,b,e,f,g){return e+(b-e)*Math.exp(-(g-a)/f)},a.TimelineSignal.prototype._linearInterpolate=function(a,b,e,f,g){return b+(g-a)/(e-
a)*(f-b)},a.TimelineSignal.prototype._exponentialInterpolate=function(a,b,e,f,g){return b=Math.max(this._minOutput,b),b*Math.pow(f/b,(g-a)/(e-a))},a.TimelineSignal.prototype._curveInterpolate=function(a,b,e,f){var c,d,k,l,p,q=b.length;return f>=a+e?b[q-1]:f<=a?b[0]:(c=(f-a)/e,d=Math.floor((q-1)*c),k=Math.ceil((q-1)*c),l=b[d],p=b[k],k===d?l:this._linearInterpolate(d,l,k,p,c*(q-1)))},a.TimelineSignal.prototype.dispose=function(){a.Signal.prototype.dispose.call(this);a.Param.prototype.dispose.call(this);
this._events.dispose();this._events=null},a.TimelineSignal})(b);(function(a){return a.Pow=function(b){this._exp=this.defaultArg(b,1);this._expScaler=this.input=this.output=new a.WaveShaper(this._expFunc(this._exp),8192)},a.extend(a.Pow,a.SignalBase),Object.defineProperty(a.Pow.prototype,"value",{get:function(){return this._exp},set:function(a){this._exp=a;this._expScaler.setMap(this._expFunc(this._exp))}}),a.Pow.prototype._expFunc=function(a){return function(b){return Math.pow(Math.abs(b),a)}},a.Pow.prototype.dispose=
function(){return a.prototype.dispose.call(this),this._expScaler.dispose(),this._expScaler=null,this},a.Pow})(b);(function(a){return a.Envelope=function(){var b=this.optionsObject(arguments,["attack","decay","sustain","release"],a.Envelope.defaults);this.attack=b.attack;this.decay=b.decay;this.sustain=b.sustain;this.release=b.release;this._attackCurve="linear";this._releaseCurve="exponential";this._sig=this.output=new a.TimelineSignal;this._sig.setValueAtTime(0,0);this.attackCurve=b.attackCurve;this.releaseCurve=
b.releaseCurve},a.extend(a.Envelope),a.Envelope.defaults={attack:.01,decay:.1,sustain:.5,release:1,attackCurve:"linear",releaseCurve:"exponential"},Object.defineProperty(a.Envelope.prototype,"value",{get:function(){return this.getValueAtTime(this.now())}}),Object.defineProperty(a.Envelope.prototype,"attackCurve",{get:function(){if(this.isString(this._attackCurve))return this._attackCurve;if(this.isArray(this._attackCurve)){for(var b in a.Envelope.Type)if(a.Envelope.Type[b].In===this._attackCurve)return b;
return this._attackCurve}},set:function(b){if(a.Envelope.Type.hasOwnProperty(b))b=a.Envelope.Type[b],this.isObject(b)?this._attackCurve=b.In:this._attackCurve=b;else{if(!this.isArray(b))throw Error("Tone.Envelope: invalid curve: "+b);this._attackCurve=b}}}),Object.defineProperty(a.Envelope.prototype,"releaseCurve",{get:function(){if(this.isString(this._releaseCurve))return this._releaseCurve;if(this.isArray(this._releaseCurve)){for(var b in a.Envelope.Type)if(a.Envelope.Type[b].Out===this._releaseCurve)return b;
return this._releaseCurve}},set:function(b){if(a.Envelope.Type.hasOwnProperty(b))b=a.Envelope.Type[b],this.isObject(b)?this._releaseCurve=b.Out:this._releaseCurve=b;else{if(!this.isArray(b))throw Error("Tone.Envelope: invalid curve: "+b);this._releaseCurve=b}}}),a.Envelope.prototype.triggerAttack=function(a,b){var c,d,g,h,k,l,p,q,m;return a=this.toSeconds(a),c=this.toSeconds(this.attack),d=c,g=this.toSeconds(this.decay),b=this.defaultArg(b,1),h=this.getValueAtTime(a),0<h&&(k=1/d,l=1-h,d=l/k),"linear"===
this._attackCurve?this._sig.linearRampToValue(b,d,a):"exponential"===this._attackCurve?this._sig.exponentialRampToValue(b,d,a):0<d&&(this._sig.setRampPoint(a),p=this._attackCurve,d<c&&(q=1-d/c,m=Math.floor(q*this._attackCurve.length),p=this._attackCurve.slice(m),p[0]=h),this._sig.setValueCurveAtTime(p,a,d,b)),this._sig.exponentialRampToValue(b*this.sustain,g,d+a),this},a.Envelope.prototype.triggerRelease=function(a){var b,c,f;return a=this.toSeconds(a),b=this.getValueAtTime(a),0<b&&(c=this.toSeconds(this.release),
"linear"===this._releaseCurve?this._sig.linearRampToValue(0,c,a):"exponential"===this._releaseCurve?this._sig.exponentialRampToValue(0,c,a):(f=this._releaseCurve,this.isArray(f)&&(this._sig.setRampPoint(a),this._sig.setValueCurveAtTime(f,a,c,b)))),this},a.Envelope.prototype.getValueAtTime=function(a){return this._sig.getValueAtTime(a)},a.Envelope.prototype.triggerAttackRelease=function(a,b,e){return b=this.toSeconds(b),this.triggerAttack(b,e),this.triggerRelease(b+this.toSeconds(a)),this},a.Envelope.prototype.cancel=
function(a){return this._sig.cancelScheduledValues(a),this},a.Envelope.prototype.connect=a.Signal.prototype.connect,function(){function b(a){var b,c=Array(a.length);for(b=0;b<a.length;b++)c[b]=1-a[b];return c}var d,e=[];for(d=0;128>d;d++)e[d]=Math.sin(d/127*(Math.PI/2));var f=[];for(d=0;127>d;d++){var g=d/127;var h=Math.sin(2*g*Math.PI*6.4-Math.PI/2)+1;f[d]=h/10+.83*g}f[127]=1;h=[];for(d=0;128>d;d++)h[d]=Math.ceil(d/127*5)/5;var k=[];for(d=0;128>d;d++)g=d/127,k[d]=.5*(1-Math.cos(Math.PI*g));var l=
[];for(d=0;128>d;d++){g=d/127;var p=4*Math.pow(g,3)+.2;p=Math.cos(p*Math.PI*2*g);l[d]=Math.abs(p*(1-g))}a.Envelope.Type={linear:"linear",exponential:"exponential",bounce:{In:b(l),Out:l},cosine:{In:e,Out:e.slice(0).reverse()},step:{In:h,Out:b(h)},ripple:{In:f,Out:b(f)},sine:{In:k,Out:b(k)}}}(),a.Envelope.prototype.dispose=function(){return a.prototype.dispose.call(this),this._sig.dispose(),this._sig=null,this._attackCurve=null,this._releaseCurve=null,this},a.Envelope})(b);(function(a){return a.AmplitudeEnvelope=
function(){a.Envelope.apply(this,arguments);this.input=this.output=new a.Gain;this._sig.connect(this.output.gain)},a.extend(a.AmplitudeEnvelope,a.Envelope),a.AmplitudeEnvelope.prototype.dispose=function(){return this.input.dispose(),this.input=null,a.Envelope.prototype.dispose.call(this),this},a.AmplitudeEnvelope})(b);(function(a){return a.Analyser=function(){var b=this.optionsObject(arguments,["type","size"],a.Analyser.defaults);this._analyser=this.input=this.output=this.context.createAnalyser();
this._type=b.type;this._returnType=b.returnType;this._buffer=null;this.size=b.size;this.type=b.type;this.returnType=b.returnType;this.minDecibels=b.minDecibels;this.maxDecibels=b.maxDecibels},a.extend(a.Analyser),a.Analyser.defaults={size:1024,returnType:"byte",type:"fft",smoothing:.8,maxDecibels:-30,minDecibels:-100},a.Analyser.Type={Waveform:"waveform",FFT:"fft"},a.Analyser.ReturnType={Byte:"byte",Float:"float"},a.Analyser.prototype.analyse=function(){var b;if(this._type===a.Analyser.Type.FFT)this._returnType===
a.Analyser.ReturnType.Byte?this._analyser.getByteFrequencyData(this._buffer):this._analyser.getFloatFrequencyData(this._buffer);else if(this._type===a.Analyser.Type.Waveform)if(this._returnType===a.Analyser.ReturnType.Byte)this._analyser.getByteTimeDomainData(this._buffer);else if(this.isFunction(AnalyserNode.prototype.getFloatTimeDomainData))this._analyser.getFloatTimeDomainData(this._buffer);else{var d=new Uint8Array(this._buffer.length);this._analyser.getByteTimeDomainData(d);for(b=0;b<d.length;b++)this._buffer[b]=
.0078125*(d[b]-128)}return this._buffer},Object.defineProperty(a.Analyser.prototype,"size",{get:function(){return this._analyser.frequencyBinCount},set:function(a){this._analyser.fftSize=2*a;this.type=this._type}}),Object.defineProperty(a.Analyser.prototype,"returnType",{get:function(){return this._returnType},set:function(b){if(b===a.Analyser.ReturnType.Byte)this._buffer=new Uint8Array(this._analyser.frequencyBinCount);else{if(b!==a.Analyser.ReturnType.Float)throw new TypeError("Tone.Analayser: invalid return type: "+
b);this._buffer=new Float32Array(this._analyser.frequencyBinCount)}this._returnType=b}}),Object.defineProperty(a.Analyser.prototype,"type",{get:function(){return this._type},set:function(b){if(b!==a.Analyser.Type.Waveform&&b!==a.Analyser.Type.FFT)throw new TypeError("Tone.Analyser: invalid type: "+b);this._type=b}}),Object.defineProperty(a.Analyser.prototype,"smoothing",{get:function(){return this._analyser.smoothingTimeConstant},set:function(a){this._analyser.smoothingTimeConstant=a}}),Object.defineProperty(a.Analyser.prototype,
"minDecibels",{get:function(){return this._analyser.minDecibels},set:function(a){this._analyser.minDecibels=a}}),Object.defineProperty(a.Analyser.prototype,"maxDecibels",{get:function(){return this._analyser.maxDecibels},set:function(a){this._analyser.maxDecibels=a}}),a.Analyser.prototype.dispose=function(){a.prototype.dispose.call(this);this._analyser.disconnect();this._buffer=this._analyser=null},a.Analyser})(b);(function(a){return a.Compressor=function(){var b=this.optionsObject(arguments,["threshold",
"ratio"],a.Compressor.defaults);this._compressor=this.input=this.output=this.context.createDynamicsCompressor();this.threshold=new a.Param({param:this._compressor.threshold,units:a.Type.Decibels,convert:!1});this.attack=new a.Param(this._compressor.attack,a.Type.Time);this.release=new a.Param(this._compressor.release,a.Type.Time);this.knee=new a.Param({param:this._compressor.knee,units:a.Type.Decibels,convert:!1});this.ratio=new a.Param({param:this._compressor.ratio,convert:!1});this._readOnly(["knee",
"release","attack","ratio","threshold"]);this.set(b)},a.extend(a.Compressor),a.Compressor.defaults={ratio:12,threshold:-24,release:.25,attack:.003,knee:30},a.Compressor.prototype.dispose=function(){return a.prototype.dispose.call(this),this._writable(["knee","release","attack","ratio","threshold"]),this._compressor.disconnect(),this._compressor=null,this.attack.dispose(),this.attack=null,this.release.dispose(),this.release=null,this.threshold.dispose(),this.threshold=null,this.ratio.dispose(),this.ratio=
null,this.knee.dispose(),this.knee=null,this},a.Compressor})(b);(function(a){return a.Add=function(b){this.createInsOuts(2,0);this._sum=this.input[0]=this.input[1]=this.output=new a.Gain;this._param=this.input[1]=new a.Signal(b);this._param.connect(this._sum)},a.extend(a.Add,a.Signal),a.Add.prototype.dispose=function(){return a.prototype.dispose.call(this),this._sum.dispose(),this._sum=null,this._param.dispose(),this._param=null,this},a.Add})(b);(function(a){return a.Multiply=function(b){this.createInsOuts(2,
0);this._mult=this.input[0]=this.output=new a.Gain;this._param=this.input[1]=this.output.gain;this._param.value=this.defaultArg(b,0)},a.extend(a.Multiply,a.Signal),a.Multiply.prototype.dispose=function(){return a.prototype.dispose.call(this),this._mult.dispose(),this._mult=null,this._param=null,this},a.Multiply})(b);(function(a){return a.Negate=function(){this._multiply=this.input=this.output=new a.Multiply(-1)},a.extend(a.Negate,a.SignalBase),a.Negate.prototype.dispose=function(){return a.prototype.dispose.call(this),
this._multiply.dispose(),this._multiply=null,this},a.Negate})(b);(function(a){return a.Subtract=function(b){this.createInsOuts(2,0);this._sum=this.input[0]=this.output=new a.Gain;this._neg=new a.Negate;this._param=this.input[1]=new a.Signal(b);this._param.chain(this._neg,this._sum)},a.extend(a.Subtract,a.Signal),a.Subtract.prototype.dispose=function(){return a.prototype.dispose.call(this),this._neg.dispose(),this._neg=null,this._sum.disconnect(),this._sum=null,this._param.dispose(),this._param=null,
this},a.Subtract})(b);(function(a){return a.GreaterThanZero=function(){this._thresh=this.output=new a.WaveShaper(function(a){return 0>=a?0:1},127);this._scale=this.input=new a.Multiply(1E4);this._scale.connect(this._thresh)},a.extend(a.GreaterThanZero,a.SignalBase),a.GreaterThanZero.prototype.dispose=function(){return a.prototype.dispose.call(this),this._scale.dispose(),this._scale=null,this._thresh.dispose(),this._thresh=null,this},a.GreaterThanZero})(b);(function(a){return a.GreaterThan=function(b){this.createInsOuts(2,
0);this._param=this.input[0]=new a.Subtract(b);this.input[1]=this._param.input[1];this._gtz=this.output=new a.GreaterThanZero;this._param.connect(this._gtz)},a.extend(a.GreaterThan,a.Signal),a.GreaterThan.prototype.dispose=function(){return a.prototype.dispose.call(this),this._param.dispose(),this._param=null,this._gtz.dispose(),this._gtz=null,this},a.GreaterThan})(b);(function(a){return a.Abs=function(){this._abs=this.input=this.output=new a.WaveShaper(function(a){return 0===a?0:Math.abs(a)},127)},
a.extend(a.Abs,a.SignalBase),a.Abs.prototype.dispose=function(){return a.prototype.dispose.call(this),this._abs.dispose(),this._abs=null,this},a.Abs})(b);(function(a){return a.Modulo=function(b){this.createInsOuts(1,0);this._shaper=new a.WaveShaper(Math.pow(2,16));this._multiply=new a.Multiply;this._subtract=this.output=new a.Subtract;this._modSignal=new a.Signal(b);this.input.fan(this._shaper,this._subtract);this._modSignal.connect(this._multiply,0,0);this._shaper.connect(this._multiply,0,1);this._multiply.connect(this._subtract,
0,1);this._setWaveShaper(b)},a.extend(a.Modulo,a.SignalBase),a.Modulo.prototype._setWaveShaper=function(a){this._shaper.setMap(function(b){return Math.floor((b+1E-4)/a)})},Object.defineProperty(a.Modulo.prototype,"value",{get:function(){return this._modSignal.value},set:function(a){this._modSignal.value=a;this._setWaveShaper(a)}}),a.Modulo.prototype.dispose=function(){return a.prototype.dispose.call(this),this._shaper.dispose(),this._shaper=null,this._multiply.dispose(),this._multiply=null,this._subtract.dispose(),
this._subtract=null,this._modSignal.dispose(),this._modSignal=null,this},a.Modulo})(b);(function(a){return a.AudioToGain=function(){this._norm=this.input=this.output=new a.WaveShaper(function(a){return(a+1)/2})},a.extend(a.AudioToGain,a.SignalBase),a.AudioToGain.prototype.dispose=function(){return a.prototype.dispose.call(this),this._norm.dispose(),this._norm=null,this},a.AudioToGain})(b);(function(a){function b(a,b,c){a=new a;return c._eval(b[0]).connect(a,0,0),c._eval(b[1]).connect(a,0,1),a}function d(a,
b,c){a=new a;return c._eval(b[0]).connect(a,0,0),a}function e(a){return a&&a.args?parseFloat(a.args):void 0}return a.Expr=function(){var a,b=this._replacements(Array.prototype.slice.call(arguments)),c=this._parseInputs(b);this._nodes=[];this.input=Array(c);for(a=0;a<c;a++)this.input[a]=this.context.createGain();a=this._parseTree(b);try{var d=this._eval(a)}catch(l){throw this._disposeNodes(),Error("Tone.Expr: Could evaluate expression: "+b);}this.output=d},a.extend(a.Expr,a.SignalBase),a.Expr._Expressions=
{value:{signal:{regexp:/^\d+\.\d+|^\d+/,method:function(b){return new a.Signal(b?parseFloat(b):void 0)}},input:{regexp:/^\$\d/,method:function(a,b){var c=b.input;var d=(d=a.substr(1))?parseFloat(d):void 0;return c[d]}}},glue:{"(":{regexp:/^\(/},")":{regexp:/^\)/},",":{regexp:/^,/}},func:{abs:{regexp:/^abs/,method:d.bind(this,a.Abs)},mod:{regexp:/^mod/,method:function(b,c){var d=e(b[1]);d=new a.Modulo(d);return c._eval(b[0]).connect(d),d}},pow:{regexp:/^pow/,method:function(b,c){var d=e(b[1]);d=new a.Pow(d);
return c._eval(b[0]).connect(d),d}},a2g:{regexp:/^a2g/,method:function(b,c){var d=new a.AudioToGain;return c._eval(b[0]).connect(d),d}}},binary:{"+":{regexp:/^\+/,precedence:1,method:b.bind(this,a.Add)},"-":{regexp:/^\-/,precedence:1,method:function(c,e){return 1===c.length?d(a.Negate,c,e):b(a.Subtract,c,e)}},"*":{regexp:/^\*/,precedence:0,method:b.bind(this,a.Multiply)}},unary:{"-":{regexp:/^\-/,method:d.bind(this,a.Negate)},"!":{regexp:/^!/,method:d.bind(this,a.NOT)}}},a.Expr.prototype._parseInputs=
function(a){var b=a.match(/\$\d/g),c=0;if(null!==b)for(a=0;a<b.length;a++){var d=parseInt(b[a].substr(1))+1;c=Math.max(c,d)}return c},a.Expr.prototype._replacements=function(a){var b,c=a.shift();for(b=0;b<a.length;b++)c=c.replace(/%/i,a[b]);return c},a.Expr.prototype._tokenize=function(b){function c(b){var c,d,e,f,g;for(c in a.Expr._Expressions){var h=a.Expr._Expressions[c];for(d in h)if(e=h[d],f=e.regexp,g=b.match(f),null!==g)return{type:c,value:g[0],method:e.method}}throw new SyntaxError("Tone.Expr: Unexpected token "+
b);}for(var d,e=-1,f=[];0<b.length;)b=b.trim(),d=c(b),f.push(d),b=b.substr(d.value.length);return{next:function(){return f[++e]},peek:function(){return f[e+1]}}},a.Expr.prototype._parseTree=function(b){function c(a,b){return!m(a)&&"glue"===a.type&&a.value===b}function d(b,c,d){var e,f;c=a.Expr._Expressions[c];if(!m(b))for(e in c)if(f=c[e],f.regexp.test(b.value))if(m(d)||f.precedence===d)return!0;return!1}function e(a){var b;m(a)&&(a=5);var c=0>a?f():e(a-1);for(b=q.peek();d(b,"binary",a);)b=q.next(),
c={operator:b.value,method:b.method,args:[c,e(a-1)]},b=q.peek();return c}function f(){var a,b;return a=q.peek(),d(a,"unary")?(a=q.next(),b=f(),{operator:a.value,method:a.method,args:[b]}):p()}function p(){var a,b;if(a=q.peek(),m(a))throw new SyntaxError("Tone.Expr: Unexpected termination of expression");if("func"===a.type){a=q.next();var d=[];if(b=q.next(),!c(b,"("))throw new SyntaxError('Tone.Expr: Expected ( in a function call "'+a.value+'"');b=q.peek();if(!c(b,")")){var f,g;for(d=[];(g=e(),!m(g))&&
(d.push(g),f=q.peek(),c(f,","));)q.next()}if(b=q.next(),!c(b,")"))throw new SyntaxError('Tone.Expr: Expected ) in a function call "'+a.value+'"');return{method:a.method,args:d,name:name}}if("value"===a.type)return a=q.next(),{method:a.method,args:a.value};if(c(a,"(")){if(q.next(),b=e(),a=q.next(),!c(a,")"))throw new SyntaxError("Expected )");return b}throw new SyntaxError("Tone.Expr: Parse error, cannot process token "+a.value);}var q=this._tokenize(b),m=this.isUndef.bind(this);return e()},a.Expr.prototype._eval=
function(a){if(!this.isUndef(a))return a=a.method(a.args,this),this._nodes.push(a),a},a.Expr.prototype._disposeNodes=function(){var a;for(a=0;a<this._nodes.length;a++){var b=this._nodes[a];this.isFunction(b.dispose)?b.dispose():this.isFunction(b.disconnect)&&b.disconnect();this._nodes[a]=null}this._nodes=null},a.Expr.prototype.dispose=function(){a.prototype.dispose.call(this);this._disposeNodes()},a.Expr})(b);(function(a){return a.EqualPowerGain=function(){this._eqPower=this.input=this.output=new a.WaveShaper(function(a){return.001>
Math.abs(a)?0:this.equalPowerScale(a)}.bind(this),4096)},a.extend(a.EqualPowerGain,a.SignalBase),a.EqualPowerGain.prototype.dispose=function(){return a.prototype.dispose.call(this),this._eqPower.dispose(),this._eqPower=null,this},a.EqualPowerGain})(b);(function(a){return a.CrossFade=function(b){this.createInsOuts(2,1);this.a=this.input[0]=new a.Gain;this.b=this.input[1]=new a.Gain;this.fade=new a.Signal(this.defaultArg(b,.5),a.Type.NormalRange);this._equalPowerA=new a.EqualPowerGain;this._equalPowerB=
new a.EqualPowerGain;this._invert=new a.Expr("1 - $0");this.a.connect(this.output);this.b.connect(this.output);this.fade.chain(this._equalPowerB,this.b.gain);this.fade.chain(this._invert,this._equalPowerA,this.a.gain);this._readOnly("fade")},a.extend(a.CrossFade),a.CrossFade.prototype.dispose=function(){return a.prototype.dispose.call(this),this._writable("fade"),this._equalPowerA.dispose(),this._equalPowerA=null,this._equalPowerB.dispose(),this._equalPowerB=null,this.fade.dispose(),this.fade=null,
this._invert.dispose(),this._invert=null,this.a.dispose(),this.a=null,this.b.dispose(),this.b=null,this},a.CrossFade})(b);(function(a){return a.Filter=function(){this.createInsOuts(1,1);var b=this.optionsObject(arguments,["frequency","type","rolloff"],a.Filter.defaults);this._filters=[];this.frequency=new a.Signal(b.frequency,a.Type.Frequency);this.detune=new a.Signal(0,a.Type.Cents);this.gain=new a.Signal({value:b.gain,convert:!1});this.Q=new a.Signal(b.Q);this._type=b.type;this.rolloff=this._rolloff=
b.rolloff;this._readOnly(["detune","frequency","gain","Q"])},a.extend(a.Filter),a.Filter.defaults={type:"lowpass",frequency:350,rolloff:-12,Q:1,gain:0},Object.defineProperty(a.Filter.prototype,"type",{get:function(){return this._type},set:function(a){var b;if(-1==="lowpass highpass bandpass lowshelf highshelf notch allpass peaking".split(" ").indexOf(a))throw new TypeError("Tone.Filter: invalid type "+a);this._type=a;for(b=0;b<this._filters.length;b++)this._filters[b].type=a}}),Object.defineProperty(a.Filter.prototype,
"rolloff",{get:function(){return this._rolloff},set:function(a){var b,c;if(a=parseInt(a,10),b=[-12,-24,-48,-96],c=b.indexOf(a),-1===c)throw new RangeError("Tone.Filter: rolloff can only be -12, -24, -48 or -96");c+=1;this._rolloff=a;this.input.disconnect();for(a=0;a<this._filters.length;a++)this._filters[a].disconnect(),this._filters[a]=null;this._filters=Array(c);for(a=0;a<c;a++)b=this.context.createBiquadFilter(),b.type=this._type,this.frequency.connect(b.frequency),this.detune.connect(b.detune),
this.Q.connect(b.Q),this.gain.connect(b.gain),this._filters[a]=b;c=[this.input].concat(this._filters).concat([this.output]);this.connectSeries.apply(this,c)}}),a.Filter.prototype.dispose=function(){a.prototype.dispose.call(this);for(var b=0;b<this._filters.length;b++)this._filters[b].disconnect(),this._filters[b]=null;return this._filters=null,this._writable(["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.frequency=null,this.Q=null,this.detune.dispose(),this.detune=
null,this.gain.dispose(),this.gain=null,this},a.Filter})(b);(function(a){return a.MultibandSplit=function(){var b=this.optionsObject(arguments,["lowFrequency","highFrequency"],a.MultibandSplit.defaults);this.input=new a.Gain;this.output=Array(3);this.low=this.output[0]=new a.Filter(0,"lowpass");this._lowMidFilter=new a.Filter(0,"highpass");this.mid=this.output[1]=new a.Filter(0,"lowpass");this.high=this.output[2]=new a.Filter(0,"highpass");this.lowFrequency=new a.Signal(b.lowFrequency,a.Type.Frequency);
this.highFrequency=new a.Signal(b.highFrequency,a.Type.Frequency);this.Q=new a.Signal(b.Q);this.input.fan(this.low,this.high);this.input.chain(this._lowMidFilter,this.mid);this.lowFrequency.connect(this.low.frequency);this.lowFrequency.connect(this._lowMidFilter.frequency);this.highFrequency.connect(this.mid.frequency);this.highFrequency.connect(this.high.frequency);this.Q.connect(this.low.Q);this.Q.connect(this._lowMidFilter.Q);this.Q.connect(this.mid.Q);this.Q.connect(this.high.Q);this._readOnly(["high",
"mid","low","highFrequency","lowFrequency"])},a.extend(a.MultibandSplit),a.MultibandSplit.defaults={lowFrequency:400,highFrequency:2500,Q:1},a.MultibandSplit.prototype.dispose=function(){return a.prototype.dispose.call(this),this._writable(["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this.low=null,this._lowMidFilter.dispose(),this._lowMidFilter=null,this.mid.dispose(),this.mid=null,this.high.dispose(),this.high=null,this.lowFrequency.dispose(),this.lowFrequency=null,this.highFrequency.dispose(),
this.highFrequency=null,this.Q.dispose(),this.Q=null,this},a.MultibandSplit})(b);(function(a){return a.EQ3=function(){var b=this.optionsObject(arguments,["low","mid","high"],a.EQ3.defaults);this.output=new a.Gain;this._multibandSplit=this.input=new a.MultibandSplit({lowFrequency:b.lowFrequency,highFrequency:b.highFrequency});this._lowGain=new a.Gain(b.low,a.Type.Decibels);this._midGain=new a.Gain(b.mid,a.Type.Decibels);this._highGain=new a.Gain(b.high,a.Type.Decibels);this.low=this._lowGain.gain;
this.mid=this._midGain.gain;this.high=this._highGain.gain;this.Q=this._multibandSplit.Q;this.lowFrequency=this._multibandSplit.lowFrequency;this.highFrequency=this._multibandSplit.highFrequency;this._multibandSplit.low.chain(this._lowGain,this.output);this._multibandSplit.mid.chain(this._midGain,this.output);this._multibandSplit.high.chain(this._highGain,this.output);this._readOnly(["low","mid","high","lowFrequency","highFrequency"])},a.extend(a.EQ3),a.EQ3.defaults={low:0,mid:0,high:0,lowFrequency:400,
highFrequency:2500},a.EQ3.prototype.dispose=function(){return a.prototype.dispose.call(this),this._writable(["low","mid","high","lowFrequency","highFrequency"]),this._multibandSplit.dispose(),this._multibandSplit=null,this.lowFrequency=null,this.highFrequency=null,this._lowGain.dispose(),this._lowGain=null,this._midGain.dispose(),this._midGain=null,this._highGain.dispose(),this._highGain=null,this.low=null,this.mid=null,this.high=null,this.Q=null,this},a.EQ3})(b);(function(a){return a.Scale=function(b,
d){this._outputMin=this.defaultArg(b,0);this._outputMax=this.defaultArg(d,1);this._scale=this.input=new a.Multiply(1);this._add=this.output=new a.Add(0);this._scale.connect(this._add);this._setRange()},a.extend(a.Scale,a.SignalBase),Object.defineProperty(a.Scale.prototype,"min",{get:function(){return this._outputMin},set:function(a){this._outputMin=a;this._setRange()}}),Object.defineProperty(a.Scale.prototype,"max",{get:function(){return this._outputMax},set:function(a){this._outputMax=a;this._setRange()}}),
a.Scale.prototype._setRange=function(){this._add.value=this._outputMin;this._scale.value=this._outputMax-this._outputMin},a.Scale.prototype.dispose=function(){return a.prototype.dispose.call(this),this._add.dispose(),this._add=null,this._scale.dispose(),this._scale=null,this},a.Scale})(b);(function(a){return a.ScaleExp=function(b,d,e){this._scale=this.output=new a.Scale(b,d);this._exp=this.input=new a.Pow(this.defaultArg(e,2));this._exp.connect(this._scale)},a.extend(a.ScaleExp,a.SignalBase),Object.defineProperty(a.ScaleExp.prototype,
"exponent",{get:function(){return this._exp.value},set:function(a){this._exp.value=a}}),Object.defineProperty(a.ScaleExp.prototype,"min",{get:function(){return this._scale.min},set:function(a){this._scale.min=a}}),Object.defineProperty(a.ScaleExp.prototype,"max",{get:function(){return this._scale.max},set:function(a){this._scale.max=a}}),a.ScaleExp.prototype.dispose=function(){return a.prototype.dispose.call(this),this._scale.dispose(),this._scale=null,this._exp.dispose(),this._exp=null,this},a.ScaleExp})(b);
(function(a){return a.Delay=function(){var b=this.optionsObject(arguments,["delayTime","maxDelay"],a.Delay.defaults);this._delayNode=this.input=this.output=this.context.createDelay(this.toSeconds(b.maxDelay));this.delayTime=new a.Param({param:this._delayNode.delayTime,units:a.Type.Time,value:b.delayTime});this._readOnly("delayTime")},a.extend(a.Delay),a.Delay.defaults={maxDelay:1,delayTime:0},a.Delay.prototype.dispose=function(){return a.Param.prototype.dispose.call(this),this._delayNode.disconnect(),
this._delayNode=null,this._writable("delayTime"),this.delayTime=null,this},a.Delay})(b);(function(a){return a.FeedbackCombFilter=function(){var b=this.optionsObject(arguments,["delayTime","resonance"],a.FeedbackCombFilter.defaults);this._delay=this.input=this.output=new a.Delay(b.delayTime);this.delayTime=this._delay.delayTime;this._feedback=new a.Gain(b.resonance,a.Type.NormalRange);this.resonance=this._feedback.gain;this._delay.chain(this._feedback,this._delay);this._readOnly(["resonance","delayTime"])},
a.extend(a.FeedbackCombFilter),a.FeedbackCombFilter.defaults={delayTime:.1,resonance:.5},a.FeedbackCombFilter.prototype.dispose=function(){return a.prototype.dispose.call(this),this._writable(["resonance","delayTime"]),this._delay.dispose(),this._delay=null,this.delayTime=null,this._feedback.dispose(),this._feedback=null,this.resonance=null,this},a.FeedbackCombFilter})(b);(function(a){return a.Follower=function(){this.createInsOuts(1,1);var b=this.optionsObject(arguments,["attack","release"],a.Follower.defaults);
this._abs=new a.Abs;this._filter=this.context.createBiquadFilter();this._filter.type="lowpass";this._filter.frequency.value=0;this._filter.Q.value=-100;this._frequencyValues=new a.WaveShaper;this._sub=new a.Subtract;this._delay=new a.Delay(this.blockTime);this._mult=new a.Multiply(1E4);this._attack=b.attack;this._release=b.release;this.input.chain(this._abs,this._filter,this.output);this._abs.connect(this._sub,0,1);this._filter.chain(this._delay,this._sub);this._sub.chain(this._mult,this._frequencyValues,
this._filter.frequency);this._setAttackRelease(this._attack,this._release)},a.extend(a.Follower),a.Follower.defaults={attack:.05,release:.5},a.Follower.prototype._setAttackRelease=function(b,d){var c=this.blockTime;b=a.Time(b).toFrequency();d=a.Time(d).toFrequency();b=Math.max(b,c);d=Math.max(d,c);this._frequencyValues.setMap(function(a){return 0>=a?b:d})},Object.defineProperty(a.Follower.prototype,"attack",{get:function(){return this._attack},set:function(a){this._attack=a;this._setAttackRelease(this._attack,
this._release)}}),Object.defineProperty(a.Follower.prototype,"release",{get:function(){return this._release},set:function(a){this._release=a;this._setAttackRelease(this._attack,this._release)}}),a.Follower.prototype.connect=a.Signal.prototype.connect,a.Follower.prototype.dispose=function(){return a.prototype.dispose.call(this),this._filter.disconnect(),this._filter=null,this._frequencyValues.disconnect(),this._frequencyValues=null,this._delay.dispose(),this._delay=null,this._sub.disconnect(),this._sub=
null,this._abs.dispose(),this._abs=null,this._mult.dispose(),this._mult=null,this._curve=null,this},a.Follower})(b);(function(a){return a.ScaledEnvelope=function(){var b=this.optionsObject(arguments,["attack","decay","sustain","release"],a.Envelope.defaults);a.Envelope.call(this,b);b=this.defaultArg(b,a.ScaledEnvelope.defaults);this._exp=this.output=new a.Pow(b.exponent);this._scale=this.output=new a.Scale(b.min,b.max);this._sig.chain(this._exp,this._scale)},a.extend(a.ScaledEnvelope,a.Envelope),
a.ScaledEnvelope.defaults={min:0,max:1,exponent:1},Object.defineProperty(a.ScaledEnvelope.prototype,"min",{get:function(){return this._scale.min},set:function(a){this._scale.min=a}}),Object.defineProperty(a.ScaledEnvelope.prototype,"max",{get:function(){return this._scale.max},set:function(a){this._scale.max=a}}),Object.defineProperty(a.ScaledEnvelope.prototype,"exponent",{get:function(){return this._exp.value},set:function(a){this._exp.value=a}}),a.ScaledEnvelope.prototype.dispose=function(){return a.Envelope.prototype.dispose.call(this),
this._scale.dispose(),this._scale=null,this._exp.dispose(),this._exp=null,this},a.ScaledEnvelope})(b);(function(a){return a.FrequencyEnvelope=function(){var b=this.optionsObject(arguments,["attack","decay","sustain","release"],a.Envelope.defaults);a.ScaledEnvelope.call(this,b);b=this.defaultArg(b,a.FrequencyEnvelope.defaults);this._octaves=b.octaves;this.baseFrequency=b.baseFrequency;this.octaves=b.octaves},a.extend(a.FrequencyEnvelope,a.Envelope),a.FrequencyEnvelope.defaults={baseFrequency:200,octaves:4,
exponent:2},Object.defineProperty(a.FrequencyEnvelope.prototype,"baseFrequency",{get:function(){return this._scale.min},set:function(a){this._scale.min=this.toFrequency(a);this.octaves=this._octaves}}),Object.defineProperty(a.FrequencyEnvelope.prototype,"octaves",{get:function(){return this._octaves},set:function(a){this._octaves=a;this._scale.max=this.baseFrequency*Math.pow(2,a)}}),Object.defineProperty(a.FrequencyEnvelope.prototype,"exponent",{get:function(){return this._exp.value},set:function(a){this._exp.value=
a}}),a.FrequencyEnvelope.prototype.dispose=function(){return a.ScaledEnvelope.prototype.dispose.call(this),this},a.FrequencyEnvelope})(b);(function(a){return a.Gate=function(){this.createInsOuts(1,1);var b=this.optionsObject(arguments,["threshold","attack","release"],a.Gate.defaults);this._follower=new a.Follower(b.attack,b.release);this._gt=new a.GreaterThan(this.dbToGain(b.threshold));this.input.connect(this.output);this.input.chain(this._gt,this._follower,this.output.gain)},a.extend(a.Gate),a.Gate.defaults=
{attack:.1,release:.1,threshold:-40},Object.defineProperty(a.Gate.prototype,"threshold",{get:function(){return this.gainToDb(this._gt.value)},set:function(a){this._gt.value=this.dbToGain(a)}}),Object.defineProperty(a.Gate.prototype,"attack",{get:function(){return this._follower.attack},set:function(a){this._follower.attack=a}}),Object.defineProperty(a.Gate.prototype,"release",{get:function(){return this._follower.release},set:function(a){this._follower.release=a}}),a.Gate.prototype.dispose=function(){return a.prototype.dispose.call(this),
this._follower.dispose(),this._gt.dispose(),this._follower=null,this._gt=null,this},a.Gate})(b);(function(a){return a.TimelineState=function(b){a.Timeline.call(this);this._initial=b},a.extend(a.TimelineState,a.Timeline),a.TimelineState.prototype.getValueAtTime=function(a){a=this.get(a);return null!==a?a.state:this._initial},a.TimelineState.prototype.setStateAtTime=function(a,b){this.add({state:a,time:b})},a.TimelineState})(b);(function(a){return a.Emitter=function(){this._events={}},a.extend(a.Emitter),
a.Emitter.prototype.on=function(a,b){var c,d=a.split(/\W+/);for(c=0;c<d.length;c++){var g=d[c];this._events.hasOwnProperty(g)||(this._events[g]=[]);this._events[g].push(b)}return this},a.Emitter.prototype.off=function(b,d){var c,f,g=b.split(/\W+/);for(c=0;c<g.length;c++)if(b=g[c],this._events.hasOwnProperty(b))if(a.prototype.isUndef(d))this._events[b]=[];else{var h=this._events[b];for(f=0;f<h.length;f++)h[f]===d&&h.splice(f,1)}return this},a.Emitter.prototype.emit=function(a){var b,c;if(this._events&&
(b=Array.prototype.slice.call(arguments,1),this._events.hasOwnProperty(a))){var f=this._events[a];var g=0;for(c=f.length;g<c;g++)f[g].apply(this,b)}return this},a.Emitter.mixin=function(b){var c,e=["on","off","emit"];b._events={};for(c=0;c<e.length;c++){var f=e[c];var g=a.Emitter.prototype[f];b[f]=g}},a.Emitter.prototype.dispose=function(){return a.prototype.dispose.call(this),this._events=null,this},a.Emitter})(b);(function(a){var b,d,e,f,g;return a.Clock=function(){a.Emitter.call(this);var b=this.optionsObject(arguments,
["callback","frequency"],a.Clock.defaults);this.callback=b.callback;this._nextTick=0;this._lastState=a.State.Stopped;this.frequency=new a.TimelineSignal(b.frequency,a.Type.Frequency);this._readOnly("frequency");this.ticks=0;this._state=new a.TimelineState(a.State.Stopped);this._boundLoop=this._loop.bind(this);a.Clock._worker.addEventListener("message",this._boundLoop)},a.extend(a.Clock,a.Emitter),a.Clock.defaults={callback:a.noOp,frequency:1,lookAhead:"auto"},Object.defineProperty(a.Clock.prototype,
"state",{get:function(){return this._state.getValueAtTime(this.now())}}),a.Clock.prototype.start=function(b,c){return b=this.toSeconds(b),this._state.getValueAtTime(b)!==a.State.Started&&this._state.add({state:a.State.Started,time:b,offset:c}),this},a.Clock.prototype.stop=function(b){return b=this.toSeconds(b),this._state.cancel(b),this._state.setStateAtTime(a.State.Stopped,b),this},a.Clock.prototype.pause=function(b){return b=this.toSeconds(b),this._state.getValueAtTime(b)===a.State.Started&&this._state.setStateAtTime(a.State.Paused,
b),this},a.Clock.prototype._loop=function(){for(var b,c,d,e=this.now()+a.Clock.lookAhead+a.Clock.updateInterval+2*a.Clock.lag;e>this._nextTick&&this._state;)b=this._state.getValueAtTime(this._nextTick),b!==this._lastState&&(this._lastState=b,c=this._state.get(this._nextTick),b===a.State.Started?(this._nextTick=c.time,this.isUndef(c.offset)||(this.ticks=c.offset),this.emit("start",c.time,this.ticks)):b===a.State.Stopped?(this.ticks=0,this.emit("stop",c.time)):b===a.State.Paused&&this.emit("pause",
c.time)),d=this._nextTick,this.frequency&&(this._nextTick+=1/this.frequency.getValueAtTime(this._nextTick),b===a.State.Started&&(this.callback(d),this.ticks++))},a.Clock.prototype.getStateAtTime=function(a){return a=this.toSeconds(a),this._state.getValueAtTime(a)},a.Clock.prototype.dispose=function(){a.Emitter.prototype.dispose.call(this);a.Clock._worker.removeEventListener("message",this._boundLoop);this._writable("frequency");this.frequency.dispose();this._boundLoop=this.frequency=null;this._nextTick=
1/0;this.callback=null;this._state.dispose();this._state=null},window.URL=window.URL||window.webkitURL,a.Clock._lookAhead=.1,a.Clock._updateInterval=a.Clock._lookAhead/3,b=new Blob(["var timeoutTime = "+1E3*a.Clock._updateInterval+";self.onmessage = function(msg){\ttimeoutTime = parseInt(msg.data);};function tick(){\tsetTimeout(tick, timeoutTime);\tself.postMessage('tick');}tick();"]),d=URL.createObjectURL(b),a.Clock._worker=new Worker(d),e=-1,f=0,a.Clock._worker.addEventListener("message",function(){var b,
c=a.now();-1!==e&&(b=c-e,f=Math.max(b,.97*f));e=c}),Object.defineProperty(a.Clock,"lag",{get:function(){return Math.max(f-a.Clock._updateInterval,0)}}),Object.defineProperty(a.Clock,"lookAhead",{get:function(){return a.Clock._lookAhead},set:function(b){a.Clock._lookAhead=b}}),Object.defineProperty(a.Clock,"updateInterval",{get:function(){return a.Clock._updateInterval},set:function(b){a.Clock._updateInterval=Math.max(b,.01);a.Clock._worker.postMessage(1E3*b)}}),g="interactive",Object.defineProperty(a.Clock,
"latencyHint",{get:function(){return g},set:function(b){var c=b;if(g=b,a.prototype.isString(b))switch(b){case "interactive":c=.1;a.context.latencyHint=b;break;case "playback":c=.8;a.context.latencyHint=b;break;case "balanced":c=.25;a.context.latencyHint=b;break;case "fastest":c=.01}a.Clock.lookAhead=c;a.Clock.updateInterval=c/3}}),a._initAudioContext(function(){e=-1;f=0}),a.Clock})(b);(function(a){a.IntervalTimeline=function(){this._root=null;this._length=0};a.extend(a.IntervalTimeline);a.IntervalTimeline.prototype.add=
function(a){if(this.isUndef(a.time)||this.isUndef(a.duration))throw Error("Tone.IntervalTimeline: events must have time and duration parameters");a=new b(a.time,a.time+a.duration,a);null===this._root?this._root=a:this._root.insert(a);for(this._length++;null!==a;)a.updateHeight(),a.updateMax(),this._rebalance(a),a=a.parent;return this};a.IntervalTimeline.prototype.remove=function(a){var b,c;if(null!==this._root){var d=[];this._root.search(a.time,d);for(b=0;b<d.length;b++)if(c=d[b],c.event===a){this._removeNode(c);
this._length--;break}}return this};Object.defineProperty(a.IntervalTimeline.prototype,"length",{get:function(){return this._length}});a.IntervalTimeline.prototype.cancel=function(a){return this.forEachAfter(a,function(a){this.remove(a)}.bind(this)),this};a.IntervalTimeline.prototype._setRoot=function(a){this._root=a;null!==this._root&&(this._root.parent=null)};a.IntervalTimeline.prototype._replaceNodeInParent=function(a,b){null!==a.parent?(a.isLeftChild()?a.parent.left=b:a.parent.right=b,this._rebalance(a.parent)):
this._setRoot(b)};a.IntervalTimeline.prototype._removeNode=function(a){var b;if(null===a.left&&null===a.right)this._replaceNodeInParent(a,null);else if(null===a.right)this._replaceNodeInParent(a,a.left);else if(null===a.left)this._replaceNodeInParent(a,a.right);else{if(b=a.getBalance(),0<b)if(null===a.left.right){b=a.left;b.right=a.right;var c=b}else{for(b=a.left.right;null!==b.right;)b=b.right;b.parent.right=b.left;c=b.parent;b.left=a.left;b.right=a.right}else if(null===a.right.left)b=a.right,b.left=
a.left,c=b;else{for(b=a.right.left;null!==b.left;)b=b.left;b.parent=b.parent;b.parent.left=b.right;c=b.parent;b.left=a.left;b.right=a.right}null!==a.parent?a.isLeftChild()?a.parent.left=b:a.parent.right=b:this._setRoot(b);this._rebalance(c)}a.dispose()};a.IntervalTimeline.prototype._rotateLeft=function(a){var b=a.parent,c=a.isLeftChild(),d=a.right;a.right=d.left;d.left=a;null!==b?c?b.left=d:b.right=d:this._setRoot(d)};a.IntervalTimeline.prototype._rotateRight=function(a){var b=a.parent,c=a.isLeftChild(),
d=a.left;a.left=d.right;d.right=a;null!==b?c?b.left=d:b.right=d:this._setRoot(d)};a.IntervalTimeline.prototype._rebalance=function(a){var b=a.getBalance();1<b?0>a.left.getBalance()?this._rotateLeft(a.left):this._rotateRight(a):-1>b&&(0<a.right.getBalance()?this._rotateRight(a.right):this._rotateLeft(a))};a.IntervalTimeline.prototype.get=function(a){var b,c;if(null!==this._root&&(b=[],this._root.search(a,b),0<b.length)){a=b[0];for(c=1;c<b.length;c++)b[c].low>a.low&&(a=b[c]);return a.event}return null};
a.IntervalTimeline.prototype.forEach=function(a){var b,c;if(null!==this._root){var d=[];null!==this._root&&this._root.traverse(function(a){d.push(a)});for(b=0;b<d.length;b++)(c=d[b].event)&&a(c)}return this};a.IntervalTimeline.prototype.forEachAtTime=function(a,b){var c,d;if(null!==this._root){var e=[];this._root.search(a,e);for(c=e.length-1;0<=c;c--)(d=e[c].event)&&b(d)}return this};a.IntervalTimeline.prototype.forEachAfter=function(a,b){var c,d;if(null!==this._root){var e=[];this._root.searchAfter(a,
e);for(c=e.length-1;0<=c;c--)(d=e[c].event)&&b(d)}return this};a.IntervalTimeline.prototype.dispose=function(){var a,b=[];null!==this._root&&this._root.traverse(function(a){b.push(a)});for(a=0;a<b.length;a++)b[a].dispose();return b=null,this._root=null,this};var b=function(a,b,c){this.event=c;this.low=a;this.max=this.high=b;this.parent=this._right=this._left=null;this.height=0};return b.prototype.insert=function(a){a.low<=this.low?null===this.left?this.left=a:this.left.insert(a):null===this.right?
this.right=a:this.right.insert(a)},b.prototype.search=function(a,b){a>this.max||(null!==this.left&&this.left.search(a,b),this.low<=a&&this.high>a&&b.push(this),this.low>a||null!==this.right&&this.right.search(a,b))},b.prototype.searchAfter=function(a,b){this.low>=a&&(b.push(this),null!==this.left&&this.left.searchAfter(a,b));null!==this.right&&this.right.searchAfter(a,b)},b.prototype.traverse=function(a){a(this);null!==this.left&&this.left.traverse(a);null!==this.right&&this.right.traverse(a)},b.prototype.updateHeight=
function(){null!==this.left&&null!==this.right?this.height=Math.max(this.left.height,this.right.height)+1:null!==this.right?this.height=this.right.height+1:null!==this.left?this.height=this.left.height+1:this.height=0},b.prototype.updateMax=function(){this.max=this.high;null!==this.left&&(this.max=Math.max(this.max,this.left.max));null!==this.right&&(this.max=Math.max(this.max,this.right.max))},b.prototype.getBalance=function(){var a=0;return null!==this.left&&null!==this.right?a=this.left.height-
this.right.height:null!==this.left?a=this.left.height+1:null!==this.right&&(a=-(this.right.height+1)),a},b.prototype.isLeftChild=function(){return null!==this.parent&&this.parent.left===this},Object.defineProperty(b.prototype,"left",{get:function(){return this._left},set:function(a){this._left=a;null!==a&&(a.parent=this);this.updateHeight();this.updateMax()}}),Object.defineProperty(b.prototype,"right",{get:function(){return this._right},set:function(a){this._right=a;null!==a&&(a.parent=this);this.updateHeight();
this.updateMax()}}),b.prototype.dispose=function(){this.event=this._right=this._left=this.parent=null},a.IntervalTimeline})(b);(function(a){a.Transport=function(){a.Emitter.call(this);this.loop=!1;this._loopEnd=this._loopStart=0;this._ppq=b.defaults.PPQ;this._clock=new a.Clock({callback:this._processTick.bind(this),frequency:0});this._bindClockEvents();this.bpm=this._clock.frequency;this.bpm._toUnits=this._toUnits.bind(this);this.bpm._fromUnits=this._fromUnits.bind(this);this.bpm.units=a.Type.BPM;
this.bpm.value=b.defaults.bpm;this._readOnly("bpm");this._timeSignature=b.defaults.timeSignature;this._scheduledEvents={};this._eventID=0;this._timeline=new a.Timeline;this._repeatedEvents=new a.IntervalTimeline;this._onceEvents=new a.Timeline;this._syncedSignals=[];this._swingTicks=b.defaults.PPQ/2;this._swingAmount=0};a.extend(a.Transport,a.Emitter);a.Transport.defaults={bpm:120,swing:0,swingSubdivision:"8n",timeSignature:4,loopStart:0,loopEnd:"4m",PPQ:192};a.Transport.prototype._processTick=function(b){var c,
d,g=this._clock.ticks;0<this._swingAmount&&0!==g%this._ppq&&0!==g%(2*this._swingTicks)&&(c=g%(2*this._swingTicks)/(2*this._swingTicks),d=Math.sin(c*Math.PI)*this._swingAmount,b+=a.Time(2*this._swingTicks/3,"i").eval()*d);this.loop&&g===this._loopEnd&&(this.emit("loopEnd",b),this._clock.ticks=this._loopStart,g=this._loopStart,this.emit("loopStart",b,this.seconds),this.emit("loop",b));this._onceEvents.forEachBefore(g,function(a){a.callback(b);delete this._scheduledEvents[a.id.toString()]}.bind(this));
this._onceEvents.cancelBefore(g);this._timeline.forEachAtTime(g,function(a){a.callback(b)});this._repeatedEvents.forEachAtTime(g,function(a){0===(g-a.time)%a.interval&&a.callback(b)})};a.Transport.prototype.schedule=function(a,b){var c={time:this.toTicks(b),callback:a},d=this._eventID++;return this._scheduledEvents[d.toString()]={event:c,timeline:this._timeline},this._timeline.add(c),d};a.Transport.prototype.scheduleRepeat=function(a,b,c,g){var d,e;if(0>=b)throw Error("Tone.Transport: repeat events must have an interval larger than 0");
return d={time:this.toTicks(c),duration:this.toTicks(this.defaultArg(g,1/0)),interval:this.toTicks(b),callback:a},e=this._eventID++,this._scheduledEvents[e.toString()]={event:d,timeline:this._repeatedEvents},this._repeatedEvents.add(d),e};a.Transport.prototype.scheduleOnce=function(a,b){var c=this._eventID++,d={time:this.toTicks(b),callback:a,id:c};return this._scheduledEvents[c.toString()]={event:d,timeline:this._onceEvents},this._onceEvents.add(d),c};a.Transport.prototype.clear=function(a){if(this._scheduledEvents.hasOwnProperty(a)){var b=
this._scheduledEvents[a.toString()];b.timeline.remove(b.event);delete this._scheduledEvents[a.toString()]}return this};a.Transport.prototype.cancel=function(a){return a=this.defaultArg(a,0),a=this.toTicks(a),this._timeline.cancel(a),this._onceEvents.cancel(a),this._repeatedEvents.cancel(a),this};a.Transport.prototype._bindClockEvents=function(){this._clock.on("start",function(b,c){c=a.Time(this._clock.ticks,"i").toSeconds();this.emit("start",b,c)}.bind(this));this._clock.on("stop",function(a){this.emit("stop",
a)}.bind(this));this._clock.on("pause",function(a){this.emit("pause",a)}.bind(this))};Object.defineProperty(a.Transport.prototype,"state",{get:function(){return this._clock.getStateAtTime(this.now())}});a.Transport.prototype.start=function(a,b){return this.isUndef(b)||(b=this.toTicks(b)),this._clock.start(a,b),this};a.Transport.prototype.stop=function(a){return this._clock.stop(a),this};a.Transport.prototype.pause=function(a){return this._clock.pause(a),this};Object.defineProperty(a.Transport.prototype,
"timeSignature",{get:function(){return this._timeSignature},set:function(a){this.isArray(a)&&(a=a[0]/a[1]*4);this._timeSignature=a}});Object.defineProperty(a.Transport.prototype,"loopStart",{get:function(){return a.TransportTime(this._loopStart,"i").toSeconds()},set:function(a){this._loopStart=this.toTicks(a)}});Object.defineProperty(a.Transport.prototype,"loopEnd",{get:function(){return a.TransportTime(this._loopEnd,"i").toSeconds()},set:function(a){this._loopEnd=this.toTicks(a)}});a.Transport.prototype.setLoopPoints=
function(a,b){return this.loopStart=a,this.loopEnd=b,this};Object.defineProperty(a.Transport.prototype,"swing",{get:function(){return this._swingAmount},set:function(a){this._swingAmount=a}});Object.defineProperty(a.Transport.prototype,"swingSubdivision",{get:function(){return a.Time(this._swingTicks,"i").toNotation()},set:function(a){this._swingTicks=this.toTicks(a)}});Object.defineProperty(a.Transport.prototype,"position",{get:function(){return a.TransportTime(this.ticks,"i").toBarsBeatsSixteenths()},
set:function(a){this.ticks=this.toTicks(a)}});Object.defineProperty(a.Transport.prototype,"seconds",{get:function(){return a.TransportTime(this.ticks,"i").toSeconds()},set:function(a){this.ticks=this.toTicks(a)}});Object.defineProperty(a.Transport.prototype,"progress",{get:function(){return this.loop?(this.ticks-this._loopStart)/(this._loopEnd-this._loopStart):0}});Object.defineProperty(a.Transport.prototype,"ticks",{get:function(){return this._clock.ticks},set:function(b){var c=this.now();this.state===
a.State.Started?(this.emit("stop",c),this._clock.ticks=b,this.emit("start",c,this.seconds)):this._clock.ticks=b}});Object.defineProperty(a.Transport.prototype,"PPQ",{get:function(){return this._ppq},set:function(a){var b=this.bpm.value;this._ppq=a;this.bpm.value=b}});Object.defineProperty(a.Transport.prototype,"latencyHint",{get:function(){return a.Clock.latencyHint},set:function(b){a.Clock.latencyHint=b}});a.Transport.prototype._fromUnits=function(a){return 1/(60/a/this.PPQ)};a.Transport.prototype._toUnits=
function(a){return a/this.PPQ*60};a.Transport.prototype.nextSubdivision=function(b){var c,d,g;return b=this.toSeconds(b),this.state!==a.State.Started?0:(c=this._clock._nextTick,d=a.Time(this.ticks,"i").eval(),g=b-d%b,0===g&&(g=b),c+g)};a.Transport.prototype.syncSignal=function(b,c){c||(c=0!==b._param.value?b._param.value/this.bpm._param.value:0);var d=new a.Gain(c);return this.bpm.chain(d,b._param),this._syncedSignals.push({ratio:d,signal:b,initial:b._param.value}),b._param.value=0,this};a.Transport.prototype.unsyncSignal=
function(a){var b;for(b=this._syncedSignals.length-1;0<=b;b--){var c=this._syncedSignals[b];c.signal===a&&(c.ratio.dispose(),c.signal._param.value=c.initial,this._syncedSignals.splice(b,1))}return this};a.Transport.prototype.dispose=function(){return a.Emitter.prototype.dispose.call(this),this._clock.dispose(),this._clock=null,this._writable("bpm"),this.bpm=null,this._timeline.dispose(),this._timeline=null,this._onceEvents.dispose(),this._onceEvents=null,this._repeatedEvents.dispose(),this._repeatedEvents=
null,this};var b=a.Transport;return a._initAudioContext(function(){if("function"==typeof a.Transport)a.Transport=new a.Transport;else{a.Transport.stop();var c=a.Transport.get();a.Transport.dispose();b.call(a.Transport);a.Transport.set(c)}}),a.Transport})(b);(function(a){return a.Volume=function(){var b=this.optionsObject(arguments,["volume"],a.Volume.defaults);this.output=this.input=new a.Gain(b.volume,a.Type.Decibels);this._unmutedVolume=0;this._muted=!1;this.volume=this.output.gain;this._readOnly("volume");
this.mute=b.mute},a.extend(a.Volume),a.Volume.defaults={volume:0,mute:!1},Object.defineProperty(a.Volume.prototype,"mute",{get:function(){return this._muted},set:function(a){!this._muted&&a?(this._unmutedVolume=this.volume.value,this.volume.value=-(1/0)):this._muted&&!a&&(this.volume.value=this._unmutedVolume);this._muted=a}}),a.Volume.prototype.dispose=function(){return this.input.dispose(),a.prototype.dispose.call(this),this._writable("volume"),this.volume.dispose(),this.volume=null,this},a.Volume})(b);
(function(a){a.Master=function(){this.createInsOuts(1,1);this._volume=this.output=new a.Volume;this.volume=this._volume.volume;this._readOnly("volume");this.input.chain(this.output,this.context.destination)};a.extend(a.Master);a.Master.defaults={volume:0,mute:!1};Object.defineProperty(a.Master.prototype,"mute",{get:function(){return this._volume.mute},set:function(a){this._volume.mute=a}});a.Master.prototype.chain=function(){this.input.disconnect();this.input.chain.apply(this.input,arguments);arguments[arguments.length-
1].connect(this.output)};a.Master.prototype.dispose=function(){a.prototype.dispose.call(this);this._writable("volume");this._volume.dispose();this.volume=this._volume=null};a.prototype.toMaster=function(){return this.connect(a.Master),this};AudioNode.prototype.toMaster=function(){return this.connect(a.Master),this};var b=a.Master;return a._initAudioContext(function(){a.prototype.isUndef(a.Master)?(b.prototype.dispose.call(a.Master),b.call(a.Master)):a.Master=new b}),a.Master})(b);(function(a){return a.Source=
function(b){b=this.defaultArg(b,a.Source.defaults);this._volume=this.output=new a.Volume(b.volume);this.volume=this._volume.volume;this._readOnly("volume");this._state=new a.TimelineState(a.State.Stopped);this._state.memory=10;this._synced=!1;this._scheduled=[];this._volume.output.output.channelCount=2;this._volume.output.output.channelCountMode="explicit";this.mute=b.mute},a.extend(a.Source),a.Source.defaults={volume:0,mute:!1},Object.defineProperty(a.Source.prototype,"state",{get:function(){return this._synced?
a.Transport.state===a.State.Started?this._state.getValueAtTime(a.Transport.seconds):a.State.Stopped:this._state.getValueAtTime(this.now())}}),Object.defineProperty(a.Source.prototype,"mute",{get:function(){return this._volume.mute},set:function(a){this._volume.mute=a}}),a.Source.prototype._start=a.noOp,a.Source.prototype._stop=a.noOp,a.Source.prototype.start=function(b,d,e){var c,g;return b=this.isUndef(b)&&this._synced?a.Transport.seconds:this.toSeconds(b),this.retrigger||this._state.getValueAtTime(b)!==
a.State.Started||this.stop(b),this._state.setStateAtTime(a.State.Started,b),this._synced?(c=this._state.get(b),c.offset=this.defaultArg(d,0),c.duration=e,g=a.Transport.schedule(function(a){this._start(a,d,e)}.bind(this),b),this._scheduled.push(g)):this._start.apply(this,arguments),this},a.Source.prototype.stop=function(b){if(b=this.isUndef(b)&&this._synced?a.Transport.seconds:this.toSeconds(b),this._state.cancel(b),this._state.setStateAtTime(a.State.Stopped,b),this._synced){var c=a.Transport.schedule(this._stop.bind(this),
b);this._scheduled.push(c)}else this._stop.apply(this,arguments);return this},a.Source.prototype.sync=function(){return this._synced=!0,a.Transport.on("start loopStart",function(b,d){var c,f,g;0<d&&(c=this._state.get(d),c&&c.state===a.State.Started&&c.time!==d&&(f=d-this.toSeconds(c.time),c.duration&&(g=this.toSeconds(c.duration)-f),this._start(b,this.toSeconds(c.offset)+f,g)))}.bind(this)),a.Transport.on("stop pause loopEnd",function(b){this._state.getValueAtTime(a.Transport.seconds)===a.State.Started&&
this._stop(b)}.bind(this)),this},a.Source.prototype.unsync=function(){var b;this._synced=!1;a.Transport.off("start stop pause loopEnd loopStart");for(b=0;b<this._scheduled.length;b++){var d=this._scheduled[b];a.Transport.clear(d)}return this._scheduled=[],this._state.cancel(0),this},a.Source.prototype.dispose=function(){a.prototype.dispose.call(this);this.unsync();this._scheduled=null;this._writable("volume");this._volume.dispose();this.volume=this._volume=null;this._state.dispose();this._state=null},
a.Source})(b);(function(a){return a.Oscillator=function(){var b=this.optionsObject(arguments,["frequency","type"],a.Oscillator.defaults);a.Source.call(this,b);this._oscillator=null;this.frequency=new a.Signal(b.frequency,a.Type.Frequency);this.detune=new a.Signal(b.detune,a.Type.Cents);this._wave=null;this._partials=this.defaultArg(b.partials,[1]);this._phase=b.phase;this._type=null;this.type=b.type;this.phase=this._phase;this._readOnly(["frequency","detune"])},a.extend(a.Oscillator,a.Source),a.Oscillator.defaults=
{type:"sine",frequency:440,detune:0,phase:0,partials:[]},a.Oscillator.Type={Sine:"sine",Triangle:"triangle",Sawtooth:"sawtooth",Square:"square",Custom:"custom"},a.Oscillator.prototype._start=function(a){this._oscillator=this.context.createOscillator();this._oscillator.setPeriodicWave(this._wave);this._oscillator.connect(this.output);this.frequency.connect(this._oscillator.frequency);this.detune.connect(this._oscillator.detune);this._oscillator.start(this.toSeconds(a))},a.Oscillator.prototype._stop=
function(a){return this._oscillator&&(this._oscillator.stop(this.toSeconds(a)),this._oscillator=null),this},a.Oscillator.prototype.syncFrequency=function(){return a.Transport.syncSignal(this.frequency),this},a.Oscillator.prototype.unsyncFrequency=function(){return a.Transport.unsyncSignal(this.frequency),this},Object.defineProperty(a.Oscillator.prototype,"type",{get:function(){return this._type},set:function(a){var b=this._getRealImaginary(a,this._phase);this._wave=this.context.createPeriodicWave(b[0],
b[1]);null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave);this._type=a}}),a.Oscillator.prototype._getRealImaginary=function(b,d){var c,f,g=2048,h=new Float32Array(g),k=new Float32Array(g),l=1;b===a.Oscillator.Type.Custom?(l=this._partials.length+1,g=l):(c=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(b),c&&(l=parseInt(c[2])+1,b=c[1],l=Math.max(l,2),g=l));for(c=1;c<g;++c){switch(f=2/(c*Math.PI),b){case a.Oscillator.Type.Sine:f=c<=l?1:0;break;case a.Oscillator.Type.Square:f=1&c?2*
f:0;break;case a.Oscillator.Type.Sawtooth:f*=1&c?1:-1;break;case a.Oscillator.Type.Triangle:f=1&c?2*f*f*(c-1>>1&1?-1:1):0;break;case a.Oscillator.Type.Custom:f=this._partials[c-1];break;default:throw new TypeError("Tone.Oscillator: invalid type: "+b);}0!==f?(h[c]=-f*Math.sin(d*c),k[c]=f*Math.cos(d*c)):(h[c]=0,k[c]=0)}return[h,k]},a.Oscillator.prototype._inverseFFT=function(a,b,e){var c,d=0,h=a.length;for(c=0;c<h;c++)d+=a[c]*Math.cos(c*e)+b[c]*Math.sin(c*e);return d},a.Oscillator.prototype._getInitialValue=
function(){var a=this._getRealImaginary(this._type,0);var b=a[0],e=a[1],f=0,g=2*Math.PI;for(a=0;8>a;a++)f=Math.max(this._inverseFFT(b,e,a/8*g),f);return-this._inverseFFT(b,e,this._phase)/f},Object.defineProperty(a.Oscillator.prototype,"partials",{get:function(){return this._type!==a.Oscillator.Type.Custom?[]:this._partials},set:function(b){this._partials=b;this.type=a.Oscillator.Type.Custom}}),Object.defineProperty(a.Oscillator.prototype,"phase",{get:function(){return 180/Math.PI*this._phase},set:function(a){this._phase=
a*Math.PI/180;this.type=this._type}}),a.Oscillator.prototype.dispose=function(){return a.Source.prototype.dispose.call(this),null!==this._oscillator&&(this._oscillator.disconnect(),this._oscillator=null),this._wave=null,this._writable(["frequency","detune"]),this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this._partials=null,this},a.Oscillator})(b);(function(a){return a.Zero=function(){this._gain=this.input=this.output=new a.Gain;a.Zero._zeros.connect(this._gain)},
a.extend(a.Zero),a.Zero.prototype.dispose=function(){return a.prototype.dispose.call(this),this._gain.dispose(),this._gain=null,this},a.Zero._zeros=null,a._initAudioContext(function(b){var c,e=b.createBuffer(1,128,b.sampleRate),f=e.getChannelData(0);for(c=0;c<f.length;c++)f[c]=0;a.Zero._zeros=b.createBufferSource();a.Zero._zeros.channelCount=1;a.Zero._zeros.channelCountMode="explicit";a.Zero._zeros.buffer=e;a.Zero._zeros.loop=!0;a.Zero._zeros.start(0);a.Zero._zeros.noGC()}),a.Zero})(b);(function(a){return a.LFO=
function(){var b=this.optionsObject(arguments,["frequency","min","max"],a.LFO.defaults);this._oscillator=new a.Oscillator({frequency:b.frequency,type:b.type});this.frequency=this._oscillator.frequency;this.amplitude=this._oscillator.volume;this.amplitude.units=a.Type.NormalRange;this.amplitude.value=b.amplitude;this._stoppedSignal=new a.Signal(0,a.Type.AudioRange);this._zeros=new a.Zero;this._stoppedValue=0;this._a2g=new a.AudioToGain;this._scaler=this.output=new a.Scale(b.min,b.max);this._units=
a.Type.Default;this.units=b.units;this._oscillator.chain(this._a2g,this._scaler);this._zeros.connect(this._a2g);this._stoppedSignal.connect(this._a2g);this._readOnly(["amplitude","frequency"]);this.phase=b.phase},a.extend(a.LFO,a.Oscillator),a.LFO.defaults={type:"sine",min:0,max:1,phase:0,frequency:"4n",amplitude:1,units:a.Type.Default},a.LFO.prototype.start=function(a){return a=this.toSeconds(a),this._stoppedSignal.setValueAtTime(0,a),this._oscillator.start(a),this},a.LFO.prototype.stop=function(a){return a=
this.toSeconds(a),this._stoppedSignal.setValueAtTime(this._stoppedValue,a),this._oscillator.stop(a),this},a.LFO.prototype.sync=function(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this},a.LFO.prototype.unsync=function(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this},Object.defineProperty(a.LFO.prototype,"min",{get:function(){return this._toUnits(this._scaler.min)},set:function(a){a=this._fromUnits(a);this._scaler.min=a}}),Object.defineProperty(a.LFO.prototype,
"max",{get:function(){return this._toUnits(this._scaler.max)},set:function(a){a=this._fromUnits(a);this._scaler.max=a}}),Object.defineProperty(a.LFO.prototype,"type",{get:function(){return this._oscillator.type},set:function(a){this._oscillator.type=a;this._stoppedValue=this._oscillator._getInitialValue();this._stoppedSignal.value=this._stoppedValue}}),Object.defineProperty(a.LFO.prototype,"phase",{get:function(){return this._oscillator.phase},set:function(a){this._oscillator.phase=a;this._stoppedValue=
this._oscillator._getInitialValue();this._stoppedSignal.value=this._stoppedValue}}),Object.defineProperty(a.LFO.prototype,"units",{get:function(){return this._units},set:function(a){var b=this.min,c=this.max;this._units=a;this.min=b;this.max=c}}),Object.defineProperty(a.LFO.prototype,"mute",{get:function(){return this._oscillator.mute},set:function(a){this._oscillator.mute=a}}),Object.defineProperty(a.LFO.prototype,"state",{get:function(){return this._oscillator.state}}),a.LFO.prototype.connect=function(b){return b.constructor!==
a.Signal&&b.constructor!==a.Param&&b.constructor!==a.TimelineSignal||(this.convert=b.convert,this.units=b.units),a.Signal.prototype.connect.apply(this,arguments),this},a.LFO.prototype._fromUnits=a.Param.prototype._fromUnits,a.LFO.prototype._toUnits=a.Param.prototype._toUnits,a.LFO.prototype.dispose=function(){return a.prototype.dispose.call(this),this._writable(["amplitude","frequency"]),this._oscillator.dispose(),this._oscillator=null,this._stoppedSignal.dispose(),this._stoppedSignal=null,this._zeros.dispose(),
this._zeros=null,this._scaler.dispose(),this._scaler=null,this._a2g.dispose(),this._a2g=null,this.frequency=null,this.amplitude=null,this},a.LFO})(b);(function(a){return a.Limiter=function(){var b=this.optionsObject(arguments,["threshold"],a.Limiter.defaults);this._compressor=this.input=this.output=new a.Compressor({attack:.001,decay:.001,threshold:b.threshold});this.threshold=this._compressor.threshold;this._readOnly("threshold")},a.extend(a.Limiter),a.Limiter.defaults={threshold:-12},a.Limiter.prototype.dispose=
function(){return a.prototype.dispose.call(this),this._compressor.dispose(),this._compressor=null,this._writable("threshold"),this.threshold=null,this},a.Limiter})(b);(function(a){return a.LowpassCombFilter=function(){this.createInsOuts(1,1);var b=this.optionsObject(arguments,["delayTime","resonance","dampening"],a.LowpassCombFilter.defaults);this._delay=this.input=new a.Delay(b.delayTime);this.delayTime=this._delay.delayTime;this._lowpass=this.output=this.context.createBiquadFilter();this._lowpass.Q.value=
-3.0102999566398125;this._lowpass.type="lowpass";this.dampening=new a.Param({param:this._lowpass.frequency,units:a.Type.Frequency,value:b.dampening});this._feedback=new a.Gain(b.resonance,a.Type.NormalRange);this.resonance=this._feedback.gain;this._delay.chain(this._lowpass,this._feedback,this._delay);this._readOnly(["dampening","resonance","delayTime"])},a.extend(a.LowpassCombFilter),a.LowpassCombFilter.defaults={delayTime:.1,resonance:.5,dampening:3E3},a.LowpassCombFilter.prototype.dispose=function(){return a.prototype.dispose.call(this),
this._writable(["dampening","resonance","delayTime"]),this.dampening.dispose(),this.dampening=null,this.resonance.dispose(),this.resonance=null,this._delay.dispose(),this._delay=null,this.delayTime=null,this._lowpass.disconnect(),this._lowpass=null,this._feedback.disconnect(),this._feedback=null,this},a.LowpassCombFilter})(b);(function(a){return a.Merge=function(){this.createInsOuts(2,0);this.left=this.input[0]=new a.Gain;this.right=this.input[1]=new a.Gain;this._merger=this.output=this.context.createChannelMerger(2);
this.left.connect(this._merger,0,0);this.right.connect(this._merger,0,1);this.left.channelCount=1;this.right.channelCount=1;this.left.channelCountMode="explicit";this.right.channelCountMode="explicit"},a.extend(a.Merge),a.Merge.prototype.dispose=function(){return a.prototype.dispose.call(this),this.left.dispose(),this.left=null,this.right.dispose(),this.right=null,this._merger.disconnect(),this._merger=null,this},a.Merge})(b);(function(a){return a.Meter=function(){var b=this.optionsObject(arguments,
["type","smoothing"],a.Meter.defaults);this.type=b.type;this.input=this.output=this._analyser=new a.Analyser("waveform",512);this._analyser.returnType="float";this.smoothing=b.smoothing;this._lastValue=0},a.extend(a.Meter),a.Meter.Type={Level:"level",Signal:"signal"},a.Meter.defaults={smoothing:.8,type:a.Meter.Type.Level},Object.defineProperty(a.Meter.prototype,"value",{get:function(){var b,d,e,f,g=this._analyser.analyse();if(this.type===a.Meter.Type.Level){for(d=b=0;d<g.length;d++)b+=Math.pow(g[d],
2);return e=Math.sqrt(b/g.length),e=Math.max(e,this._lastValue*this.smoothing),this._lastValue=e,f=e/.35,Math.sqrt(f)}return g[0]}}),a.Meter.prototype.dispose=function(){return a.prototype.dispose.call(this),this._analyser.dispose(),this._analyser=null,this},a.Meter})(b);(function(a){return a.Split=function(){this.createInsOuts(0,2);this._splitter=this.input=this.context.createChannelSplitter(2);this.left=this.output[0]=new a.Gain;this.right=this.output[1]=new a.Gain;this._splitter.connect(this.left,
0,0);this._splitter.connect(this.right,1,0)},a.extend(a.Split),a.Split.prototype.dispose=function(){return a.prototype.dispose.call(this),this._splitter.disconnect(),this.left.dispose(),this.left=null,this.right.dispose(),this.right=null,this._splitter=null,this},a.Split})(b);(function(a){a.MidSideSplit=function(){this.createInsOuts(0,2);this._split=this.input=new a.Split;this.mid=this.output[0]=new a.Expr("($0 + $1) * $2");this.side=this.output[1]=new a.Expr("($0 - $1) * $2");this._split.connect(this.mid,
0,0);this._split.connect(this.mid,1,1);this._split.connect(this.side,0,0);this._split.connect(this.side,1,1);b.connect(this.mid,0,2);b.connect(this.side,0,2)};a.extend(a.MidSideSplit);var b=null;return a._initAudioContext(function(){b=new a.Signal(1/Math.sqrt(2))}),a.MidSideSplit.prototype.dispose=function(){return a.prototype.dispose.call(this),this.mid.dispose(),this.mid=null,this.side.dispose(),this.side=null,this._split.dispose(),this._split=null,this},a.MidSideSplit})(b);(function(a){a.MidSideMerge=
function(){this.createInsOuts(2,0);this.mid=this.input[0]=new a.Gain;this._left=new a.Expr("($0 + $1) * $2");this.side=this.input[1]=new a.Gain;this._right=new a.Expr("($0 - $1) * $2");this._merge=this.output=new a.Merge;this.mid.connect(this._left,0,0);this.side.connect(this._left,0,1);this.mid.connect(this._right,0,0);this.side.connect(this._right,0,1);this._left.connect(this._merge,0,0);this._right.connect(this._merge,0,1);b.connect(this._left,0,2);b.connect(this._right,0,2)};a.extend(a.MidSideMerge);
var b=null;return a._initAudioContext(function(){b=new a.Signal(1/Math.sqrt(2))}),a.MidSideMerge.prototype.dispose=function(){return a.prototype.dispose.call(this),this.mid.dispose(),this.mid=null,this.side.dispose(),this.side=null,this._left.dispose(),this._left=null,this._right.dispose(),this._right=null,this._merge.dispose(),this._merge=null,this},a.MidSideMerge})(b);(function(a){return a.MidSideCompressor=function(b){b=this.defaultArg(b,a.MidSideCompressor.defaults);this._midSideSplit=this.input=
new a.MidSideSplit;this._midSideMerge=this.output=new a.MidSideMerge;this.mid=new a.Compressor(b.mid);this.side=new a.Compressor(b.side);this._midSideSplit.mid.chain(this.mid,this._midSideMerge.mid);this._midSideSplit.side.chain(this.side,this._midSideMerge.side);this._readOnly(["mid","side"])},a.extend(a.MidSideCompressor),a.MidSideCompressor.defaults={mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},side:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10}},a.MidSideCompressor.prototype.dispose=
function(){return a.prototype.dispose.call(this),this._writable(["mid","side"]),this.mid.dispose(),this.mid=null,this.side.dispose(),this.side=null,this._midSideSplit.dispose(),this._midSideSplit=null,this._midSideMerge.dispose(),this._midSideMerge=null,this},a.MidSideCompressor})(b);(function(a){return a.Mono=function(){this.createInsOuts(1,0);this._merge=this.output=new a.Merge;this.input.connect(this._merge,0,0);this.input.connect(this._merge,0,1);this.input.gain.value=this.dbToGain(-10)},a.extend(a.Mono),
a.Mono.prototype.dispose=function(){return a.prototype.dispose.call(this),this._merge.dispose(),this._merge=null,this},a.Mono})(b);(function(a){return a.MultibandCompressor=function(b){b=this.defaultArg(arguments,a.MultibandCompressor.defaults);this._splitter=this.input=new a.MultibandSplit({lowFrequency:b.lowFrequency,highFrequency:b.highFrequency});this.lowFrequency=this._splitter.lowFrequency;this.highFrequency=this._splitter.highFrequency;this.output=new a.Gain;this.low=new a.Compressor(b.low);
this.mid=new a.Compressor(b.mid);this.high=new a.Compressor(b.high);this._splitter.low.chain(this.low,this.output);this._splitter.mid.chain(this.mid,this.output);this._splitter.high.chain(this.high,this.output);this._readOnly(["high","mid","low","highFrequency","lowFrequency"])},a.extend(a.MultibandCompressor),a.MultibandCompressor.defaults={low:a.Compressor.defaults,mid:a.Compressor.defaults,high:a.Compressor.defaults,lowFrequency:250,highFrequency:2E3},a.MultibandCompressor.prototype.dispose=function(){return a.prototype.dispose.call(this),
this._splitter.dispose(),this._writable(["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this._splitter=null,this.low=null,this.mid=null,this.high=null,this.lowFrequency=null,this.highFrequency=null,this},a.MultibandCompressor})(b);(function(a){return a.Panner=function(b){this._hasStereoPanner?(this._panner=this.input=this.output=this.context.createStereoPanner(),this.pan=this._panner.pan):(this._crossFade=new a.CrossFade,this._merger=
this.output=new a.Merge,this._splitter=this.input=new a.Split,this.pan=new a.Signal(0,a.Type.AudioRange),this._zero=new a.Zero,this._a2g=new a.AudioToGain,this._zero.connect(this._a2g),this.pan.chain(this._a2g,this._crossFade.fade),this._splitter.connect(this._crossFade,0,0),this._splitter.connect(this._crossFade,1,1),this._crossFade.a.connect(this._merger,0,0),this._crossFade.b.connect(this._merger,0,1));this.pan.value=this.defaultArg(b,0);this._readOnly("pan")},a.extend(a.Panner),a.Panner.prototype._hasStereoPanner=
a.prototype.isFunction(a.context.createStereoPanner),a.Panner.prototype.dispose=function(){return a.prototype.dispose.call(this),this._writable("pan"),this._hasStereoPanner?(this._panner.disconnect(),this._panner=null,this.pan=null):(this._zero.dispose(),this._zero=null,this._crossFade.dispose(),this._crossFade=null,this._splitter.dispose(),this._splitter=null,this._merger.dispose(),this._merger=null,this.pan.dispose(),this.pan=null,this._a2g.dispose(),this._a2g=null),this},a.Panner})(b);(function(a){return a.Panner3D=
function(){var b=this.optionsObject(arguments,["positionX","positionY","positionZ"],a.Panner3D.defaults);this._panner=this.input=this.output=this.context.createPanner();this._panner.panningModel=b.panningModel;this._panner.maxDistance=b.maxDistance;this._panner.distanceModel=b.distanceModel;this._panner.coneOuterGain=b.coneOuterGain;this._panner.coneOuterAngle=b.coneOuterAngle;this._panner.coneInnerAngle=b.coneInnerAngle;this._panner.refDistance=b.refDistance;this._panner.rolloffFactor=b.rolloffFactor;
this._orientation=[b.orientationX,b.orientationY,b.orientationZ];this._position=[b.positionX,b.positionY,b.positionZ];this.orientationX=b.orientationX;this.orientationY=b.orientationY;this.orientationZ=b.orientationZ;this.positionX=b.positionX;this.positionY=b.positionY;this.positionZ=b.positionZ},a.extend(a.Panner3D),a.Panner3D.defaults={positionX:0,positionY:0,positionZ:0,orientationX:0,orientationY:0,orientationZ:0,panningModel:"equalpower",maxDistance:1E4,distanceModel:"inverse",coneOuterGain:0,
coneOuterAngle:360,coneInnerAngle:360,refDistance:1,rolloffFactor:1},a.Panner3D.prototype._rampTimeConstant=.01,a.Panner3D.prototype.setPosition=function(a,b,e){if(this._panner.positionX){var c=this.now();this._panner.positionX.setTargetAtTime(a,c,this._rampTimeConstant);this._panner.positionY.setTargetAtTime(b,c,this._rampTimeConstant);this._panner.positionZ.setTargetAtTime(e,c,this._rampTimeConstant)}else this._panner.setPosition(a,b,e);return this._position=Array.prototype.slice.call(arguments),
this},a.Panner3D.prototype.setOrientation=function(a,b,e){if(this._panner.orientationX){var c=this.now();this._panner.orientationX.setTargetAtTime(a,c,this._rampTimeConstant);this._panner.orientationY.setTargetAtTime(b,c,this._rampTimeConstant);this._panner.orientationZ.setTargetAtTime(e,c,this._rampTimeConstant)}else this._panner.setOrientation(a,b,e);return this._orientation=Array.prototype.slice.call(arguments),this},Object.defineProperty(a.Panner3D.prototype,"positionX",{set:function(a){this._position[0]=
a;this.setPosition.apply(this,this._position)},get:function(){return this._position[0]}}),Object.defineProperty(a.Panner3D.prototype,"positionY",{set:function(a){this._position[1]=a;this.setPosition.apply(this,this._position)},get:function(){return this._position[1]}}),Object.defineProperty(a.Panner3D.prototype,"positionZ",{set:function(a){this._position[2]=a;this.setPosition.apply(this,this._position)},get:function(){return this._position[2]}}),Object.defineProperty(a.Panner3D.prototype,"orientationX",
{set:function(a){this._orientation[0]=a;this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[0]}}),Object.defineProperty(a.Panner3D.prototype,"orientationY",{set:function(a){this._orientation[1]=a;this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[1]}}),Object.defineProperty(a.Panner3D.prototype,"orientationZ",{set:function(a){this._orientation[2]=a;this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[2]}}),
a.Panner3D._aliasProperty=function(b){Object.defineProperty(a.Panner3D.prototype,b,{set:function(a){this._panner[b]=a},get:function(){return this._panner[b]}})},a.Panner3D._aliasProperty("panningModel"),a.Panner3D._aliasProperty("refDistance"),a.Panner3D._aliasProperty("rolloffFactor"),a.Panner3D._aliasProperty("distanceModel"),a.Panner3D._aliasProperty("coneInnerAngle"),a.Panner3D._aliasProperty("coneOuterAngle"),a.Panner3D._aliasProperty("coneOuterGain"),a.Panner3D._aliasProperty("maxDistance"),
a.Panner3D.prototype.dispose=function(){return this._panner.disconnect(),this._panner=null,this._orientation=null,this._position=null,this},a.Panner3D})(b);(function(a){return a.PanVol=function(){var b=this.optionsObject(arguments,["pan","volume"],a.PanVol.defaults);this._panner=this.input=new a.Panner(b.pan);this.pan=this._panner.pan;this._volume=this.output=new a.Volume(b.volume);this.volume=this._volume.volume;this._panner.connect(this._volume);this._readOnly(["pan","volume"])},a.extend(a.PanVol),
a.PanVol.defaults={pan:.5,volume:0},a.PanVol.prototype.dispose=function(){return a.prototype.dispose.call(this),this._writable(["pan","volume"]),this._panner.dispose(),this._panner=null,this.pan=null,this._volume.dispose(),this._volume=null,this.volume=null,this},a.PanVol})(b);(function(a){return a.CtrlInterpolate=function(){var b=this.optionsObject(arguments,["values","index"],a.CtrlInterpolate.defaults);this.values=b.values;this.index=b.index},a.extend(a.CtrlInterpolate),a.CtrlInterpolate.defaults=
{index:0,values:[]},Object.defineProperty(a.CtrlInterpolate.prototype,"value",{get:function(){var a,b,e,f=this.index;return f=Math.min(f,this.values.length-1),a=Math.floor(f),b=this.values[a],e=this.values[Math.ceil(f)],this._interpolate(f-a,b,e)}}),a.CtrlInterpolate.prototype._interpolate=function(a,b,e){var c;if(this.isArray(b)){var d=[];for(c=0;c<b.length;c++)d[c]=this._interpolate(a,b[c],e[c]);return d}if(this.isObject(b)){d={};for(c in b)d[c]=this._interpolate(a,b[c],e[c]);return d}return b=
this._toNumber(b),e=this._toNumber(e),(1-a)*b+a*e},a.CtrlInterpolate.prototype._toNumber=function(a){return this.isNumber(a)?a:this.toSeconds(a)},a.CtrlInterpolate.prototype.dispose=function(){this.values=null},a.CtrlInterpolate})(b);(function(a){return a.CtrlMarkov=function(a,b){this.values=this.defaultArg(a,{});this.value=this.defaultArg(b,Object.keys(this.values)[0])},a.extend(a.CtrlMarkov),a.CtrlMarkov.prototype.next=function(){var a,b,e,f;if(this.values.hasOwnProperty(this.value))if(a=this.values[this.value],
this.isArray(a)){var g=this._getProbDistribution(a);var h=Math.random();for(e=b=0;e<g.length;e++){var k=g[e];h>b&&h<b+k&&(f=a[e],this.isObject(f)?this.value=f.value:this.value=f);b+=k}}else this.value=a;return this.value},a.CtrlMarkov.prototype._getProbDistribution=function(a){var b,c=[],f=0,g=!1;for(b=0;b<a.length;b++){var h=a[b];this.isObject(h)?(g=!0,c[b]=h.probability):c[b]=1/a.length;f+=c[b]}if(g)for(a=0;a<c.length;a++)c[a]/=f;return c},a.CtrlMarkov.prototype.dispose=function(){this.values=null},
a.CtrlMarkov})(b);(function(a){return a.CtrlPattern=function(){var b=this.optionsObject(arguments,["values","type"],a.CtrlPattern.defaults);this.values=b.values;this.index=0;this._direction=this._shuffled=this._type=null;this.type=b.type},a.extend(a.CtrlPattern),a.CtrlPattern.Type={Up:"up",Down:"down",UpDown:"upDown",DownUp:"downUp",AlternateUp:"alternateUp",AlternateDown:"alternateDown",Random:"random",RandomWalk:"randomWalk",RandomOnce:"randomOnce"},a.CtrlPattern.defaults={type:a.CtrlPattern.Type.Up,
values:[]},Object.defineProperty(a.CtrlPattern.prototype,"value",{get:function(){if(0!==this.values.length){if(1===this.values.length)return this.values[0];this.index=Math.min(this.index,this.values.length-1);var b=this.values[this.index];return this.type===a.CtrlPattern.Type.RandomOnce&&(this.values.length!==this._shuffled.length&&this._shuffleValues(),b=this.values[this._shuffled[this.index]]),b}}}),Object.defineProperty(a.CtrlPattern.prototype,"type",{get:function(){return this._type},set:function(b){this._type=
b;this._shuffled=null;this._type===a.CtrlPattern.Type.Up||this._type===a.CtrlPattern.Type.UpDown||this._type===a.CtrlPattern.Type.RandomOnce||this._type===a.CtrlPattern.Type.AlternateUp?this.index=0:this._type!==a.CtrlPattern.Type.Down&&this._type!==a.CtrlPattern.Type.DownUp&&this._type!==a.CtrlPattern.Type.AlternateDown||(this.index=this.values.length-1);this._type===a.CtrlPattern.Type.UpDown||this._type===a.CtrlPattern.Type.AlternateUp?this._direction=a.CtrlPattern.Type.Up:this._type!==a.CtrlPattern.Type.DownUp&&
this._type!==a.CtrlPattern.Type.AlternateDown||(this._direction=a.CtrlPattern.Type.Down);this._type===a.CtrlPattern.Type.RandomOnce?this._shuffleValues():this._type===a.CtrlPattern.Random&&(this.index=Math.floor(Math.random()*this.values.length))}}),a.CtrlPattern.prototype.next=function(){var b=this.type;return b===a.CtrlPattern.Type.Up?(this.index++,this.index>=this.values.length&&(this.index=0)):b===a.CtrlPattern.Type.Down?(this.index--,0>this.index&&(this.index=this.values.length-1)):b===a.CtrlPattern.Type.UpDown||
b===a.CtrlPattern.Type.DownUp?(this._direction===a.CtrlPattern.Type.Up?this.index++:this.index--,0>this.index?(this.index=1,this._direction=a.CtrlPattern.Type.Up):this.index>=this.values.length&&(this.index=this.values.length-2,this._direction=a.CtrlPattern.Type.Down)):b===a.CtrlPattern.Type.Random?this.index=Math.floor(Math.random()*this.values.length):b===a.CtrlPattern.Type.RandomWalk?.5>Math.random()?(this.index--,this.index=Math.max(this.index,0)):(this.index++,this.index=Math.min(this.index,
this.values.length-1)):b===a.CtrlPattern.Type.RandomOnce?(this.index++,this.index>=this.values.length&&(this.index=0,this._shuffleValues())):b===a.CtrlPattern.Type.AlternateUp?(this._direction===a.CtrlPattern.Type.Up?(this.index+=2,this._direction=a.CtrlPattern.Type.Down):(--this.index,this._direction=a.CtrlPattern.Type.Up),this.index>=this.values.length&&(this.index=0,this._direction=a.CtrlPattern.Type.Up)):b===a.CtrlPattern.Type.AlternateDown&&(this._direction===a.CtrlPattern.Type.Up?(this.index+=
1,this._direction=a.CtrlPattern.Type.Down):(this.index-=2,this._direction=a.CtrlPattern.Type.Up),0>this.index&&(this.index=this.values.length-1,this._direction=a.CtrlPattern.Type.Down)),this.value},a.CtrlPattern.prototype._shuffleValues=function(){var a,b=[];this._shuffled=[];for(a=0;a<this.values.length;a++)b[a]=a;for(;0<b.length;)a=b.splice(Math.floor(b.length*Math.random()),1),this._shuffled.push(a[0])},a.CtrlPattern.prototype.dispose=function(){this.values=this._shuffled=null},a.CtrlPattern})(b);
(function(a){return a.CtrlRandom=function(){var b=this.optionsObject(arguments,["min","max"],a.CtrlRandom.defaults);this.min=b.min;this.max=b.max;this.integer=b.integer},a.extend(a.CtrlRandom),a.CtrlRandom.defaults={min:0,max:1,integer:!1},Object.defineProperty(a.CtrlRandom.prototype,"value",{get:function(){var a=this.toSeconds(this.min),b=this.toSeconds(this.max),e=Math.random();a=e*a+(1-e)*b;return this.integer&&(a=Math.floor(a)),a}}),a.CtrlRandom})(b);(function(a){return a.Buffer=function(){var b=
this.optionsObject(arguments,["url","onload","onerror"],a.Buffer.defaults);this._buffer=null;this._reversed=b.reverse;this._xhr=null;b.url instanceof AudioBuffer||b.url instanceof a.Buffer?(this.set(b.url),b.onload&&b.onload(this)):this.isString(b.url)&&this.load(b.url,b.onload,b.onerror)},a.extend(a.Buffer),a.Buffer.defaults={url:void 0,reverse:!1},a.Buffer.prototype.set=function(b){return b instanceof a.Buffer?this._buffer=b.get():this._buffer=b,this},a.Buffer.prototype.get=function(){return this._buffer},
a.Buffer.prototype.load=function(b,d,e){return new Promise(function(c,g){this._xhr=a.Buffer.load(b,function(a){this._xhr=null;this.set(a);c(this);d&&d(this)}.bind(this),function(a){this._xhr=null;g(a);e&&e(a)}.bind(this))}.bind(this))},a.Buffer.prototype.dispose=function(){return a.Emitter.prototype.dispose.call(this),this._buffer=null,this._xhr&&(a.Buffer._currentDownloads--,this._xhr.abort(),this._xhr=null),this},Object.defineProperty(a.Buffer.prototype,"loaded",{get:function(){return 0<this.length}}),
Object.defineProperty(a.Buffer.prototype,"duration",{get:function(){return this._buffer?this._buffer.duration:0}}),Object.defineProperty(a.Buffer.prototype,"length",{get:function(){return this._buffer?this._buffer.length:0}}),Object.defineProperty(a.Buffer.prototype,"numberOfChannels",{get:function(){return this._buffer?this._buffer.numberOfChannels:0}}),a.Buffer.prototype.fromArray=function(a){var b,c,f=(b=0<a[0].length)?a.length:1,g=this.context.createBuffer(f,b?a[0].length:a.length,this.context.sampleRate);
b||1!==f||(a=[a]);for(b=0;b<f;b++)if(this.isFunction(g.copyToChannel))g.copyToChannel(a[b],b);else{var h=g.getChannelData(b);var k=a[b];for(c=0;c<k.length;c++)h[c]=k[c]}return this._buffer=g,this},a.Buffer.prototype.toArray=function(a){var b,c;if(this.isNumber(a))return this._buffer.getChannelData(a);a=[];for(b=0;b<this.numberOfChannels;b++)if(a[b]=new Float32Array(this.length),this.isFunction(this._buffer.copyFromChannel))this._buffer.copyFromChannel(a[b],b);else{var f=this._buffer.getChannelData(b);
var g=a[b];for(c=0;c<f.length;c++)g[c]=f[c]}return 1===a.length?a[0]:a},a.Buffer.prototype.slice=function(b,d){var c;d=this.defaultArg(d,this.duration);var f=Math.floor(this.context.sampleRate*this.toSeconds(b));var g=Math.floor(this.context.sampleRate*this.toSeconds(d));var h=[];for(c=0;c<this.numberOfChannels;c++)h[c]=this.toArray(c).slice(f,g);return(new a.Buffer).fromArray(h)},a.Buffer.prototype._reverse=function(){if(this.loaded)for(var a=0;a<this._buffer.numberOfChannels;a++)Array.prototype.reverse.call(this._buffer.getChannelData(a));
return this},Object.defineProperty(a.Buffer.prototype,"reverse",{get:function(){return this._reversed},set:function(a){this._reversed!==a&&(this._reversed=a,this._reverse())}}),a.Emitter.mixin(a.Buffer),a.Buffer._downloadQueue=[],a.Buffer._currentDownloads=0,a.Buffer.baseUrl="",a.Buffer.load=function(b,d,e){function c(a){if(!e)throw Error(a);e(a)}function g(){var b,c=0;for(b=0;b<a.Buffer._downloadQueue.length;b++)c+=a.Buffer._downloadQueue[b].progress;a.Buffer.emit("progress",c/a.Buffer._downloadQueue.length)}
d=d||a.noOp;var h=new XMLHttpRequest;return h.open("GET",a.Buffer.baseUrl+b,!0),h.responseType="arraybuffer",h.progress=0,a.Buffer._currentDownloads++,a.Buffer._downloadQueue.push(h),h.addEventListener("load",function(){200===h.status?a.context.decodeAudioData(h.response,function(b){h.progress=1;g();d(b);a.Buffer._currentDownloads--;0===a.Buffer._currentDownloads&&(a.Buffer._downloadQueue=[],a.Buffer.emit("load"))},function(){c("Tone.Buffer: could not decode audio data: "+b)}):c("Tone.Buffer: could not locate file: "+
b)}),h.addEventListener("error",c),h.addEventListener("progress",function(a){a.lengthComputable&&(h.progress=a.loaded/a.total*.95,g())}),h.send(),h},a.Buffer.stopDownloads=function(){return a.Buffer._downloadQueue.forEach(function(a){a.abort()}),a.Buffer._currentDownloads=0,a.Buffer},a.Buffer.supportsType=function(a){var b;a=a.split(".");return a=a[a.length-1],b=document.createElement("audio").canPlayType("audio/"+a),""!==b},a.Buffer})(b);(function(a){return a.Buffers=function(a,b,e){this._buffers=
{};this.baseUrl=this.defaultArg(e,"");a=this._flattenUrls(a);this._loadingCount=0;for(var c in a)this._loadingCount++,this.add(c,a[c],this._bufferLoaded.bind(this,b))},a.extend(a.Buffers),a.Buffers.prototype.has=function(a){return this._buffers.hasOwnProperty(a)},a.Buffers.prototype.get=function(a){if(this.has(a))return this._buffers[a];throw Error("Tone.Buffers: no buffer named "+a);},a.Buffers.prototype._bufferLoaded=function(a){this._loadingCount--;0===this._loadingCount&&a&&a(this)},Object.defineProperty(a.Buffers.prototype,
"loaded",{get:function(){var a,b=!0;for(a in this._buffers){var e=this.get(a);b=b&&e.loaded}return b}}),a.Buffers.prototype.add=function(b,d,e){return e=this.defaultArg(e,a.noOp),d instanceof a.Buffer?(this._buffers[b]=d,e(this)):d instanceof AudioBuffer?(this._buffers[b]=new a.Buffer(d),e(this)):this.isString(d)&&(this._buffers[b]=new a.Buffer(this.baseUrl+d,e)),this},a.Buffers.prototype._flattenUrls=function(a){var b,c,f={};for(b in a)if(a.hasOwnProperty(b))if(this.isObject(a[b])){var g=this._flattenUrls(a[b]);
for(c in g)g.hasOwnProperty(c)&&(f[b+"."+c]=g[c])}else f[b]=a[b];return f},a.Buffers.prototype.dispose=function(){for(var a in this._buffers)this._buffers[a].dispose();return this._buffers=null,this},a.Buffers})(b);(function(a){var b={};return a.prototype.send=function(c,e){b.hasOwnProperty(c)||(b[c]=this.context.createGain());e=this.defaultArg(e,0);var d=new a.Gain(e,a.Type.Decibels);return this.output.chain(d,b[c]),d},a.prototype.receive=function(a,c){return b.hasOwnProperty(a)||(b[a]=this.context.createGain()),
this.isUndef(c)&&(c=this.input),b[a].connect(c),this},a._initAudioContext(function(){b={}}),a})(b);(function(a){return a.Draw=function(){this._events=new a.Timeline;this.expiration=.25;this.anticipation=.008;this._boundDrawLoop=this._drawLoop.bind(this);this._drawLoop()},a.extend(a.Draw),a.Draw.prototype.schedule=function(a,b){return this._events.add({callback:a,time:this.toSeconds(b)}),this},a.Draw.prototype.cancel=function(a){return this._events.cancel(this.toSeconds(a)),this},a.Draw.prototype._drawLoop=
function(){var b;requestAnimationFrame(this._boundDrawLoop);for(b=a.now();this._events.length&&this._events.peek().time-this.anticipation<=b;){var d=this._events.shift();b-d.time<=this.expiration&&d.callback()}},a.Draw=new a.Draw,a.Draw})(b);(function(a){a.Listener=function(){var a=this.optionsObject(arguments,["positionX","positionY","positionZ"],b.defaults);this._listener=this.context.listener;this._orientation=[a.forwardX,a.forwardY,a.forwardZ,a.upX,a.upY,a.upZ];this._position=[a.positionX,a.positionY,
a.positionZ];this.forwardX=a.forwardX;this.forwardY=a.forwardY;this.forwardZ=a.forwardZ;this.upX=a.upX;this.upY=a.upY;this.upZ=a.upZ;this.positionX=a.positionX;this.positionY=a.positionY;this.positionZ=a.positionZ};a.extend(a.Listener);a.Listener.defaults={positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:1,upX:0,upY:1,upZ:0};a.Listener.prototype._rampTimeConstant=.01;a.Listener.prototype.setPosition=function(a,b,c){if(this._listener.positionX){var d=this.now();this._listener.positionX.setTargetAtTime(a,
d,this._rampTimeConstant);this._listener.positionY.setTargetAtTime(b,d,this._rampTimeConstant);this._listener.positionZ.setTargetAtTime(c,d,this._rampTimeConstant)}else this._listener.setPosition(a,b,c);return this._position=Array.prototype.slice.call(arguments),this};a.Listener.prototype.setOrientation=function(a,b,c,g,h,k){if(this._listener.forwardX){var d=this.now();this._listener.forwardX.setTargetAtTime(a,d,this._rampTimeConstant);this._listener.forwardY.setTargetAtTime(b,d,this._rampTimeConstant);
this._listener.forwardZ.setTargetAtTime(c,d,this._rampTimeConstant);this._listener.upX.setTargetAtTime(g,d,this._rampTimeConstant);this._listener.upY.setTargetAtTime(h,d,this._rampTimeConstant);this._listener.upZ.setTargetAtTime(k,d,this._rampTimeConstant)}else this._listener.setOrientation(a,b,c,g,h,k);return this._orientation=Array.prototype.slice.call(arguments),this};Object.defineProperty(a.Listener.prototype,"positionX",{set:function(a){this._position[0]=a;this.setPosition.apply(this,this._position)},
get:function(){return this._position[0]}});Object.defineProperty(a.Listener.prototype,"positionY",{set:function(a){this._position[1]=a;this.setPosition.apply(this,this._position)},get:function(){return this._position[1]}});Object.defineProperty(a.Listener.prototype,"positionZ",{set:function(a){this._position[2]=a;this.setPosition.apply(this,this._position)},get:function(){return this._position[2]}});Object.defineProperty(a.Listener.prototype,"forwardX",{set:function(a){this._orientation[0]=a;this.setOrientation.apply(this,
this._orientation)},get:function(){return this._orientation[0]}});Object.defineProperty(a.Listener.prototype,"forwardY",{set:function(a){this._orientation[1]=a;this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[1]}});Object.defineProperty(a.Listener.prototype,"forwardZ",{set:function(a){this._orientation[2]=a;this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[2]}});Object.defineProperty(a.Listener.prototype,"upX",{set:function(a){this._orientation[3]=
a;this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[3]}});Object.defineProperty(a.Listener.prototype,"upY",{set:function(a){this._orientation[4]=a;this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[4]}});Object.defineProperty(a.Listener.prototype,"upZ",{set:function(a){this._orientation[5]=a;this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[5]}});a.Listener.prototype.dispose=function(){return this._listener.disconnect(),
this._listener=null,this._orientation=null,this._position=null,this};var b=a.Listener;return a._initAudioContext(function(){"function"==typeof a.Listener?a.Listener=new a.Listener:b.call(a.Listener)}),a.Listener})(b);(function(a){return a.Effect=function(){this.createInsOuts(1,1);var b=this.optionsObject(arguments,["wet"],a.Effect.defaults);this._dryWet=new a.CrossFade(b.wet);this.wet=this._dryWet.fade;this.effectSend=new a.Gain;this.effectReturn=new a.Gain;this.input.connect(this._dryWet.a);this.input.connect(this.effectSend);
this.effectReturn.connect(this._dryWet.b);this._dryWet.connect(this.output);this._readOnly(["wet"])},a.extend(a.Effect),a.Effect.defaults={wet:1},a.Effect.prototype.connectEffect=function(a){return this.effectSend.chain(a,this.effectReturn),this},a.Effect.prototype.dispose=function(){return a.prototype.dispose.call(this),this._dryWet.dispose(),this._dryWet=null,this.effectSend.dispose(),this.effectSend=null,this.effectReturn.dispose(),this.effectReturn=null,this._writable(["wet"]),this.wet=null,this},
a.Effect})(b);(function(a){return a.AutoFilter=function(){var b=this.optionsObject(arguments,["frequency","baseFrequency","octaves"],a.AutoFilter.defaults);a.Effect.call(this,b);this._lfo=new a.LFO({frequency:b.frequency,amplitude:b.depth});this.depth=this._lfo.amplitude;this.frequency=this._lfo.frequency;this.filter=new a.Filter(b.filter);this._octaves=0;this.connectEffect(this.filter);this._lfo.connect(this.filter.frequency);this.type=b.type;this._readOnly(["frequency","depth"]);this.octaves=b.octaves;
this.baseFrequency=b.baseFrequency},a.extend(a.AutoFilter,a.Effect),a.AutoFilter.defaults={frequency:1,type:"sine",depth:1,baseFrequency:200,octaves:2.6,filter:{type:"lowpass",rolloff:-12,Q:1}},a.AutoFilter.prototype.start=function(a){return this._lfo.start(a),this},a.AutoFilter.prototype.stop=function(a){return this._lfo.stop(a),this},a.AutoFilter.prototype.sync=function(a){return this._lfo.sync(a),this},a.AutoFilter.prototype.unsync=function(){return this._lfo.unsync(),this},Object.defineProperty(a.AutoFilter.prototype,
"type",{get:function(){return this._lfo.type},set:function(a){this._lfo.type=a}}),Object.defineProperty(a.AutoFilter.prototype,"baseFrequency",{get:function(){return this._lfo.min},set:function(a){this._lfo.min=this.toFrequency(a);this.octaves=this._octaves}}),Object.defineProperty(a.AutoFilter.prototype,"octaves",{get:function(){return this._octaves},set:function(a){this._octaves=a;this._lfo.max=this.baseFrequency*Math.pow(2,a)}}),a.AutoFilter.prototype.dispose=function(){return a.Effect.prototype.dispose.call(this),
this._lfo.dispose(),this._lfo=null,this.filter.dispose(),this.filter=null,this._writable(["frequency","depth"]),this.frequency=null,this.depth=null,this},a.AutoFilter})(b);(function(a){return a.AutoPanner=function(){var b=this.optionsObject(arguments,["frequency"],a.AutoPanner.defaults);a.Effect.call(this,b);this._lfo=new a.LFO({frequency:b.frequency,amplitude:b.depth,min:-1,max:1});this.depth=this._lfo.amplitude;this._panner=new a.Panner;this.frequency=this._lfo.frequency;this.connectEffect(this._panner);
this._lfo.connect(this._panner.pan);this.type=b.type;this._readOnly(["depth","frequency"])},a.extend(a.AutoPanner,a.Effect),a.AutoPanner.defaults={frequency:1,type:"sine",depth:1},a.AutoPanner.prototype.start=function(a){return this._lfo.start(a),this},a.AutoPanner.prototype.stop=function(a){return this._lfo.stop(a),this},a.AutoPanner.prototype.sync=function(a){return this._lfo.sync(a),this},a.AutoPanner.prototype.unsync=function(){return this._lfo.unsync(),this},Object.defineProperty(a.AutoPanner.prototype,
"type",{get:function(){return this._lfo.type},set:function(a){this._lfo.type=a}}),a.AutoPanner.prototype.dispose=function(){return a.Effect.prototype.dispose.call(this),this._lfo.dispose(),this._lfo=null,this._panner.dispose(),this._panner=null,this._writable(["depth","frequency"]),this.frequency=null,this.depth=null,this},a.AutoPanner})(b);(function(a){return a.AutoWah=function(){var b=this.optionsObject(arguments,["baseFrequency","octaves","sensitivity"],a.AutoWah.defaults);a.Effect.call(this,b);
this.follower=new a.Follower(b.follower);this._sweepRange=new a.ScaleExp(0,1,.5);this._baseFrequency=b.baseFrequency;this._octaves=b.octaves;this._inputBoost=new a.Gain;this._bandpass=new a.Filter({rolloff:-48,frequency:0,Q:b.Q});this._peaking=new a.Filter(0,"peaking");this._peaking.gain.value=b.gain;this.gain=this._peaking.gain;this.Q=this._bandpass.Q;this.effectSend.chain(this._inputBoost,this.follower,this._sweepRange);this._sweepRange.connect(this._bandpass.frequency);this._sweepRange.connect(this._peaking.frequency);
this.effectSend.chain(this._bandpass,this._peaking,this.effectReturn);this._setSweepRange();this.sensitivity=b.sensitivity;this._readOnly(["gain","Q"])},a.extend(a.AutoWah,a.Effect),a.AutoWah.defaults={baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:{attack:.3,release:.5}},Object.defineProperty(a.AutoWah.prototype,"octaves",{get:function(){return this._octaves},set:function(a){this._octaves=a;this._setSweepRange()}}),Object.defineProperty(a.AutoWah.prototype,"baseFrequency",{get:function(){return this._baseFrequency},
set:function(a){this._baseFrequency=a;this._setSweepRange()}}),Object.defineProperty(a.AutoWah.prototype,"sensitivity",{get:function(){return this.gainToDb(1/this._inputBoost.gain.value)},set:function(a){this._inputBoost.gain.value=1/this.dbToGain(a)}}),a.AutoWah.prototype._setSweepRange=function(){this._sweepRange.min=this._baseFrequency;this._sweepRange.max=Math.min(this._baseFrequency*Math.pow(2,this._octaves),this.context.sampleRate/2)},a.AutoWah.prototype.dispose=function(){return a.Effect.prototype.dispose.call(this),
this.follower.dispose(),this.follower=null,this._sweepRange.dispose(),this._sweepRange=null,this._bandpass.dispose(),this._bandpass=null,this._peaking.dispose(),this._peaking=null,this._inputBoost.dispose(),this._inputBoost=null,this._writable(["gain","Q"]),this.gain=null,this.Q=null,this},a.AutoWah})(b);(function(a){return a.BitCrusher=function(){var b=this.optionsObject(arguments,["bits"],a.BitCrusher.defaults);a.Effect.call(this,b);var d=1/Math.pow(2,b.bits-1);this._subtract=new a.Subtract;this._modulo=
new a.Modulo(d);this._bits=b.bits;this.effectSend.fan(this._subtract,this._modulo);this._modulo.connect(this._subtract,0,1);this._subtract.connect(this.effectReturn)},a.extend(a.BitCrusher,a.Effect),a.BitCrusher.defaults={bits:4},Object.defineProperty(a.BitCrusher.prototype,"bits",{get:function(){return this._bits},set:function(a){this._bits=a;this._modulo.value=1/Math.pow(2,a-1)}}),a.BitCrusher.prototype.dispose=function(){return a.Effect.prototype.dispose.call(this),this._subtract.dispose(),this._subtract=
null,this._modulo.dispose(),this._modulo=null,this},a.BitCrusher})(b);(function(a){return a.Chebyshev=function(){var b=this.optionsObject(arguments,["order"],a.Chebyshev.defaults);a.Effect.call(this,b);this._shaper=new a.WaveShaper(4096);this._order=b.order;this.connectEffect(this._shaper);this.order=b.order;this.oversample=b.oversample},a.extend(a.Chebyshev,a.Effect),a.Chebyshev.defaults={order:1,oversample:"none"},a.Chebyshev.prototype._getCoefficient=function(a,b,e){return e.hasOwnProperty(b)?
e[b]:(0===b?e[b]=0:1===b?e[b]=a:e[b]=2*a*this._getCoefficient(a,b-1,e)-this._getCoefficient(a,b-2,e),e[b])},Object.defineProperty(a.Chebyshev.prototype,"order",{get:function(){return this._order},set:function(a){var b;this._order=a;var c=Array(4096);var f=c.length;for(b=0;b<f;++b){var g=2*b/f-1;0===g?c[b]=0:c[b]=this._getCoefficient(g,a,{})}this._shaper.curve=c}}),Object.defineProperty(a.Chebyshev.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(a){this._shaper.oversample=
a}}),a.Chebyshev.prototype.dispose=function(){return a.Effect.prototype.dispose.call(this),this._shaper.dispose(),this._shaper=null,this},a.Chebyshev})(b);(function(a){return a.StereoEffect=function(){this.createInsOuts(1,1);var b=this.optionsObject(arguments,["wet"],a.Effect.defaults);this._dryWet=new a.CrossFade(b.wet);this.wet=this._dryWet.fade;this._split=new a.Split;this.effectSendL=this._split.left;this.effectSendR=this._split.right;this._merge=new a.Merge;this.effectReturnL=this._merge.left;
this.effectReturnR=this._merge.right;this.input.connect(this._split);this.input.connect(this._dryWet,0,0);this._merge.connect(this._dryWet,0,1);this._dryWet.connect(this.output);this._readOnly(["wet"])},a.extend(a.StereoEffect,a.Effect),a.StereoEffect.prototype.dispose=function(){return a.prototype.dispose.call(this),this._dryWet.dispose(),this._dryWet=null,this._split.dispose(),this._split=null,this._merge.dispose(),this._merge=null,this.effectSendL=null,this.effectSendR=null,this.effectReturnL=
null,this.effectReturnR=null,this._writable(["wet"]),this.wet=null,this},a.StereoEffect})(b);(function(a){return a.FeedbackEffect=function(){var b=this.optionsObject(arguments,["feedback"]);b=this.defaultArg(b,a.FeedbackEffect.defaults);a.Effect.call(this,b);this._feedbackGain=new a.Gain(b.feedback,a.Type.NormalRange);this.feedback=this._feedbackGain.gain;this.effectReturn.chain(this._feedbackGain,this.effectSend);this._readOnly(["feedback"])},a.extend(a.FeedbackEffect,a.Effect),a.FeedbackEffect.defaults=
{feedback:.125},a.FeedbackEffect.prototype.dispose=function(){return a.Effect.prototype.dispose.call(this),this._writable(["feedback"]),this._feedbackGain.dispose(),this._feedbackGain=null,this.feedback=null,this},a.FeedbackEffect})(b);(function(a){return a.StereoXFeedbackEffect=function(){var b=this.optionsObject(arguments,["feedback"],a.FeedbackEffect.defaults);a.StereoEffect.call(this,b);this.feedback=new a.Signal(b.feedback,a.Type.NormalRange);this._feedbackLR=new a.Gain;this._feedbackRL=new a.Gain;
this.effectReturnL.chain(this._feedbackLR,this.effectSendR);this.effectReturnR.chain(this._feedbackRL,this.effectSendL);this.feedback.fan(this._feedbackLR.gain,this._feedbackRL.gain);this._readOnly(["feedback"])},a.extend(a.StereoXFeedbackEffect,a.FeedbackEffect),a.StereoXFeedbackEffect.prototype.dispose=function(){return a.StereoEffect.prototype.dispose.call(this),this._writable(["feedback"]),this.feedback.dispose(),this.feedback=null,this._feedbackLR.dispose(),this._feedbackLR=null,this._feedbackRL.dispose(),
this._feedbackRL=null,this},a.StereoXFeedbackEffect})(b);(function(a){return a.Chorus=function(){var b=this.optionsObject(arguments,["frequency","delayTime","depth"],a.Chorus.defaults);a.StereoXFeedbackEffect.call(this,b);this._depth=b.depth;this._delayTime=b.delayTime/1E3;this._lfoL=new a.LFO({frequency:b.frequency,min:0,max:1});this._lfoR=new a.LFO({frequency:b.frequency,min:0,max:1,phase:180});this._delayNodeL=new a.Delay;this._delayNodeR=new a.Delay;this.frequency=this._lfoL.frequency;this.effectSendL.chain(this._delayNodeL,
this.effectReturnL);this.effectSendR.chain(this._delayNodeR,this.effectReturnR);this.effectSendL.connect(this.effectReturnL);this.effectSendR.connect(this.effectReturnR);this._lfoL.connect(this._delayNodeL.delayTime);this._lfoR.connect(this._delayNodeR.delayTime);this._lfoL.start();this._lfoR.start();this._lfoL.frequency.connect(this._lfoR.frequency);this.depth=this._depth;this.frequency.value=b.frequency;this.type=b.type;this._readOnly(["frequency"]);this.spread=b.spread},a.extend(a.Chorus,a.StereoXFeedbackEffect),
a.Chorus.defaults={frequency:1.5,delayTime:3.5,depth:.7,feedback:.1,type:"sine",spread:180},Object.defineProperty(a.Chorus.prototype,"depth",{get:function(){return this._depth},set:function(a){this._depth=a;a*=this._delayTime;this._lfoL.min=Math.max(this._delayTime-a,0);this._lfoL.max=this._delayTime+a;this._lfoR.min=Math.max(this._delayTime-a,0);this._lfoR.max=this._delayTime+a}}),Object.defineProperty(a.Chorus.prototype,"delayTime",{get:function(){return 1E3*this._delayTime},set:function(a){this._delayTime=
a/1E3;this.depth=this._depth}}),Object.defineProperty(a.Chorus.prototype,"type",{get:function(){return this._lfoL.type},set:function(a){this._lfoL.type=a;this._lfoR.type=a}}),Object.defineProperty(a.Chorus.prototype,"spread",{get:function(){return this._lfoR.phase-this._lfoL.phase},set:function(a){this._lfoL.phase=90-a/2;this._lfoR.phase=a/2+90}}),a.Chorus.prototype.dispose=function(){return a.StereoXFeedbackEffect.prototype.dispose.call(this),this._lfoL.dispose(),this._lfoL=null,this._lfoR.dispose(),
this._lfoR=null,this._delayNodeL.dispose(),this._delayNodeL=null,this._delayNodeR.dispose(),this._delayNodeR=null,this._writable("frequency"),this.frequency=null,this},a.Chorus})(b);(function(a){return a.Convolver=function(){var b=this.optionsObject(arguments,["url","onload"],a.Convolver.defaults);a.Effect.call(this,b);this._convolver=this.context.createConvolver();this._buffer=new a.Buffer;this.isString(b.url)?this._buffer.load(b.url,function(a){this.buffer=a;b.onload()}.bind(this)):b.url&&(this.buffer=
b.url,b.onload());this.connectEffect(this._convolver)},a.extend(a.Convolver,a.Effect),a.Convolver.defaults={onload:a.noOp},Object.defineProperty(a.Convolver.prototype,"buffer",{get:function(){return this._buffer.get()},set:function(a){this._buffer.set(a);this._convolver.buffer=this._buffer.get()}}),a.Convolver.prototype.load=function(a,b){return this._buffer.load(a,function(a){this.buffer=a;b&&b()}.bind(this))},a.Convolver.prototype.dispose=function(){return a.Effect.prototype.dispose.call(this),
this._convolver.disconnect(),this._convolver=null,this._buffer.dispose(),this._buffer=null,this},a.Convolver})(b);(function(a){return a.Distortion=function(){var b=this.optionsObject(arguments,["distortion"],a.Distortion.defaults);a.Effect.call(this,b);this._shaper=new a.WaveShaper(4096);this._distortion=b.distortion;this.connectEffect(this._shaper);this.distortion=b.distortion;this.oversample=b.oversample},a.extend(a.Distortion,a.Effect),a.Distortion.defaults={distortion:.4,oversample:"none"},Object.defineProperty(a.Distortion.prototype,
"distortion",{get:function(){return this._distortion},set:function(a){this._distortion=a;var b=100*a;var c=Math.PI/180;this._shaper.setMap(function(a){return.001>Math.abs(a)?0:(3+b)*a*20*c/(Math.PI+b*Math.abs(a))})}}),Object.defineProperty(a.Distortion.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(a){this._shaper.oversample=a}}),a.Distortion.prototype.dispose=function(){return a.Effect.prototype.dispose.call(this),this._shaper.dispose(),this._shaper=null,this},
a.Distortion})(b);(function(a){return a.FeedbackDelay=function(){var b=this.optionsObject(arguments,["delayTime","feedback"],a.FeedbackDelay.defaults);a.FeedbackEffect.call(this,b);this._delayNode=new a.Delay(b.delayTime);this.delayTime=this._delayNode.delayTime;this.connectEffect(this._delayNode);this._readOnly(["delayTime"])},a.extend(a.FeedbackDelay,a.FeedbackEffect),a.FeedbackDelay.defaults={delayTime:.25},a.FeedbackDelay.prototype.dispose=function(){return a.FeedbackEffect.prototype.dispose.call(this),
this._delayNode.dispose(),this._delayNode=null,this._writable(["delayTime"]),this.delayTime=null,this},a.FeedbackDelay})(b);(function(a){var b=[1557/44100,1617/44100,1491/44100,1422/44100,1277/44100,1356/44100,1188/44100,1116/44100],d=[225,556,441,341];return a.Freeverb=function(){var c=this.optionsObject(arguments,["roomSize","dampening"],a.Freeverb.defaults);a.StereoEffect.call(this,c);this.roomSize=new a.Signal(c.roomSize,a.Type.NormalRange);this.dampening=new a.Signal(c.dampening,a.Type.Frequency);
this._combFilters=[];this._allpassFiltersL=[];this._allpassFiltersR=[];for(c=0;c<d.length;c++){var f=this.context.createBiquadFilter();f.type="allpass";f.frequency.value=d[c];this._allpassFiltersL.push(f)}for(c=0;c<d.length;c++)f=this.context.createBiquadFilter(),f.type="allpass",f.frequency.value=d[c],this._allpassFiltersR.push(f);for(c=0;c<b.length;c++)f=new a.LowpassCombFilter(b[c]),c<b.length/2?this.effectSendL.chain(f,this._allpassFiltersL[0]):this.effectSendR.chain(f,this._allpassFiltersR[0]),
this.roomSize.connect(f.resonance),this.dampening.connect(f.dampening),this._combFilters.push(f);this.connectSeries.apply(this,this._allpassFiltersL);this.connectSeries.apply(this,this._allpassFiltersR);this._allpassFiltersL[this._allpassFiltersL.length-1].connect(this.effectReturnL);this._allpassFiltersR[this._allpassFiltersR.length-1].connect(this.effectReturnR);this._readOnly(["roomSize","dampening"])},a.extend(a.Freeverb,a.StereoEffect),a.Freeverb.defaults={roomSize:.7,dampening:3E3},a.Freeverb.prototype.dispose=
function(){var b;a.StereoEffect.prototype.dispose.call(this);for(b=0;b<this._allpassFiltersL.length;b++)this._allpassFiltersL[b].disconnect(),this._allpassFiltersL[b]=null;this._allpassFiltersL=null;for(b=0;b<this._allpassFiltersR.length;b++)this._allpassFiltersR[b].disconnect(),this._allpassFiltersR[b]=null;this._allpassFiltersR=null;for(b=0;b<this._combFilters.length;b++)this._combFilters[b].dispose(),this._combFilters[b]=null;return this._combFilters=null,this._writable(["roomSize","dampening"]),
this.roomSize.dispose(),this.roomSize=null,this.dampening.dispose(),this.dampening=null,this},a.Freeverb})(b);(function(a){var b=[.06748,.06404,.08212,.09004],d=[.773,.802,.753,.733],e=[347,113,37];return a.JCReverb=function(){var c=this.optionsObject(arguments,["roomSize"],a.JCReverb.defaults);a.StereoEffect.call(this,c);this.roomSize=new a.Signal(c.roomSize,a.Type.NormalRange);this._scaleRoomSize=new a.Scale(-.733,.197);this._allpassFilters=[];this._feedbackCombFilters=[];for(c=0;c<e.length;c++){var g=
this.context.createBiquadFilter();g.type="allpass";g.frequency.value=e[c];this._allpassFilters.push(g)}for(c=0;c<b.length;c++)g=new a.FeedbackCombFilter(b[c],.1),this._scaleRoomSize.connect(g.resonance),g.resonance.value=d[c],this._allpassFilters[this._allpassFilters.length-1].connect(g),c<b.length/2?g.connect(this.effectReturnL):g.connect(this.effectReturnR),this._feedbackCombFilters.push(g);this.roomSize.connect(this._scaleRoomSize);this.connectSeries.apply(this,this._allpassFilters);this.effectSendL.connect(this._allpassFilters[0]);
this.effectSendR.connect(this._allpassFilters[0]);this._readOnly(["roomSize"])},a.extend(a.JCReverb,a.StereoEffect),a.JCReverb.defaults={roomSize:.5},a.JCReverb.prototype.dispose=function(){var b;a.StereoEffect.prototype.dispose.call(this);for(b=0;b<this._allpassFilters.length;b++)this._allpassFilters[b].disconnect(),this._allpassFilters[b]=null;this._allpassFilters=null;for(b=0;b<this._feedbackCombFilters.length;b++)this._feedbackCombFilters[b].dispose(),this._feedbackCombFilters[b]=null;return this._feedbackCombFilters=
null,this._writable(["roomSize"]),this.roomSize.dispose(),this.roomSize=null,this._scaleRoomSize.dispose(),this._scaleRoomSize=null,this},a.JCReverb})(b);(function(a){return a.MidSideEffect=function(){a.Effect.apply(this,arguments);this._midSideSplit=new a.MidSideSplit;this._midSideMerge=new a.MidSideMerge;this.midSend=this._midSideSplit.mid;this.sideSend=this._midSideSplit.side;this.midReturn=this._midSideMerge.mid;this.sideReturn=this._midSideMerge.side;this.effectSend.connect(this._midSideSplit);
this._midSideMerge.connect(this.effectReturn)},a.extend(a.MidSideEffect,a.Effect),a.MidSideEffect.prototype.dispose=function(){return a.Effect.prototype.dispose.call(this),this._midSideSplit.dispose(),this._midSideSplit=null,this._midSideMerge.dispose(),this._midSideMerge=null,this.midSend=null,this.sideSend=null,this.midReturn=null,this.sideReturn=null,this},a.MidSideEffect})(b);(function(a){return a.Phaser=function(){var b=this.optionsObject(arguments,["frequency","octaves","baseFrequency"],a.Phaser.defaults);
a.StereoEffect.call(this,b);this._lfoL=new a.LFO(b.frequency,0,1);this._lfoR=new a.LFO(b.frequency,0,1);this._lfoR.phase=180;this._baseFrequency=b.baseFrequency;this._octaves=b.octaves;this.Q=new a.Signal(b.Q,a.Type.Positive);this._filtersL=this._makeFilters(b.stages,this._lfoL,this.Q);this._filtersR=this._makeFilters(b.stages,this._lfoR,this.Q);this.frequency=this._lfoL.frequency;this.frequency.value=b.frequency;this.effectSendL.connect(this._filtersL[0]);this.effectSendR.connect(this._filtersR[0]);
this._filtersL[b.stages-1].connect(this.effectReturnL);this._filtersR[b.stages-1].connect(this.effectReturnR);this._lfoL.frequency.connect(this._lfoR.frequency);this.baseFrequency=b.baseFrequency;this.octaves=b.octaves;this._lfoL.start();this._lfoR.start();this._readOnly(["frequency","Q"])},a.extend(a.Phaser,a.StereoEffect),a.Phaser.defaults={frequency:.5,octaves:3,stages:10,Q:10,baseFrequency:350},a.Phaser.prototype._makeFilters=function(a,b,e){var c,d=Array(a);for(c=0;c<a;c++){var h=this.context.createBiquadFilter();
h.type="allpass";e.connect(h.Q);b.connect(h.frequency);d[c]=h}return this.connectSeries.apply(this,d),d},Object.defineProperty(a.Phaser.prototype,"octaves",{get:function(){return this._octaves},set:function(a){this._octaves=a;a=this._baseFrequency*Math.pow(2,a);this._lfoL.max=a;this._lfoR.max=a}}),Object.defineProperty(a.Phaser.prototype,"baseFrequency",{get:function(){return this._baseFrequency},set:function(a){this._baseFrequency=a;this._lfoL.min=a;this._lfoR.min=a;this.octaves=this._octaves}}),
a.Phaser.prototype.dispose=function(){var b;a.StereoEffect.prototype.dispose.call(this);this._writable(["frequency","Q"]);this.Q.dispose();this.Q=null;this._lfoL.dispose();this._lfoL=null;this._lfoR.dispose();this._lfoR=null;for(b=0;b<this._filtersL.length;b++)this._filtersL[b].disconnect(),this._filtersL[b]=null;this._filtersL=null;for(b=0;b<this._filtersR.length;b++)this._filtersR[b].disconnect(),this._filtersR[b]=null;return this._filtersR=null,this.frequency=null,this},a.Phaser})(b);(function(a){return a.PingPongDelay=
function(){var b=this.optionsObject(arguments,["delayTime","feedback"],a.PingPongDelay.defaults);a.StereoXFeedbackEffect.call(this,b);this._leftDelay=new a.Delay(0,b.maxDelayTime);this._rightDelay=new a.Delay(0,b.maxDelayTime);this._rightPreDelay=new a.Delay(0,b.maxDelayTime);this.delayTime=new a.Signal(b.delayTime,a.Type.Time);this.effectSendL.chain(this._leftDelay,this.effectReturnL);this.effectSendR.chain(this._rightPreDelay,this._rightDelay,this.effectReturnR);this.delayTime.fan(this._leftDelay.delayTime,
this._rightDelay.delayTime,this._rightPreDelay.delayTime);this._feedbackLR.disconnect();this._feedbackLR.connect(this._rightDelay);this._readOnly(["delayTime"])},a.extend(a.PingPongDelay,a.StereoXFeedbackEffect),a.PingPongDelay.defaults={delayTime:.25,maxDelayTime:1},a.PingPongDelay.prototype.dispose=function(){return a.StereoXFeedbackEffect.prototype.dispose.call(this),this._leftDelay.dispose(),this._leftDelay=null,this._rightDelay.dispose(),this._rightDelay=null,this._rightPreDelay.dispose(),this._rightPreDelay=
null,this._writable(["delayTime"]),this.delayTime.dispose(),this.delayTime=null,this},a.PingPongDelay})(b);(function(a){return a.PitchShift=function(){var b=this.optionsObject(arguments,["pitch"],a.PitchShift.defaults);a.FeedbackEffect.call(this,b);this._frequency=new a.Signal(0);this._delayA=new a.Delay(0,1);this._lfoA=(new a.LFO({min:0,max:.1,type:"sawtooth"})).connect(this._delayA.delayTime);this._delayB=new a.Delay(0,1);this._lfoB=(new a.LFO({min:0,max:.1,type:"sawtooth",phase:180})).connect(this._delayB.delayTime);
this._crossFade=new a.CrossFade;this._crossFadeLFO=(new a.LFO({min:0,max:1,type:"triangle",phase:90})).connect(this._crossFade.fade);this._feedbackDelay=new a.Delay(b.delayTime);this.delayTime=this._feedbackDelay.delayTime;this._readOnly("delayTime");this._pitch=b.pitch;this._windowSize=b.windowSize;this._delayA.connect(this._crossFade.a);this._delayB.connect(this._crossFade.b);this._frequency.fan(this._lfoA.frequency,this._lfoB.frequency,this._crossFadeLFO.frequency);this.effectSend.fan(this._delayA,
this._delayB);this._crossFade.chain(this._feedbackDelay,this.effectReturn);b=this.now();this._lfoA.start(b);this._lfoB.start(b);this._crossFadeLFO.start(b);this.windowSize=this._windowSize},a.extend(a.PitchShift,a.FeedbackEffect),a.PitchShift.defaults={pitch:0,windowSize:.1,delayTime:0,feedback:0},Object.defineProperty(a.PitchShift.prototype,"pitch",{get:function(){return this._pitch},set:function(a){this._pitch=a;var b=0;0>a?(this._lfoA.min=0,this._lfoA.max=this._windowSize,this._lfoB.min=0,this._lfoB.max=
this._windowSize,b=this.intervalToFrequencyRatio(a-1)+1):(this._lfoA.min=this._windowSize,this._lfoA.max=0,this._lfoB.min=this._windowSize,this._lfoB.max=0,b=this.intervalToFrequencyRatio(a)-1);this._frequency.value=1.2/this._windowSize*b}}),Object.defineProperty(a.PitchShift.prototype,"windowSize",{get:function(){return this._windowSize},set:function(a){this._windowSize=this.toSeconds(a);this.pitch=this._pitch}}),a.PitchShift.prototype.dispose=function(){return a.FeedbackEffect.prototype.dispose.call(this),
this._frequency.dispose(),this._frequency=null,this._delayA.disconnect(),this._delayA=null,this._delayB.disconnect(),this._delayB=null,this._lfoA.dispose(),this._lfoA=null,this._lfoB.dispose(),this._lfoB=null,this._crossFade.dispose(),this._crossFade=null,this._crossFadeLFO.dispose(),this._crossFadeLFO=null,this._writable("delayTime"),this._feedbackDelay.dispose(),this._feedbackDelay=null,this.delayTime=null,this},a.PitchShift})(b);(function(a){return a.StereoFeedbackEffect=function(){var b=this.optionsObject(arguments,
["feedback"],a.FeedbackEffect.defaults);a.StereoEffect.call(this,b);this.feedback=new a.Signal(b.feedback,a.Type.NormalRange);this._feedbackL=new a.Gain;this._feedbackR=new a.Gain;this.effectReturnL.chain(this._feedbackL,this.effectSendL);this.effectReturnR.chain(this._feedbackR,this.effectSendR);this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain);this._readOnly(["feedback"])},a.extend(a.StereoFeedbackEffect,a.FeedbackEffect),a.StereoFeedbackEffect.prototype.dispose=function(){return a.StereoEffect.prototype.dispose.call(this),
this._writable(["feedback"]),this.feedback.dispose(),this.feedback=null,this._feedbackL.dispose(),this._feedbackL=null,this._feedbackR.dispose(),this._feedbackR=null,this},a.StereoFeedbackEffect})(b);(function(a){return a.StereoWidener=function(){var b=this.optionsObject(arguments,["width"],a.StereoWidener.defaults);a.MidSideEffect.call(this,b);this.width=new a.Signal(b.width,a.Type.NormalRange);this._midMult=new a.Expr("$0 * ($1 * (1 - $2))");this._sideMult=new a.Expr("$0 * ($1 * $2)");this._two=
new a.Signal(2);this._two.connect(this._midMult,0,1);this.width.connect(this._midMult,0,2);this._two.connect(this._sideMult,0,1);this.width.connect(this._sideMult,0,2);this.midSend.chain(this._midMult,this.midReturn);this.sideSend.chain(this._sideMult,this.sideReturn);this._readOnly(["width"])},a.extend(a.StereoWidener,a.MidSideEffect),a.StereoWidener.defaults={width:.5},a.StereoWidener.prototype.dispose=function(){return a.MidSideEffect.prototype.dispose.call(this),this._writable(["width"]),this.width.dispose(),
this.width=null,this._midMult.dispose(),this._midMult=null,this._sideMult.dispose(),this._sideMult=null,this._two.dispose(),this._two=null,this},a.StereoWidener})(b);(function(a){return a.Tremolo=function(){var b=this.optionsObject(arguments,["frequency","depth"],a.Tremolo.defaults);a.StereoEffect.call(this,b);this._lfoL=new a.LFO({phase:b.spread,min:1,max:0});this._lfoR=new a.LFO({phase:b.spread,min:1,max:0});this._amplitudeL=new a.Gain;this._amplitudeR=new a.Gain;this.frequency=new a.Signal(b.frequency,
a.Type.Frequency);this.depth=new a.Signal(b.depth,a.Type.NormalRange);this._readOnly(["frequency","depth"]);this.effectSendL.chain(this._amplitudeL,this.effectReturnL);this.effectSendR.chain(this._amplitudeR,this.effectReturnR);this._lfoL.connect(this._amplitudeL.gain);this._lfoR.connect(this._amplitudeR.gain);this.frequency.fan(this._lfoL.frequency,this._lfoR.frequency);this.depth.fan(this._lfoR.amplitude,this._lfoL.amplitude);this.type=b.type;this.spread=b.spread},a.extend(a.Tremolo,a.StereoEffect),
a.Tremolo.defaults={frequency:10,type:"sine",depth:.5,spread:180},a.Tremolo.prototype.start=function(a){return this._lfoL.start(a),this._lfoR.start(a),this},a.Tremolo.prototype.stop=function(a){return this._lfoL.stop(a),this._lfoR.stop(a),this},a.Tremolo.prototype.sync=function(a){return this._lfoL.sync(a),this._lfoR.sync(a),this},a.Tremolo.prototype.unsync=function(){return this._lfoL.unsync(),this._lfoR.unsync(),this},Object.defineProperty(a.Tremolo.prototype,"type",{get:function(){return this._lfoL.type},
set:function(a){this._lfoL.type=a;this._lfoR.type=a}}),Object.defineProperty(a.Tremolo.prototype,"spread",{get:function(){return this._lfoR.phase-this._lfoL.phase},set:function(a){this._lfoL.phase=90-a/2;this._lfoR.phase=a/2+90}}),a.Tremolo.prototype.dispose=function(){return a.StereoEffect.prototype.dispose.call(this),this._writable(["frequency","depth"]),this._lfoL.dispose(),this._lfoL=null,this._lfoR.dispose(),this._lfoR=null,this._amplitudeL.dispose(),this._amplitudeL=null,this._amplitudeR.dispose(),
this._amplitudeR=null,this.frequency=null,this.depth=null,this},a.Tremolo})(b);(function(a){return a.Vibrato=function(){var b=this.optionsObject(arguments,["frequency","depth"],a.Vibrato.defaults);a.Effect.call(this,b);this._delayNode=new a.Delay(0,b.maxDelay);this._lfo=(new a.LFO({type:b.type,min:0,max:b.maxDelay,frequency:b.frequency,phase:-90})).start().connect(this._delayNode.delayTime);this.frequency=this._lfo.frequency;this.depth=this._lfo.amplitude;this.depth.value=b.depth;this._readOnly(["frequency",
"depth"]);this.effectSend.chain(this._delayNode,this.effectReturn)},a.extend(a.Vibrato,a.Effect),a.Vibrato.defaults={maxDelay:.005,frequency:5,depth:.1,type:"sine"},Object.defineProperty(a.Vibrato.prototype,"type",{get:function(){return this._lfo.type},set:function(a){this._lfo.type=a}}),a.Vibrato.prototype.dispose=function(){a.Effect.prototype.dispose.call(this);this._delayNode.dispose();this._delayNode=null;this._lfo.dispose();this._lfo=null;this._writable(["frequency","depth"]);this.depth=this.frequency=
null},a.Vibrato})(b);(function(a){return a.Event=function(){var b=this.optionsObject(arguments,["callback","value"],a.Event.defaults);this._loop=b.loop;this.callback=b.callback;this.value=b.value;this._loopStart=this.toTicks(b.loopStart);this._loopEnd=this.toTicks(b.loopEnd);this._state=new a.TimelineState(a.State.Stopped);this._playbackRate=1;this._startOffset=0;this.probability=b.probability;this.humanize=b.humanize;this.mute=b.mute;this.playbackRate=b.playbackRate},a.extend(a.Event),a.Event.defaults=
{callback:a.noOp,loop:!1,loopEnd:"1m",loopStart:0,playbackRate:1,value:null,probability:1,mute:!1,humanize:!1},a.Event.prototype._rescheduleEvents=function(b){return b=this.defaultArg(b,-1),this._state.forEachFrom(b,function(b){var c,d,g,h;b.state===a.State.Started&&(this.isUndef(b.id)||a.Transport.clear(b.id),d=b.time+Math.round(this.startOffset/this._playbackRate),this._loop?(c=1/0,this.isNumber(this._loop)&&(c=this._loop*this._getLoopDuration()),g=this._state.getAfter(d),null!==g&&(c=Math.min(c,
g.time-d)),c!==1/0&&(this._state.setStateAtTime(a.State.Stopped,d+c+1),c=a.Time(c,"i")),h=a.Time(this._getLoopDuration(),"i"),b.id=a.Transport.scheduleRepeat(this._tick.bind(this),h,a.TransportTime(d,"i"),c)):b.id=a.Transport.schedule(this._tick.bind(this),d+"i"))}.bind(this)),this},Object.defineProperty(a.Event.prototype,"state",{get:function(){return this._state.getValueAtTime(a.Transport.ticks)}}),Object.defineProperty(a.Event.prototype,"startOffset",{get:function(){return this._startOffset},set:function(a){this._startOffset=
a}}),a.Event.prototype.start=function(b){return b=this.toTicks(b),this._state.getValueAtTime(b)===a.State.Stopped&&(this._state.add({state:a.State.Started,time:b,id:void 0}),this._rescheduleEvents(b)),this},a.Event.prototype.stop=function(b){var c,e;return this.cancel(b),b=this.toTicks(b),this._state.getValueAtTime(b)===a.State.Started&&(this._state.setStateAtTime(a.State.Stopped,b),c=this._state.getBefore(b),e=b,null!==c&&(e=c.time),this._rescheduleEvents(e)),this},a.Event.prototype.cancel=function(b){return b=
this.defaultArg(b,-(1/0)),b=this.toTicks(b),this._state.forEachFrom(b,function(b){a.Transport.clear(b.id)}),this._state.cancel(b),this},a.Event.prototype._tick=function(b){if(!(this.mute||this._state.getValueAtTime(a.Transport.ticks)!==a.State.Started||1>this.probability&&Math.random()>this.probability)){if(this.humanize){var c=.02;this.isBoolean(this.humanize)||(c=this.toSeconds(this.humanize));b+=(2*Math.random()-1)*c}this.callback(b,this.value)}},a.Event.prototype._getLoopDuration=function(){return Math.round((this._loopEnd-
this._loopStart)/this._playbackRate)},Object.defineProperty(a.Event.prototype,"loop",{get:function(){return this._loop},set:function(a){this._loop=a;this._rescheduleEvents()}}),Object.defineProperty(a.Event.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(a){this._playbackRate=a;this._rescheduleEvents()}}),Object.defineProperty(a.Event.prototype,"loopEnd",{get:function(){return a.TransportTime(this._loopEnd,"i").toNotation()},set:function(a){this._loopEnd=this.toTicks(a);
this._loop&&this._rescheduleEvents()}}),Object.defineProperty(a.Event.prototype,"loopStart",{get:function(){return a.TransportTime(this._loopStart,"i").toNotation()},set:function(a){this._loopStart=this.toTicks(a);this._loop&&this._rescheduleEvents()}}),Object.defineProperty(a.Event.prototype,"progress",{get:function(){var b,d,e,f;return this._loop?(b=a.Transport.ticks,d=this._state.get(b),null!==d&&d.state===a.State.Started?(e=this._getLoopDuration(),f=(b-d.time)%e,f/e):0):0}}),a.Event.prototype.dispose=
function(){this.cancel();this._state.dispose();this.value=this.callback=this._state=null},a.Event})(b);(function(a){return a.Loop=function(){var b=this.optionsObject(arguments,["callback","interval"],a.Loop.defaults);this._event=new a.Event({callback:this._tick.bind(this),loop:!0,loopEnd:b.interval,playbackRate:b.playbackRate,probability:b.probability});this.callback=b.callback;this.iterations=b.iterations},a.extend(a.Loop),a.Loop.defaults={interval:"4n",callback:a.noOp,playbackRate:1,iterations:1/
0,probability:!0,mute:!1},a.Loop.prototype.start=function(a){return this._event.start(a),this},a.Loop.prototype.stop=function(a){return this._event.stop(a),this},a.Loop.prototype.cancel=function(a){return this._event.cancel(a),this},a.Loop.prototype._tick=function(a){this.callback(a)},Object.defineProperty(a.Loop.prototype,"state",{get:function(){return this._event.state}}),Object.defineProperty(a.Loop.prototype,"progress",{get:function(){return this._event.progress}}),Object.defineProperty(a.Loop.prototype,
"interval",{get:function(){return this._event.loopEnd},set:function(a){this._event.loopEnd=a}}),Object.defineProperty(a.Loop.prototype,"playbackRate",{get:function(){return this._event.playbackRate},set:function(a){this._event.playbackRate=a}}),Object.defineProperty(a.Loop.prototype,"humanize",{get:function(){return this._event.humanize},set:function(a){this._event.humanize=a}}),Object.defineProperty(a.Loop.prototype,"probability",{get:function(){return this._event.probability},set:function(a){this._event.probability=
a}}),Object.defineProperty(a.Loop.prototype,"mute",{get:function(){return this._event.mute},set:function(a){this._event.mute=a}}),Object.defineProperty(a.Loop.prototype,"iterations",{get:function(){return!0===this._event.loop?1/0:this._event.loop},set:function(a){a===1/0?this._event.loop=!0:this._event.loop=a}}),a.Loop.prototype.dispose=function(){this._event.dispose();this.callback=this._event=null},a.Loop})(b);(function(a){return a.Part=function(){var b;var d=this.optionsObject(arguments,["callback",
"events"],a.Part.defaults);if(this._loop=d.loop,this._loopStart=this.toTicks(d.loopStart),this._loopEnd=this.toTicks(d.loopEnd),this._playbackRate=d.playbackRate,this._probability=d.probability,this._humanize=d.humanize,this._startOffset=0,this._state=new a.TimelineState(a.State.Stopped),this._events=[],this.callback=d.callback,this.mute=d.mute,b=this.defaultArg(d.events,[]),!this.isUndef(d.events))for(d=0;d<b.length;d++)Array.isArray(b[d])?this.add(b[d][0],b[d][1]):this.add(b[d])},a.extend(a.Part,
a.Event),a.Part.defaults={callback:a.noOp,loop:!1,loopEnd:"1m",loopStart:0,playbackRate:1,probability:1,humanize:!1,mute:!1},a.Part.prototype.start=function(b,d){var c=this.toTicks(b);return this._state.getValueAtTime(c)!==a.State.Started&&(d=this._loop?this.defaultArg(d,this._loopStart):this.defaultArg(d,0),d=this.toTicks(d),this._state.add({state:a.State.Started,time:c,offset:d}),this._forEach(function(a){this._startNote(a,c,d)})),this},a.Part.prototype._startNote=function(b,d,e){d-=e;this._loop?
b.startOffset>=this._loopStart&&b.startOffset<this._loopEnd?(b.startOffset<e&&(d+=this._getLoopDuration()),b.start(a.TransportTime(d,"i"))):b.startOffset<this._loopStart&&b.startOffset>=e&&(b.loop=!1,b.start(a.TransportTime(d,"i"))):b.startOffset>=e&&b.start(a.TransportTime(d,"i"))},Object.defineProperty(a.Part.prototype,"startOffset",{get:function(){return this._startOffset},set:function(a){this._startOffset=a;this._forEach(function(a){a.startOffset+=this._startOffset})}}),a.Part.prototype.stop=
function(b){var c=this.toTicks(b);return this._state.cancel(c),this._state.setStateAtTime(a.State.Stopped,c),this._forEach(function(a){a.stop(b)}),this},a.Part.prototype.at=function(b,d){var c,f;b=a.TransportTime(b);var g=a.Time(1,"i").toSeconds();for(c=0;c<this._events.length;c++)if(f=this._events[c],Math.abs(b.toTicks()-f.startOffset)<g)return this.isUndef(d)||(f.value=d),f;return this.isUndef(d)?null:(this.add(b,d),this._events[this._events.length-1])},a.Part.prototype.add=function(b,d){b.hasOwnProperty("time")&&
(d=b,b=d.time);b=this.toTicks(b);var c;return d instanceof a.Event?(c=d,c.callback=this._tick.bind(this)):c=new a.Event({callback:this._tick.bind(this),value:d}),c.startOffset=b,c.set({loopEnd:this.loopEnd,loopStart:this.loopStart,loop:this.loop,humanize:this.humanize,playbackRate:this.playbackRate,probability:this.probability}),this._events.push(c),this._restartEvent(c),this},a.Part.prototype._restartEvent=function(b){this._state.forEach(function(c){c.state===a.State.Started?this._startNote(b,c.time,
c.offset):b.stop(a.TransportTime(c.time,"i"))}.bind(this))},a.Part.prototype.remove=function(b,d){var c;b.hasOwnProperty("time")&&(d=b,b=d.time);b=this.toTicks(b);for(c=this._events.length-1;0<=c;c--){var f=this._events[c];f instanceof a.Part?f.remove(b,d):f.startOffset===b&&(this.isUndef(d)||!this.isUndef(d)&&f.value===d)&&(this._events.splice(c,1),f.dispose())}return this},a.Part.prototype.removeAll=function(){return this._forEach(function(a){a.dispose()}),this._events=[],this},a.Part.prototype.cancel=
function(a){return a=this.toTicks(a),this._forEach(function(b){b.cancel(a)}),this._state.cancel(a),this},a.Part.prototype._forEach=function(b,d){var c;d=this.defaultArg(d,this);for(c=this._events.length-1;0<=c;c--){var f=this._events[c];f instanceof a.Part?f._forEach(b,d):b.call(d,f)}return this},a.Part.prototype._setAll=function(a,b){this._forEach(function(c){c[a]=b})},a.Part.prototype._tick=function(a,b){this.mute||this.callback(a,b)},a.Part.prototype._testLoopBoundries=function(b){b.startOffset<
this._loopStart||b.startOffset>=this._loopEnd?b.cancel(0):b.state===a.State.Stopped&&this._restartEvent(b)},Object.defineProperty(a.Part.prototype,"probability",{get:function(){return this._probability},set:function(a){this._probability=a;this._setAll("probability",a)}}),Object.defineProperty(a.Part.prototype,"humanize",{get:function(){return this._humanize},set:function(a){this._humanize=a;this._setAll("humanize",a)}}),Object.defineProperty(a.Part.prototype,"loop",{get:function(){return this._loop},
set:function(a){this._loop=a;this._forEach(function(b){b._loopStart=this._loopStart;b._loopEnd=this._loopEnd;b.loop=a;this._testLoopBoundries(b)})}}),Object.defineProperty(a.Part.prototype,"loopEnd",{get:function(){return a.TransportTime(this._loopEnd,"i").toNotation()},set:function(a){this._loopEnd=this.toTicks(a);this._loop&&this._forEach(function(b){b.loopEnd=a;this._testLoopBoundries(b)})}}),Object.defineProperty(a.Part.prototype,"loopStart",{get:function(){return a.TransportTime(this._loopStart,
"i").toNotation()},set:function(a){this._loopStart=this.toTicks(a);this._loop&&this._forEach(function(a){a.loopStart=this.loopStart;this._testLoopBoundries(a)})}}),Object.defineProperty(a.Part.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(a){this._playbackRate=a;this._setAll("playbackRate",a)}}),Object.defineProperty(a.Part.prototype,"length",{get:function(){return this._events.length}}),a.Part.prototype.dispose=function(){return this.removeAll(),this._state.dispose(),
this._state=null,this.callback=null,this._events=null,this},a.Part})(b);(function(a){return a.Pattern=function(){var b=this.optionsObject(arguments,["callback","values","pattern"],a.Pattern.defaults);a.Loop.call(this,b);this._pattern=new a.CtrlPattern({values:b.values,type:b.pattern,index:b.index})},a.extend(a.Pattern,a.Loop),a.Pattern.defaults={pattern:a.CtrlPattern.Type.Up,values:[]},a.Pattern.prototype._tick=function(a){this.callback(a,this._pattern.value);this._pattern.next()},Object.defineProperty(a.Pattern.prototype,
"index",{get:function(){return this._pattern.index},set:function(a){this._pattern.index=a}}),Object.defineProperty(a.Pattern.prototype,"values",{get:function(){return this._pattern.values},set:function(a){this._pattern.values=a}}),Object.defineProperty(a.Pattern.prototype,"value",{get:function(){return this._pattern.value}}),Object.defineProperty(a.Pattern.prototype,"pattern",{get:function(){return this._pattern.type},set:function(a){this._pattern.type=a}}),a.Pattern.prototype.dispose=function(){a.Loop.prototype.dispose.call(this);
this._pattern.dispose();this._pattern=null},a.Pattern})(b);(function(a){return a.Sequence=function(){var b=this.optionsObject(arguments,["callback","events","subdivision"],a.Sequence.defaults);var d=b.events;if(delete b.events,a.Part.call(this,b),this._subdivision=this.toTicks(b.subdivision),this.isUndef(b.loopEnd)&&!this.isUndef(d)&&(this._loopEnd=d.length*this._subdivision),this._loop=!0,!this.isUndef(d))for(b=0;b<d.length;b++)this.add(b,d[b])},a.extend(a.Sequence,a.Part),a.Sequence.defaults={subdivision:"4n"},
Object.defineProperty(a.Sequence.prototype,"subdivision",{get:function(){return a.Time(this._subdivision,"i").toNotation()}}),a.Sequence.prototype.at=function(b,d){return this.isArray(d)&&this.remove(b),a.Part.prototype.at.call(this,this._indexTime(b),d)},a.Sequence.prototype.add=function(b,d){if(null===d)return this;if(this.isArray(d)){var c=Math.round(this._subdivision/d.length);d=new a.Sequence(this._tick.bind(this),d,a.Time(c,"i"))}return a.Part.prototype.add.call(this,this._indexTime(b),d),this},
a.Sequence.prototype.remove=function(b,d){return a.Part.prototype.remove.call(this,this._indexTime(b),d),this},a.Sequence.prototype._indexTime=function(b){return b instanceof a.TransportTime?b:a.TransportTime(b*this._subdivision+this.startOffset,"i")},a.Sequence.prototype.dispose=function(){return a.Part.prototype.dispose.call(this),this},a.Sequence})(b);(function(a){return a.PulseOscillator=function(){var b=this.optionsObject(arguments,["frequency","width"],a.Oscillator.defaults);a.Source.call(this,
b);this.width=new a.Signal(b.width,a.Type.NormalRange);this._widthGate=new a.Gain;this._sawtooth=new a.Oscillator({frequency:b.frequency,detune:b.detune,type:"sawtooth",phase:b.phase});this.frequency=this._sawtooth.frequency;this.detune=this._sawtooth.detune;this._thresh=new a.WaveShaper(function(a){return 0>a?-1:1});this._sawtooth.chain(this._thresh,this.output);this.width.chain(this._widthGate,this._thresh);this._readOnly(["width","frequency","detune"])},a.extend(a.PulseOscillator,a.Oscillator),
a.PulseOscillator.defaults={frequency:440,detune:0,phase:0,width:.2},a.PulseOscillator.prototype._start=function(a){a=this.toSeconds(a);this._sawtooth.start(a);this._widthGate.gain.setValueAtTime(1,a)},a.PulseOscillator.prototype._stop=function(a){a=this.toSeconds(a);this._sawtooth.stop(a);this._widthGate.gain.setValueAtTime(0,a)},Object.defineProperty(a.PulseOscillator.prototype,"phase",{get:function(){return this._sawtooth.phase},set:function(a){this._sawtooth.phase=a}}),Object.defineProperty(a.PulseOscillator.prototype,
"type",{get:function(){return"pulse"}}),Object.defineProperty(a.PulseOscillator.prototype,"partials",{get:function(){return[]}}),a.PulseOscillator.prototype.dispose=function(){return a.Source.prototype.dispose.call(this),this._sawtooth.dispose(),this._sawtooth=null,this._writable(["width","frequency","detune"]),this.width.dispose(),this.width=null,this._widthGate.dispose(),this._widthGate=null,this._thresh.dispose(),this._thresh=null,this.frequency=null,this.detune=null,this},a.PulseOscillator})(b);
(function(a){return a.PWMOscillator=function(){var b=this.optionsObject(arguments,["frequency","modulationFrequency"],a.PWMOscillator.defaults);a.Source.call(this,b);this._pulse=new a.PulseOscillator(b.modulationFrequency);this._pulse._sawtooth.type="sine";this._modulator=new a.Oscillator({frequency:b.frequency,detune:b.detune,phase:b.phase});this._scale=new a.Multiply(2);this.frequency=this._modulator.frequency;this.detune=this._modulator.detune;this.modulationFrequency=this._pulse.frequency;this._modulator.chain(this._scale,
this._pulse.width);this._pulse.connect(this.output);this._readOnly(["modulationFrequency","frequency","detune"])},a.extend(a.PWMOscillator,a.Oscillator),a.PWMOscillator.defaults={frequency:440,detune:0,phase:0,modulationFrequency:.4},a.PWMOscillator.prototype._start=function(a){a=this.toSeconds(a);this._modulator.start(a);this._pulse.start(a)},a.PWMOscillator.prototype._stop=function(a){a=this.toSeconds(a);this._modulator.stop(a);this._pulse.stop(a)},Object.defineProperty(a.PWMOscillator.prototype,
"type",{get:function(){return"pwm"}}),Object.defineProperty(a.PWMOscillator.prototype,"partials",{get:function(){return[]}}),Object.defineProperty(a.PWMOscillator.prototype,"phase",{get:function(){return this._modulator.phase},set:function(a){this._modulator.phase=a}}),a.PWMOscillator.prototype.dispose=function(){return a.Source.prototype.dispose.call(this),this._pulse.dispose(),this._pulse=null,this._scale.dispose(),this._scale=null,this._modulator.dispose(),this._modulator=null,this._writable(["modulationFrequency",
"frequency","detune"]),this.frequency=null,this.detune=null,this.modulationFrequency=null,this},a.PWMOscillator})(b);(function(a){return a.FMOscillator=function(){var b=this.optionsObject(arguments,["frequency","type","modulationType"],a.FMOscillator.defaults);a.Source.call(this,b);this._carrier=new a.Oscillator(b.frequency,b.type);this.frequency=new a.Signal(b.frequency,a.Type.Frequency);this.detune=this._carrier.detune;this.detune.value=b.detune;this.modulationIndex=new a.Multiply(b.modulationIndex);
this.modulationIndex.units=a.Type.Positive;this._modulator=new a.Oscillator(b.frequency,b.modulationType);this.harmonicity=new a.Multiply(b.harmonicity);this.harmonicity.units=a.Type.Positive;this._modulationNode=new a.Gain(0);this.frequency.connect(this._carrier.frequency);this.frequency.chain(this.harmonicity,this._modulator.frequency);this.frequency.chain(this.modulationIndex,this._modulationNode);this._modulator.connect(this._modulationNode.gain);this._modulationNode.connect(this._carrier.frequency);
this._carrier.connect(this.output);this.detune.connect(this._modulator.detune);this.phase=b.phase;this._readOnly(["modulationIndex","frequency","detune","harmonicity"])},a.extend(a.FMOscillator,a.Oscillator),a.FMOscillator.defaults={frequency:440,detune:0,phase:0,modulationIndex:2,modulationType:"square",harmonicity:1},a.FMOscillator.prototype._start=function(a){a=this.toSeconds(a);this._modulator.start(a);this._carrier.start(a)},a.FMOscillator.prototype._stop=function(a){a=this.toSeconds(a);this._modulator.stop(a);
this._carrier.stop(a)},Object.defineProperty(a.FMOscillator.prototype,"type",{get:function(){return this._carrier.type},set:function(a){this._carrier.type=a}}),Object.defineProperty(a.FMOscillator.prototype,"modulationType",{get:function(){return this._modulator.type},set:function(a){this._modulator.type=a}}),Object.defineProperty(a.FMOscillator.prototype,"phase",{get:function(){return this._carrier.phase},set:function(a){this._carrier.phase=a;this._modulator.phase=a}}),Object.defineProperty(a.FMOscillator.prototype,
"partials",{get:function(){return this._carrier.partials},set:function(a){this._carrier.partials=a}}),a.FMOscillator.prototype.dispose=function(){return a.Source.prototype.dispose.call(this),this._writable(["modulationIndex","frequency","detune","harmonicity"]),this.frequency.dispose(),this.frequency=null,this.detune=null,this.harmonicity.dispose(),this.harmonicity=null,this._carrier.dispose(),this._carrier=null,this._modulator.dispose(),this._modulator=null,this._modulationNode.dispose(),this._modulationNode=
null,this.modulationIndex.dispose(),this.modulationIndex=null,this},a.FMOscillator})(b);(function(a){return a.AMOscillator=function(){var b=this.optionsObject(arguments,["frequency","type","modulationType"],a.AMOscillator.defaults);a.Source.call(this,b);this._carrier=new a.Oscillator(b.frequency,b.type);this.frequency=this._carrier.frequency;this.detune=this._carrier.detune;this.detune.value=b.detune;this._modulator=new a.Oscillator(b.frequency,b.modulationType);this._modulationScale=new a.AudioToGain;
this.harmonicity=new a.Multiply(b.harmonicity);this.harmonicity.units=a.Type.Positive;this._modulationNode=new a.Gain(0);this.frequency.chain(this.harmonicity,this._modulator.frequency);this.detune.connect(this._modulator.detune);this._modulator.chain(this._modulationScale,this._modulationNode.gain);this._carrier.chain(this._modulationNode,this.output);this.phase=b.phase;this._readOnly(["frequency","detune","harmonicity"])},a.extend(a.AMOscillator,a.Oscillator),a.AMOscillator.defaults={frequency:440,
detune:0,phase:0,modulationType:"square",harmonicity:1},a.AMOscillator.prototype._start=function(a){a=this.toSeconds(a);this._modulator.start(a);this._carrier.start(a)},a.AMOscillator.prototype._stop=function(a){a=this.toSeconds(a);this._modulator.stop(a);this._carrier.stop(a)},Object.defineProperty(a.AMOscillator.prototype,"type",{get:function(){return this._carrier.type},set:function(a){this._carrier.type=a}}),Object.defineProperty(a.AMOscillator.prototype,"modulationType",{get:function(){return this._modulator.type},
set:function(a){this._modulator.type=a}}),Object.defineProperty(a.AMOscillator.prototype,"phase",{get:function(){return this._carrier.phase},set:function(a){this._carrier.phase=a;this._modulator.phase=a}}),Object.defineProperty(a.AMOscillator.prototype,"partials",{get:function(){return this._carrier.partials},set:function(a){this._carrier.partials=a}}),a.AMOscillator.prototype.dispose=function(){return a.Source.prototype.dispose.call(this),this._writable(["frequency","detune","harmonicity"]),this.frequency=
null,this.detune=null,this.harmonicity.dispose(),this.harmonicity=null,this._carrier.dispose(),this._carrier=null,this._modulator.dispose(),this._modulator=null,this._modulationNode.dispose(),this._modulationNode=null,this._modulationScale.dispose(),this._modulationScale=null,this},a.AMOscillator})(b);(function(a){return a.FatOscillator=function(){var b=this.optionsObject(arguments,["frequency","type","spread"],a.FatOscillator.defaults);a.Source.call(this,b);this.frequency=new a.Signal(b.frequency,
a.Type.Frequency);this.detune=new a.Signal(b.detune,a.Type.Cents);this._oscillators=[];this._spread=b.spread;this._type=b.type;this._phase=b.phase;this._partials=this.defaultArg(b.partials,[]);this.count=b.count;this._readOnly(["frequency","detune"])},a.extend(a.FatOscillator,a.Oscillator),a.FatOscillator.defaults={frequency:440,detune:0,phase:0,spread:20,count:3,type:"sawtooth"},a.FatOscillator.prototype._start=function(a){a=this.toSeconds(a);this._forEach(function(b){b.start(a)})},a.FatOscillator.prototype._stop=
function(a){a=this.toSeconds(a);this._forEach(function(b){b.stop(a)})},a.FatOscillator.prototype._forEach=function(a){for(var b=0;b<this._oscillators.length;b++)a.call(this,this._oscillators[b],b)},Object.defineProperty(a.FatOscillator.prototype,"type",{get:function(){return this._type},set:function(a){this._type=a;this._forEach(function(b){b.type=a})}}),Object.defineProperty(a.FatOscillator.prototype,"spread",{get:function(){return this._spread},set:function(a){var b,c;this._spread=a;1<this._oscillators.length&&
(b=-a/2,c=a/(this._oscillators.length-1),this._forEach(function(a,d){a.detune.value=b+c*d}))}}),Object.defineProperty(a.FatOscillator.prototype,"count",{get:function(){return this._oscillators.length},set:function(b){var c;if(b=Math.max(b,1),this._oscillators.length!==b){this._forEach(function(a){a.dispose()});this._oscillators=[];for(c=0;c<b;c++){var e=new a.Oscillator;this.type===a.Oscillator.Type.Custom?e.partials=this._partials:e.type=this._type;e.phase=this._phase;e.volume.value=-6-b;this.frequency.connect(e.frequency);
this.detune.connect(e.detune);e.connect(this.output);this._oscillators[c]=e}this.spread=this._spread;this.state===a.State.Started&&this._forEach(function(a){a.start()})}}}),Object.defineProperty(a.FatOscillator.prototype,"phase",{get:function(){return this._phase},set:function(a){this._phase=a;this._forEach(function(b){b.phase=a})}}),Object.defineProperty(a.FatOscillator.prototype,"partials",{get:function(){return this._partials},set:function(b){this._partials=b;this._type=a.Oscillator.Type.Custom;
this._forEach(function(a){a.partials=b})}}),a.FatOscillator.prototype.dispose=function(){return a.Source.prototype.dispose.call(this),this._writable(["frequency","detune"]),this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this._forEach(function(a){a.dispose()}),this._oscillators=null,this._partials=null,this},a.FatOscillator})(b);(function(a){a.OmniOscillator=function(){var b=this.optionsObject(arguments,["frequency","type"],a.OmniOscillator.defaults);a.Source.call(this,
b);this.frequency=new a.Signal(b.frequency,a.Type.Frequency);this.detune=new a.Signal(b.detune,a.Type.Cents);this._sourceType=void 0;this._oscillator=null;this.type=b.type;this._readOnly(["frequency","detune"]);this.set(b)};a.extend(a.OmniOscillator,a.Oscillator);a.OmniOscillator.defaults={frequency:440,detune:0,type:"sine",phase:0};return a.OmniOscillator.prototype._start=function(a){this._oscillator.start(a)},a.OmniOscillator.prototype._stop=function(a){this._oscillator.stop(a)},Object.defineProperty(a.OmniOscillator.prototype,
"type",{get:function(){var a="";return"FMOscillator"===this._sourceType?a="fm":"AMOscillator"===this._sourceType?a="am":"FatOscillator"===this._sourceType&&(a="fat"),a+this._oscillator.type},set:function(a){"fm"===a.substr(0,2)?(this._createNewOscillator("FMOscillator"),this._oscillator.type=a.substr(2)):"am"===a.substr(0,2)?(this._createNewOscillator("AMOscillator"),this._oscillator.type=a.substr(2)):"fat"===a.substr(0,3)?(this._createNewOscillator("FatOscillator"),this._oscillator.type=a.substr(3)):
"pwm"===a?this._createNewOscillator("PWMOscillator"):"pulse"===a?this._createNewOscillator("PulseOscillator"):(this._createNewOscillator("Oscillator"),this._oscillator.type=a)}}),Object.defineProperty(a.OmniOscillator.prototype,"partials",{get:function(){return this._oscillator.partials},set:function(a){this._oscillator.partials=a}}),a.OmniOscillator.prototype.set=function(b,d){return"type"===b?this.type=d:this.isObject(b)&&b.hasOwnProperty("type")&&(this.type=b.type),a.prototype.set.apply(this,arguments),
this},a.OmniOscillator.prototype._createNewOscillator=function(b){var c,e,f;b!==this._sourceType&&(this._sourceType=b,c=a[b],e=this.now()+this.blockTime,null!==this._oscillator&&(f=this._oscillator,f.stop(e),setTimeout(function(){f.dispose();f=null},1E3*this.blockTime)),this._oscillator=new c,this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this.state===a.State.Started&&this._oscillator.start(e))},Object.defineProperty(a.OmniOscillator.prototype,
"phase",{get:function(){return this._oscillator.phase},set:function(a){this._oscillator.phase=a}}),Object.defineProperty(a.OmniOscillator.prototype,"width",{get:function(){if("PulseOscillator"===this._sourceType)return this._oscillator.width}}),Object.defineProperty(a.OmniOscillator.prototype,"count",{get:function(){if("FatOscillator"===this._sourceType)return this._oscillator.count},set:function(a){"FatOscillator"===this._sourceType&&(this._oscillator.count=a)}}),Object.defineProperty(a.OmniOscillator.prototype,
"spread",{get:function(){if("FatOscillator"===this._sourceType)return this._oscillator.spread},set:function(a){"FatOscillator"===this._sourceType&&(this._oscillator.spread=a)}}),Object.defineProperty(a.OmniOscillator.prototype,"modulationType",{get:function(){if("FMOscillator"===this._sourceType||"AMOscillator"===this._sourceType)return this._oscillator.modulationType},set:function(a){"FMOscillator"!==this._sourceType&&"AMOscillator"!==this._sourceType||(this._oscillator.modulationType=a)}}),Object.defineProperty(a.OmniOscillator.prototype,
"modulationIndex",{get:function(){if("FMOscillator"===this._sourceType)return this._oscillator.modulationIndex}}),Object.defineProperty(a.OmniOscillator.prototype,"harmonicity",{get:function(){if("FMOscillator"===this._sourceType||"AMOscillator"===this._sourceType)return this._oscillator.harmonicity}}),Object.defineProperty(a.OmniOscillator.prototype,"modulationFrequency",{get:function(){if("PWMOscillator"===this._sourceType)return this._oscillator.modulationFrequency}}),a.OmniOscillator.prototype.dispose=
function(){return a.Source.prototype.dispose.call(this),this._writable(["frequency","detune"]),this.detune.dispose(),this.detune=null,this.frequency.dispose(),this.frequency=null,this._oscillator.dispose(),this._oscillator=null,this._sourceType=null,this},a.OmniOscillator})(b);(function(a){return a.Instrument=function(b){b=this.defaultArg(b,a.Instrument.defaults);this._volume=this.output=new a.Volume(b.volume);this.volume=this._volume.volume;this._readOnly("volume")},a.extend(a.Instrument),a.Instrument.defaults=
{volume:0},a.Instrument.prototype.triggerAttack=a.noOp,a.Instrument.prototype.triggerRelease=a.noOp,a.Instrument.prototype.triggerAttackRelease=function(a,b,e,f){return e=this.isUndef(e)?this.now()+this.blockTime:this.toSeconds(e),b=this.toSeconds(b),this.triggerAttack(a,e,f),this.triggerRelease(e+b),this},a.Instrument.prototype.dispose=function(){return a.prototype.dispose.call(this),this._volume.dispose(),this._volume=null,this._writable(["volume"]),this.volume=null,this},a.Instrument})(b);(function(a){return a.Monophonic=
function(b){b=this.defaultArg(b,a.Monophonic.defaults);a.Instrument.call(this,b);this.portamento=b.portamento},a.extend(a.Monophonic,a.Instrument),a.Monophonic.defaults={portamento:0},a.Monophonic.prototype.triggerAttack=function(a,b,e){return b=this.isUndef(b)?this.now()+this.blockTime:this.toSeconds(b),this._triggerEnvelopeAttack(b,e),this.setNote(a,b),this},a.Monophonic.prototype.triggerRelease=function(a){return a=this.isUndef(a)?this.now()+this.blockTime:this.toSeconds(a),this._triggerEnvelopeRelease(a),
this},a.Monophonic.prototype._triggerEnvelopeAttack=function(){},a.Monophonic.prototype._triggerEnvelopeRelease=function(){},a.Monophonic.prototype.setNote=function(a,b){var c,d;return b=this.toSeconds(b),0<this.portamento?(c=this.frequency.value,this.frequency.setValueAtTime(c,b),d=this.toSeconds(this.portamento),this.frequency.exponentialRampToValueAtTime(a,b+d)):this.frequency.setValueAtTime(a,b),this},a.Monophonic})(b);(function(a){return a.Synth=function(b){b=this.defaultArg(b,a.Synth.defaults);
a.Monophonic.call(this,b);this.oscillator=new a.OmniOscillator(b.oscillator);this.frequency=this.oscillator.frequency;this.detune=this.oscillator.detune;this.envelope=new a.AmplitudeEnvelope(b.envelope);this.oscillator.chain(this.envelope,this.output);this.oscillator.start();this._readOnly(["oscillator","frequency","detune","envelope"])},a.extend(a.Synth,a.Monophonic),a.Synth.defaults={oscillator:{type:"triangle"},envelope:{attack:.005,decay:.1,sustain:.3,release:1}},a.Synth.prototype._triggerEnvelopeAttack=
function(a,b){return this.envelope.triggerAttack(a,b),this},a.Synth.prototype._triggerEnvelopeRelease=function(a){return this.envelope.triggerRelease(a),this},a.Synth.prototype.dispose=function(){return a.Monophonic.prototype.dispose.call(this),this._writable(["oscillator","frequency","detune","envelope"]),this.oscillator.dispose(),this.oscillator=null,this.envelope.dispose(),this.envelope=null,this.frequency=null,this.detune=null,this},a.Synth})(b);(function(a){return a.AMSynth=function(b){b=this.defaultArg(b,
a.AMSynth.defaults);a.Monophonic.call(this,b);this._carrier=new a.Synth;this._carrier.volume.value=-10;this.oscillator=this._carrier.oscillator;this.envelope=this._carrier.envelope.set(b.envelope);this._modulator=new a.Synth;this._modulator.volume.value=-10;this.modulation=this._modulator.oscillator.set(b.modulation);this.modulationEnvelope=this._modulator.envelope.set(b.modulationEnvelope);this.frequency=new a.Signal(440,a.Type.Frequency);this.detune=new a.Signal(b.detune,a.Type.Cents);this.harmonicity=
new a.Multiply(b.harmonicity);this.harmonicity.units=a.Type.Positive;this._modulationScale=new a.AudioToGain;this._modulationNode=new a.Gain;this.frequency.connect(this._carrier.frequency);this.frequency.chain(this.harmonicity,this._modulator.frequency);this.detune.fan(this._carrier.detune,this._modulator.detune);this._modulator.chain(this._modulationScale,this._modulationNode.gain);this._carrier.chain(this._modulationNode,this.output);this._readOnly("frequency harmonicity oscillator envelope modulation modulationEnvelope detune".split(" "))},
a.extend(a.AMSynth,a.Monophonic),a.AMSynth.defaults={harmonicity:3,detune:0,oscillator:{type:"sine"},envelope:{attack:.01,decay:.01,sustain:1,release:.5},modulation:{type:"square"},modulationEnvelope:{attack:.5,decay:0,sustain:1,release:.5}},a.AMSynth.prototype._triggerEnvelopeAttack=function(a,b){return a=this.toSeconds(a),this.envelope.triggerAttack(a,b),this.modulationEnvelope.triggerAttack(a,b),this},a.AMSynth.prototype._triggerEnvelopeRelease=function(a){return this.envelope.triggerRelease(a),
this.modulationEnvelope.triggerRelease(a),this},a.AMSynth.prototype.dispose=function(){return a.Monophonic.prototype.dispose.call(this),this._writable("frequency harmonicity oscillator envelope modulation modulationEnvelope detune".split(" ")),this._carrier.dispose(),this._carrier=null,this._modulator.dispose(),this._modulator=null,this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this.harmonicity.dispose(),this.harmonicity=null,this._modulationScale.dispose(),this._modulationScale=
null,this._modulationNode.dispose(),this._modulationNode=null,this.oscillator=null,this.envelope=null,this.modulationEnvelope=null,this.modulation=null,this},a.AMSynth})(b);(function(a){return a.MonoSynth=function(b){b=this.defaultArg(b,a.MonoSynth.defaults);a.Monophonic.call(this,b);this.oscillator=new a.OmniOscillator(b.oscillator);this.frequency=this.oscillator.frequency;this.detune=this.oscillator.detune;this.filter=new a.Filter(b.filter);this.filterEnvelope=new a.FrequencyEnvelope(b.filterEnvelope);
this.envelope=new a.AmplitudeEnvelope(b.envelope);this.oscillator.chain(this.filter,this.envelope,this.output);this.oscillator.start();this.filterEnvelope.connect(this.filter.frequency);this._readOnly("oscillator frequency detune filter filterEnvelope envelope".split(" "))},a.extend(a.MonoSynth,a.Monophonic),a.MonoSynth.defaults={frequency:"C4",detune:0,oscillator:{type:"square"},filter:{Q:6,type:"lowpass",rolloff:-24},envelope:{attack:.005,decay:.1,sustain:.9,release:1},filterEnvelope:{attack:.06,
decay:.2,sustain:.5,release:2,baseFrequency:200,octaves:7,exponent:2}},a.MonoSynth.prototype._triggerEnvelopeAttack=function(a,b){return this.envelope.triggerAttack(a,b),this.filterEnvelope.triggerAttack(a),this},a.MonoSynth.prototype._triggerEnvelopeRelease=function(a){return this.envelope.triggerRelease(a),this.filterEnvelope.triggerRelease(a),this},a.MonoSynth.prototype.dispose=function(){return a.Monophonic.prototype.dispose.call(this),this._writable("oscillator frequency detune filter filterEnvelope envelope".split(" ")),
this.oscillator.dispose(),this.oscillator=null,this.envelope.dispose(),this.envelope=null,this.filterEnvelope.dispose(),this.filterEnvelope=null,this.filter.dispose(),this.filter=null,this.frequency=null,this.detune=null,this},a.MonoSynth})(b);(function(a){return a.DuoSynth=function(b){b=this.defaultArg(b,a.DuoSynth.defaults);a.Monophonic.call(this,b);this.voice0=new a.MonoSynth(b.voice0);this.voice0.volume.value=-10;this.voice1=new a.MonoSynth(b.voice1);this.voice1.volume.value=-10;this._vibrato=
new a.LFO(b.vibratoRate,-50,50);this._vibrato.start();this.vibratoRate=this._vibrato.frequency;this._vibratoGain=new a.Gain(b.vibratoAmount,a.Type.Positive);this.vibratoAmount=this._vibratoGain.gain;this.frequency=new a.Signal(440,a.Type.Frequency);this.harmonicity=new a.Multiply(b.harmonicity);this.harmonicity.units=a.Type.Positive;this.frequency.connect(this.voice0.frequency);this.frequency.chain(this.harmonicity,this.voice1.frequency);this._vibrato.connect(this._vibratoGain);this._vibratoGain.fan(this.voice0.detune,
this.voice1.detune);this.voice0.connect(this.output);this.voice1.connect(this.output);this._readOnly(["voice0","voice1","frequency","vibratoAmount","vibratoRate"])},a.extend(a.DuoSynth,a.Monophonic),a.DuoSynth.defaults={vibratoAmount:.5,vibratoRate:5,harmonicity:1.5,voice0:{volume:-10,portamento:0,oscillator:{type:"sine"},filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}},voice1:{volume:-10,portamento:0,oscillator:{type:"sine"},filterEnvelope:{attack:.01,
decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}}},a.DuoSynth.prototype._triggerEnvelopeAttack=function(a,b){return a=this.toSeconds(a),this.voice0.envelope.triggerAttack(a,b),this.voice1.envelope.triggerAttack(a,b),this.voice0.filterEnvelope.triggerAttack(a),this.voice1.filterEnvelope.triggerAttack(a),this},a.DuoSynth.prototype._triggerEnvelopeRelease=function(a){return this.voice0.triggerRelease(a),this.voice1.triggerRelease(a),this},a.DuoSynth.prototype.dispose=
function(){return a.Monophonic.prototype.dispose.call(this),this._writable(["voice0","voice1","frequency","vibratoAmount","vibratoRate"]),this.voice0.dispose(),this.voice0=null,this.voice1.dispose(),this.voice1=null,this.frequency.dispose(),this.frequency=null,this._vibratoGain.dispose(),this._vibratoGain=null,this._vibrato=null,this.harmonicity.dispose(),this.harmonicity=null,this.vibratoAmount.dispose(),this.vibratoAmount=null,this.vibratoRate=null,this},a.DuoSynth})(b);(function(a){return a.FMSynth=
function(b){b=this.defaultArg(b,a.FMSynth.defaults);a.Monophonic.call(this,b);this._carrier=new a.Synth(b.carrier);this._carrier.volume.value=-10;this.oscillator=this._carrier.oscillator;this.envelope=this._carrier.envelope.set(b.envelope);this._modulator=new a.Synth(b.modulator);this._modulator.volume.value=-10;this.modulation=this._modulator.oscillator.set(b.modulation);this.modulationEnvelope=this._modulator.envelope.set(b.modulationEnvelope);this.frequency=new a.Signal(440,a.Type.Frequency);this.detune=
new a.Signal(b.detune,a.Type.Cents);this.harmonicity=new a.Multiply(b.harmonicity);this.harmonicity.units=a.Type.Positive;this.modulationIndex=new a.Multiply(b.modulationIndex);this.modulationIndex.units=a.Type.Positive;this._modulationNode=new a.Gain(0);this.frequency.connect(this._carrier.frequency);this.frequency.chain(this.harmonicity,this._modulator.frequency);this.frequency.chain(this.modulationIndex,this._modulationNode);this.detune.fan(this._carrier.detune,this._modulator.detune);this._modulator.connect(this._modulationNode.gain);
this._modulationNode.connect(this._carrier.frequency);this._carrier.connect(this.output);this._readOnly("frequency harmonicity modulationIndex oscillator envelope modulation modulationEnvelope detune".split(" "))},a.extend(a.FMSynth,a.Monophonic),a.FMSynth.defaults={harmonicity:3,modulationIndex:10,detune:0,oscillator:{type:"sine"},envelope:{attack:.01,decay:.01,sustain:1,release:.5},modulation:{type:"square"},modulationEnvelope:{attack:.5,decay:0,sustain:1,release:.5}},a.FMSynth.prototype._triggerEnvelopeAttack=
function(a,b){return a=this.toSeconds(a),this.envelope.triggerAttack(a,b),this.modulationEnvelope.triggerAttack(a),this},a.FMSynth.prototype._triggerEnvelopeRelease=function(a){return a=this.toSeconds(a),this.envelope.triggerRelease(a),this.modulationEnvelope.triggerRelease(a),this},a.FMSynth.prototype.dispose=function(){return a.Monophonic.prototype.dispose.call(this),this._writable("frequency harmonicity modulationIndex oscillator envelope modulation modulationEnvelope detune".split(" ")),this._carrier.dispose(),
this._carrier=null,this._modulator.dispose(),this._modulator=null,this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this.modulationIndex.dispose(),this.modulationIndex=null,this.harmonicity.dispose(),this.harmonicity=null,this._modulationNode.dispose(),this._modulationNode=null,this.oscillator=null,this.envelope=null,this.modulationEnvelope=null,this.modulation=null,this},a.FMSynth})(b);(function(a){return a.MembraneSynth=function(b){b=this.defaultArg(b,a.MembraneSynth.defaults);
a.Instrument.call(this,b);this.oscillator=(new a.OmniOscillator(b.oscillator)).start();this.envelope=new a.AmplitudeEnvelope(b.envelope);this.octaves=b.octaves;this.pitchDecay=b.pitchDecay;this.oscillator.chain(this.envelope,this.output);this._readOnly(["oscillator","envelope"])},a.extend(a.MembraneSynth,a.Instrument),a.MembraneSynth.defaults={pitchDecay:.05,octaves:10,oscillator:{type:"sine"},envelope:{attack:.001,decay:.4,sustain:.01,release:1.4,attackCurve:"exponential"}},a.MembraneSynth.prototype.triggerAttack=
function(a,b,e){b=this.toSeconds(b);a=this.toFrequency(a);return this.oscillator.frequency.setValueAtTime(a*this.octaves,b),this.oscillator.frequency.exponentialRampToValueAtTime(a,b+this.toSeconds(this.pitchDecay)),this.envelope.triggerAttack(b,e),this},a.MembraneSynth.prototype.triggerRelease=function(a){return this.envelope.triggerRelease(a),this},a.MembraneSynth.prototype.dispose=function(){return a.Instrument.prototype.dispose.call(this),this._writable(["oscillator","envelope"]),this.oscillator.dispose(),
this.oscillator=null,this.envelope.dispose(),this.envelope=null,this},a.MembraneSynth})(b);(function(a){var b=[1,1.483,1.932,2.546,2.63,3.897];return a.MetalSynth=function(c){var d;c=this.defaultArg(c,a.MetalSynth.defaults);a.Instrument.call(this,c);this.frequency=new a.Signal(c.frequency,a.Type.Frequency);this._oscillators=[];this._freqMultipliers=[];this._amplitue=(new a.Gain(0)).connect(this.output);this._highpass=(new a.Filter({type:"highpass",Q:-3.0102999566398125})).connect(this._amplitue);
this._octaves=c.octaves;this._filterFreqScaler=new a.Scale(c.resonance,7E3);this.envelope=(new a.Envelope({attack:c.envelope.attack,attackCurve:"linear",decay:c.envelope.decay,sustain:0,release:c.envelope.release})).chain(this._filterFreqScaler,this._highpass.frequency);this.envelope.connect(this._amplitue.gain);for(d=0;d<b.length;d++){var f=new a.FMOscillator({type:"square",modulationType:"square",harmonicity:c.harmonicity,modulationIndex:c.modulationIndex});f.connect(this._highpass).start(0);this._oscillators[d]=
f;var g=new a.Multiply(b[d]);this._freqMultipliers[d]=g;this.frequency.chain(g,f.frequency)}this.octaves=c.octaves},a.extend(a.MetalSynth,a.Instrument),a.MetalSynth.defaults={frequency:200,envelope:{attack:.001,decay:1.4,release:.2},harmonicity:5.1,modulationIndex:32,resonance:4E3,octaves:1.5},a.MetalSynth.prototype.triggerAttack=function(a,b){return a=this.toSeconds(a),b=this.defaultArg(b,1),this.envelope.triggerAttack(a,b),this},a.MetalSynth.prototype.triggerRelease=function(a){return a=this.toSeconds(a),
this.envelope.triggerRelease(a),this},a.MetalSynth.prototype.triggerAttackRelease=function(a,b,c){return b=this.toSeconds(b),a=this.toSeconds(a),this.triggerAttack(b,c),this.triggerRelease(b+a),this},Object.defineProperty(a.MetalSynth.prototype,"modulationIndex",{get:function(){return this._oscillators[0].modulationIndex.value},set:function(a){for(var b=0;b<this._oscillators.length;b++)this._oscillators[b].modulationIndex.value=a}}),Object.defineProperty(a.MetalSynth.prototype,"harmonicity",{get:function(){return this._oscillators[0].harmonicity.value},
set:function(a){for(var b=0;b<this._oscillators.length;b++)this._oscillators[b].harmonicity.value=a}}),Object.defineProperty(a.MetalSynth.prototype,"resonance",{get:function(){return this._filterFreqScaler.min},set:function(a){this._filterFreqScaler.min=a;this.octaves=this._octaves}}),Object.defineProperty(a.MetalSynth.prototype,"octaves",{get:function(){return this._octaves},set:function(a){this._octaves=a;this._filterFreqScaler.max=this._filterFreqScaler.min*Math.pow(2,a)}}),a.MetalSynth.prototype.dispose=
function(){a.Instrument.prototype.dispose.call(this);for(var b=0;b<this._oscillators.length;b++)this._oscillators[b].dispose(),this._freqMultipliers[b].dispose();this._freqMultipliers=this._oscillators=null;this.frequency.dispose();this.frequency=null;this._filterFreqScaler.dispose();this._filterFreqScaler=null;this._amplitue.dispose();this._amplitue=null;this.envelope.dispose();this.envelope=null;this._highpass.dispose();this._highpass=null},a.MetalSynth})(b);(function(a){a.Noise=function(){var b=
this.optionsObject(arguments,["type"],a.Noise.defaults);a.Source.call(this,b);this._buffer=this._source=null;this._playbackRate=b.playbackRate;this.type=b.type};a.extend(a.Noise,a.Source);a.Noise.defaults={type:"white",playbackRate:1};Object.defineProperty(a.Noise.prototype,"type",{get:function(){return this._buffer===e?"white":this._buffer===d?"brown":this._buffer===b?"pink":void 0},set:function(c){if(this.type!==c){switch(c){case "white":this._buffer=e;break;case "pink":this._buffer=b;break;case "brown":this._buffer=
d;break;default:throw new TypeError("Tone.Noise: invalid type: "+c);}this.state===a.State.Started&&(c=this.now()+this.blockTime,this._stop(c),this._start(c))}}});Object.defineProperty(a.Noise.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(a){this._playbackRate=a;this._source&&(this._source.playbackRate.value=a)}});a.Noise.prototype._start=function(a){this._source=this.context.createBufferSource();this._source.buffer=this._buffer;this._source.loop=!0;this._source.playbackRate.value=
this._playbackRate;this._source.connect(this.output);this._source.start(this.toSeconds(a),Math.random()*(this._buffer.duration-.001))};a.Noise.prototype._stop=function(a){this._source&&this._source.stop(this.toSeconds(a))};a.Noise.prototype.dispose=function(){return a.Source.prototype.dispose.call(this),null!==this._source&&(this._source.disconnect(),this._source=null),this._buffer=null,this};var b=null,d=null,e=null;return a._initAudioContext(function(a){var c=a.sampleRate,f=4*c;b=function(){var b,
d,e,g,h,r,t,u,v,w=a.createBuffer(2,f,c);for(b=0;b<w.numberOfChannels;b++){var x=w.getChannelData(b);for(v=d=e=g=h=r=t=u=0;v<f;v++){var C=2*Math.random()-1;d=.99886*d+.0555179*C;e=.99332*e+.0750759*C;g=.969*g+.153852*C;h=.8665*h+.3104856*C;r=.55*r+.5329522*C;t=-.7616*t-.016898*C;x[v]=d+e+g+h+r+t+u+.5362*C;x[v]*=.11;u=.115926*C}}return w}();d=function(){var b,d,e,g=a.createBuffer(2,f,c);for(b=0;b<g.numberOfChannels;b++){var h=g.getChannelData(b);for(e=d=0;e<f;e++){var r=2*Math.random()-1;h[e]=(d+.02*
r)/1.02;d=h[e];h[e]*=3.5}}return g}();e=function(){var b,d,e=a.createBuffer(2,f,c);for(b=0;b<e.numberOfChannels;b++){var g=e.getChannelData(b);for(d=0;d<f;d++)g[d]=2*Math.random()-1}return e}()}),a.Noise})(b);(function(a){return a.NoiseSynth=function(b){b=this.defaultArg(b,a.NoiseSynth.defaults);a.Instrument.call(this,b);this.noise=new a.Noise;this.envelope=new a.AmplitudeEnvelope(b.envelope);this.noise.chain(this.envelope,this.output);this.noise.start();this._readOnly(["noise","envelope"])},a.extend(a.NoiseSynth,
a.Instrument),a.NoiseSynth.defaults={noise:{type:"white"},envelope:{attack:.005,decay:.1,sustain:0}},a.NoiseSynth.prototype.triggerAttack=function(a,b){return this.envelope.triggerAttack(a,b),this},a.NoiseSynth.prototype.triggerRelease=function(a){return this.envelope.triggerRelease(a),this},a.NoiseSynth.prototype.triggerAttackRelease=function(a,b,e){return b=this.toSeconds(b),a=this.toSeconds(a),this.triggerAttack(b,e),this.triggerRelease(b+a),this},a.NoiseSynth.prototype.dispose=function(){return a.Instrument.prototype.dispose.call(this),
this._writable(["noise","envelope"]),this.noise.dispose(),this.noise=null,this.envelope.dispose(),this.envelope=null,this},a.NoiseSynth})(b);(function(a){return a.PluckSynth=function(b){b=this.defaultArg(b,a.PluckSynth.defaults);a.Instrument.call(this,b);this._noise=new a.Noise("pink");this.attackNoise=b.attackNoise;this._lfcf=new a.LowpassCombFilter({resonance:b.resonance,dampening:b.dampening});this.resonance=this._lfcf.resonance;this.dampening=this._lfcf.dampening;this._noise.connect(this._lfcf);
this._lfcf.connect(this.output);this._readOnly(["resonance","dampening"])},a.extend(a.PluckSynth,a.Instrument),a.PluckSynth.defaults={attackNoise:1,dampening:4E3,resonance:.9},a.PluckSynth.prototype.triggerAttack=function(a,b){a=this.toFrequency(a);b=this.toSeconds(b);var c=1/a;return this._lfcf.delayTime.setValueAtTime(c,b),this._noise.start(b),this._noise.stop(b+c*this.attackNoise),this},a.PluckSynth.prototype.dispose=function(){return a.Instrument.prototype.dispose.call(this),this._noise.dispose(),
this._lfcf.dispose(),this._noise=null,this._lfcf=null,this._writable(["resonance","dampening"]),this.dampening=null,this.resonance=null,this},a.PluckSynth})(b);(function(a){return a.PolySynth=function(){var b;a.Instrument.call(this);var d=this.optionsObject(arguments,["polyphony","voice"],a.PolySynth.defaults);d=this.defaultArg(d,a.Instrument.defaults);d.polyphony=Math.min(a.PolySynth.MAX_POLYPHONY,d.polyphony);this.voices=Array(d.polyphony);this._triggers=Array(d.polyphony);this.detune=new a.Signal(d.detune,
a.Type.Cents);this._readOnly("detune");for(b=0;b<d.polyphony;b++){var e=new d.voice(arguments[2],arguments[3]);this.voices[b]=e;e.connect(this.output);e.hasOwnProperty("detune")&&this.detune.connect(e.detune);this._triggers[b]={release:-1,note:null,voice:e}}this.volume.value=d.volume},a.extend(a.PolySynth,a.Instrument),a.PolySynth.defaults={polyphony:4,volume:0,detune:0,voice:a.Synth},a.PolySynth.prototype.triggerAttack=function(a,b,e){var c,d;Array.isArray(a)||(a=[a]);b=this.toSeconds(b);for(c=0;c<
a.length;c++){var h=a[c];var k=this._triggers[0];for(d=1;d<this._triggers.length;d++)this._triggers[d].release<k.release&&(k=this._triggers[d]);k.release=1/0;k.note=JSON.stringify(h);k.voice.triggerAttack(h,b,e)}return this},a.PolySynth.prototype.triggerAttackRelease=function(a,b,e,f){if(e=this.toSeconds(e),this.triggerAttack(a,e,f),this.isArray(b)&&this.isArray(a))for(f=0;f<a.length;f++){var c=b[Math.min(f,b.length-1)];this.triggerRelease(a[f],e+this.toSeconds(c))}else this.triggerRelease(a,e+this.toSeconds(b));
return this},a.PolySynth.prototype.triggerRelease=function(a,b){var c,d;Array.isArray(a)||(a=[a]);b=this.toSeconds(b);for(c=0;c<a.length;c++){var g=JSON.stringify(a[c]);for(d=0;d<this._triggers.length;d++){var h=this._triggers[d];h.note===g&&h.release>b&&(h.voice.triggerRelease(b),h.release=b)}}return this},a.PolySynth.prototype.set=function(a,b,e){for(var c=0;c<this.voices.length;c++)this.voices[c].set(a,b,e);return this},a.PolySynth.prototype.get=function(a){return this.voices[0].get(a)},a.PolySynth.prototype.releaseAll=
function(a){var b;a=this.toSeconds(a);for(b=0;b<this._triggers.length;b++){var c=this._triggers[b];c.release>a&&(c.release=a,c.voice.triggerRelease(a))}return this},a.PolySynth.prototype.dispose=function(){a.Instrument.prototype.dispose.call(this);for(var b=0;b<this.voices.length;b++)this.voices[b].dispose(),this.voices[b]=null;return this._writable("detune"),this.detune.dispose(),this.detune=null,this.voices=null,this._triggers=null,this},a.PolySynth.MAX_POLYPHONY=20,a.PolySynth})(b);(function(a){return a.Player=
function(b){var c;b instanceof a.Buffer?(b=b.get(),c=a.Player.defaults):c=this.optionsObject(arguments,["url","onload"],a.Player.defaults);a.Source.call(this,c);this._source=null;this.autostart=c.autostart;this._buffer=new a.Buffer({url:c.url,onload:this._onload.bind(this,c.onload),reverse:c.reverse});b instanceof AudioBuffer&&this._buffer.set(b);this._loop=c.loop;this._loopStart=c.loopStart;this._loopEnd=c.loopEnd;this._playbackRate=c.playbackRate;this.retrigger=c.retrigger},a.extend(a.Player,a.Source),
a.Player.defaults={onload:a.noOp,playbackRate:1,loop:!1,autostart:!1,loopStart:0,loopEnd:0,retrigger:!1,reverse:!1},a.Player.prototype.load=function(a,b){return this._buffer.load(a,this._onload.bind(this,b))},a.Player.prototype._onload=function(b){b=this.defaultArg(b,a.noOp);b(this);this.autostart&&this.start()},a.Player.prototype._start=function(b,d,e){var c,g;if(!this._buffer.loaded)throw Error("Tone.Player: tried to start Player before the buffer was loaded");if(d=this._loop?this.defaultArg(d,
this._loopStart):this.defaultArg(d,0),d=this.toSeconds(d),e=this.defaultArg(e,Math.max(this._buffer.duration-d,0)),e=this.toSeconds(e),b=this.toSeconds(b),this._source=this.context.createBufferSource(),this._source.buffer=this._buffer.get(),this._loop?(this._source.loop=this._loop,this._source.loopStart=this.toSeconds(this._loopStart),this._source.loopEnd=this.toSeconds(this._loopEnd)):this._state.setStateAtTime(a.State.Stopped,b+e),this._source.playbackRate.value=this._playbackRate,this._source.connect(this.output),
this._loop){if(c=this._source.loopEnd||this._buffer.duration,g=this._source.loopStart,e=c-g,d>c)for(;d>c;)d-=e;this._source.start(b,d)}else this._source.start(b,d,e);return this},a.Player.prototype._stop=function(a){return this._source&&(this._source.stop(this.toSeconds(a)),this._source=null),this},a.Player.prototype.seek=function(b,d){return d=this.toSeconds(d),this._state.getValueAtTime(d)===a.State.Started&&(b=this.toSeconds(b),this._stop(d),this._start(d,b)),this},a.Player.prototype.setLoopPoints=
function(a,b){return this.loopStart=a,this.loopEnd=b,this},Object.defineProperty(a.Player.prototype,"loopStart",{get:function(){return this._loopStart},set:function(a){this._loopStart=a;this._source&&(this._source.loopStart=this.toSeconds(a))}}),Object.defineProperty(a.Player.prototype,"loopEnd",{get:function(){return this._loopEnd},set:function(a){this._loopEnd=a;this._source&&(this._source.loopEnd=this.toSeconds(a))}}),Object.defineProperty(a.Player.prototype,"buffer",{get:function(){return this._buffer},
set:function(a){this._buffer.set(a)}}),Object.defineProperty(a.Player.prototype,"loop",{get:function(){return this._loop},set:function(a){this._loop=a;this._source&&(this._source.loop=a)}}),Object.defineProperty(a.Player.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(a){this._playbackRate=a;this._source&&(this._source.playbackRate.value=a)}}),Object.defineProperty(a.Player.prototype,"reverse",{get:function(){return this._buffer.reverse},set:function(a){this._buffer.reverse=
a}}),a.Player.prototype.dispose=function(){return a.Source.prototype.dispose.call(this),null!==this._source&&(this._source.disconnect(),this._source=null),this._buffer.dispose(),this._buffer=null,this},a.Player})(b);(function(a){return a.Sampler=function(){var b=this.optionsObject(arguments,["url","onload"],a.Sampler.defaults);a.Instrument.call(this,b);this.player=new a.Player(b.url,b.onload);this.player.retrigger=!0;this.envelope=new a.AmplitudeEnvelope(b.envelope);this.player.chain(this.envelope,
this.output);this._readOnly(["player","envelope"]);this.loop=b.loop;this.reverse=b.reverse},a.extend(a.Sampler,a.Instrument),a.Sampler.defaults={onload:a.noOp,loop:!1,reverse:!1,envelope:{attack:.001,decay:0,sustain:1,release:.1}},a.Sampler.prototype.triggerAttack=function(a,b,e){return b=this.toSeconds(b),a=this.defaultArg(a,0),this.player.playbackRate=this.intervalToFrequencyRatio(a),this.player.start(b),this.envelope.triggerAttack(b,e),this},a.Sampler.prototype.triggerRelease=function(a){return a=
this.toSeconds(a),this.envelope.triggerRelease(a),this.player.stop(this.toSeconds(this.envelope.release)+a),this},Object.defineProperty(a.Sampler.prototype,"loop",{get:function(){return this.player.loop},set:function(a){this.player.loop=a}}),Object.defineProperty(a.Sampler.prototype,"reverse",{get:function(){return this.player.reverse},set:function(a){this.player.reverse=a}}),Object.defineProperty(a.Sampler.prototype,"buffer",{get:function(){return this.player.buffer},set:function(a){this.player.buffer=
a}}),a.Sampler.prototype.dispose=function(){return a.Instrument.prototype.dispose.call(this),this._writable(["player","envelope"]),this.player.dispose(),this.player=null,this.envelope.dispose(),this.envelope=null,this},a.Sampler})(b);(function(a){return a.GainToAudio=function(){this._norm=this.input=this.output=new a.WaveShaper(function(a){return 2*Math.abs(a)-1})},a.extend(a.GainToAudio,a.SignalBase),a.GainToAudio.prototype.dispose=function(){return a.prototype.dispose.call(this),this._norm.dispose(),
this._norm=null,this},a.GainToAudio})(b);(function(a){return a.Normalize=function(b,d){this._inputMin=this.defaultArg(b,0);this._inputMax=this.defaultArg(d,1);this._sub=this.input=new a.Add(0);this._div=this.output=new a.Multiply(1);this._sub.connect(this._div);this._setRange()},a.extend(a.Normalize,a.SignalBase),Object.defineProperty(a.Normalize.prototype,"min",{get:function(){return this._inputMin},set:function(a){this._inputMin=a;this._setRange()}}),Object.defineProperty(a.Normalize.prototype,
"max",{get:function(){return this._inputMax},set:function(a){this._inputMax=a;this._setRange()}}),a.Normalize.prototype._setRange=function(){this._sub.value=-this._inputMin;this._div.value=1/(this._inputMax-this._inputMin)},a.Normalize.prototype.dispose=function(){return a.prototype.dispose.call(this),this._sub.dispose(),this._sub=null,this._div.dispose(),this._div=null,this},a.Normalize})(b);(function(a){return a.BufferSource=function(){var b=this.optionsObject(arguments,["buffer","onended"],a.BufferSource.defaults);
this.onended=b.onended;this._stopTime=this._startTime=-1;this._gainNode=this.output=new a.Gain;this._source=this.context.createBufferSource();this._source.connect(this._gainNode);this.playbackRate=new a.Param(this._source.playbackRate,a.Type.Positive);this.fadeIn=b.fadeIn;this.fadeOut=b.fadeOut;this._gain=1;this._onendedTimeout=-1;this.isUndef(b.buffer)||(this.buffer=b.buffer);this.loop=b.loop},a.extend(a.BufferSource),a.BufferSource.defaults={onended:a.noOp,fadeIn:0,fadeOut:0},Object.defineProperty(a.BufferSource.prototype,
"state",{get:function(){var b=this.now();return-1!==this._startTime&&b>=this._startTime&&b<this._stopTime?a.State.Started:a.State.Stopped}}),a.BufferSource.prototype.start=function(a,b,e,f,g){if(-1!==this._startTime)throw Error("Tone.BufferSource: can only be started once.");return this.buffer&&(a=this.toSeconds(a),b=this.loop?this.defaultArg(b,this.loopStart):this.defaultArg(b,0),b=this.toSeconds(b),a=this.toSeconds(a),this._source.start(a,b),f=this.defaultArg(f,1),this._gain=f,g=this.isUndef(g)?
this.toSeconds(this.fadeIn):this.toSeconds(g),0<g?(this._gainNode.gain.setValueAtTime(0,a),this._gainNode.gain.linearRampToValueAtTime(this._gain,a+g)):this._gainNode.gain.setValueAtTime(f,a),this._startTime=a+g,this.isUndef(e)||(e=this.defaultArg(e,this.buffer.duration-b),e=this.toSeconds(e),this.stop(a+e+g,g))),this},a.BufferSource.prototype.stop=function(a,b){return this.buffer&&(a=this.toSeconds(a),b=this.isUndef(b)?this.toSeconds(this.fadeOut):this.toSeconds(b),this._stopTime=a+b,this._gainNode.gain.cancelScheduledValues(this._startTime+
this.sampleTime),0<b?(this._gainNode.gain.setValueAtTime(this._gain,a),this._gainNode.gain.linearRampToValueAtTime(0,a+b),a+=b):this._gainNode.gain.setValueAtTime(0,a),this.isNumber(this._source.playbackState)&&2!==this._source.playbackState||this._source.stop(a),clearTimeout(this._onendedTimeout),this._onendedTimeout=setTimeout(this._onended.bind(this),1E3*(this._stopTime-this.now()))),this},a.BufferSource.prototype._onended=function(){this.onended(this);this.dispose()},Object.defineProperty(a.BufferSource.prototype,
"loopStart",{get:function(){return this._source.loopStart},set:function(a){this._source.loopStart=this.toSeconds(a)}}),Object.defineProperty(a.BufferSource.prototype,"loopEnd",{get:function(){return this._source.loopEnd},set:function(a){this._source.loopEnd=this.toSeconds(a)}}),Object.defineProperty(a.BufferSource.prototype,"buffer",{get:function(){return this._source?this._source.buffer:null},set:function(b){b instanceof a.Buffer?this._source.buffer=b.get():this._source.buffer=b}}),Object.defineProperty(a.BufferSource.prototype,
"loop",{get:function(){return this._source.loop},set:function(a){this._source.loop=a}}),a.BufferSource.prototype.dispose=function(){return this.onended=null,this._source&&(this._source.disconnect(),this._source=null),this._gainNode&&(this._gainNode.dispose(),this._gainNode=null),this._startTime=-1,this.playbackRate=null,this.output=null,clearTimeout(this._onendedTimeout),this},a.BufferSource})(b);(function(a){return a.MultiPlayer=function(){var b=this.optionsObject(arguments,["urls","onload"],a.MultiPlayer.defaults);
b.urls instanceof a.Buffers?this.buffers=b.urls:this.buffers=new a.Buffers(b.urls,b.onload);this._activeSources={};this.fadeIn=b.fadeIn;this.fadeOut=b.fadeOut;this._volume=this.output=new a.Volume(b.volume);this.volume=this._volume.volume;this._readOnly("volume");this._volume.output.output.channelCount=2;this._volume.output.output.channelCountMode="explicit";this.mute=b.mute},a.extend(a.MultiPlayer,a.Source),a.MultiPlayer.defaults={onload:a.noOp,fadeIn:0,fadeOut:0},a.MultiPlayer.prototype._makeSource=
function(b){var c,e;return this.isString(b)||this.isNumber(b)?c=this.buffers.get(b).get():b instanceof a.Buffer?c=b.get():b instanceof AudioBuffer&&(c=b),e=(new a.BufferSource(c)).connect(this.output),this._activeSources.hasOwnProperty(b)||(this._activeSources[b]=[]),this._activeSources[b].push(e),e},a.MultiPlayer.prototype.start=function(a,b,e,f,g,h){b=this.toSeconds(b);a=this._makeSource(a);return a.start(b,e,f,this.defaultArg(h,1),this.fadeIn),f&&a.stop(b+this.toSeconds(f),this.fadeOut),g=this.defaultArg(g,
0),a.playbackRate.value=this.intervalToFrequencyRatio(g),this},a.MultiPlayer.prototype.startLoop=function(a,b,e,f,g,h,k){b=this.toSeconds(b);a=this._makeSource(a);return a.loop=!0,a.loopStart=this.toSeconds(this.defaultArg(f,0)),a.loopEnd=this.toSeconds(this.defaultArg(g,0)),a.start(b,e,void 0,this.defaultArg(k,1),this.fadeIn),h=this.defaultArg(h,0),a.playbackRate.value=this.intervalToFrequencyRatio(h),this},a.MultiPlayer.prototype.stop=function(a,b){if(!this._activeSources[a]||!this._activeSources[a].length)throw Error("Tone.MultiPlayer: cannot stop a buffer that hasn't been started or is already stopped");
return b=this.toSeconds(b),this._activeSources[a].shift().stop(b,this.fadeOut),this},a.MultiPlayer.prototype.stopAll=function(a){var b,c;a=this.toSeconds(a);for(b in this._activeSources){var f=this._activeSources[b];for(c=0;c<f.length;c++)f[c].stop(a)}return this},a.MultiPlayer.prototype.add=function(a,b,e){return this.buffers.add(a,b,e),this},Object.defineProperty(a.MultiPlayer.prototype,"state",{get:function(){return 0<this._activeSources.length?a.State.Started:a.State.Stopped}}),Object.defineProperty(a.MultiPlayer.prototype,
"mute",{get:function(){return this._volume.mute},set:function(a){this._volume.mute=a}}),a.MultiPlayer.prototype.dispose=function(){a.prototype.dispose.call(this);this._volume.dispose();this._volume=null;this._writable("volume");this.volume=null;for(var b in this._activeSources)this._activeSources[b].forEach(function(a){a.dispose()});return this.buffers.dispose(),this.buffers=null,this._activeSources=null,this},a.MultiPlayer})(b);(function(a){return a.GrainPlayer=function(){var b=this.optionsObject(arguments,
["url","onload"],a.GrainPlayer.defaults);a.Source.call(this);this.buffer=new a.Buffer(b.url,b.onload);this._player=this.output=new a.MultiPlayer;this._clock=new a.Clock(this._tick.bind(this),1);this._loopEnd=this._loopStart=0;this._playbackRate=b.playbackRate;this._grainSize=b.grainSize;this._overlap=b.overlap;this.detune=b.detune;this.drift=b.drift;this.overlap=b.overlap;this.loop=b.loop;this.playbackRate=b.playbackRate;this.grainSize=b.grainSize;this.loopStart=b.loopStart;this.loopEnd=b.loopEnd;
this.reverse=b.reverse},a.extend(a.GrainPlayer,a.Source),a.GrainPlayer.defaults={onload:a.noOp,overlap:.1,grainSize:.2,drift:0,playbackRate:1,detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1},a.GrainPlayer.prototype._start=function(a,b){b=this.defaultArg(b,0);b=this.toSeconds(b);a=this.toSeconds(a);this._offset=b;this._clock.start(a)},a.GrainPlayer.prototype._stop=function(a){this._clock.stop(a);this._player.stop(this.buffer,a);this._offset=0},a.GrainPlayer.prototype._tick=function(a){var b,c=this.buffer.duration;
this.loop&&0<this._loopEnd&&(c=this._loopEnd);var f=this._offset-this._overlap+(2*Math.random()-1)*this.drift;var g=this.detune/100;var h=this._player.fadeIn;this.loop&&this._offset>c?(b=this._offset-c,this._player.start(this.buffer,a,f,b+this._overlap,g),f=this._offset%c,this._offset=this._loopStart,this._player.fadeIn=0,this._player.start(this.buffer,a+b,this._offset,f+this._overlap,g)):this._offset>c?this.stop(a):(0>f&&(this._player.fadeIn=Math.max(this._player.fadeIn+f,0),f=0),this._player.start(this.buffer,
a,f,this.grainSize+this._overlap,g));this._player.fadeIn=h;this._offset+=(this._clock._nextTick-a)*this._playbackRate},a.GrainPlayer.prototype.scrub=function(a,b){return this._offset=this.toSeconds(a),this._tick(this.toSeconds(b)),this},Object.defineProperty(a.GrainPlayer.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(a){this._playbackRate=a;this.grainSize=this._grainSize}}),Object.defineProperty(a.GrainPlayer.prototype,"loopStart",{get:function(){return this._loopStart},
set:function(a){this._loopStart=this.toSeconds(a)}}),Object.defineProperty(a.GrainPlayer.prototype,"loopEnd",{get:function(){return this._loopEnd},set:function(a){this._loopEnd=this.toSeconds(a)}}),Object.defineProperty(a.GrainPlayer.prototype,"reverse",{get:function(){return this.buffer.reverse},set:function(a){this.buffer.reverse=a}}),Object.defineProperty(a.GrainPlayer.prototype,"grainSize",{get:function(){return this._grainSize},set:function(a){this._grainSize=this.toSeconds(a);this._clock.frequency.value=
this._playbackRate/this._grainSize}}),Object.defineProperty(a.GrainPlayer.prototype,"overlap",{get:function(){return this._overlap},set:function(a){this._overlap=a=this.toSeconds(a);0>this._overlap?(this._player.fadeIn=.01,this._player.fadeOut=.01):(this._player.fadeIn=a,this._player.fadeOut=a)}}),a.GrainPlayer.prototype.dispose=function(){return a.Source.prototype.dispose.call(this),this.buffer.dispose(),this.buffer=null,this._player.dispose(),this._player=null,this._clock.dispose(),this._clock=
null,this},a.GrainPlayer})(b);(function(a){return a.UserMedia=function(){var b=this.optionsObject(arguments,["volume"],a.UserMedia.defaults);this._device=this._stream=this._mediaStream=null;this._volume=this.output=new a.Volume(b.volume);this.volume=this._volume.volume;this._readOnly("volume");this.mute=b.mute},a.extend(a.UserMedia),a.UserMedia.defaults={volume:0,mute:!1},a.UserMedia.prototype.open=function(a){return a=this.defaultArg(a,"default"),this.enumerateDevices().then(function(b){var c,d;
if(this.isNumber(a)?c=b[a]:(c=b.find(function(b){return b.label===a||b.deviceId===a}),c||(c=b[0])),!c)throw Error("Tone.UserMedia: no matching audio inputs.");return this._device=c,d={audio:{deviceId:c.deviceId,echoCancellation:!1,sampleRate:this.context.sampleRate}},navigator.mediaDevices.getUserMedia(d).then(function(a){return this._stream||(this._stream=a,this._mediaStream=this.context.createMediaStreamSource(a),this._mediaStream.connect(this.output)),this}.bind(this))}.bind(this))},a.UserMedia.prototype.close=
function(){return this._stream&&(this._stream.getAudioTracks().forEach(function(a){a.stop()}),this._stream=null,this._mediaStream.disconnect(),this._mediaStream=null),this._device=null,this},a.UserMedia.prototype.enumerateDevices=function(){return navigator.mediaDevices.enumerateDevices().then(function(a){return a.filter(function(a){return"audioinput"===a.kind})})},Object.defineProperty(a.UserMedia.prototype,"state",{get:function(){return this._stream&&this._stream.active?a.State.Started:a.State.Stopped}}),
Object.defineProperty(a.UserMedia.prototype,"deviceId",{get:function(){if(this._device)return this._device.deviceId}}),Object.defineProperty(a.UserMedia.prototype,"groupId",{get:function(){if(this._device)return this._device.groupId}}),Object.defineProperty(a.UserMedia.prototype,"label",{get:function(){if(this._device)return this._device.label}}),Object.defineProperty(a.UserMedia.prototype,"mute",{get:function(){return this._volume.mute},set:function(a){this._volume.mute=a}}),a.UserMedia.prototype.dispose=
function(){return a.prototype.dispose.call(this),this.close(),this._writable("volume"),this._volume.dispose(),this._volume=null,this.volume=null,this},Object.defineProperty(a.UserMedia,"supported",{get:function(){return!a.prototype.isUndef(navigator.mediaDevices)&&a.prototype.isFunction(navigator.mediaDevices.getUserMedia)}}),a.UserMedia})(b);return b});
function ObjectControls(b,a){this.intersected;this.selected;this.eye=b;this.mouse=new THREE.Vector3;this.unprojectedMouse=new THREE.Vector3;this.objects=[];var c=a=a||{};this.domElement=c.domElement||document;this.recursive=c.recursive||!1;this.raycaster=new THREE.Raycaster;this.raycaster.near=this.eye.near;this.raycaster.far=this.eye.far;c=this.mouseDown.bind(this);var d=this.mouseUp.bind(this),e=this.mouseMove.bind(this);this.domElement.addEventListener("mousedown",c,!1);this.domElement.addEventListener("mouseup",
d,!1);this.domElement.addEventListener("mousemove",e,!1);this.domElement.addEventListener("touchdown",c,!1);this.domElement.addEventListener("touchup",d,!1);this.domElement.addEventListener("touchmove",e,!1);this.unprojectMouse()}ObjectControls.prototype._down=function(){this.down();this.intersected&&this._select(this.intersected)};ObjectControls.prototype.down=function(){};ObjectControls.prototype._up=function(){this.up();this.selected&&this._deselect(this.selected)};
ObjectControls.prototype.up=function(){};ObjectControls.prototype._hoverOut=function(b){this.hoverOut();this.objectHovered=!1;b.hoverOut&&b.hoverOut(this)};ObjectControls.prototype.hoverOut=function(){};ObjectControls.prototype._hoverOver=function(b){this.hoverOver();this.objectHovered=!0;b.hoverOver&&b.hoverOver(this)};ObjectControls.prototype.hoverOver=function(){};
ObjectControls.prototype._select=function(b){this.select();var a=this.getIntersectionPoint(this.intersected);this.selected=b;this.intersectionPoint=a;b.select&&b.select(this)};ObjectControls.prototype.select=function(){};ObjectControls.prototype._deselect=function(b){this.intersectionPoint=this.selected=void 0;b.deselect&&b.deselect(this);this.deselect()};ObjectControls.prototype.deselect=function(){};ObjectControls.prototype.add=function(b){this.objects.push(b)};
ObjectControls.prototype.remove=function(b){for(var a=0;a<this.objects.length;a++)this.objects[a]==b&&this.objects.splice(a,1)};ObjectControls.prototype.update=function(){this.setRaycaster(this.unprojectedMouse);this.selected?this._updateSelected(this.unprojectedMouse):this.checkForIntersections(this.unprojectedMouse)};ObjectControls.prototype._updateSelected=function(){this.selected.update&&this.selected.update(this)};ObjectControls.prototype.updateSelected=function(){};
ObjectControls.prototype.setRaycaster=function(b){b=b.clone();b.sub(this.eye.position);b.normalize();this.raycaster.set(this.eye.position,b)};ObjectControls.prototype.checkForIntersections=function(b){b=this.raycaster.intersectObjects(this.objects,this.recursive);if(0<b.length){for(var a=0;a<b.length;a++)if(this.recursive){var c=this._findTopLevelAncestor(b[a].object);c&&(b[a].object=c)}this._objectIntersected(b)}else this._noObjectIntersected()};
ObjectControls.prototype.checkForUpDown=function(b,a){!0===this.upDownEvent(this.selectionStrength,b,a)?this._down():!1===this.upDownEvent(this.selectionStrength,b,a)&&this._up()};ObjectControls.prototype.getIntersectionPoint=function(b){return this.raycaster.intersectObjects(this.objects,this.recursive)[0].point.sub(b.position)};ObjectControls.prototype._findTopLevelAncestor=function(b){for(;-1===this.objects.indexOf(b);){if(!b.parent)return null;b=b.parent}return b};
ObjectControls.prototype._objectIntersected=function(b){b=b[0].object;this.intersected?this.intersected!=b&&(this._hoverOut(this.intersected),this.intersected=b,this._hoverOver(this.intersected)):(this.intersected=b,this._hoverOver(this.intersected));this.objectIntersected()};ObjectControls.prototype.objectIntersected=function(){};ObjectControls.prototype._noObjectIntersected=function(){this.intersected&&(this._hoverOut(this.intersected),this.intersected=void 0);this.noObjectIntersected()};
ObjectControls.prototype.noObjectIntersected=function(){};ObjectControls.prototype.mouseMove=function(b){this.mouseMoved=!0;this.mouse.x=b.clientX/window.innerWidth*2-1;this.mouse.y=2*-(b.clientY/window.innerHeight)+1;this.mouse.z=1;this.unprojectMouse()};ObjectControls.prototype.unprojectMouse=function(){this.unprojectedMouse.copy(this.mouse);this.unprojectedMouse.unproject(this.eye)};ObjectControls.prototype.mouseDown=function(b){this.mouseMove(b);this._down()};
ObjectControls.prototype.mouseUp=function(){this.mouseMove(event);this._up()};ObjectControls.prototype.touchStart=function(b){this.touchMove(b);this._down()};ObjectControls.prototype.touchEnd=function(b){this.touchMove(b);this._up()};ObjectControls.prototype.touchMove=function(b){this.mouseMoved=!0;this.mouse.x=b.touches[0].pageX/window.innerWidth*2-1;this.mouse.y=2*-(b.touches[0].pageY/window.innerHeight)+1;this.mouse.z=1;this.unprojectMouse()};
var scene,camera,renderer,objectControls,objects=[],mesh=[],speed=[],counter=0;speed.push(Math.random()/14,Math.random()/12,Math.random()/14,Math.random()/12,Math.random()/14,Math.random()/12,Math.random()/12,Math.random()/12,Math.random()/12);var intersectionPlane,collidableMeshList=[],newMat=new THREE.MeshNormalMaterial,planeMaterial=new THREE.MeshBasicMaterial({color:7434882}),planeGeo=new THREE.PlaneBufferGeometry(20,23),plane2=new THREE.Mesh(planeGeo,planeMaterial);
plane2.rotation.x=8*-Math.PI/24;plane2.rotation.z=5*Math.PI/16;plane2.position.x=30;plane2.position.y=-8;plane2.receiveShadow=!0;var CylinderGeo=new THREE.CylinderGeometry(.15,.15,25),cylinderMat=new THREE.MeshBasicMaterial({color:10902632}),cylinder1=new THREE.Mesh(CylinderGeo,cylinderMat);cylinder1.position.x=-20;cylinder1.position.y=18;var cylinder2=new THREE.Mesh(CylinderGeo,cylinderMat);cylinder2.position.x=30;cylinder2.position.y=0;var cylinder3=new THREE.Mesh(CylinderGeo,cylinderMat);
cylinder3.position.x=80;cylinder3.position.y=-17;var cylinder4=new THREE.Mesh(CylinderGeo,cylinderMat);cylinder4.position.x=130;cylinder4.position.y=-34;
var synth1=(new Tone.Synth({portamento:.01,oscillator:{type:"square"},envelope:{attack:.005,decay:.2,sustain:.4,release:1.4},filterEnvelope:{attack:.005,decay:.1,sustain:.05,release:.8,baseFrequency:300,octaves:4}})).toMaster(),synth2=(new Tone.Synth({portamento:.01,oscillator:{type:"sine10"},envelope:{attack:.005,decay:.2,sustain:.4,release:1.4}})).toMaster(),synth3=(new Tone.FMSynth({modulationIndex:12.22,envelope:{attack:.01,decay:.2},modulation:{type:"sine10"},modulationEnvelope:{attack:.2,decay:.01}})).toMaster(),
synth4=new Tone.MonoSynth({portamento:.01,oscillator:{type:"sawtooth"},envelope:{attack:.005,decay:.2,sustain:.4,release:1.4}}),volume3=new Tone.Volume(15);synth3.chain(volume3,Tone.Master);var volume4=new Tone.Volume(-10);synth4.chain(volume4,Tone.Master);Tone.Master.mute=!0;init();animate();
function init(){scene=new THREE.Scene;camera=new THREE.PerspectiveCamera(30,window.innerWidth/window.innerHeight,1,1E3);camera.position.z=400;renderer=new THREE.WebGLRenderer({antialias:!0});renderer.setSize(window.innerWidth,window.innerHeight);renderer.setPixelRatio(window.devicePixelRatio);renderer.setClearColor(2106669);renderer.shadowMapEnabled=!0;renderer.shadowMapSoft=!0;document.body.appendChild(renderer.domElement);var b=new THREE.SpotLight(0,.75);b.position.set(-10,80,20);b.target.position.set(-200,
88,10);b.castShadow=!0;b.shadowDarkness=.2;b.shadowBias=1E-5;helper=new THREE.SpotLightHelper(b);b.shadowMapWidth=2048;b.shadowMapHeight=2048;var a=new THREE.SpotLight(0,.95);a.position.set(40,80,30);a.target.position.set(0,-20,-30);a.castShadow=!0;a.shadowDarkness=.2;b.shadowBias=.001;new THREE.SpotLightHelper(a);a.shadowMapWidth=2048;a.shadowMapHeight=2048;b=new THREE.DirectionalLight("rgb(255,255,255)",1);b.castShadow=!0;b.shadowDarkness=.2;b.shadowMapWidth=2048;b.shadowMapHeight=2048;new THREE.DirectionalLightHelper(b,
1);var c=new THREE.PointLight(10824509,.7,100);c.position.set(110,-5,10);c.shadowDarkness=.4;c.shadowColor=8018261;new THREE.PointLightHelper(c);var d=new THREE.PointLight(10824509,.7,100);d.position.set(0,30,10);new THREE.PointLightHelper(d);var e=new THREE.AmbientLight(7364704,3);e.shadowDarkness=.08;e.shadowColor=3656831;var f=new THREE.MeshBasicMaterial({color:7434882}),g=new THREE.PlaneBufferGeometry(20,23),h=new THREE.Mesh(g,f);h.rotation.x=8*-Math.PI/24;h.rotation.z=5*Math.PI/16;h.position.x=
-20;h.position.y=10;h.receiveShadow=!0;var k=new THREE.Mesh(g,f);k.rotation.x=8*-Math.PI/24;k.rotation.z=5*Math.PI/16;k.position.x=30;k.position.y=-8;k.receiveShadow=!0;var l=new THREE.Mesh(g,f);l.rotation.x=8*-Math.PI/24;l.rotation.z=5*Math.PI/16;l.position.x=80;l.position.y=-26;l.receiveShadow=!0;f=new THREE.Mesh(g,f);f.rotation.x=8*-Math.PI/24;f.rotation.z=5*Math.PI/16;f.position.x=130;f.position.y=-43;f.receiveShadow=!0;var p=new THREE.LineDashedMaterial({color:10902632,dashSize:10*Math.PI/40,
gapSize:10*Math.PI/40,linewidth:1}),q=new THREE.CircleGeometry(10,50);q.vertices.shift();q.computeLineDistances();g=new THREE.Line(q,p);g.position.set(-20,38,0);g.rotation.x=Math.PI/9;g.rotation.y=-Math.PI/7;g.scale.set(1.5,1.5,1.5);var m=new THREE.Line(q,p);m.position.set(31,20,0);m.rotation.x=Math.PI/9;m.rotation.y=-Math.PI/6;m.scale.set(1.5,1.64,1.5);var r=new THREE.Line(q,p);r.position.set(81,2,0);r.rotation.x=Math.PI/9;r.rotation.y=-Math.PI/5;r.scale.set(1.6,1.7,1.5);p=new THREE.Line(q,p);p.position.set(131,
-14,0);p.rotation.x=Math.PI/9;p.rotation.y=-Math.PI/4;p.scale.set(1.65,1.75,1.5);scene.add(b);scene.add(a);scene.add(c);scene.add(d);scene.add(e);scene.add(h);scene.add(k);scene.add(l);scene.add(f);scene.add(cylinder1);scene.add(cylinder2);scene.add(cylinder3);scene.add(cylinder4);scene.add(g);scene.add(m);scene.add(r);scene.add(p);objectControls=new ObjectControls(camera);b=new THREE.PlaneBufferGeometry(1E5,1E5);a=new THREE.MeshLambertMaterial({color:11711154});intersectionPlane=new THREE.Mesh(b,
a);intersectionPlane.visible=!1;scene.add(intersectionPlane);b=new THREE.Mesh((new createMergedGeometry).geometry,a);b.position.x=-140;b.position.y=20;b.castShadow=!0;b.receiveShadow=!0;c=new THREE.Mesh((new createMergedGeometry).geometry,a);c.position.x=-113;c.position.y=20;c.castShadow=!0;c.receiveShadow=!0;d=new THREE.Mesh((new createMergedGeometry).geometry,a);d.position.x=-86;d.position.y=20;d.castShadow=!0;d.receiveShadow=!0;e=new THREE.Mesh((new createMergedGeometry).geometry,a);e.position.x=
-140;e.position.y=-7;e.castShadow=!0;e.receiveShadow=!0;h=new THREE.Mesh((new createMergedGeometry).geometry,a);h.position.x=-113;h.position.y=-7;h.castShadow=!0;h.receiveShadow=!0;k=new THREE.Mesh((new createMergedGeometry).geometry,a);k.position.x=-86;k.position.y=-7;k.castShadow=!0;k.receiveShadow=!0;l=new THREE.Mesh((new createMergedGeometry).geometry,a);l.position.x=-140;l.position.y=-34;l.castShadow=!0;l.receiveShadow=!0;f=new THREE.Mesh((new createMergedGeometry).geometry,a);f.position.x=-113;
f.position.y=-34;f.castShadow=!0;f.receiveShadow=!0;a=new THREE.Mesh((new createMergedGeometry).geometry,a);a.position.x=-86;a.position.y=-34;a.castShadow=!0;a.receiveShadow=!0;mesh.push(b,c,d,e,h,k,l,f,a);for(a=0;a<mesh.length;a++)collidableMeshList.push(mesh[a]);for(a=0;a<mesh.length;a++)mesh[a].scale.set(.26,.26,.26),mesh[a].castShadow=!0,mesh[a].receiveShadow=!0,mesh[a].selected=!1,mesh[a].select=function(){this.selected=!0;intersectionPlane.position.copy(this.position)},mesh[a].deselect=function(){this.selected=
!1},mesh[a].update=function(){var a=objectControls.raycaster.intersectObject(intersectionPlane);a[0]?this.position.copy(a[0].point):console.log("something is terribly wrong")},scene.add(mesh[a]),objectControls.add(mesh[a]);window.addEventListener("resize",onWindowResize,!1);console.log("%c www.yaninma.com ","background: #355493; color: #fff");window.addEventListener("load",function(){document.getElementById("loadingPage").style.display="none"})}
function createMergedGeometry(){this.geometry=new THREE.Geometry;for(var b=0;5>b;b++){var a=new THREE.BoxGeometry(65*Math.random(),65*Math.random(),65*Math.random()),c=(new THREE.Matrix4).makeTranslation(10*Math.random(),10*Math.random(),10*Math.random()).makeRotationX(Math.random()*Math.PI);a.applyMatrix(c);this.geometry.merge(a)}}function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight;camera.updateProjectionMatrix();renderer.setSize(window.innerWidth,window.innerHeight)}
function animate(){requestAnimationFrame(animate);objectControls.update();update();generateSound();changeGeoColor();renderer.render(scene,camera)}function update(){counter++;20<counter&&(Tone.Master.mute=!1);for(var b=0;b<mesh.length;b++)mesh[b].rotation.x+=slider1.value/1500;for(b=0;b<mesh.length;b++)mesh[b].rotation.z+=slider2.value/2E3;for(b=0;b<mesh.length;b++)mesh[b].rotation.y+=speed[b]}
function generateSound(){var b=document.getElementById("contact1");b.innerHTML="contact1:   0";var a=document.getElementById("contact2");a.innerHTML="contact2:   0";var c=document.getElementById("contact3");c.innerHTML="contact3:   0";var d=document.getElementById("contact4");d.innerHTML="contact4:   0";for(var e=cylinder1.position.clone(),f=0;f<cylinder1.geometry.vertices.length;f++){var g=cylinder1.geometry.vertices[f].clone().applyMatrix4(cylinder1.matrix).sub(cylinder1.position),h=(new THREE.Raycaster(e,
g.clone().normalize())).intersectObjects(collidableMeshList);if(0<h.length&&h[0].distance<g.length()){b.innerHTML="contact1:  "+h[0].distance;plane2.material=new THREE.MeshLambertMaterial({color:13837885});switch(Math.floor(h[0].distance)){case 7:note2="E4";break;case 8:note2="D2";break;case 9:note2="D2";break;case 10:note2="D2";break;case 11:note2="E2";break;case 12:note2="E2";break;case 13:note2="E2";break;default:note2="E2"}synth2.triggerAttack(note2)}else synth2.triggerRelease()}b=cylinder2.position.clone();
for(e=0;e<cylinder2.geometry.vertices.length;e++)if(f=cylinder2.geometry.vertices[e].clone().applyMatrix4(cylinder2.matrix).sub(cylinder2.position),g=(new THREE.Raycaster(b,f.clone().normalize())).intersectObjects(collidableMeshList),0<g.length&&g[0].distance<f.length()){a.innerHTML="contact2:  "+g[0].distance;switch(Math.floor(g[0].distance)){case 5:note1="C6";break;case 6:note1="C6";break;case 7:note1="C6";break;case 8:note1="D6";break;case 9:note1="D6";break;case 10:note1="D6";break;case 11:note1=
"E6";break;case 12:note1="E6";break;case 13:note1="E6";break;case 14:note1="A6";break;case 15:note1="C6";break;case 16:note1="C6";break;case 17:note1="C6";break;case 18:note1="G6";break;case 19:note1="G6";break;case 20:note1="A6";break;case 21:note1="A6";break;default:note1="A6"}synth1.triggerAttack(note1)}else synth1.triggerRelease();a=cylinder3.position.clone();for(b=0;b<cylinder2.geometry.vertices.length;b++)if(e=cylinder3.geometry.vertices[b].clone().applyMatrix4(cylinder3.matrix).sub(cylinder3.position),
f=(new THREE.Raycaster(a,e.clone().normalize())).intersectObjects(collidableMeshList),0<f.length&&f[0].distance<e.length()){c.innerHTML="contact3:  "+f[0].distance;switch(Math.floor(f[0].distance)){case 5:note3="C3";break;case 6:note3="C3";break;case 7:note3="C3";break;case 8:note3="D3";break;case 9:note3="D4";break;case 10:note3="D3";break;case 11:note3="E3";break;case 12:note3="E4";break;case 13:note3="E3";break;case 14:note3="A3";break;case 15:note3="C3";break;case 16:note3="C3";break;case 17:note3=
"C3";break;case 18:note3="G3";break;case 19:note3="G3";break;case 20:note3="A4";break;case 21:note3="A4";break;default:note3="F3"}synth3.triggerAttack(note3)}else synth3.triggerRelease();c=cylinder4.position.clone();for(a=0;a<cylinder4.geometry.vertices.length;a++)if(b=cylinder4.geometry.vertices[a].clone().applyMatrix4(cylinder4.matrix).sub(cylinder4.position),e=(new THREE.Raycaster(c,b.clone().normalize())).intersectObjects(collidableMeshList),0<e.length&&4<e[0].distance&&e[0].distance<b.length()){d.innerHTML=
"contact4:  "+e[0].distance;switch(Math.floor(e[0].distance)){case 5:note4="C3";break;case 6:note4="C4";break;case 7:note4="C5";break;case 8:note4="D4";break;case 9:note4="D4";break;case 10:note4="D3";break;case 11:note4="E3";break;case 12:note4="E4";break;case 13:note4="E4";break;case 14:note4="A4";break;case 15:note4="C3";break;case 16:note4="C4";break;case 17:note4="C5";break;case 18:note4="G4";break;case 19:note4="G4";break;case 20:note4="A4";break;case 21:note4="A4";break;default:note4="C3"}synth4.triggerAttack(note4)}else synth4.triggerRelease()}
function changeGeoColor(){for(var b=0;b<mesh.length;b++)mesh[b].material=80>Math.abs(mesh[b].position.y-cylinder1.position.y)&&30>Math.abs(mesh[b].position.x-cylinder1.position.x)||80>Math.abs(mesh[b].position.y-cylinder2.position.y)&&30>Math.abs(mesh[b].position.x-cylinder2.position.x)||80>Math.abs(mesh[b].position.y-cylinder3.position.y)&&30>Math.abs(mesh[b].position.x-cylinder3.position.x)||180>Math.abs(mesh[b].position.y-cylinder4.position.y)&&30>Math.abs(mesh[b].position.x-cylinder4.position.x)?
new THREE.MeshLambertMaterial({color:13004569}):new THREE.MeshLambertMaterial({color:10389124})};