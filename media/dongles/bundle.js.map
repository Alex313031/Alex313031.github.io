{"version":3,"sources":["../../node_modules/browser-pack/_prelude.js","js/CannonController.js","js/Joint.js","js/JointMaterial.js","js/main.js","js/randomElement.js","js/skinDataToGeometry.js"],"names":[],"mappings":"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","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","'use strict';\n\n// var CANNON = require( 'cannon' );\n\nvar CannonController = function(options){\n\n  options = options || {};\n\n  var fixedTimeStep = options.fixedTimeStep ||  1 / 60; // seconds \n  var maxSubSteps = options.maxSubSteps ||  4;\n\n  var world = new CANNON.World();\n\n  world.broadphase = new CANNON.NaiveBroadphase();\n\n  world.gravity = options.gravity ||  new CANNON.Vec3(0, -982, 0); // m/sÂ² \n\n  var bodies = world.bodies;\n\n  var lastTime;\n\n  var v3 = function(x,y,z){ new CANNON.Vec3(x,y,z); };\n\n  function update( time ){\n\n    if(lastTime !== undefined){\n\n       world.step( fixedTimeStep, time - lastTime, maxSubSteps );\n\n    }\n\n    lastTime = time;\n\n  }\n\n  function addBody( shape, params ){\n    \n    var body = new CANNON.Body( params );\n    \n    body.addShape( shape );\n\n    world.add( body ); \n\n    return body;\n  }\n\n  function removeBody( body ){\n\n    world.removeBody( body );\n\n  }\n\n  function removeConstraint( constraint ){\n    world.removeConstraint(constraint);\n  }\n\n\n  function addConstraint( constraint ){\n    \n    world.addConstraint( constraint );\n\n    return constraint; \n  }\n\n\n  function addPointConstraint( bodyA, localPivotA, bodyB, localPivotB, collideConnected, options ){\n    \n    var constraint = new CANNON.PointToPointConstraint(\n      bodyA,\n      localPivotA,\n      bodyB,\n      localPivotB);\n\n    constraint.collideConnected = collideConnected !== undefined? collideConnected : false;\n    \n    return addConstraint( constraint );\n  }\n\n  function addHingeConstraint( bodyA, pivotA, axisA, bodyB, pivotB, axisB, maxForce, collideConnected, enableMoter)\n  {\n    var constraint = new CANNON.HingeConstraint( bodyA, bodyB, {\n      pivotA: pivotA,\n      pivotB: pivotB,\n      axisA: axisA, //new CANNON.Vec3(1,0,0),\n      axisB: axisB, //new CANNON.Vec3(1,0,0),\n      maxForce: maxForce\n    });\n\n    constraint.collideConnected = collideConnected !== undefined? collideConnected : false;\n\n    if(enableMoter === true)  constraint.enableMotor();\n\n    return addConstraint( constraint );\n  }\n\n  function addConeConstraint( bodyA, pivotA, axisA, bodyB, pivotB, axisB, maxForce, twistAngle, collideConnected ){\n\n    var constraint = new CANNON.ConeTwistConstraint( bodyA, bodyB, {\n        pivotA: pivotA,\n        pivotB: pivotB,\n        axisA: axisA,\n        axisB: axisB,\n        maxForce: maxForce || Infinity,\n        // collideConnected: collideConnected !== undefined? collideConnected : false\n    });\n\n    constraint.twistAngle = twistAngle || 1;\n\n    constraint.collideConnected = collideConnected !== undefined? collideConnected : false;\n\n    return addConstraint( constraint );\n  }\n\n  function addLockConstraint( bodyA, bodyB, maxForce, collideConnected ){\n    var constraint = new CANNON.LockConstraint ( bodyA, bodyB, {\n      maxForce: maxForce\n    } );\n\n    constraint.collideConnected = collideConnected !== undefined? collideConnected : false;\n\n    return addConstraint( constraint );\n  }\n\n  function addSphere( radius, options ){\n\n    var sphereShape = new CANNON.Sphere( radius );\n\n    return addBody( sphereShape, options );\n  }\n\n  function addBox( halfExtents, options ){\n\n    var box = new CANNON.Box( halfExtents || v3( 0.5, 0.5, 0.5 ) );\n\n    return addBody( box, options );\n  }\n\n  function addPlane( options ){\n\n    var plane = new CANNON.Plane();\n\n    return addBody( plane, options );\n\n  }\n\n  return {\n\n    world: world,\n\n    gravity: world.gravity,\n\n    bodies: bodies,\n\n    update: update,\n\n    addBody: addBody,\n\n    removeBody: removeBody,\n    \n    removeConstraint: removeConstraint,\n\n    addConstraint: addConstraint,\n\n    addPointConstraint: addPointConstraint,\n\n    addConeConstraint: addConeConstraint,\n\n    addHingeConstraint: addHingeConstraint,\n\n    addLockConstraint: addLockConstraint,\n\n    addSphere: addSphere,\n\n    addBox: addBox,\n\n    addPlane: addPlane,\n\n    addBoxMesh: function( boxMesh, options ){\n\n      if(!boxMesh.geometry.boundingBox){\n        boxMesh.geometry.computeBoundingBox();\n      }\n\n      var extents = boxMesh.geometry.boundingBox.getSize().multiply( boxMesh.scale );\n\n      var halfExtents = new CANNON.Vec3( extents.x * 0.5, extents.y * 0.5, extents.z * 0.5 );\n\n      return addBox( halfExtents, options );\n\n    }\n\n  };\n\n};\n\n\nmodule.exports = CannonController;\n","'use strict';\n\n\nvar Joint = function ( options ) {\n\n  THREE.Object3D.call( this );\n\n  this.type = 'Joint';\n\n  this.offset = new THREE.Matrix4();\n\n  this.transform = new THREE.Matrix4();\n\n  Object.assign(this, options || {});\n\n  this.applyMatrix(this.transform);\n\n  this.setOffset();\n\n};\n\nJoint.prototype = Object.create( THREE.Object3D.prototype );\nJoint.prototype.constructor = Joint;\n\nJoint.prototype.setOffset = function(){\n\n  this.updateMatrixWorld();\n\n  this.offset.getInverse( this.matrixWorld );\n\n}\n\nJoint.prototype.updateTransform = function() {\n\n  this.updateMatrixWorld();\n\n  this.transform.copy( this.matrixWorld ).multiply( this.offset ); \n\n}\n\n\nmodule.exports = Joint;","// JointMaterial.js\n'use strict'\n\nvar glslify = require('glslify');\n\nvar JointMaterial = function(jointTransforms, options) {\n\n  options = options || {}\n  \n  var mat = {\n\n    transparent: true,\n\n    blending: 0,\n\n    wireframe: false,\n\n    depthTest: true,\n\n    depthWrite: true,\n\n    side: 0,\n\n    lights: true,\n\n    uniforms: Object.assign( {},\n      THREE.UniformsLib.common,\n      THREE.UniformsLib.aomap,\n      THREE.UniformsLib.lightmap,\n      THREE.UniformsLib.emissivemap,\n      THREE.UniformsLib.bumpmap,\n      THREE.UniformsLib.normalmap,\n      THREE.UniformsLib.displacementmap,\n      THREE.UniformsLib.fog,\n      THREE.UniformsLib.lights,\n      {\n        emissive : { value: new THREE.Color( 0x111520 ) },\n        specular : { value: new THREE.Color( 0x333333 ) },\n        shininess: { value: 12 },\n        joints: {type: 'm4v', value: jointTransforms },\n        map: {type: 'c', value: options.map},\n        hitVal: {type: 'f', value: 0}\n      }\n    ),\n\n    vertexShader: [\n\n    '#define PHONG',\n        \n    \"#define USE_MAP\",\n\n    // \"#define FLAT_SHADED\",\n\n\n    'varying vec3 vViewPosition;',\n\n    // '#ifndef FLAT_SHADED',\n\n      'varying vec3 vNormal;',\n\n    // '#endif',\n\n\n    \"uniform mat4 joints[4];\",\n\n    // \"attribute vec3 normal;\",\n\n    \"attribute vec3 jointWeights;\",\n\n    \"attribute vec3 jointIndices;\",\n\n    'uniform float hitVal;',\n\n    'varying float vHitVal;',\n\n\n    THREE.ShaderChunk['common'],\n    THREE.ShaderChunk['uv_pars_vertex'],\n    THREE.ShaderChunk['uv2_pars_vertex'],\n    THREE.ShaderChunk['displacementmap_pars_vertex'],\n    THREE.ShaderChunk['envmap_pars_vertex'],\n    THREE.ShaderChunk['color_pars_vertex'],\n    THREE.ShaderChunk['morphtarget_pars_vertex'],\n    THREE.ShaderChunk['skinning_pars_vertex'],\n    THREE.ShaderChunk['shadowmap_pars_vertex'],\n    THREE.ShaderChunk['logdepthbuf_pars_vertex'],\n    THREE.ShaderChunk['clipping_planes_pars_vertex'],\n\n    'void main() {',\n\n      THREE.ShaderChunk['uv_vertex'],\n      THREE.ShaderChunk['uv2_vertex'],\n      THREE.ShaderChunk['color_vertex'],\n\n      'vHitVal = hitVal * position.z / 40.0;',\n\n\n      // THREE.ShaderChunk['begin_vertex'],\n      \"mat4 jointMatrix = mat4( 0.0 );\",\n\n      \"for(int i=0; i<3; i++){\",\n\n        'jointMatrix += jointWeights[i] * joints[ int(jointIndices[i]) ];',\n\n      \"}\",\n\n      'vec3 transformed = vec3( position );',\n\n\n      // THREE.ShaderChunk['beginnormal_vertex'],\n      'vec3 objectNormal = (jointMatrix * vec4(normal, 0.)).xyz;',\n\n      THREE.ShaderChunk['morphnormal_vertex'],\n      THREE.ShaderChunk['skinbase_vertex'],\n      THREE.ShaderChunk['skinnormal_vertex'],\n      \n      // THREE.ShaderChunk['defaultnormal_vertex'],\n      'vec3 transformedNormal = normalMatrix * objectNormal;',\n\n      THREE.ShaderChunk['displacementmap_vertex'],\n      THREE.ShaderChunk['morphtarget_vertex'],\n      // THREE.ShaderChunk['skinning_vertex'],\n      // THREE.ShaderChunk['project_vertex'],\n\n\n      // THREE.ShaderChunk['worldpos_vertex'],\n      // 'vec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );',\n      'vec4 worldPosition = modelMatrix * jointMatrix * vec4( transformed, 1.0 );',\n      \"vec4 mvPosition = viewMatrix * worldPosition;\",\n      \"gl_Position = projectionMatrix * mvPosition;\",\n      \n      \n      THREE.ShaderChunk['logdepthbuf_vertex'],\n      THREE.ShaderChunk['clipping_planes_vertex'],\n\n\n      \" vViewPosition = -mvPosition.xyz;\",\n\n      'vNormal = normalize( transformedNormal );',\n\n      THREE.ShaderChunk['envmap_vertex'],\n      THREE.ShaderChunk['shadowmap_vertex'],\n\n    '}',\n\n    ].join('\\n'),\n\n    fragmentShader: [\n      '#define PHONG',\n      \n      \"#define USE_MAP\",\n\n      'uniform vec3 diffuse;',\n      'uniform vec3 emissive;',\n      'uniform vec3 specular;',\n      'uniform float shininess;',\n      'uniform float opacity;',\n      'varying float vHitVal;',\n\n      THREE.ShaderChunk['common'],\n      THREE.ShaderChunk['packing'],\n      THREE.ShaderChunk['color_pars_fragment'],\n      THREE.ShaderChunk['uv_pars_fragment'],\n      THREE.ShaderChunk['uv2_pars_fragment'],\n      THREE.ShaderChunk['map_pars_fragment'],\n      THREE.ShaderChunk['alphamap_pars_fragment'],\n      THREE.ShaderChunk['aomap_pars_fragment'],\n      THREE.ShaderChunk['lightmap_pars_fragment'],\n      THREE.ShaderChunk['emissivemap_pars_fragment'],\n      THREE.ShaderChunk['envmap_pars_fragment'],\n      THREE.ShaderChunk['fog_pars_fragment'],\n      THREE.ShaderChunk['bsdfs'],\n      THREE.ShaderChunk['lights_pars'],\n      THREE.ShaderChunk['lights_phong_pars_fragment'],\n      THREE.ShaderChunk['shadowmap_pars_fragment'],\n      THREE.ShaderChunk['bumpmap_pars_fragment'],\n      THREE.ShaderChunk['normalmap_pars_fragment'],\n      THREE.ShaderChunk['specularmap_pars_fragment'],\n      THREE.ShaderChunk['logdepthbuf_pars_fragment'],\n      THREE.ShaderChunk['clipping_planes_pars_fragment'],\n\n      'void main() {',\n\n        'gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);',\n\n        THREE.ShaderChunk['clipping_planes_fragment'],\n\n        'vec4 diffuseColor = vec4( diffuse, opacity );',\n        'ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );',\n        'vec3 totalEmissiveRadiance = emissive;',\n\n        THREE.ShaderChunk['logdepthbuf_fragment'],\n        THREE.ShaderChunk['map_fragment'],\n        THREE.ShaderChunk['color_fragment'],\n        THREE.ShaderChunk['alphamap_fragment'],\n        THREE.ShaderChunk['alphatest_fragment'],\n        THREE.ShaderChunk['specularmap_fragment'],\n        THREE.ShaderChunk['normal_flip'],\n        THREE.ShaderChunk['normal_fragment'],\n        THREE.ShaderChunk['emissivemap_fragment'],\n\n        // accumulation\n        THREE.ShaderChunk['lights_phong_fragment'],\n        THREE.ShaderChunk['lights_template'],\n\n        // modulation\n        THREE.ShaderChunk['aomap_fragment'],\n\n        'vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;',\n\n        THREE.ShaderChunk['envmap_fragment'],\n\n        'gl_FragColor = vec4( outgoingLight, diffuseColor.a );',\n\n        'gl_FragColor.xyz = mix(gl_FragColor.xyz, vec3(1.0,0.0,0.0), min(vHitVal, 0.66));',\n\n        THREE.ShaderChunk['premultiplied_alpha_fragment'],\n        THREE.ShaderChunk['tonemapping_fragment'],\n        THREE.ShaderChunk['encodings_fragment'],\n        THREE.ShaderChunk['fog_fragment'],\n\n      '}',\n    ].join( \"\\n\" )\n\n  };\n\n\n  Object.assign(mat, options || {});\n\n  THREE.ShaderMaterial.call(this, mat);\n\n  this.castShadow = true;\n\n  this.needsUpdate = true;\n\n\n  // console.log(THREE.ShaderChunk['normalmap_pars_fragment']);\n\n\n};\n\n\n/**\n * @extends {THREE.ShaderMaterial}\n */\nJointMaterial.prototype = Object.create(\n    THREE.ShaderMaterial.prototype);\n\n\n/**\n * common js\n */\nmodule.exports = JointMaterial;\n","\n'use strict'\n\nimport Joint from './Joint.js';\n\nimport skinDataToGeometry from './skinDataToGeometry.js'\n\nimport CannonController from './CannonController.js'\n\nimport JointMaterial from './JointMaterial.js'\n\nimport randomElement from './randomElement.js'\n\n\n\nconst isSafari = Object.prototype.toString.call(window.HTMLElement).indexOf('Constructor') > 0 || (function (p) { return p.toString() === \"[object SafariRemoteNotification]\"; })(!window['safari'] || safari.pushNotification);\n\nStartAudioContext(Tone.context, '#container', ()=>{\n  // if(isSafari)  alert('StartAudioContext')\n});\n\n\n\nvar randf = THREE.Math.randFloat;\n\nvar Sketch = function(options){\n\n  options = options || {};\n  \n  var debug = false;\n\n  var elapsedTime = 0;\n\n  var container = options.container || $(\"#container\");\n\n  var globeRad = 10;\n  \n  var goalPos = new THREE.Vector3( 0, 0, 0 );\n  \n  var attenuation = 0.99;\n  \n  var hingeRange = 60;\n  \n  var shadowRes = 2048;\n\n\n\n  var gain = new Tone.Volume( 0 ).toMaster();\n  gain.set( 'volume',  -15 );\n\n\n  // tone\n  var synth = new Tone.PolySynth(3, Tone.Synth).toMaster();\n  synth.volume.value = -10;\n  synth.set(\"detune\", -1200);\n\n\n  var dist = new Tone.Chorus(1, 100, 0.5).toMaster();\n  var chorus = new Tone.PingPongDelay(\"4n\", 0.05).connect(dist);//.toMaster();\n  var duoSynth = new Tone.DuoSynth().connect(chorus);\n  duoSynth.toMaster();\n  duoSynth.volume.value = -10;\n  \n\n  var notes = ['A1','A2','A3','A4','C1','C2','C3','C4','E1','E2','E3','E4']\n  var playNote = () => {\n    duoSynth.triggerAttackRelease(randomElement(notes), \"16n\");\n  }\n\n\n  // colors\n  var c0 = new THREE.Color(0xffffff);\n  var c1 = new THREE.Color(0xedff00);\n  var orig_c0 = c0.clone();\n  var orig_c1 = c1.clone();\n\n  // three\n  var view = new ThreeView(container);// boiler plate... couldn't this be passed in? then we could do a player...\n\n  var renderer = view.setupRenderer();\n\n  if(!isSafari) {\n    renderer.shadowMap.enabled = true;\n    renderer.shadowMap.type = THREE.PCFSoftShadowMap;\n  }\n  renderer.setClearColor(0x333333, 0.1)\n\n  var clock = new THREE.Clock();\n\n  var scene = new THREE.Scene();\n\n  var camera = new THREE.PerspectiveCamera(60, view.aspect, 1, 1000);\n  camera.position.y = -5;\n  camera.position.z = 40;\n  camera.lookAt( new THREE.Vector3(camera.position.x, camera.position.y, 0) );\n  \n  var makeSpot = () => {\n    var spot = new THREE.SpotLight();\n\n    spot.castShadow = true;\n    spot.shadow.mapSize.width = shadowRes;\n    spot.shadow.mapSize.height = shadowRes;\n    spot.shadow.camera.near = 0.1;\n    spot.shadow.camera.far = 100;\n    spot.shadow.camera.fov = 60;\n    spot.shadow.bias = 0.000001;\n    // scene.add( spot );\n\n    return spot\n  }\n\n  var spot = makeSpot();\n  spot.color.set(0xBBFFEE).multiplyScalar( 0.66 );\n  spot.position.lerp(camera.position, 0.75);\n  spot.position.y += 10;\n  spot.lookAt(new THREE.Vector3( 0, 0, 0 ));\n  scene.add(spot);\n\n\n  var hemi = new THREE.HemisphereLight( 0x555834, 0x181844, 1 );\n  scene.add( hemi );\n\n\n\n  let box = new THREE.Mesh(new THREE.BoxGeometry(10,10,10), new THREE.MeshBasicMaterial({\n    color: 'white',\n    wireframe: true,\n    side: 2\n  }))\n\n\n  // var oc = new OimoWrapper();\n  // oc.gravity.set(0, 0, 0);\n\n  var cc = CannonController({\n    gravity: new CANNON.Vec3(0,-100,0),\n    maxSubSteps: isSafari ? 1 : 4\n  });\n\n\n  var debugSphere = new THREE.Mesh(new THREE.SphereGeometry(10), new THREE.MeshBasicMaterial({\n    color: 'red',\n    wireframe: true\n  }))\n  debugSphere.visible = debug;\n  debugSphere.position.z = -100;\n  scene.add(debugSphere)\n  debugSphere.body = cc.addSphere(10, {mass: 0});\n\n  var dragPlane = new THREE.Mesh(new THREE.PlaneGeometry( 300, 300, 10, 10), new THREE.MeshBasicMaterial( {\n    color: 'magenta',\n    wireframe: true\n  } ));\n  dragPlane.visible = false;\n\n  scene.add(dragPlane)\n\n\n\n\n  var dataTex = new THREE.DataTexture( new Uint8Array([255,0,255, 0,255,255]), 2, 1, THREE.RGBFormat/*, type, mapping, wrapS, wrapT, magFilter, minFilter, anisotropy */)\n  var updateDataTex = ()=>{\n\n    let colorVals = c0.toArray().concat(c1.toArray());\n\n    for(var i=0; i<colorVals.length; i++) {\n      dataTex.image.data[i] = colorVals[i] * 255;\n    }\n    dataTex.needsUpdate = true;\n  }\n  updateDataTex();\n\n\n  var skinLoader = new THREE.XHRLoader();\n  skinLoader.setResponseType('json');\n  \n\n  // debug meshes\n  let cube = new THREE.Mesh(new THREE.BoxGeometry(1,1,1), new THREE.MeshBasicMaterial({\n    color: 'cyan',\n    wireframe: true\n  }));\n\n  let jointCube = new THREE.Mesh(cube.geometry, new THREE.MeshBasicMaterial( {\n    color: 'red',\n    wireframe: true\n  } ) );\n  jointCube.scale.multiplyScalar(2);\n\n  var skins = [];\n  var intersectables = [];\n\n  var createSkin = (json, geometry) => {\n    var skin = {\n      skinObj: new THREE.Object3D(),\n      raycastIntersects: [],\n      rigidBodies: [],\n      constraints: [],\n      loaded: false,\n      joints: [],\n      geometry: null,\n      material: null,\n      mesh: null\n    }\n\n    var skinObj = skin.skinObj;\n    scene.add(skinObj);\n\n    // create the joints\n    let jointMap = {}\n    let jointMatrices = [];\n\n    json['joints'].forEach( function( j ){\n      \n      let joint = new Joint({\n        name: j.name,\n        transform: new THREE.Matrix4().fromArray(j['transform']),\n        rigidBody: j.rigidBody\n      })\n\n      skin.joints.push(joint);\n\n      jointMap[j.name] = joint;\n\n      jointMatrices.push(joint.transform);\n\n\n      // DEBUG\n      if(debug)  joint.add(jointCube.clone());\n    });\n\n\n    // create the rigid bodies\n    for(let i in json['rigidBodies']) {\n\n      let data = json['rigidBodies'][i];\n      \n      let b = new THREE.Object3D();\n      b.name = i\n      b.applyMatrix(new THREE.Matrix4().fromArray(data['transform']))\n      b.updateMatrixWorld(true);\n      skinObj.add(b)\n      skin.rigidBodies.push(b)\n      \n      let inv = new THREE.Matrix4().getInverse(b.matrixWorld)\n\n      data.joints.forEach((j)=>{\n        jointMap[j].applyMatrix(inv);\n        b.add(jointMap[j])\n      })\n\n      // debug rigid body bounds\n      let c = cube.clone();\n      c.scale.multiply( new THREE.Vector3().fromArray(data['extents']) );\n      c.visible = debug;\n      b.add(c)\n\n      // make the rigid body\n      b.body = cc.addBoxMesh( c, {\n        position: b.position,\n        mass: data.mass\n      });\n\n\n      if ( i === 'bulletRigidBodyShape4' ) {\n\n        b.body.addEventListener( 'collide', e => {\n\n          skin.mesh.material.uniforms.hitVal.value = 2;\n\n          playNote();\n\n        });\n\n      }\n\n\n\n      c.body = b.body;\n      skin.raycastIntersects.push(c)\n    }\n\n\n    // create the constraints\n    for(var i in json['constraints']) {\n\n      let c = json[\"constraints\"][i]\n      let a = skinObj.getObjectByName(c['rigidBodyA']);\n      let b = skinObj.getObjectByName(c['rigidBodyB'])\n      \n      let dataA = json['rigidBodies'][c['rigidBodyA']]\n      let dataB = json['rigidBodies'][c['rigidBodyB']]\n      \n      // TODO: local axis in rigid bodies..? \n      let constraintPos = new THREE.Vector3().fromArray(c['translate']);\n\n      let invA = new THREE.Matrix4().getInverse(a.matrixWorld)\n      let invB = new THREE.Matrix4().getInverse(b.matrixWorld)\n\n      let pointInA = constraintPos.clone().applyMatrix4(invA);\n      let pointInB = constraintPos.clone().applyMatrix4(invB);\n\n      \n      let constraint = cc.addConeConstraint( \n\n        a.body,\n        pointInA,\n        CANNON.Vec3.UNIT_Z,\n        \n        b.body,\n        pointInB,\n        CANNON.Vec3.UNIT_Z,\n\n        Infinity);\n\n\n      constraint.angle = .5\n      constraint.twistAngle = 1\n\n      skin.constraints.push(constraint)\n    }\n\n\n    // set the initial joint offsets\n    skinObj.updateMatrixWorld(true);\n\n    skin.joints.forEach( j => {\n      j.setOffset();\n    });\n\n\n\n    // put together the mesh\n    let jointTransforms = skin.joints.map(j => {\n      return j.transform\n    })\n\n    var jointMaterial = new JointMaterial(jointTransforms, {\n      map: dataTex\n    });\n\n    \n    let mesh = new THREE.Mesh(geometry, jointMaterial);\n    mesh.castShadow = true;\n    mesh.receiveShadow = true;\n\n\n\n    mesh.customDepthMaterial = new THREE.ShaderMaterial({\n        \n        vertexShader: [\n\n        \"uniform mat4 joints[4];\",\n\n        \"attribute vec3 jointWeights;\",\n\n        \"attribute vec3 jointIndices;\",\n\n        'void main() {',\n\n\n        \"mat4 jointMatrix = mat4( 0.0 );\",\n\n        \"for(int i=0; i<3; i++){\",\n\n          'jointMatrix += jointWeights[i] * joints[ int(jointIndices[i]) ];',\n\n        \"}\",\n\n        'vec3 transformed = vec3( position );',\n\n        'vec4 worldPosition = modelMatrix * jointMatrix * vec4( transformed, 1.0 );',\n        \n        \"gl_Position = projectionMatrix * viewMatrix * worldPosition;\",\n\n        '}',\n\n        ].join('\\n'),\n        \n        fragmentShader: [\n\n        THREE.ShaderChunk['common'],\n        THREE.ShaderChunk['packing'],\n        THREE.ShaderChunk['uv_pars_fragment'],\n        THREE.ShaderChunk['map_pars_fragment'],\n        THREE.ShaderChunk['alphamap_pars_fragment'],\n        THREE.ShaderChunk['logdepthbuf_pars_fragment'],\n        THREE.ShaderChunk['clipping_planes_pars_fragment'],\n\n        'void main() {',\n\n          THREE.ShaderChunk['clipping_planes_fragment'],\n\n          'vec4 diffuseColor = vec4( 1.0 );',\n\n          THREE.ShaderChunk['map_fragment'],\n          THREE.ShaderChunk['alphamap_fragment'],\n          THREE.ShaderChunk['alphatest_fragment'],\n\n          THREE.ShaderChunk['logdepthbuf_fragment'],\n\n          'gl_FragColor = packDepthToRGBA( gl_FragCoord.z );',\n\n        '}',\n        ].join('\\n'),\n        \n        uniforms: jointMaterial.uniforms\n    });\n\n\n    skinObj.add(mesh);\n    skin.geometry = geometry;\n    skin.material = jointMaterial;\n    skin.material = jointMaterial;\n    skin.mesh = mesh;\n\n    skin.rigidBodies.forEach( function( rb ){\n\n      // console.log( rb );\n    \n      if (rb.name ===  'bulletRigidBodyShape4') {\n        rb.body.mesh = skin.mesh;\n      }\n    \n    });\n\n\n    skin.loaded = true;\n\n    intersectables = intersectables.concat(skin.raycastIntersects);\n\n    return skin;\n  }\n\n  var tempPhong = new THREE.MeshPhongMaterial();\n  var tempMesh = new THREE.Mesh(new THREE.BoxGeometry(5,5,0.01), tempPhong);\n  scene.add(tempMesh);\n\n  tempMesh.position.z = -10;\n\n\n  skinLoader.load('assets/mesh.json', json => {\n\n    let geometry = skinDataToGeometry(json);\n    geometry.computeVertexNormals();\n    geometry.computeFaceNormals();\n    geometry['attributes']['position'].dynamic = true;\n\n    let step = 10;\n    let countX = 8;\n    let countY = 9;\n\n    let q = new THREE.Quaternion();\n    q.setFromEuler(new THREE.Euler( 0, 0, Math.PI * 0.25));\n    let q1 = new THREE.Quaternion();\n    q1.setFromEuler(new THREE.Euler( 0, 0, -Math.PI * 0.25));\n\n    for(let i=0; i<countX; i++) {\n      for(let j=0; j<countY; j++) {\n        let skin = createSkin(json, geometry);\n        skins.push(skin); \n        \n        skin.rigidBodies.forEach( function( rb ){\n          rb.body.position.x += ((i) - countX * 0.5 + (j%2) * 0.5) * step * 1.44;\n          rb.body.position.y += (j - countY * 0.5) * step * 0.72;\n\n          rb.body.quaternion.copy(i%2 ? q : q1);\n        });\n      }\n    }\n\n    for(var i=0; i<1; i++) {\n      view.update()\n    }\n  });\n\n\n  var updateSkin = skin => {\n\n    if (skin.loaded) {\n\n      skin.joints.forEach( j => {\n        j.updateTransform();\n      });\n\n      // rigid bodiy transforms\n      skin.rigidBodies.forEach( (b, i)=>{\n\n        if(b.body){\n\n          if(b.body.orig_pos) {\n          //   b.body.position.copy(b.body.orig_pos);\n          }\n\n          b.body.velocity.x *= attenuation;\n          b.body.velocity.y *= attenuation;\n          b.body.velocity.z *= attenuation;\n\n          b.body.angularVelocity.x *= attenuation;\n          b.body.angularVelocity.y *= attenuation;\n          b.body.angularVelocity.z *= attenuation;\n          \n          b.position.copy(b.body.position);\n          b.quaternion.copy(b.body.quaternion);\n        }\n\n        if(b.body.mesh) {\n\n          b.body.mesh.material.uniforms.hitVal.value = Math.max(b.body.mesh.material.uniforms.hitVal.value - 0.05, 0.0);\n        }\n\n      });\n\n\n      // skin.geometry['attributes']['normal'].needsUpdate = true;\n    }\n  }\n\n  view.update = function(){\n\n    if(Tone.context.state && Tone.context.state === \"suspended\") {\n      Tone.context.resume().then(function() {\n        console.log(\"AudioContext resumed!\");\n        // fire your callback here\n      });\n    }\n\n    elapsedTime = clock.getElapsedTime();\n    \n    TWEEN.update();\n\n    cc.update(elapsedTime);\n\n    // controls.update();\n    \n    skins.forEach( function( skin ){\n    \n      updateSkin(skin);\n    \n    });\n\n\n    debugSphere.body.velocity.copy( debugSphere.position );\n    debugSphere.body.velocity.vsub(debugSphere.body.position);\n    debugSphere.body.velocity.z += 30;\n    debugSphere.body.velocity.scale(10);\n\n    debugSphere.body.position.x = debugSphere.position.x;\n    debugSphere.body.position.y = debugSphere.position.y;\n    debugSphere.body.position.z = debugSphere.position.z;\n\n  };\n\n\n  view.draw = function(){\n\n    renderer.render(scene, camera, null, true);\n\n  };\n\n\n  view.onResize = function(){\n\n    camera.aspect = view.aspect;\n    camera.updateProjectionMatrix();\n\n  };\n\n\n  var raycaster = new THREE.Raycaster();\n  var mouse = new THREE.Vector2();\n  var mousedown = false;\n  var grabbed = false;\n  var draggedBody, dragConstraint;\n\n\n\n  var onPress = e => {\n    mousedown = true;\n  }\n\n  var onRelease = e => {\n    mousedown = false;\n\n    debugSphere.position.z = -50;\n  }\n\n  var onDrag = e => {\n    \n    if(mousedown){\n\n      if(e.type === 'touchmove') {\n        mouse.x = ( e.touches[0].pageX / window.innerWidth ) * 2 - 1;\n        mouse.y = - ( e.touches[0].pageY / window.innerHeight ) * 2 + 1;\n      } else {\n        mouse.x = ( e.pageX / window.innerWidth ) * 2 - 1;\n        mouse.y = - ( e.pageY / window.innerHeight ) * 2 + 1;\n      }\n\n      raycaster.setFromCamera( mouse, camera );\n\n      dragPlane.visible = true;\n      let intersects = raycaster.intersectObject( dragPlane );\n      dragPlane.visible = false;\n\n\n      if(intersects.length){\n\n        let p = intersects[0].point;\n\n        debugSphere.position.copy(p)\n\n        debugSphere.position.z = 10;\n      }\n    }\n\n  }\n\n\n  $(window).on('mousedown', onPress)\n  $(window).on('mouseup', onRelease)\n  $(window).on('mousemove', onDrag)\n\n  container.on('touchstart', onPress);\n  container.on('touchend', onRelease);\n  container.on('touchmove', onDrag);\n\n\n  return {\n    begin: function(){\n      view.begin();\n    }\n  };\n\n};\n\n\n\nwindow.onload = function() {\n\n  var sketch = new Sketch();\n\n  sketch.begin();\n\n};\n","\n\n/**\n * returns a random element from an array or object\n * @param  {Array|Object} obj\n * @return {object}\n */\nmodule.exports = function(obj) {\n\n  if (Array.isArray(obj)) {\n\n    return obj[Math.floor(Math.random() * obj.length)];\n\n  } else if (obj instanceof Object) {\n\n    return obj[randElement(Object.keys[obj])];\n\n  }\n\n  return obj;\n};\n","// SkinDataToGeometry.js\n\n\nmodule.exports = json => {\n\n  var faces = json['meshData']['faces']\n  var v = json['meshData']['position'];\n  var n = json['meshData']['normal'];\n  var uv = json['meshData']['uv'][Object.keys(json['meshData']['uv'])[0]];\n  var sw = json['skinWeights'];\n  var si = json['skinIndices'];\n\n  var positions = [];\n  var normals = [];\n  var uvs = [];\n\n  var jointWeights = [];\n  var jointIndices = [];\n\n  var addPos = p => {\n    positions.push(p[0], p[1], p[2])\n  }\n\n  var addNorm = n => {\n    normals.push(n[0], n[1], n[2])\n  }\n\n  var addUV = uv => {\n    uvs.push(uv[0], uv[1])\n  }\n\n  var addJointWeights = jw => {\n    jointWeights.push(jw[0] || 0, jw[1] || 0, jw[2] || 0)\n  }\n\n  var addJointIndices = ji => {\n    jointIndices.push(ji[0] || 0, ji[1] || 0, ji[2] || 0)\n  }\n\n  // interate through the faces\n  var v0, v1, v2, i, j;\n  faces.forEach( function( f ){\n    \n    // iterate through the face triangles\n    for(i=1, j=2; j<f[0].length; i++, j++) {\n\n      // positions\n      addPos( v[ f[0][0] ] );\n      addPos( v[ f[0][i] ] );\n      addPos( v[ f[0][j] ] );\n\n      // normals\n      addNorm( n[ f[1][0] ] );\n      addNorm( n[ f[1][i] ] );\n      addNorm( n[ f[1][j] ] );\n\n      // uvs\n      addUV( uv[ f[2][0] ] );\n      addUV( uv[ f[2][i] ] );\n      addUV( uv[ f[2][j] ] );\n\n      // joint weights\n      addJointWeights( sw[ f[0][0] ] );\n      addJointWeights( sw[ f[0][i] ] );\n      addJointWeights( sw[ f[0][j] ] );\n\n      // joint indices\n      addJointIndices( si[ f[0][0] ] );\n      addJointIndices( si[ f[0][i] ] );\n      addJointIndices( si[ f[0][j] ] );\n\n    }\n  \n  });\n\n  // create the Buffer mesh\n  var geometry = new THREE.BufferGeometry();\n\n  geometry.addAttribute( 'position', new THREE.BufferAttribute( new Float32Array(positions), 3 ) );\n  geometry.addAttribute( 'orig_position', new THREE.BufferAttribute( new Float32Array(positions), 3 ) );\n  geometry.addAttribute( 'orgPos', new THREE.BufferAttribute( new Float32Array(positions), 3 ) );\n  geometry.addAttribute( 'normal', new THREE.BufferAttribute( new Float32Array(normals), 3 ) );\n  geometry.addAttribute( 'jointWeights', new THREE.BufferAttribute( new Float32Array(jointWeights), 3 ) );\n  geometry.addAttribute( 'jointIndices', new THREE.BufferAttribute( new Float32Array(jointIndices), 3 ) );\n  geometry.addAttribute( 'uv', new THREE.BufferAttribute( new Float32Array(uvs), 2 ) );\n\n  return geometry;\n}"]}
