// less.min.js
/*!
 * Less - Leaner CSS v2.5.3
 * http://lesscss.org
 *
 * Copyright (c) 2009-2015, Alexis Sellier <self@cloudhead.net>
 * Licensed under the  License.
 *
 */

 /** * @license 
 */

!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.less=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;d.length>g;g++)e(d[g]);return e}({1:[function(a,b){var c=a("./utils").addDataAttr,d=a("./browser");b.exports=function(a,b){c(b,d.currentScript(a)),void 0===b.isFileProtocol&&(b.isFileProtocol=/^(file|(chrome|safari)(-extension)?|resource|qrc|app):/.test(a.location.protocol)),b.async=b.async||!1,b.fileAsync=b.fileAsync||!1,b.poll=b.poll||(b.isFileProtocol?1e3:1500),b.env=b.env||("127.0.0.1"==a.location.hostname||"0.0.0.0"==a.location.hostname||"localhost"==a.location.hostname||a.location.port&&a.location.port.length>0||b.isFileProtocol?"development":"production");var e=/!dumpLineNumbers:(comments|mediaquery|all)/.exec(a.location.hash);e&&(b.dumpLineNumbers=e[1]),void 0===b.useFileCache&&(b.useFileCache=!0),void 0===b.onReady&&(b.onReady=!0)}},{"./browser":3,"./utils":9}],2:[function(a,b){a("promise/polyfill.js");var c=window.less||{};a("./add-default-options")(window,c);var d=b.exports=a("./index")(window,c);window.less=d,c.onReady&&(/!watch/.test(window.location.hash)&&d.watch(),d.registerStylesheetsImmediately(),d.pageLoadFinished=d.refresh("development"===d.env))},{"./add-default-options":1,"./index":7,"promise/polyfill.js":95}],3:[function(a,b){var c=a("./utils");b.exports={createCSS:function(a,b,d){var e=d.href||"",f="less:"+(d.title||c.extractId(e)),g=a.getElementById(f),h=!1,i=a.createElement("style");i.setAttribute("type","text/css"),d.media&&i.setAttribute("media",d.media),i.id=f,i.styleSheet||(i.appendChild(a.createTextNode(b)),h=null!==g&&g.childNodes.length>0&&i.childNodes.length>0&&g.firstChild.nodeValue===i.firstChild.nodeValue);var j=a.getElementsByTagName("head")[0];if(null===g||h===!1){var k=d&&d.nextSibling||null;k?k.parentNode.insertBefore(i,k):j.appendChild(i)}if(g&&h===!1&&g.parentNode.removeChild(g),i.styleSheet)try{i.styleSheet.cssText=b}catch(l){throw new Error("Couldn't reassign styleSheet.cssText.")}},currentScript:function(a){var b=a.document;return b.currentScript||function(){var a=b.getElementsByTagName("script");return a[a.length-1]}()}}},{"./utils":9}],4:[function(a,b){b.exports=function(a,b,c){var d=null;if("development"!==b.env)try{d="undefined"==typeof a.localStorage?null:a.localStorage}catch(e){}return{setCSS:function(a,b,e){if(d){c.info("saving "+a+" to cache.");try{d.setItem(a,e),d.setItem(a+":timestamp",b)}catch(f){c.error('failed to save "'+a+'" to local storage for caching.')}}},getCSS:function(a,b){var c=d&&d.getItem(a),e=d&&d.getItem(a+":timestamp");return e&&b.lastModified&&new Date(b.lastModified).valueOf()===new Date(e).valueOf()?c:void 0}}}},{}],5:[function(a,b){var c=a("./utils"),d=a("./browser");b.exports=function(a,b,e){function f(b,f){var g,h,i="less-error-message:"+c.extractId(f||""),j='<li><label>{line}</label><pre class="{class}">{content}</pre></li>',k=a.document.createElement("div"),l=[],m=b.filename||f,n=m.match(/([^\/]+(\?.*)?)$/)[1];k.id=i,k.className="less-error-message",h="<h3>"+(b.type||"Syntax")+"Error: "+(b.message||"There is an error in your .less file")+'</h3><p>in <a href="'+m+'">'+n+"</a> ";var o=function(a,b,c){void 0!==a.extract[b]&&l.push(j.replace(/\{line\}/,(parseInt(a.line,10)||0)+(b-1)).replace(/\{class\}/,c).replace(/\{content\}/,a.extract[b]))};b.extract&&(o(b,0,""),o(b,1,"line"),o(b,2,""),h+="on line "+b.line+", column "+(b.column+1)+":</p><ul>"+l.join("")+"</ul>"),b.stack&&(b.extract||e.logLevel>=4)&&(h+="<br/>Stack Trace</br />"+b.stack.split("\n").slice(1).join("<br/>")),k.innerHTML=h,d.createCSS(a.document,[".less-error-message ul, .less-error-message li {","list-style-type: none;","margin-right: 15px;","padding: 4px 0;","margin: 0;","}",".less-error-message label {","font-size: 12px;","margin-right: 15px;","padding: 4px 0;","color: #cc7777;","}",".less-error-message pre {","color: #dd6666;","padding: 4px 0;","margin: 0;","display: inline-block;","}",".less-error-message pre.line {","color: #ff0000;","}",".less-error-message h3 {","font-size: 20px;","font-weight: bold;","padding: 15px 0 5px 0;","margin: 0;","}",".less-error-message a {","color: #10a","}",".less-error-message .error {","color: red;","font-weight: bold;","padding-bottom: 2px;","border-bottom: 1px dashed red;","}"].join("\n"),{title:"error-message"}),k.style.cssText=["font-family: Arial, sans-serif","border: 1px solid #e00","background-color: #eee","border-radius: 5px","-webkit-border-radius: 5px","-moz-border-radius: 5px","color: #e00","padding: 15px","margin-bottom: 15px"].join(";"),"development"===e.env&&(g=setInterval(function(){var b=a.document,c=b.body;c&&(b.getElementById(i)?c.replaceChild(k,b.getElementById(i)):c.insertBefore(k,c.firstChild),clearInterval(g))},10))}function g(a,b){e.errorReporting&&"html"!==e.errorReporting?"console"===e.errorReporting?k(a,b):"function"==typeof e.errorReporting&&e.errorReporting("add",a,b):f(a,b)}function h(b){var d=a.document.getElementById("less-error-message:"+c.extractId(b));d&&d.parentNode.removeChild(d)}function i(){}function j(a){e.errorReporting&&"html"!==e.errorReporting?"console"===e.errorReporting?i(a):"function"==typeof e.errorReporting&&e.errorReporting("remove",a):h(a)}function k(a,c){var d="{line} {content}",f=a.filename||c,g=[],h=(a.type||"Syntax")+"Error: "+(a.message||"There is an error in your .less file")+" in "+f+" ",i=function(a,b,c){void 0!==a.extract[b]&&g.push(d.replace(/\{line\}/,(parseInt(a.line,10)||0)+(b-1)).replace(/\{class\}/,c).replace(/\{content\}/,a.extract[b]))};a.extract&&(i(a,0,""),i(a,1,"line"),i(a,2,""),h+="on line "+a.line+", column "+(a.column+1)+":\n"+g.join("\n")),a.stack&&(a.extract||e.logLevel>=4)&&(h+="\nStack Trace\n"+a.stack),b.logger.error(h)}return{add:g,remove:j}}},{"./browser":3,"./utils":9}],6:[function(a,b){b.exports=function(b,c){function d(){if(window.XMLHttpRequest&&!("file:"===window.location.protocol&&"ActiveXObject"in window))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(a){return c.error("browser doesn't support AJAX."),null}}var e=a("../less/environment/abstract-file-manager.js"),f={},g=function(){};return g.prototype=new e,g.prototype.alwaysMakePathsAbsolute=function(){return!0},g.prototype.join=function(a,b){return a?this.extractUrlParts(b,a).path:b},g.prototype.doXHR=function(a,e,f,g){function h(b,c,d){b.status>=200&&300>b.status?c(b.responseText,b.getResponseHeader("Last-Modified")):"function"==typeof d&&d(b.status,a)}var i=d(),j=b.isFileProtocol?b.fileAsync:b.async;"function"==typeof i.overrideMimeType&&i.overrideMimeType("text/css"),c.debug("XHR: Getting '"+a+"'"),i.open("GET",a,j),i.setRequestHeader("Accept",e||"text/x-less, text/css; q=0.9, */*; q=0.5"),i.send(null),b.isFileProtocol&&!b.fileAsync?0===i.status||i.status>=200&&300>i.status?f(i.responseText):g(i.status,a):j?i.onreadystatechange=function(){4==i.readyState&&h(i,f,g)}:h(i,f,g)},g.prototype.supports=function(){return!0},g.prototype.clearFileCache=function(){f={}},g.prototype.loadFile=function(a,b,c,d,e){b&&!this.isPathAbsolute(a)&&(a=b+a),c=c||{};var g=this.extractUrlParts(a,window.location.href),h=g.url;if(c.useFileCache&&f[h])try{var i=f[h];e(null,{contents:i,filename:h,webInfo:{lastModified:new Date}})}catch(j){e({filename:h,message:"Error loading file "+h+" error was "+j.message})}else this.doXHR(h,c.mime,function(a,b){f[h]=a,e(null,{contents:a,filename:h,webInfo:{lastModified:b}})},function(a,b){e({type:"File",message:"'"+b+"' wasn't found ("+a+")",href:h})})},g}},{"../less/environment/abstract-file-manager.js":14}],7:[function(a,b){var c=a("./utils").addDataAttr,d=a("./browser");b.exports=function(b,e){function f(a){return e.postProcessor&&"function"==typeof e.postProcessor&&(a=e.postProcessor.call(a,a)||a),a}function g(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function h(a,b){var c=Array.prototype.slice.call(arguments,2);return function(){var d=c.concat(Array.prototype.slice.call(arguments,0));return a.apply(b,d)}}function i(a){for(var b,c=m.getElementsByTagName("style"),d=0;c.length>d;d++)if(b=c[d],b.type.match(t)){var f=g(e);f.modifyVars=a;var i=b.innerHTML||"";f.filename=m.location.href.replace(/#.*$/,""),n.render(i,f,h(function(a,b,c){b?r.add(b,"inline"):(a.type="text/css",a.styleSheet?a.styleSheet.cssText=c.css:a.innerHTML=c.css)},null,b))}}function j(a,b,d,h,i){function j(c){var e=c.contents,g=c.filename,i=c.webInfo,j={currentDirectory:q.getPath(g),filename:g,rootFilename:g,relativeUrls:k.relativeUrls};if(j.entryPath=j.currentDirectory,j.rootpath=k.rootpath||j.currentDirectory,i&&(i.remaining=h,!k.modifyVars)){var l=s.getCSS(g,i);if(!d&&l)return i.local=!0,void b(null,l,e,a,i,g)}r.remove(g),k.rootFileInfo=j,n.render(e,k,function(c,d){c?(c.href=g,b(c)):(d.css=f(d.css),k.modifyVars||s.setCSS(a.href,i.lastModified,d.css),b(null,d.css,e,a,i,g))})}var k=g(e);c(k,a),k.mime=a.type,i&&(k.modifyVars=i),q.loadFile(a.href,null,k,o,function(a,c){return a?void b(a):void j(c)})}function k(a,b,c){for(var d=0;n.sheets.length>d;d++)j(n.sheets[d],a,b,n.sheets.length-(d+1),c)}function l(){"development"===n.env&&(n.watchTimer=setInterval(function(){n.watchMode&&(q.clearFileCache(),k(function(a,c,e,f){a?r.add(a,a.href||f.href):c&&d.createCSS(b.document,c,f)}))},e.poll))}var m=b.document,n=a("../less")();n.options=e;var o=n.environment,p=a("./file-manager")(e,n.logger),q=new p;o.addFileManager(q),n.FileManager=p,a("./log-listener")(n,e);var r=a("./error-reporting")(b,n,e),s=n.cache=e.cache||a("./cache")(b,e,n.logger);e.functions&&n.functions.functionRegistry.addMultiple(e.functions);var t=/^text\/(x-)?less$/;return n.watch=function(){return n.watchMode||(n.env="development",l()),this.watchMode=!0,!0},n.unwatch=function(){return clearInterval(n.watchTimer),this.watchMode=!1,!1},n.registerStylesheetsImmediately=function(){var a=m.getElementsByTagName("link");n.sheets=[];for(var b=0;a.length>b;b++)("stylesheet/less"===a[b].rel||a[b].rel.match(/stylesheet/)&&a[b].type.match(t))&&n.sheets.push(a[b])},n.registerStylesheets=function(){return new Promise(function(a){n.registerStylesheetsImmediately(),a()})},n.modifyVars=function(a){return n.refresh(!0,a,!1)},n.refresh=function(a,c,e){return(a||e)&&e!==!1&&q.clearFileCache(),new Promise(function(e,f){var g,h,j;g=h=new Date,k(function(a,c,i,k,l){return a?(r.add(a,a.href||k.href),void f(a)):(n.logger.info(l.local?"loading "+k.href+" from cache.":"rendered "+k.href+" successfully."),d.createCSS(b.document,c,k),n.logger.info("css for "+k.href+" generated in "+(new Date-h)+"ms"),0===l.remaining&&(j=new Date-g,n.logger.info("less has finished. css generated in "+j+"ms"),e({startTime:g,endTime:h,totalMilliseconds:j,sheets:n.sheets.length})),void(h=new Date))},a,c),i(c)})},n.refreshStyles=i,n}},{"../less":30,"./browser":3,"./cache":4,"./error-reporting":5,"./file-manager":6,"./log-listener":8,"./utils":9}],8:[function(a,b){b.exports=function(a,b){var c=4,d=3,e=2,f=1;b.logLevel="undefined"!=typeof b.logLevel?b.logLevel:"development"===b.env?d:f,b.loggers||(b.loggers=[{debug:function(a){b.logLevel>=c&&console.log(a)},info:function(a){b.logLevel>=d&&console.log(a)},warn:function(a){b.logLevel>=e&&console.warn(a)},error:function(a){b.logLevel>=f&&console.error(a)}}]);for(var g=0;b.loggers.length>g;g++)a.logger.addListener(b.loggers[g])}},{}],9:[function(a,b){b.exports={extractId:function(a){return a.replace(/^[a-z-]+:\/+?[^\/]+/,"").replace(/[\?\&]livereload=\w+/,"").replace(/^\//,"").replace(/\.[a-zA-Z]+$/,"").replace(/[^\.\w-]+/g,"-").replace(/\./g,":")},addDataAttr:function(a,b){for(var c in b.dataset)if(b.dataset.hasOwnProperty(c))if("env"===c||"dumpLineNumbers"===c||"rootpath"===c||"errorReporting"===c)a[c]=b.dataset[c];else try{a[c]=JSON.parse(b.dataset[c])}catch(d){}}}},{}],10:[function(a,b){var c={};b.exports=c;var d=function(a,b,c){if(a)for(var d=0;c.length>d;d++)a.hasOwnProperty(c[d])&&(b[c[d]]=a[c[d]])},e=["paths","relativeUrls","rootpath","strictImports","insecure","dumpLineNumbers","compress","syncImport","chunkInput","mime","useFileCache","processImports","reference","pluginManager"];c.Parse=function(a){d(a,this,e),"string"==typeof this.paths&&(this.paths=[this.paths])};var f=["paths","compress","ieCompat","strictMath","strictUnits","sourceMap","importMultiple","urlArgs","javascriptEnabled","pluginManager","importantScope"];c.Eval=function(a,b){d(a,this,f),"string"==typeof this.paths&&(this.paths=[this.paths]),this.frames=b||[],this.importantScope=this.importantScope||[]},c.Eval.prototype.inParenthesis=function(){this.parensStack||(this.parensStack=[]),this.parensStack.push(!0)},c.Eval.prototype.outOfParenthesis=function(){this.parensStack.pop()},c.Eval.prototype.isMathOn=function(){return this.strictMath?this.parensStack&&this.parensStack.length:!0},c.Eval.prototype.isPathRelative=function(a){return!/^(?:[a-z-]+:|\/|#)/i.test(a)},c.Eval.prototype.normalizePath=function(a){var b,c=a.split("/").reverse();for(a=[];0!==c.length;)switch(b=c.pop()){case".":break;case"..":0===a.length||".."===a[a.length-1]?a.push(b):a.pop();break;default:a.push(b)}return a.join("/")}},{}],11:[function(a,b){b.exports={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"}},{}],12:[function(a,b){b.exports={colors:a("./colors"),unitConversions:a("./unit-conversions")}},{"./colors":11,"./unit-conversions":13}],13:[function(a,b){b.exports={length:{m:1,cm:.01,mm:.001,"in":.0254,px:.0254/96,pt:.0254/72,pc:.0254/72*12},duration:{s:1,ms:.001},angle:{rad:1/(2*Math.PI),deg:1/360,grad:.0025,turn:1}}},{}],14:[function(a,b){var c=function(){};c.prototype.getPath=function(a){var b=a.lastIndexOf("?");return b>0&&(a=a.slice(0,b)),b=a.lastIndexOf("/"),0>b&&(b=a.lastIndexOf("\\")),0>b?"":a.slice(0,b+1)},c.prototype.tryAppendExtension=function(a,b){return/(\.[a-z]*$)|([\?;].*)$/.test(a)?a:a+b},c.prototype.tryAppendLessExtension=function(a){return this.tryAppendExtension(a,".less")},c.prototype.supportsSync=function(){return!1},c.prototype.alwaysMakePathsAbsolute=function(){return!1},c.prototype.isPathAbsolute=function(a){return/^(?:[a-z-]+:|\/|\\|#)/i.test(a)},c.prototype.join=function(a,b){return a?a+b:b},c.prototype.pathDiff=function(a,b){var c,d,e,f,g=this.extractUrlParts(a),h=this.extractUrlParts(b),i="";if(g.hostPart!==h.hostPart)return"";for(d=Math.max(h.directories.length,g.directories.length),c=0;d>c&&h.directories[c]===g.directories[c];c++);for(f=h.directories.slice(c),e=g.directories.slice(c),c=0;f.length-1>c;c++)i+="../";for(c=0;e.length-1>c;c++)i+=e[c]+"/";return i},c.prototype.extractUrlParts=function(a,b){var c,d,e=/^((?:[a-z-]+:)?\/+?(?:[^\/\?#]*\/)|([\/\\]))?((?:[^\/\\\?#]*[\/\\])*)([^\/\\\?#]*)([#\?].*)?$/i,f=a.match(e),g={},h=[];if(!f)throw new Error("Could not parse sheet href - '"+a+"'");if(b&&(!f[1]||f[2])){if(d=b.match(e),!d)throw new Error("Could not parse page url - '"+b+"'");f[1]=f[1]||d[1]||"",f[2]||(f[3]=d[3]+f[3])}if(f[3]){for(h=f[3].replace(/\\/g,"/").split("/"),c=0;h.length>c;c++)"."===h[c]&&(h.splice(c,1),c-=1);for(c=0;h.length>c;c++)".."===h[c]&&c>0&&(h.splice(c-1,2),c-=2)}return g.hostPart=f[1],g.directories=h,g.path=(f[1]||"")+h.join("/"),g.fileUrl=g.path+(f[4]||""),g.url=g.fileUrl+(f[5]||""),g},b.exports=c},{}],15:[function(a,b){var c=a("../logger"),d=function(a,b){this.fileManagers=b||[],a=a||{};for(var c=["encodeBase64","mimeLookup","charsetLookup","getSourceMapGenerator"],d=[],e=d.concat(c),f=0;e.length>f;f++){var g=e[f],h=a[g];h?this[g]=h.bind(a):d.length>f&&this.warn("missing required function in environment - "+g)}};d.prototype.getFileManager=function(a,b,d,e,f){a||c.warn("getFileManager called with no filename.. Please report this issue. continuing."),null==b&&c.warn("getFileManager called with null directory.. Please report this issue. continuing.");var g=this.fileManagers;d.pluginManager&&(g=[].concat(g).concat(d.pluginManager.getFileManagers()));for(var h=g.length-1;h>=0;h--){var i=g[h];if(i[f?"supportsSync":"supports"](a,b,d,e))return i}return null},d.prototype.addFileManager=function(a){this.fileManagers.push(a)},d.prototype.clearFileManagers=function(){this.fileManagers=[]},b.exports=d},{"../logger":32}],16:[function(a){function b(a,b,d){var e,f,g,h,i=b.alpha,j=d.alpha,k=[];g=j+i*(1-j);for(var l=0;3>l;l++)e=b.rgb[l]/255,f=d.rgb[l]/255,h=a(e,f),g&&(h=(j*f+i*(e-j*(e+f-h)))/g),k[l]=255*h;return new c(k,g)}var c=a("../tree/color"),d=a("./function-registry"),e={multiply:function(a,b){return a*b},screen:function(a,b){return a+b-a*b},overlay:function(a,b){return a*=2,1>=a?e.multiply(a,b):e.screen(a-1,b)},softlight:function(a,b){var c=1,d=a;return b>.5&&(d=1,c=a>.25?Math.sqrt(a):((16*a-12)*a+4)*a),a-(1-2*b)*d*(c-a)},hardlight:function(a,b){return e.overlay(b,a)},difference:function(a,b){return Math.abs(a-b)},exclusion:function(a,b){return a+b-2*a*b},average:function(a,b){return(a+b)/2},negation:function(a,b){return 1-Math.abs(a+b-1)}};for(var f in e)e.hasOwnProperty(f)&&(b[f]=b.bind(null,e[f]));d.addMultiple(b)},{"../tree/color":49,"./function-registry":21}],17:[function(a){function b(a){return Math.min(1,Math.max(0,a))}function c(a){return f.hsla(a.h,a.s,a.l,a.a)}function d(a){if(a instanceof g)return parseFloat(a.unit.is("%")?a.value/100:a.value);if("number"==typeof a)return a;throw{type:"Argument",message:"color functions take numbers as parameters"}}function e(a,b){return a instanceof g&&a.unit.is("%")?parseFloat(a.value*b/100):d(a)}var f,g=a("../tree/dimension"),h=a("../tree/color"),i=a("../tree/quoted"),j=a("../tree/anonymous"),k=a("./function-registry");f={rgb:function(a,b,c){return f.rgba(a,b,c,1)},rgba:function(a,b,c,f){var g=[a,b,c].map(function(a){return e(a,255)});return f=d(f),new h(g,f)},hsl:function(a,b,c){return f.hsla(a,b,c,1)},hsla:function(a,c,e,g){function h(a){return a=0>a?a+1:a>1?a-1:a,1>6*a?j+(i-j)*a*6:1>2*a?i:2>3*a?j+(i-j)*(2/3-a)*6:j}a=d(a)%360/360,c=b(d(c)),e=b(d(e)),g=b(d(g));var i=.5>=e?e*(c+1):e+c-e*c,j=2*e-i;return f.rgba(255*h(a+1/3),255*h(a),255*h(a-1/3),g)},hsv:function(a,b,c){return f.hsva(a,b,c,1)},hsva:function(a,b,c,e){a=d(a)%360/360*360,b=d(b),c=d(c),e=d(e);var g,h;g=Math.floor(a/60%6),h=a/60-g;var i=[c,c*(1-b),c*(1-h*b),c*(1-(1-h)*b)],j=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]];return f.rgba(255*i[j[g][0]],255*i[j[g][1]],255*i[j[g][2]],e)},hue:function(a){return new g(a.toHSL().h)},saturation:function(a){return new g(100*a.toHSL().s,"%")},lightness:function(a){return new g(100*a.toHSL().l,"%")},hsvhue:function(a){return new g(a.toHSV().h)},hsvsaturation:function(a){return new g(100*a.toHSV().s,"%")},hsvvalue:function(a){return new g(100*a.toHSV().v,"%")},red:function(a){return new g(a.rgb[0])},green:function(a){return new g(a.rgb[1])},blue:function(a){return new g(a.rgb[2])},alpha:function(a){return new g(a.toHSL().a)},luma:function(a){return new g(a.luma()*a.alpha*100,"%")},luminance:function(a){var b=.2126*a.rgb[0]/255+.7152*a.rgb[1]/255+.0722*a.rgb[2]/255;return new g(b*a.alpha*100,"%")},saturate:function(a,d,e){if(!a.rgb)return null;var f=a.toHSL();return f.s+="undefined"!=typeof e&&"relative"===e.value?f.s*d.value/100:d.value/100,f.s=b(f.s),c(f)},desaturate:function(a,d,e){var f=a.toHSL();return f.s-="undefined"!=typeof e&&"relative"===e.value?f.s*d.value/100:d.value/100,f.s=b(f.s),c(f)},lighten:function(a,d,e){var f=a.toHSL();return f.l+="undefined"!=typeof e&&"relative"===e.value?f.l*d.value/100:d.value/100,f.l=b(f.l),c(f)},darken:function(a,d,e){var f=a.toHSL();return f.l-="undefined"!=typeof e&&"relative"===e.value?f.l*d.value/100:d.value/100,f.l=b(f.l),c(f)},fadein:function(a,d,e){var f=a.toHSL();return f.a+="undefined"!=typeof e&&"relative"===e.value?f.a*d.value/100:d.value/100,f.a=b(f.a),c(f)},fadeout:function(a,d,e){var f=a.toHSL();return f.a-="undefined"!=typeof e&&"relative"===e.value?f.a*d.value/100:d.value/100,f.a=b(f.a),c(f)},fade:function(a,d){var e=a.toHSL();return e.a=d.value/100,e.a=b(e.a),c(e)},spin:function(a,b){var d=a.toHSL(),e=(d.h+b.value)%360;return d.h=0>e?360+e:e,c(d)},mix:function(a,b,c){a.toHSL&&b.toHSL||(console.log(b.type),console.dir(b)),c||(c=new g(50));var d=c.value/100,e=2*d-1,f=a.toHSL().a-b.toHSL().a,i=((e*f==-1?e:(e+f)/(1+e*f))+1)/2,j=1-i,k=[a.rgb[0]*i+b.rgb[0]*j,a.rgb[1]*i+b.rgb[1]*j,a.rgb[2]*i+b.rgb[2]*j],l=a.alpha*d+b.alpha*(1-d);return new h(k,l)},greyscale:function(a){return f.desaturate(a,new g(100))},contrast:function(a,b,c,e){if(!a.rgb)return null;if("undefined"==typeof c&&(c=f.rgba(255,255,255,1)),"undefined"==typeof b&&(b=f.rgba(0,0,0,1)),b.luma()>c.luma()){var g=c;c=b,b=g}return e="undefined"==typeof e?.43:d(e),a.luma()<e?c:b},argb:function(a){return new j(a.toARGB())},color:function(a){if(a instanceof i&&/^#([a-f0-9]{6}|[a-f0-9]{3})$/i.test(a.value))return new h(a.value.slice(1));if(a instanceof h||(a=h.fromKeyword(a.value)))return a.value=void 0,a;throw{type:"Argument",message:"argument must be a color keyword or 3/6 digit hex e.g. #FFF"}},tint:function(a,b){return f.mix(f.rgb(255,255,255),a,b)},shade:function(a,b){return f.mix(f.rgb(0,0,0),a,b)}},k.addMultiple(f)},{"../tree/anonymous":45,"../tree/color":49,"../tree/dimension":55,"../tree/quoted":72,"./function-registry":21}],18:[function(a,b){b.exports=function(b){var c=a("../tree/quoted"),d=a("../tree/url"),e=a("./function-registry"),f=function(a,b){return new d(b,a.index,a.currentFileInfo).eval(a.context)},g=a("../logger");e.add("data-uri",function(a,e){e||(e=a,a=null);var h=a&&a.value,i=e.value,j=this.currentFileInfo,k=j.relativeUrls?j.currentDirectory:j.entryPath,l=i.indexOf("#"),m="";-1!==l&&(m=i.slice(l),i=i.slice(0,l));var n=b.getFileManager(i,k,this.context,b,!0);if(!n)return f(this,e);var o=!1;if(a)o=/;base64$/.test(h);else{if(h=b.mimeLookup(i),"image/svg+xml"===h)o=!1;else{var p=b.charsetLookup(h);o=["US-ASCII","UTF-8"].indexOf(p)<0}o&&(h+=";base64")}var q=n.loadFileSync(i,k,this.context,b);if(!q.contents)return g.warn("Skipped data-uri embedding of "+i+" because file not found"),f(this,e||a);var r=q.contents;if(o&&!b.encodeBase64)return f(this,e);r=o?b.encodeBase64(r):encodeURIComponent(r);var s="data:"+h+","+r+m,t=32768;return s.length>=t&&this.context.ieCompat!==!1?(g.warn("Skipped data-uri embedding of "+i+" because its size ("+s.length+" characters) exceeds IE8-safe "+t+" characters!"),f(this,e||a)):new d(new c('"'+s+'"',s,!1,this.index,this.currentFileInfo),this.index,this.currentFileInfo)})}},{"../logger":32,"../tree/quoted":72,"../tree/url":79,"./function-registry":21}],19:[function(a,b){var c=a("../tree/keyword"),d=a("./function-registry"),e={eval:function(){var a=this.value_,b=this.error_;if(b)throw b;return null!=a?a?c.True:c.False:void 0},value:function(a){this.value_=a},error:function(a){this.error_=a},reset:function(){this.value_=this.error_=null}};d.add("default",e.eval.bind(e)),b.exports=e},{"../tree/keyword":64,"./function-registry":21}],20:[function(a,b){var c=a("../tree/expression"),d=function(a,b,c,d){this.name=a.toLowerCase(),this.index=c,this.context=b,this.currentFileInfo=d,this.func=b.frames[0].functionRegistry.get(this.name)};d.prototype.isValid=function(){return Boolean(this.func)},d.prototype.call=function(a){return Array.isArray(a)&&(a=a.filter(function(a){return"Comment"===a.type?!1:!0}).map(function(a){if("Expression"===a.type){var b=a.value.filter(function(a){return"Comment"===a.type?!1:!0});return 1===b.length?b[0]:new c(b)}return a})),this.func.apply(this,a)},b.exports=d},{"../tree/expression":58}],21:[function(a,b){function c(a){return{_data:{},add:function(a,b){a=a.toLowerCase(),this._data.hasOwnProperty(a),this._data[a]=b},addMultiple:function(a){Object.keys(a).forEach(function(b){this.add(b,a[b])}.bind(this))},get:function(b){return this._data[b]||a&&a.get(b)},inherit:function(){return c(this)}}}b.exports=c(null)},{}],22:[function(a,b){b.exports=function(b){var c={functionRegistry:a("./function-registry"),functionCaller:a("./function-caller")};return a("./default"),a("./color"),a("./color-blending"),a("./data-uri")(b),a("./math"),a("./number"),a("./string"),a("./svg")(b),a("./types"),c}},{"./color":17,"./color-blending":16,"./data-uri":18,"./default":19,"./function-caller":20,"./function-registry":21,"./math":24,"./number":25,"./string":26,"./svg":27,"./types":28}],23:[function(a,b){var c=a("../tree/dimension"),d=function(){};d._math=function(a,b,d){if(!(d instanceof c))throw{type:"Argument",message:"argument must be a number"};return null==b?b=d.unit:d=d.unify(),new c(a(parseFloat(d.value)),b)},b.exports=d},{"../tree/dimension":55}],24:[function(a){var b=a("./function-registry"),c=a("./math-helper.js"),d={ceil:null,floor:null,sqrt:null,abs:null,tan:"",sin:"",cos:"",atan:"rad",asin:"rad",acos:"rad"};for(var e in d)d.hasOwnProperty(e)&&(d[e]=c._math.bind(null,Math[e],d[e]));d.round=function(a,b){var d="undefined"==typeof b?0:b.value;return c._math(function(a){return a.toFixed(d)},null,a)},b.addMultiple(d)},{"./function-registry":21,"./math-helper.js":23}],25:[function(a){var b=a("../tree/dimension"),c=a("../tree/anonymous"),d=a("./function-registry"),e=a("./math-helper.js"),f=function(a,d){switch(d=Array.prototype.slice.call(d),d.length){case 0:throw{type:"Argument",message:"one or more arguments required"}}var e,f,g,h,i,j,k,l,m=[],n={};for(e=0;d.length>e;e++)if(g=d[e],g instanceof b)if(h=""===g.unit.toString()&&void 0!==l?new b(g.value,l).unify():g.unify(),j=""===h.unit.toString()&&void 0!==k?k:h.unit.toString(),k=""!==j&&void 0===k||""!==j&&""===m[0].unify().unit.toString()?j:k,l=""!==j&&void 0===l?g.unit.toString():l,f=void 0!==n[""]&&""!==j&&j===k?n[""]:n[j],void 0!==f)i=""===m[f].unit.toString()&&void 0!==l?new b(m[f].value,l).unify():m[f].unify(),(a&&i.value>h.value||!a&&h.value>i.value)&&(m[f]=g);else{if(void 0!==k&&j!==k)throw{type:"Argument",message:"incompatible types"};n[j]=m.length,m.push(g)}else Array.isArray(d[e].value)&&Array.prototype.push.apply(d,Array.prototype.slice.call(d[e].value));return 1==m.length?m[0]:(d=m.map(function(a){return a.toCSS(this.context)}).join(this.context.compress?",":", "),new c((a?"min":"max")+"("+d+")"))};d.addMultiple({min:function(){return f(!0,arguments)},max:function(){return f(!1,arguments)},convert:function(a,b){return a.convertTo(b.value)},pi:function(){return new b(Math.PI)},mod:function(a,c){return new b(a.value%c.value,a.unit)},pow:function(a,c){if("number"==typeof a&&"number"==typeof c)a=new b(a),c=new b(c);else if(!(a instanceof b&&c instanceof b))throw{type:"Argument",message:"arguments must be numbers"};return new b(Math.pow(a.value,c.value),a.unit)},percentage:function(a){var b=e._math(function(a){return 100*a},"%",a);return b}})},{"../tree/anonymous":45,"../tree/dimension":55,"./function-registry":21,"./math-helper.js":23}],26:[function(a){var b=a("../tree/quoted"),c=a("../tree/anonymous"),d=a("../tree/javascript"),e=a("./function-registry");e.addMultiple({e:function(a){return new c(a instanceof d?a.evaluated:a.value)},escape:function(a){return new c(encodeURI(a.value).replace(/=/g,"%3D").replace(/:/g,"%3A").replace(/#/g,"%23").replace(/;/g,"%3B").replace(/\(/g,"%28").replace(/\)/g,"%29"))},replace:function(a,c,d,e){var f=a.value;return d="Quoted"===d.type?d.value:d.toCSS(),f=f.replace(new RegExp(c.value,e?e.value:""),d),new b(a.quote||"",f,a.escaped)},"%":function(a){for(var c=Array.prototype.slice.call(arguments,1),d=a.value,e=0;c.length>e;e++)d=d.replace(/%[sda]/i,function(a){var b="Quoted"===c[e].type&&a.match(/s/i)?c[e].value:c[e].toCSS();return a.match(/[A-Z]$/)?encodeURIComponent(b):b});return d=d.replace(/%%/g,"%"),new b(a.quote||"",d,a.escaped)}})},{"../tree/anonymous":45,"../tree/javascript":62,"../tree/quoted":72,"./function-registry":21}],27:[function(a,b){b.exports=function(){var b=a("../tree/dimension"),c=a("../tree/color"),d=a("../tree/expression"),e=a("../tree/quoted"),f=a("../tree/url"),g=a("./function-registry");g.add("svg-gradient",function(a){function g(){throw{type:"Argument",message:"svg-gradient expects direction, start_color [start_position], [color position,]..., end_color [end_position] or direction, color list"}}var h,i,j,k,l,m,n,o,p="linear",q='x="0" y="0" width="1" height="1"',r={compress:!1},s=a.toCSS(r);switch(2==arguments.length?(arguments[1].value.length<2&&g(),h=arguments[1].value):arguments.length<3?g():h=Array.prototype.slice.call(arguments,1),s){case"to bottom":i='x1="0%" y1="0%" x2="0%" y2="100%"';break;case"to right":i='x1="0%" y1="0%" x2="100%" y2="0%"';break;case"to bottom right":i='x1="0%" y1="0%" x2="100%" y2="100%"';break;case"to top right":i='x1="0%" y1="100%" x2="100%" y2="0%"';break;case"ellipse":case"ellipse at center":p="radial",i='cx="50%" cy="50%" r="75%"',q='x="-50" y="-50" width="101" height="101"';break;default:throw{type:"Argument",message:"svg-gradient direction must be 'to bottom', 'to right', 'to bottom right', 'to top right' or 'ellipse at center'"
}}for(j='<?xml version="1.0" ?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="100%" height="100%" viewBox="0 0 1 1" preserveAspectRatio="none"><'+p+'Gradient id="gradient" gradientUnits="userSpaceOnUse" '+i+">",k=0;h.length>k;k+=1)h[k]instanceof d?(l=h[k].value[0],m=h[k].value[1]):(l=h[k],m=void 0),l instanceof c&&((0===k||k+1===h.length)&&void 0===m||m instanceof b)||g(),n=m?m.toCSS(r):0===k?"0%":"100%",o=l.alpha,j+='<stop offset="'+n+'" stop-color="'+l.toRGB()+'"'+(1>o?' stop-opacity="'+o+'"':"")+"/>";return j+="</"+p+"Gradient><rect "+q+' fill="url(#gradient)" /></svg>',j=encodeURIComponent(j),j="data:image/svg+xml,"+j,new f(new e("'"+j+"'",j,!1,this.index,this.currentFileInfo),this.index,this.currentFileInfo)})}},{"../tree/color":49,"../tree/dimension":55,"../tree/expression":58,"../tree/quoted":72,"../tree/url":79,"./function-registry":21}],28:[function(a){var b=a("../tree/keyword"),c=a("../tree/detached-ruleset"),d=a("../tree/dimension"),e=a("../tree/color"),f=a("../tree/quoted"),g=a("../tree/anonymous"),h=a("../tree/url"),i=a("../tree/operation"),j=a("./function-registry"),k=function(a,c){return a instanceof c?b.True:b.False},l=function(a,c){if(void 0===c)throw{type:"Argument",message:"missing the required second argument to isunit."};if(c="string"==typeof c.value?c.value:c,"string"!=typeof c)throw{type:"Argument",message:"Second argument to isunit should be a unit or a string."};return a instanceof d&&a.unit.is(c)?b.True:b.False},m=function(a){var b=Array.isArray(a.value)?a.value:Array(a);return b};j.addMultiple({isruleset:function(a){return k(a,c)},iscolor:function(a){return k(a,e)},isnumber:function(a){return k(a,d)},isstring:function(a){return k(a,f)},iskeyword:function(a){return k(a,b)},isurl:function(a){return k(a,h)},ispixel:function(a){return l(a,"px")},ispercentage:function(a){return l(a,"%")},isem:function(a){return l(a,"em")},isunit:l,unit:function(a,c){if(!(a instanceof d))throw{type:"Argument",message:"the first argument to unit must be a number"+(a instanceof i?". Have you forgotten parenthesis?":"")};return c=c?c instanceof b?c.value:c.toCSS():"",new d(a.value,c)},"get-unit":function(a){return new g(a.unit)},extract:function(a,b){return b=b.value-1,m(a)[b]},length:function(a){return new d(m(a).length)}})},{"../tree/anonymous":45,"../tree/color":49,"../tree/detached-ruleset":54,"../tree/dimension":55,"../tree/keyword":64,"../tree/operation":70,"../tree/quoted":72,"../tree/url":79,"./function-registry":21}],29:[function(a,b){var c=a("./contexts"),d=a("./parser/parser"),e=a("./plugins/function-importer");b.exports=function(a){var b=function(a,b){this.rootFilename=b.filename,this.paths=a.paths||[],this.contents={},this.contentsIgnoredChars={},this.mime=a.mime,this.error=null,this.context=a,this.queue=[],this.files={}};return b.prototype.push=function(b,f,g,h,i){var j=this;this.queue.push(b);var k=function(a,c,d){j.queue.splice(j.queue.indexOf(b),1);var e=d===j.rootFilename;h.optional&&a?i(null,{rules:[]},!1,null):(j.files[d]=c,a&&!j.error&&(j.error=a),i(a,c,e,d))},l={relativeUrls:this.context.relativeUrls,entryPath:g.entryPath,rootpath:g.rootpath,rootFilename:g.rootFilename},m=a.getFileManager(b,g.currentDirectory,this.context,a);if(!m)return void k({message:"Could not find a file-manager for "+b});f&&(b=m.tryAppendExtension(b,h.plugin?".js":".less"));var n=function(a){var b=a.filename,f=a.contents.replace(/^\uFEFF/,"");l.currentDirectory=m.getPath(b),l.relativeUrls&&(l.rootpath=m.join(j.context.rootpath||"",m.pathDiff(l.currentDirectory,l.entryPath)),!m.isPathAbsolute(l.rootpath)&&m.alwaysMakePathsAbsolute()&&(l.rootpath=m.join(l.entryPath,l.rootpath))),l.filename=b;var i=new c.Parse(j.context);i.processImports=!1,j.contents[b]=f,(g.reference||h.reference)&&(l.reference=!0),h.plugin?new e(i,l).eval(f,function(a,c){k(a,c,b)}):h.inline?k(null,f,b):new d(i,j,l).parse(f,function(a,c){k(a,c,b)})},o=m.loadFile(b,g.currentDirectory,this.context,a,function(a,b){a?k(a):n(b)});o&&o.then(n,k)},b}},{"./contexts":10,"./parser/parser":37,"./plugins/function-importer":39}],30:[function(a,b){b.exports=function(b,c){var d,e,f,g,h,i={version:[2,5,3],data:a("./data"),tree:a("./tree"),Environment:h=a("./environment/environment"),AbstractFileManager:a("./environment/abstract-file-manager"),environment:b=new h(b,c),visitors:a("./visitors"),Parser:a("./parser/parser"),functions:a("./functions")(b),contexts:a("./contexts"),SourceMapOutput:d=a("./source-map-output")(b),SourceMapBuilder:e=a("./source-map-builder")(d,b),ParseTree:f=a("./parse-tree")(e),ImportManager:g=a("./import-manager")(b),render:a("./render")(b,f,g),parse:a("./parse")(b,f,g),LessError:a("./less-error"),transformTree:a("./transform-tree"),utils:a("./utils"),PluginManager:a("./plugin-manager"),logger:a("./logger")};return i}},{"./contexts":10,"./data":12,"./environment/abstract-file-manager":14,"./environment/environment":15,"./functions":22,"./import-manager":29,"./less-error":31,"./logger":32,"./parse":34,"./parse-tree":33,"./parser/parser":37,"./plugin-manager":38,"./render":40,"./source-map-builder":41,"./source-map-output":42,"./transform-tree":43,"./tree":61,"./utils":82,"./visitors":86}],31:[function(a,b){var c=a("./utils"),d=b.exports=function(a,b,d){Error.call(this);var e=a.filename||d;if(b&&e){var f=b.contents[e],g=c.getLocation(a.index,f),h=g.line,i=g.column,j=a.call&&c.getLocation(a.call,f).line,k=f.split("\n");this.type=a.type||"Syntax",this.filename=e,this.index=a.index,this.line="number"==typeof h?h+1:null,this.callLine=j+1,this.callExtract=k[j],this.column=i,this.extract=[k[h-1],k[h],k[h+1]]}this.message=a.message,this.stack=a.stack};if("undefined"==typeof Object.create){var e=function(){};e.prototype=Error.prototype,d.prototype=new e}else d.prototype=Object.create(Error.prototype);d.prototype.constructor=d},{"./utils":82}],32:[function(a,b){b.exports={error:function(a){this._fireEvent("error",a)},warn:function(a){this._fireEvent("warn",a)},info:function(a){this._fireEvent("info",a)},debug:function(a){this._fireEvent("debug",a)},addListener:function(a){this._listeners.push(a)},removeListener:function(a){for(var b=0;this._listeners.length>b;b++)if(this._listeners[b]===a)return void this._listeners.splice(b,1)},_fireEvent:function(a,b){for(var c=0;this._listeners.length>c;c++){var d=this._listeners[c][a];d&&d(b)}},_listeners:[]}},{}],33:[function(a,b){var c=a("./less-error"),d=a("./transform-tree"),e=a("./logger");b.exports=function(a){var b=function(a,b){this.root=a,this.imports=b};return b.prototype.toCSS=function(b){var f,g,h={};try{f=d(this.root,b)}catch(i){throw new c(i,this.imports)}try{var j=Boolean(b.compress);j&&e.warn("The compress option has been deprecated. We recommend you use a dedicated css minifier, for instance see less-plugin-clean-css.");var k={compress:j,dumpLineNumbers:b.dumpLineNumbers,strictUnits:Boolean(b.strictUnits),numPrecision:8};b.sourceMap?(g=new a(b.sourceMap),h.css=g.toCSS(f,k,this.imports)):h.css=f.toCSS(k)}catch(i){throw new c(i,this.imports)}if(b.pluginManager)for(var l=b.pluginManager.getPostProcessors(),m=0;l.length>m;m++)h.css=l[m].process(h.css,{sourceMap:g,options:b,imports:this.imports});b.sourceMap&&(h.map=g.getExternalSourceMap()),h.imports=[];for(var n in this.imports.files)this.imports.files.hasOwnProperty(n)&&n!==this.imports.rootFilename&&h.imports.push(n);return h},b}},{"./less-error":31,"./logger":32,"./transform-tree":43}],34:[function(a,b){var c,d=a("./contexts"),e=a("./parser/parser"),f=a("./plugin-manager");b.exports=function(b,g,h){var i=function(b,g,j){if(g=g||{},"function"==typeof g&&(j=g,g={}),!j){c||(c="undefined"==typeof Promise?a("promise"):Promise);var k=this;return new c(function(a,c){i.call(k,b,g,function(b,d){b?c(b):a(d)})})}var l,m,n=new f(this);if(n.addPlugins(g.plugins),g.pluginManager=n,l=new d.Parse(g),g.rootFileInfo)m=g.rootFileInfo;else{var o=g.filename||"input",p=o.replace(/[^\/\\]*$/,"");m={filename:o,relativeUrls:l.relativeUrls,rootpath:l.rootpath||"",currentDirectory:p,entryPath:p,rootFilename:o},m.rootpath&&"/"!==m.rootpath.slice(-1)&&(m.rootpath+="/")}var q=new h(l,m);new e(l,q,m).parse(b,function(a,b){return a?j(a):void j(null,b,q,g)},g)};return i}},{"./contexts":10,"./parser/parser":37,"./plugin-manager":38,promise:void 0}],35:[function(a,b){b.exports=function(a,b){function c(b){var c=h-q;512>c&&!b||!c||(p.push(a.slice(q,h+1)),q=h+1)}var d,e,f,g,h,i,j,k,l,m=a.length,n=0,o=0,p=[],q=0;for(h=0;m>h;h++)if(j=a.charCodeAt(h),!(j>=97&&122>=j||34>j))switch(j){case 40:o++,e=h;continue;case 41:if(--o<0)return b("missing opening `(`",h);continue;case 59:o||c();continue;case 123:n++,d=h;continue;case 125:if(--n<0)return b("missing opening `{`",h);n||o||c();continue;case 92:if(m-1>h){h++;continue}return b("unescaped `\\`",h);case 34:case 39:case 96:for(l=0,i=h,h+=1;m>h;h++)if(k=a.charCodeAt(h),!(k>96)){if(k==j){l=1;break}if(92==k){if(h==m-1)return b("unescaped `\\`",h);h++}}if(l)continue;return b("unmatched `"+String.fromCharCode(j)+"`",i);case 47:if(o||h==m-1)continue;if(k=a.charCodeAt(h+1),47==k)for(h+=2;m>h&&(k=a.charCodeAt(h),!(13>=k)||10!=k&&13!=k);h++);else if(42==k){for(f=i=h,h+=2;m-1>h&&(k=a.charCodeAt(h),125==k&&(g=h),42!=k||47!=a.charCodeAt(h+1));h++);if(h==m-1)return b("missing closing `*/`",i);h++}continue;case 42:if(m-1>h&&47==a.charCodeAt(h+1))return b("unmatched `/*`",h);continue}return 0!==n?f>d&&g>f?b("missing closing `}` or `*/`",d):b("missing closing `}`",d):0!==o?b("missing closing `)`",e):(c(!0),p)}},{}],36:[function(a,b){var c=a("./chunker");b.exports=function(){var a,b,d,e,f,g,h,i=[],j={};j.save=function(){h=j.i,i.push({current:g,i:j.i,j:b})},j.restore=function(a){(j.i>d||j.i===d&&a&&!e)&&(d=j.i,e=a);var c=i.pop();g=c.current,h=j.i=c.i,b=c.j},j.forget=function(){i.pop()},j.isWhitespace=function(b){var c=j.i+(b||0),d=a.charCodeAt(c);return d===k||d===n||d===l||d===m},j.$re=function(a){j.i>h&&(g=g.slice(j.i-h),h=j.i);var b=a.exec(g);return b?(s(b[0].length),"string"==typeof b?b:1===b.length?b[0]:b):null},j.$char=function(b){return a.charAt(j.i)!==b?null:(s(1),b)},j.$str=function(b){for(var c=b.length,d=0;c>d;d++)if(a.charAt(j.i+d)!==b.charAt(d))return null;return s(c),b},j.$quoted=function(){var b=a.charAt(j.i);if("'"===b||'"'===b){for(var c=a.length,d=j.i,e=1;c>e+d;e++){var f=a.charAt(e+d);switch(f){case"\\":e++;continue;case"\r":case"\n":break;case b:var g=a.substr(d,e+1);return s(e+1),g}}return null}};var k=32,l=9,m=10,n=13,o=43,p=44,q=47,r=57;j.autoCommentAbsorb=!0,j.commentStore=[],j.finished=!1;var s=function(c){for(var d,e,i,o=j.i,p=b,r=j.i-h,t=j.i+g.length-r,u=j.i+=c,v=a;t>j.i;j.i++){if(d=v.charCodeAt(j.i),j.autoCommentAbsorb&&d===q){if(e=v.charAt(j.i+1),"/"===e){i={index:j.i,isLineComment:!0};var w=v.indexOf("\n",j.i+2);0>w&&(w=t),j.i=w,i.text=v.substr(i.i,j.i-i.i),j.commentStore.push(i);continue}if("*"===e){var x=v.indexOf("*/",j.i+2);if(x>=0){i={index:j.i,text:v.substr(j.i,x+2-j.i),isLineComment:!1},j.i+=i.text.length-1,j.commentStore.push(i);continue}}break}if(d!==k&&d!==m&&d!==l&&d!==n)break}if(g=g.slice(c+j.i-u+r),h=j.i,!g.length){if(f.length-1>b)return g=f[++b],s(0),!0;j.finished=!0}return o!==j.i||p!==b};return j.peek=function(b){if("string"==typeof b){for(var c=0;b.length>c;c++)if(a.charAt(j.i+c)!==b.charAt(c))return!1;return!0}return b.test(g)},j.peekChar=function(b){return a.charAt(j.i)===b},j.currentChar=function(){return a.charAt(j.i)},j.getInput=function(){return a},j.peekNotNumeric=function(){var b=a.charCodeAt(j.i);return b>r||o>b||b===q||b===p},j.start=function(e,i,k){a=e,j.i=b=h=d=0,f=i?c(e,k):[e],g=f[0],s(0)},j.end=function(){var b,c=j.i>=a.length;return d>j.i&&(b=e,j.i=d),{isFinished:c,furthest:j.i,furthestPossibleErrorMessage:b,furthestReachedEnd:j.i>=a.length-1,furthestChar:a[j.i]}},j}},{"./chunker":35}],37:[function(a,b){var c=a("../less-error"),d=a("../tree"),e=a("../visitors"),f=a("./parser-input"),g=a("../utils"),h=function i(a,b,h){function j(a,b){var c="[object Function]"===Object.prototype.toString.call(a)?a.call(n):o.$re(a);return c?c:void l(b||("string"==typeof a?"expected '"+a+"' got '"+o.currentChar()+"'":"unexpected token"))}function k(a,b){return o.$char(a)?a:void l(b||"expected '"+a+"' got '"+o.currentChar()+"'")}function l(a,d){throw new c({index:o.i,filename:h.filename,type:d||"Syntax",message:a},b)}function m(a){var b=h.filename;return{lineNumber:g.getLocation(a,o.getInput()).line+1,fileName:b}}var n,o=f();return{parse:function(f,g,j){var k,l,m,n,p=null,q="";if(l=j&&j.globalVars?i.serializeVars(j.globalVars)+"\n":"",m=j&&j.modifyVars?"\n"+i.serializeVars(j.modifyVars):"",a.pluginManager)for(var r=a.pluginManager.getPreProcessors(),s=0;r.length>s;s++)f=r[s].process(f,{context:a,imports:b,fileInfo:h});(l||j&&j.banner)&&(q=(j&&j.banner?j.banner:"")+l,n=b.contentsIgnoredChars,n[h.filename]=n[h.filename]||0,n[h.filename]+=q.length),f=f.replace(/\r\n?/g,"\n"),f=q+f.replace(/^\uFEFF/,"")+m,b.contents[h.filename]=f;try{o.start(f,a.chunkInput,function(a,d){throw new c({index:d,type:"Parse",message:a,filename:h.filename},b)}),k=new d.Ruleset(null,this.parsers.primary()),k.root=!0,k.firstRoot=!0}catch(t){return g(new c(t,b,h.filename))}var u=o.end();if(!u.isFinished){var v=u.furthestPossibleErrorMessage;v||(v="Unrecognised input","}"===u.furthestChar?v+=". Possibly missing opening '{'":")"===u.furthestChar?v+=". Possibly missing opening '('":u.furthestReachedEnd&&(v+=". Possibly missing something")),p=new c({type:"Parse",message:v,index:u.furthest,filename:h.filename},b)}var w=function(a){return a=p||a||b.error,a?(a instanceof c||(a=new c(a,b,h.filename)),g(a)):g(null,k)};return a.processImports===!1?w():void new e.ImportVisitor(b,w).run(k)},parsers:n={primary:function(){for(var a,b=this.mixin,c=[];;){for(;;){if(a=this.comment(),!a)break;c.push(a)}if(o.finished)break;if(o.peek("}"))break;if(a=this.extendRule())c=c.concat(a);else if(a=b.definition()||this.rule()||this.ruleset()||b.call()||this.rulesetCall()||this.directive())c.push(a);else{for(var d=!1;o.$char(";");)d=!0;if(!d)break}}return c},comment:function(){if(o.commentStore.length){var a=o.commentStore.shift();return new d.Comment(a.text,a.isLineComment,a.index,h)}},entities:{quoted:function(){var a,b=o.i,c=!1;return o.save(),o.$char("~")&&(c=!0),(a=o.$quoted())?(o.forget(),new d.Quoted(a.charAt(0),a.substr(1,a.length-2),c,b,h)):void o.restore()},keyword:function(){var a=o.$char("%")||o.$re(/^[_A-Za-z-][_A-Za-z0-9-]*/);return a?d.Color.fromKeyword(a)||new d.Keyword(a):void 0},call:function(){var a,b,c,e,f=o.i;if(!o.peek(/^url\(/i))return o.save(),(a=o.$re(/^([\w-]+|%|progid:[\w\.]+)\(/))?(a=a[1],b=a.toLowerCase(),"alpha"===b&&(e=n.alpha())?(o.forget(),e):(c=this.arguments(),o.$char(")")?(o.forget(),new d.Call(a,c,f,h)):void o.restore("Could not parse call arguments or missing ')'"))):void o.forget()},arguments:function(){for(var a,b=[];;){if(a=this.assignment()||n.expression(),!a)break;if(b.push(a),!o.$char(","))break}return b},literal:function(){return this.dimension()||this.color()||this.quoted()||this.unicodeDescriptor()},assignment:function(){var a,b;return o.save(),(a=o.$re(/^\w+(?=\s?=)/i))&&o.$char("=")&&(b=n.entity())?(o.forget(),new d.Assignment(a,b)):void o.restore()},url:function(){var a,b=o.i;return o.autoCommentAbsorb=!1,o.$str("url(")?(a=this.quoted()||this.variable()||o.$re(/^(?:(?:\\[\(\)'"])|[^\(\)'"])+/)||"",o.autoCommentAbsorb=!0,k(")"),new d.URL(null!=a.value||a instanceof d.Variable?a:new d.Anonymous(a),b,h)):void(o.autoCommentAbsorb=!0)},variable:function(){var a,b=o.i;return"@"===o.currentChar()&&(a=o.$re(/^@@?[\w-]+/))?new d.Variable(a,b,h):void 0},variableCurly:function(){var a,b=o.i;return"@"===o.currentChar()&&(a=o.$re(/^@\{([\w-]+)\}/))?new d.Variable("@"+a[1],b,h):void 0},color:function(){var a;if("#"===o.currentChar()&&(a=o.$re(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})/))){var b=a.input.match(/^#([\w]+).*/);return b=b[1],b.match(/^[A-Fa-f0-9]+$/)||l("Invalid HEX color code"),new d.Color(a[1],void 0,"#"+b)}},dimension:function(){if(!o.peekNotNumeric()){var a=o.$re(/^([+-]?\d*\.?\d+)(%|[a-z]+)?/i);return a?new d.Dimension(a[1],a[2]):void 0}},unicodeDescriptor:function(){var a;return a=o.$re(/^U\+[0-9a-fA-F?]+(\-[0-9a-fA-F?]+)?/),a?new d.UnicodeDescriptor(a[0]):void 0},javascript:function(){var a,b=o.i;o.save();var c=o.$char("~"),e=o.$char("`");return e?(a=o.$re(/^[^`]*`/))?(o.forget(),new d.JavaScript(a.substr(0,a.length-1),Boolean(c),b,h)):void o.restore("invalid javascript definition"):void o.restore()}},variable:function(){var a;return"@"===o.currentChar()&&(a=o.$re(/^(@[\w-]+)\s*:/))?a[1]:void 0},rulesetCall:function(){var a;return"@"===o.currentChar()&&(a=o.$re(/^(@[\w-]+)\s*\(\s*\)\s*;/))?new d.RulesetCall(a[1]):void 0},extend:function(a){var b,c,e,f,g,h=o.i;if(o.$str(a?"&:extend(":":extend(")){do{for(e=null,b=null;!(e=o.$re(/^(all)(?=\s*(\)|,))/))&&(c=this.element());)b?b.push(c):b=[c];e=e&&e[1],b||l("Missing target selector for :extend()."),g=new d.Extend(new d.Selector(b),e,h),f?f.push(g):f=[g]}while(o.$char(","));return j(/^\)/),a&&j(/^;/),f}},extendRule:function(){return this.extend(!0)},mixin:{call:function(){var a,b,c,e,f,g,i=o.currentChar(),j=!1,l=o.i;if("."===i||"#"===i){for(o.save();;){if(a=o.i,e=o.$re(/^[#.](?:[\w-]|\\(?:[A-Fa-f0-9]{1,6} ?|[^A-Fa-f0-9]))+/),!e)break;c=new d.Element(f,e,a,h),b?b.push(c):b=[c],f=o.$char(">")}return b&&(o.$char("(")&&(g=this.args(!0).args,k(")")),n.important()&&(j=!0),n.end())?(o.forget(),new d.mixin.Call(b,g,l,h,j)):void o.restore()}},args:function(a){var b,c,e,f,g,h,i,j=n.entities,k={args:null,variadic:!1},m=[],p=[],q=[];for(o.save();;){if(a)h=n.detachedRuleset()||n.expression();else{if(o.commentStore.length=0,o.$str("...")){k.variadic=!0,o.$char(";")&&!b&&(b=!0),(b?p:q).push({variadic:!0});break}h=j.variable()||j.literal()||j.keyword()}if(!h)break;f=null,h.throwAwayComments&&h.throwAwayComments(),g=h;var r=null;if(a?h.value&&1==h.value.length&&(r=h.value[0]):r=h,r&&r instanceof d.Variable)if(o.$char(":")){if(m.length>0&&(b&&l("Cannot mix ; and , as delimiter types"),c=!0),g=n.detachedRuleset()||n.expression(),!g){if(!a)return o.restore(),k.args=[],k;l("could not understand value for named argument")}f=e=r.name}else if(o.$str("...")){if(!a){k.variadic=!0,o.$char(";")&&!b&&(b=!0),(b?p:q).push({name:h.name,variadic:!0});break}i=!0}else a||(e=f=r.name,g=null);g&&m.push(g),q.push({name:f,value:g,expand:i}),o.$char(",")||(o.$char(";")||b)&&(c&&l("Cannot mix ; and , as delimiter types"),b=!0,m.length>1&&(g=new d.Value(m)),p.push({name:e,value:g,expand:i}),e=null,m=[],c=!1)}return o.forget(),k.args=b?p:q,k},definition:function(){var a,b,c,e,f=[],g=!1;if(!("."!==o.currentChar()&&"#"!==o.currentChar()||o.peek(/^[^{]*\}/)))if(o.save(),b=o.$re(/^([#.](?:[\w-]|\\(?:[A-Fa-f0-9]{1,6} ?|[^A-Fa-f0-9]))+)\s*\(/)){a=b[1];var h=this.args(!1);if(f=h.args,g=h.variadic,!o.$char(")"))return void o.restore("Missing closing ')'");if(o.commentStore.length=0,o.$str("when")&&(e=j(n.conditions,"expected condition")),c=n.block())return o.forget(),new d.mixin.Definition(a,f,c,e,g);o.restore()}else o.forget()}},entity:function(){var a=this.entities;return this.comment()||a.literal()||a.variable()||a.url()||a.call()||a.keyword()||a.javascript()},end:function(){return o.$char(";")||o.peek("}")},alpha:function(){var a;if(o.$re(/^opacity=/i))return a=o.$re(/^\d+/),a||(a=j(this.entities.variable,"Could not parse alpha")),k(")"),new d.Alpha(a)},element:function(){var a,b,c,e=o.i;return b=this.combinator(),a=o.$re(/^(?:\d+\.\d+|\d+)%/)||o.$re(/^(?:[.#]?|:*)(?:[\w-]|[^\x00-\x9f]|\\(?:[A-Fa-f0-9]{1,6} ?|[^A-Fa-f0-9]))+/)||o.$char("*")||o.$char("&")||this.attribute()||o.$re(/^\([^&()@]+\)/)||o.$re(/^[\.#:](?=@)/)||this.entities.variableCurly(),a||(o.save(),o.$char("(")?(c=this.selector())&&o.$char(")")?(a=new d.Paren(c),o.forget()):o.restore("Missing closing ')'"):o.forget()),a?new d.Element(b,a,e,h):void 0},combinator:function(){var a=o.currentChar();if("/"===a){o.save();var b=o.$re(/^\/[a-z]+\//i);if(b)return o.forget(),new d.Combinator(b);o.restore()}if(">"===a||"+"===a||"~"===a||"|"===a||"^"===a){for(o.i++,"^"===a&&"^"===o.currentChar()&&(a="^^",o.i++);o.isWhitespace();)o.i++;return new d.Combinator(a)}return new d.Combinator(o.isWhitespace(-1)?" ":null)},lessSelector:function(){return this.selector(!0)},selector:function(a){for(var b,c,e,f,g,i,k,m=o.i;(a&&(c=this.extend())||a&&(i=o.$str("when"))||(f=this.element()))&&(i?k=j(this.conditions,"expected condition"):k?l("CSS guard can only be used at the end of selector"):c?g=g?g.concat(c):c:(g&&l("Extend can only be used at the end of selector"),e=o.currentChar(),b?b.push(f):b=[f],f=null),"{"!==e&&"}"!==e&&";"!==e&&","!==e&&")"!==e););return b?new d.Selector(b,g,k,m,h):void(g&&l("Extend must be used to extend a selector, it cannot be used on its own"))},attribute:function(){if(o.$char("[")){var a,b,c,e=this.entities;return(a=e.variableCurly())||(a=j(/^(?:[_A-Za-z0-9-\*]*\|)?(?:[_A-Za-z0-9-]|\\.)+/)),c=o.$re(/^[|~*$^]?=/),c&&(b=e.quoted()||o.$re(/^[0-9]+%/)||o.$re(/^[\w-]+/)||e.variableCurly()),k("]"),new d.Attribute(a,c,b)}},block:function(){var a;return o.$char("{")&&(a=this.primary())&&o.$char("}")?a:void 0},blockRuleset:function(){var a=this.block();return a&&(a=new d.Ruleset(null,a)),a},detachedRuleset:function(){var a=this.blockRuleset();return a?new d.DetachedRuleset(a):void 0},ruleset:function(){var b,c,e,f;for(o.save(),a.dumpLineNumbers&&(f=m(o.i));;){if(c=this.lessSelector(),!c)break;if(b?b.push(c):b=[c],o.commentStore.length=0,c.condition&&b.length>1&&l("Guards are only currently allowed on a single selector."),!o.$char(","))break;c.condition&&l("Guards are only currently allowed on a single selector."),o.commentStore.length=0}if(b&&(e=this.block())){o.forget();var g=new d.Ruleset(b,e,a.strictImports);return a.dumpLineNumbers&&(g.debugInfo=f),g}o.restore()},rule:function(b){var c,e,f,g,i,j=o.i,k=o.currentChar();if("."!==k&&"#"!==k&&"&"!==k&&":"!==k)if(o.save(),c=this.variable()||this.ruleProperty()){if(i="string"==typeof c,i&&(e=this.detachedRuleset()),o.commentStore.length=0,!e){g=!i&&c.length>1&&c.pop().value;var l=!b&&(a.compress||i);if(l&&(e=this.value()),!e&&(e=this.anonymousValue()))return o.forget(),new d.Rule(c,e,!1,g,j,h);l||e||(e=this.value()),f=this.important()}if(e&&this.end())return o.forget(),new d.Rule(c,e,f,g,j,h);if(o.restore(),e&&!b)return this.rule(!0)}else o.forget()},anonymousValue:function(){var a=o.$re(/^([^@+\/'"*`(;{}-]*);/);return a?new d.Anonymous(a[1]):void 0},"import":function(){var a,b,c=o.i,e=o.$re(/^@import?\s+/);if(e){var f=(e?this.importOptions():null)||{};if(a=this.entities.quoted()||this.entities.url())return b=this.mediaFeatures(),o.$char(";")||(o.i=c,l("missing semi-colon or unrecognised media features on import")),b=b&&new d.Value(b),new d.Import(a,b,f,c,h);o.i=c,l("malformed import statement")}},importOptions:function(){var a,b,c,d={};if(!o.$char("("))return null;do if(a=this.importOption()){switch(b=a,c=!0,b){case"css":b="less",c=!1;break;case"once":b="multiple",c=!1}if(d[b]=c,!o.$char(","))break}while(a);return k(")"),d},importOption:function(){var a=o.$re(/^(less|css|multiple|once|inline|reference|optional)/);return a?a[1]:void 0},mediaFeature:function(){var a,b,c=this.entities,e=[];o.save();do if(a=c.keyword()||c.variable())e.push(a);else if(o.$char("(")){if(b=this.property(),a=this.value(),!o.$char(")"))return o.restore("Missing closing ')'"),null;if(b&&a)e.push(new d.Paren(new d.Rule(b,a,null,null,o.i,h,!0)));else{if(!a)return o.restore("badly formed media feature definition"),null;e.push(new d.Paren(a))}}while(a);return o.forget(),e.length>0?new d.Expression(e):void 0},mediaFeatures:function(){var a,b=this.entities,c=[];do if(a=this.mediaFeature()){if(c.push(a),!o.$char(","))break}else if(a=b.variable(),a&&(c.push(a),!o.$char(",")))break;while(a);return c.length>0?c:null},media:function(){var b,c,e,f;return a.dumpLineNumbers&&(f=m(o.i)),o.save(),o.$str("@media")?(b=this.mediaFeatures(),(c=this.block())?(o.forget(),e=new d.Media(c,b,o.i,h),a.dumpLineNumbers&&(e.debugInfo=f),e):void o.restore("media definitions require block statements after any features")):void o.restore()},plugin:function(){var a,b=o.i,c=o.$re(/^@plugin?\s+/);if(c){var e={plugin:!0};if(a=this.entities.quoted()||this.entities.url())return o.$char(";")||(o.i=b,l("missing semi-colon on plugin")),new d.Import(a,null,e,b,h);o.i=b,l("malformed plugin statement")}},directive:function(){var b,c,e,f,g,i,j,k=o.i,n=!0,p=!0;if("@"===o.currentChar()){if(c=this["import"]()||this.plugin()||this.media())return c;if(o.save(),b=o.$re(/^@[a-z-]+/)){switch(f=b,"-"==b.charAt(1)&&b.indexOf("-",2)>0&&(f="@"+b.slice(b.indexOf("-",2)+1)),f){case"@counter-style":g=!0,n=!0;break;case"@charset":g=!0,n=!1;break;case"@namespace":i=!0,n=!1;break;case"@keyframes":g=!0;break;case"@host":case"@page":j=!0;break;case"@document":case"@supports":j=!0,p=!1}return o.commentStore.length=0,g?(c=this.entity(),c||l("expected "+b+" identifier")):i?(c=this.expression(),c||l("expected "+b+" expression")):j&&(c=(o.$re(/^[^{;]+/)||"").trim(),c&&(c=new d.Anonymous(c))),n&&(e=this.blockRuleset()),e||!n&&c&&o.$char(";")?(o.forget(),new d.Directive(b,c,e,k,h,a.dumpLineNumbers?m(k):null,!1,p)):void o.restore("directive options not recognised")}}},value:function(){var a,b=[];do if(a=this.expression(),a&&(b.push(a),!o.$char(",")))break;while(a);return b.length>0?new d.Value(b):void 0},important:function(){return"!"===o.currentChar()?o.$re(/^! *important/):void 0},sub:function(){var a,b;return o.save(),o.$char("(")?(a=this.addition(),a&&o.$char(")")?(o.forget(),b=new d.Expression([a]),b.parens=!0,b):void o.restore("Expected ')'")):void o.restore()},multiplication:function(){var a,b,c,e,f;if(a=this.operand()){for(f=o.isWhitespace(-1);;){if(o.peek(/^\/[*\/]/))break;if(o.save(),c=o.$char("/")||o.$char("*"),!c){o.forget();break}if(b=this.operand(),!b){o.restore();break}o.forget(),a.parensInOp=!0,b.parensInOp=!0,e=new d.Operation(c,[e||a,b],f),f=o.isWhitespace(-1)}return e||a}},addition:function(){var a,b,c,e,f;if(a=this.multiplication()){for(f=o.isWhitespace(-1);;){if(c=o.$re(/^[-+]\s+/)||!f&&(o.$char("+")||o.$char("-")),!c)break;if(b=this.multiplication(),!b)break;a.parensInOp=!0,b.parensInOp=!0,e=new d.Operation(c,[e||a,b],f),f=o.isWhitespace(-1)}return e||a}},conditions:function(){var a,b,c,e=o.i;if(a=this.condition()){for(;;){if(!o.peek(/^,\s*(not\s*)?\(/)||!o.$char(","))break;if(b=this.condition(),!b)break;c=new d.Condition("or",c||a,b,e)}return c||a}},condition:function(){var a,b,c,e,f=this.entities,g=o.i,h=!1;return o.$str("not")&&(h=!0),k("("),a=this.addition()||f.keyword()||f.quoted(),a?(o.$char(">")?e=o.$char("=")?">=":">":o.$char("<")?e=o.$char("=")?"<=":"<":o.$char("=")&&(e=o.$char(">")?"=>":o.$char("<")?"=<":"="),e?(b=this.addition()||f.keyword()||f.quoted(),b?c=new d.Condition(e,a,b,g,h):l("expected expression")):c=new d.Condition("=",a,new d.Keyword("true"),g,h),k(")"),o.$str("and")?new d.Condition("and",c,this.condition()):c):void 0},operand:function(){var a,b=this.entities;o.peek(/^-[@\(]/)&&(a=o.$char("-"));var c=this.sub()||b.dimension()||b.color()||b.variable()||b.call();return a&&(c.parensInOp=!0,c=new d.Negative(c)),c},expression:function(){var a,b,c=[];do a=this.comment(),a?c.push(a):(a=this.addition()||this.entity(),a&&(c.push(a),o.peek(/^\/[\/*]/)||(b=o.$char("/"),b&&c.push(new d.Anonymous(b)))));while(a);return c.length>0?new d.Expression(c):void 0},property:function(){var a=o.$re(/^(\*?-?[_a-zA-Z0-9-]+)\s*:/);return a?a[1]:void 0},ruleProperty:function(){function a(a){var b=o.i,c=o.$re(a);return c?(f.push(b),e.push(c[1])):void 0}var b,c,e=[],f=[];o.save();var g=o.$re(/^([_a-zA-Z0-9-]+)\s*:/);if(g)return e=[new d.Keyword(g[1])],o.forget(),e;for(a(/^(\*?)/);;)if(!a(/^((?:[\w-]+)|(?:@\{[\w-]+\}))/))break;if(e.length>1&&a(/^((?:\+_|\+)?)\s*:/)){for(o.forget(),""===e[0]&&(e.shift(),f.shift()),c=0;e.length>c;c++)b=e[c],e[c]="@"!==b.charAt(0)?new d.Keyword(b):new d.Variable("@"+b.slice(2,-1),f[c],h);return e}o.restore()}}}};h.serializeVars=function(a){var b="";for(var c in a)if(Object.hasOwnProperty.call(a,c)){var d=a[c];b+=("@"===c[0]?"":"@")+c+": "+d+(";"===String(d).slice(-1)?"":";")}return b},b.exports=h},{"../less-error":31,"../tree":61,"../utils":82,"../visitors":86,"./parser-input":36}],38:[function(a,b){var c=function(a){this.less=a,this.visitors=[],this.preProcessors=[],this.postProcessors=[],this.installedPlugins=[],this.fileManagers=[]};c.prototype.addPlugins=function(a){if(a)for(var b=0;a.length>b;b++)this.addPlugin(a[b])},c.prototype.addPlugin=function(a){this.installedPlugins.push(a),a.install(this.less,this)},c.prototype.addVisitor=function(a){this.visitors.push(a)},c.prototype.addPreProcessor=function(a,b){var c;for(c=0;this.preProcessors.length>c&&!(this.preProcessors[c].priority>=b);c++);this.preProcessors.splice(c,0,{preProcessor:a,priority:b})},c.prototype.addPostProcessor=function(a,b){var c;for(c=0;this.postProcessors.length>c&&!(this.postProcessors[c].priority>=b);c++);this.postProcessors.splice(c,0,{postProcessor:a,priority:b})},c.prototype.addFileManager=function(a){this.fileManagers.push(a)},c.prototype.getPreProcessors=function(){for(var a=[],b=0;this.preProcessors.length>b;b++)a.push(this.preProcessors[b].preProcessor);return a},c.prototype.getPostProcessors=function(){for(var a=[],b=0;this.postProcessors.length>b;b++)a.push(this.postProcessors[b].postProcessor);return a},c.prototype.getVisitors=function(){return this.visitors},c.prototype.getFileManagers=function(){return this.fileManagers},b.exports=c},{}],39:[function(a,b){var c=a("../less-error"),d=a("../tree"),e=b.exports=function(a,b){this.fileInfo=b};e.prototype.eval=function(a,b){var e,f,g={};f={add:function(a,b){g[a]=b},addMultiple:function(a){Object.keys(a).forEach(function(b){g[b]=a[b]})}};try{e=new Function("functions","tree","fileInfo",a),e(f,d,this.fileInfo)}catch(h){b(new c({message:"Plugin evaluation error: '"+h.name+": "+h.message.replace(/["]/g,"'")+"'",filename:this.fileInfo.filename}),null)}b(null,{functions:g})}},{"../less-error":31,"../tree":61}],40:[function(a,b){var c;b.exports=function(b,d){var e=function(b,f,g){if("function"==typeof f&&(g=f,f={}),!g){c||(c="undefined"==typeof Promise?a("promise"):Promise);var h=this;return new c(function(a,c){e.call(h,b,f,function(b,d){b?c(b):a(d)})})}this.parse(b,f,function(a,b,c,e){if(a)return g(a);var f;try{var h=new d(b,c);f=h.toCSS(e)}catch(a){return g(a)}g(null,f)})};return e}},{promise:void 0}],41:[function(a,b){b.exports=function(a,b){var c=function(a){this.options=a};return c.prototype.toCSS=function(b,c,d){var e=new a({contentsIgnoredCharsMap:d.contentsIgnoredChars,rootNode:b,contentsMap:d.contents,sourceMapFilename:this.options.sourceMapFilename,sourceMapURL:this.options.sourceMapURL,outputFilename:this.options.sourceMapOutputFilename,sourceMapBasepath:this.options.sourceMapBasepath,sourceMapRootpath:this.options.sourceMapRootpath,outputSourceFiles:this.options.outputSourceFiles,sourceMapGenerator:this.options.sourceMapGenerator,sourceMapFileInline:this.options.sourceMapFileInline}),f=e.toCSS(c);return this.sourceMap=e.sourceMap,this.sourceMapURL=e.sourceMapURL,this.options.sourceMapInputFilename&&(this.sourceMapInputFilename=e.normalizeFilename(this.options.sourceMapInputFilename)),f+this.getCSSAppendage()},c.prototype.getCSSAppendage=function(){var a=this.sourceMapURL;if(this.options.sourceMapFileInline){if(void 0===this.sourceMap)return"";a="data:application/json;base64,"+b.encodeBase64(this.sourceMap)}return a?"/*# sourceMappingURL="+a+" */":""},c.prototype.getExternalSourceMap=function(){return this.sourceMap},c.prototype.setExternalSourceMap=function(a){this.sourceMap=a},c.prototype.isInline=function(){return this.options.sourceMapFileInline},c.prototype.getSourceMapURL=function(){return this.sourceMapURL},c.prototype.getOutputFilename=function(){return this.options.sourceMapOutputFilename},c.prototype.getInputFilename=function(){return this.sourceMapInputFilename},c}},{}],42:[function(a,b){b.exports=function(a){var b=function(b){this._css=[],this._rootNode=b.rootNode,this._contentsMap=b.contentsMap,
this._contentsIgnoredCharsMap=b.contentsIgnoredCharsMap,b.sourceMapFilename&&(this._sourceMapFilename=b.sourceMapFilename.replace(/\\/g,"/")),this._outputFilename=b.outputFilename,this.sourceMapURL=b.sourceMapURL,b.sourceMapBasepath&&(this._sourceMapBasepath=b.sourceMapBasepath.replace(/\\/g,"/")),b.sourceMapRootpath?(this._sourceMapRootpath=b.sourceMapRootpath.replace(/\\/g,"/"),"/"!==this._sourceMapRootpath.charAt(this._sourceMapRootpath.length-1)&&(this._sourceMapRootpath+="/")):this._sourceMapRootpath="",this._outputSourceFiles=b.outputSourceFiles,this._sourceMapGeneratorConstructor=a.getSourceMapGenerator(),this._lineNumber=0,this._column=0};return b.prototype.normalizeFilename=function(a){return a=a.replace(/\\/g,"/"),this._sourceMapBasepath&&0===a.indexOf(this._sourceMapBasepath)&&(a=a.substring(this._sourceMapBasepath.length),("\\"===a.charAt(0)||"/"===a.charAt(0))&&(a=a.substring(1))),(this._sourceMapRootpath||"")+a},b.prototype.add=function(a,b,c,d){if(a){var e,f,g,h,i;if(b){var j=this._contentsMap[b.filename];this._contentsIgnoredCharsMap[b.filename]&&(c-=this._contentsIgnoredCharsMap[b.filename],0>c&&(c=0),j=j.slice(this._contentsIgnoredCharsMap[b.filename])),j=j.substring(0,c),f=j.split("\n"),h=f[f.length-1]}if(e=a.split("\n"),g=e[e.length-1],b)if(d)for(i=0;e.length>i;i++)this._sourceMapGenerator.addMapping({generated:{line:this._lineNumber+i+1,column:0===i?this._column:0},original:{line:f.length+i,column:0===i?h.length:0},source:this.normalizeFilename(b.filename)});else this._sourceMapGenerator.addMapping({generated:{line:this._lineNumber+1,column:this._column},original:{line:f.length,column:h.length},source:this.normalizeFilename(b.filename)});1===e.length?this._column+=g.length:(this._lineNumber+=e.length-1,this._column=g.length),this._css.push(a)}},b.prototype.isEmpty=function(){return 0===this._css.length},b.prototype.toCSS=function(a){if(this._sourceMapGenerator=new this._sourceMapGeneratorConstructor({file:this._outputFilename,sourceRoot:null}),this._outputSourceFiles)for(var b in this._contentsMap)if(this._contentsMap.hasOwnProperty(b)){var c=this._contentsMap[b];this._contentsIgnoredCharsMap[b]&&(c=c.slice(this._contentsIgnoredCharsMap[b])),this._sourceMapGenerator.setSourceContent(this.normalizeFilename(b),c)}if(this._rootNode.genCSS(a,this),this._css.length>0){var d,e=JSON.stringify(this._sourceMapGenerator.toJSON());this.sourceMapURL?d=this.sourceMapURL:this._sourceMapFilename&&(d=this._sourceMapFilename),this.sourceMapURL=d,this.sourceMap=e}return this._css.join("")},b}},{}],43:[function(a,b){var c=a("./contexts"),d=a("./visitors"),e=a("./tree");b.exports=function(a,b){b=b||{};var f,g=b.variables,h=new c.Eval(b);"object"!=typeof g||Array.isArray(g)||(g=Object.keys(g).map(function(a){var b=g[a];return b instanceof e.Value||(b instanceof e.Expression||(b=new e.Expression([b])),b=new e.Value([b])),new e.Rule("@"+a,b,!1,null,0)}),h.frames=[new e.Ruleset(null,g)]);var i,j=[],k=[new d.JoinSelectorVisitor,new d.ExtendVisitor,new d.ToCSSVisitor({compress:Boolean(b.compress)})];if(b.pluginManager){var l=b.pluginManager.getVisitors();for(i=0;l.length>i;i++){var m=l[i];m.isPreEvalVisitor?j.push(m):m.isPreVisitor?k.splice(0,0,m):k.push(m)}}for(i=0;j.length>i;i++)j[i].run(a);for(f=a.eval(h),i=0;k.length>i;i++)k[i].run(f);return f}},{"./contexts":10,"./tree":61,"./visitors":86}],44:[function(a,b){var c=a("./node"),d=function(a){this.value=a};d.prototype=new c,d.prototype.type="Alpha",d.prototype.accept=function(a){this.value=a.visit(this.value)},d.prototype.eval=function(a){return this.value.eval?new d(this.value.eval(a)):this},d.prototype.genCSS=function(a,b){b.add("alpha(opacity="),this.value.genCSS?this.value.genCSS(a,b):b.add(this.value),b.add(")")},b.exports=d},{"./node":69}],45:[function(a,b){var c=a("./node"),d=function(a,b,c,d,e,f){this.value=a,this.index=b,this.mapLines=d,this.currentFileInfo=c,this.rulesetLike="undefined"==typeof e?!1:e,this.isReferenced=f||!1};d.prototype=new c,d.prototype.type="Anonymous",d.prototype.eval=function(){return new d(this.value,this.index,this.currentFileInfo,this.mapLines,this.rulesetLike,this.isReferenced)},d.prototype.compare=function(a){return a.toCSS&&this.toCSS()===a.toCSS()?0:void 0},d.prototype.isRulesetLike=function(){return this.rulesetLike},d.prototype.genCSS=function(a,b){b.add(this.value,this.currentFileInfo,this.index,this.mapLines)},d.prototype.markReferenced=function(){this.isReferenced=!0},d.prototype.getIsReferenced=function(){return!this.currentFileInfo||!this.currentFileInfo.reference||this.isReferenced},b.exports=d},{"./node":69}],46:[function(a,b){var c=a("./node"),d=function(a,b){this.key=a,this.value=b};d.prototype=new c,d.prototype.type="Assignment",d.prototype.accept=function(a){this.value=a.visit(this.value)},d.prototype.eval=function(a){return this.value.eval?new d(this.key,this.value.eval(a)):this},d.prototype.genCSS=function(a,b){b.add(this.key+"="),this.value.genCSS?this.value.genCSS(a,b):b.add(this.value)},b.exports=d},{"./node":69}],47:[function(a,b){var c=a("./node"),d=function(a,b,c){this.key=a,this.op=b,this.value=c};d.prototype=new c,d.prototype.type="Attribute",d.prototype.eval=function(a){return new d(this.key.eval?this.key.eval(a):this.key,this.op,this.value&&this.value.eval?this.value.eval(a):this.value)},d.prototype.genCSS=function(a,b){b.add(this.toCSS(a))},d.prototype.toCSS=function(a){var b=this.key.toCSS?this.key.toCSS(a):this.key;return this.op&&(b+=this.op,b+=this.value.toCSS?this.value.toCSS(a):this.value),"["+b+"]"},b.exports=d},{"./node":69}],48:[function(a,b){var c=a("./node"),d=a("../functions/function-caller"),e=function(a,b,c,d){this.name=a,this.args=b,this.index=c,this.currentFileInfo=d};e.prototype=new c,e.prototype.type="Call",e.prototype.accept=function(a){this.args&&(this.args=a.visitArray(this.args))},e.prototype.eval=function(a){var b,c=this.args.map(function(b){return b.eval(a)}),f=new d(this.name,a,this.index,this.currentFileInfo);if(f.isValid())try{if(b=f.call(c),null!=b)return b}catch(g){throw{type:g.type||"Runtime",message:"error evaluating function `"+this.name+"`"+(g.message?": "+g.message:""),index:this.index,filename:this.currentFileInfo.filename}}return new e(this.name,c,this.index,this.currentFileInfo)},e.prototype.genCSS=function(a,b){b.add(this.name+"(",this.currentFileInfo,this.index);for(var c=0;this.args.length>c;c++)this.args[c].genCSS(a,b),this.args.length>c+1&&b.add(", ");b.add(")")},b.exports=e},{"../functions/function-caller":20,"./node":69}],49:[function(a,b){function c(a,b){return Math.min(Math.max(a,0),b)}function d(a){return"#"+a.map(function(a){return a=c(Math.round(a),255),(16>a?"0":"")+a.toString(16)}).join("")}var e=a("./node"),f=a("../data/colors"),g=function(a,b,c){this.rgb=Array.isArray(a)?a:6==a.length?a.match(/.{2}/g).map(function(a){return parseInt(a,16)}):a.split("").map(function(a){return parseInt(a+a,16)}),this.alpha="number"==typeof b?b:1,"undefined"!=typeof c&&(this.value=c)};g.prototype=new e,g.prototype.type="Color",g.prototype.luma=function(){var a=this.rgb[0]/255,b=this.rgb[1]/255,c=this.rgb[2]/255;return a=.03928>=a?a/12.92:Math.pow((a+.055)/1.055,2.4),b=.03928>=b?b/12.92:Math.pow((b+.055)/1.055,2.4),c=.03928>=c?c/12.92:Math.pow((c+.055)/1.055,2.4),.2126*a+.7152*b+.0722*c},g.prototype.genCSS=function(a,b){b.add(this.toCSS(a))},g.prototype.toCSS=function(a,b){var d,e,f=a&&a.compress&&!b;if(this.value)return this.value;if(e=this.fround(a,this.alpha),1>e)return"rgba("+this.rgb.map(function(a){return c(Math.round(a),255)}).concat(c(e,1)).join(","+(f?"":" "))+")";if(d=this.toRGB(),f){var g=d.split("");g[1]===g[2]&&g[3]===g[4]&&g[5]===g[6]&&(d="#"+g[1]+g[3]+g[5])}return d},g.prototype.operate=function(a,b,c){for(var d=[],e=this.alpha*(1-c.alpha)+c.alpha,f=0;3>f;f++)d[f]=this._operate(a,b,this.rgb[f],c.rgb[f]);return new g(d,e)},g.prototype.toRGB=function(){return d(this.rgb)},g.prototype.toHSL=function(){var a,b,c=this.rgb[0]/255,d=this.rgb[1]/255,e=this.rgb[2]/255,f=this.alpha,g=Math.max(c,d,e),h=Math.min(c,d,e),i=(g+h)/2,j=g-h;if(g===h)a=b=0;else{switch(b=i>.5?j/(2-g-h):j/(g+h),g){case c:a=(d-e)/j+(e>d?6:0);break;case d:a=(e-c)/j+2;break;case e:a=(c-d)/j+4}a/=6}return{h:360*a,s:b,l:i,a:f}},g.prototype.toHSV=function(){var a,b,c=this.rgb[0]/255,d=this.rgb[1]/255,e=this.rgb[2]/255,f=this.alpha,g=Math.max(c,d,e),h=Math.min(c,d,e),i=g,j=g-h;if(b=0===g?0:j/g,g===h)a=0;else{switch(g){case c:a=(d-e)/j+(e>d?6:0);break;case d:a=(e-c)/j+2;break;case e:a=(c-d)/j+4}a/=6}return{h:360*a,s:b,v:i,a:f}},g.prototype.toARGB=function(){return d([255*this.alpha].concat(this.rgb))},g.prototype.compare=function(a){return a.rgb&&a.rgb[0]===this.rgb[0]&&a.rgb[1]===this.rgb[1]&&a.rgb[2]===this.rgb[2]&&a.alpha===this.alpha?0:void 0},g.fromKeyword=function(a){var b,c=a.toLowerCase();return f.hasOwnProperty(c)?b=new g(f[c].slice(1)):"transparent"===c&&(b=new g([0,0,0],0)),b?(b.value=a,b):void 0},b.exports=g},{"../data/colors":11,"./node":69}],50:[function(a,b){var c=a("./node"),d=function(a){" "===a?(this.value=" ",this.emptyOrWhitespace=!0):(this.value=a?a.trim():"",this.emptyOrWhitespace=""===this.value)};d.prototype=new c,d.prototype.type="Combinator";var e={"":!0," ":!0,"|":!0};d.prototype.genCSS=function(a,b){var c=a.compress||e[this.value]?"":" ";b.add(c+this.value+c)},b.exports=d},{"./node":69}],51:[function(a,b){var c=a("./node"),d=a("./debug-info"),e=function(a,b,c,d){this.value=a,this.isLineComment=b,this.currentFileInfo=d};e.prototype=new c,e.prototype.type="Comment",e.prototype.genCSS=function(a,b){this.debugInfo&&b.add(d(a,this),this.currentFileInfo,this.index),b.add(this.value)},e.prototype.isSilent=function(a){var b=this.currentFileInfo&&this.currentFileInfo.reference&&!this.isReferenced,c=a.compress&&"!"!==this.value[2];return this.isLineComment||b||c},e.prototype.markReferenced=function(){this.isReferenced=!0},b.exports=e},{"./debug-info":53,"./node":69}],52:[function(a,b){var c=a("./node"),d=function(a,b,c,d,e){this.op=a.trim(),this.lvalue=b,this.rvalue=c,this.index=d,this.negate=e};d.prototype=new c,d.prototype.type="Condition",d.prototype.accept=function(a){this.lvalue=a.visit(this.lvalue),this.rvalue=a.visit(this.rvalue)},d.prototype.eval=function(a){var b=function(a,b,d){switch(a){case"and":return b&&d;case"or":return b||d;default:switch(c.compare(b,d)){case-1:return"<"===a||"=<"===a||"<="===a;case 0:return"="===a||">="===a||"=<"===a||"<="===a;case 1:return">"===a||">="===a;default:return!1}}}(this.op,this.lvalue.eval(a),this.rvalue.eval(a));return this.negate?!b:b},b.exports=d},{"./node":69}],53:[function(a,b){var c=function(a,b,d){var e="";if(a.dumpLineNumbers&&!a.compress)switch(a.dumpLineNumbers){case"comments":e=c.asComment(b);break;case"mediaquery":e=c.asMediaQuery(b);break;case"all":e=c.asComment(b)+(d||"")+c.asMediaQuery(b)}return e};c.asComment=function(a){return"/* line "+a.debugInfo.lineNumber+", "+a.debugInfo.fileName+" */\n"},c.asMediaQuery=function(a){var b=a.debugInfo.fileName;return/^[a-z]+:\/\//i.test(b)||(b="file://"+b),"@media -sass-debug-info{filename{font-family:"+b.replace(/([.:\/\\])/g,function(a){return"\\"==a&&(a="/"),"\\"+a})+"}line{font-family:\\00003"+a.debugInfo.lineNumber+"}}\n"},b.exports=c},{}],54:[function(a,b){var c=a("./node"),d=a("../contexts"),e=function(a,b){this.ruleset=a,this.frames=b};e.prototype=new c,e.prototype.type="DetachedRuleset",e.prototype.evalFirst=!0,e.prototype.accept=function(a){this.ruleset=a.visit(this.ruleset)},e.prototype.eval=function(a){var b=this.frames||a.frames.slice(0);return new e(this.ruleset,b)},e.prototype.callEval=function(a){return this.ruleset.eval(this.frames?new d.Eval(a,this.frames.concat(a.frames)):a)},b.exports=e},{"../contexts":10,"./node":69}],55:[function(a,b){var c=a("./node"),d=a("../data/unit-conversions"),e=a("./unit"),f=a("./color"),g=function(a,b){this.value=parseFloat(a),this.unit=b&&b instanceof e?b:new e(b?[b]:void 0)};g.prototype=new c,g.prototype.type="Dimension",g.prototype.accept=function(a){this.unit=a.visit(this.unit)},g.prototype.eval=function(){return this},g.prototype.toColor=function(){return new f([this.value,this.value,this.value])},g.prototype.genCSS=function(a,b){if(a&&a.strictUnits&&!this.unit.isSingular())throw new Error("Multiple units in dimension. Correct the units or use the unit function. Bad unit: "+this.unit.toString());var c=this.fround(a,this.value),d=String(c);if(0!==c&&1e-6>c&&c>-1e-6&&(d=c.toFixed(20).replace(/0+$/,"")),a&&a.compress){if(0===c&&this.unit.isLength())return void b.add(d);c>0&&1>c&&(d=d.substr(1))}b.add(d),this.unit.genCSS(a,b)},g.prototype.operate=function(a,b,c){var d=this._operate(a,b,this.value,c.value),e=this.unit.clone();if("+"===b||"-"===b)if(0===e.numerator.length&&0===e.denominator.length)e=c.unit.clone(),this.unit.backupUnit&&(e.backupUnit=this.unit.backupUnit);else if(0===c.unit.numerator.length&&0===e.denominator.length);else{if(c=c.convertTo(this.unit.usedUnits()),a.strictUnits&&c.unit.toString()!==e.toString())throw new Error("Incompatible units. Change the units or use the unit function. Bad units: '"+e.toString()+"' and '"+c.unit.toString()+"'.");d=this._operate(a,b,this.value,c.value)}else"*"===b?(e.numerator=e.numerator.concat(c.unit.numerator).sort(),e.denominator=e.denominator.concat(c.unit.denominator).sort(),e.cancel()):"/"===b&&(e.numerator=e.numerator.concat(c.unit.denominator).sort(),e.denominator=e.denominator.concat(c.unit.numerator).sort(),e.cancel());return new g(d,e)},g.prototype.compare=function(a){var b,d;if(!(a instanceof g))return void 0;if(this.unit.isEmpty()||a.unit.isEmpty())b=this,d=a;else if(b=this.unify(),d=a.unify(),0!==b.unit.compare(d.unit))return void 0;return c.numericCompare(b.value,d.value)},g.prototype.unify=function(){return this.convertTo({length:"px",duration:"s",angle:"rad"})},g.prototype.convertTo=function(a){var b,c,e,f,h,i=this.value,j=this.unit.clone(),k={};if("string"==typeof a){for(b in d)d[b].hasOwnProperty(a)&&(k={},k[b]=a);a=k}h=function(a,b){return e.hasOwnProperty(a)?(b?i/=e[a]/e[f]:i*=e[a]/e[f],f):a};for(c in a)a.hasOwnProperty(c)&&(f=a[c],e=d[c],j.map(h));return j.cancel(),new g(i,j)},b.exports=g},{"../data/unit-conversions":13,"./color":49,"./node":69,"./unit":78}],56:[function(a,b){var c=a("./node"),d=a("./selector"),e=a("./ruleset"),f=function(a,b,c,e,f,g,h,i){var j;if(this.name=a,this.value=b,c)for(Array.isArray(c)?this.rules=c:(this.rules=[c],this.rules[0].selectors=new d([],null,null,this.index,f).createEmptySelectors()),j=0;this.rules.length>j;j++)this.rules[j].allowImports=!0;this.index=e,this.currentFileInfo=f,this.debugInfo=g,this.isReferenced=h,this.isRooted=i||!1};f.prototype=new c,f.prototype.type="Directive",f.prototype.accept=function(a){var b=this.value,c=this.rules;c&&(this.rules=a.visitArray(c)),b&&(this.value=a.visit(b))},f.prototype.isRulesetLike=function(){return this.rules||!this.isCharset()},f.prototype.isCharset=function(){return"@charset"===this.name},f.prototype.genCSS=function(a,b){var c=this.value,d=this.rules;b.add(this.name,this.currentFileInfo,this.index),c&&(b.add(" "),c.genCSS(a,b)),d?this.outputRuleset(a,b,d):b.add(";")},f.prototype.eval=function(a){var b,c,d=this.value,e=this.rules;return b=a.mediaPath,c=a.mediaBlocks,a.mediaPath=[],a.mediaBlocks=[],d&&(d=d.eval(a)),e&&(e=[e[0].eval(a)],e[0].root=!0),a.mediaPath=b,a.mediaBlocks=c,new f(this.name,d,e,this.index,this.currentFileInfo,this.debugInfo,this.isReferenced,this.isRooted)},f.prototype.variable=function(a){return this.rules?e.prototype.variable.call(this.rules[0],a):void 0},f.prototype.find=function(){return this.rules?e.prototype.find.apply(this.rules[0],arguments):void 0},f.prototype.rulesets=function(){return this.rules?e.prototype.rulesets.apply(this.rules[0]):void 0},f.prototype.markReferenced=function(){var a,b;if(this.isReferenced=!0,this.rules)for(b=this.rules,a=0;b.length>a;a++)b[a].markReferenced&&b[a].markReferenced()},f.prototype.getIsReferenced=function(){return!this.currentFileInfo||!this.currentFileInfo.reference||this.isReferenced},f.prototype.outputRuleset=function(a,b,c){var d,e=c.length;if(a.tabLevel=(0|a.tabLevel)+1,a.compress){for(b.add("{"),d=0;e>d;d++)c[d].genCSS(a,b);return b.add("}"),void a.tabLevel--}var f="\n"+Array(a.tabLevel).join("  "),g=f+"  ";if(e){for(b.add(" {"+g),c[0].genCSS(a,b),d=1;e>d;d++)b.add(g),c[d].genCSS(a,b);b.add(f+"}")}else b.add(" {"+f+"}");a.tabLevel--},b.exports=f},{"./node":69,"./ruleset":75,"./selector":76}],57:[function(a,b){var c=a("./node"),d=a("./paren"),e=a("./combinator"),f=function(a,b,c,d){this.combinator=a instanceof e?a:new e(a),this.value="string"==typeof b?b.trim():b?b:"",this.index=c,this.currentFileInfo=d};f.prototype=new c,f.prototype.type="Element",f.prototype.accept=function(a){var b=this.value;this.combinator=a.visit(this.combinator),"object"==typeof b&&(this.value=a.visit(b))},f.prototype.eval=function(a){return new f(this.combinator,this.value.eval?this.value.eval(a):this.value,this.index,this.currentFileInfo)},f.prototype.genCSS=function(a,b){b.add(this.toCSS(a),this.currentFileInfo,this.index)},f.prototype.toCSS=function(a){a=a||{};var b=this.value,c=a.firstSelector;return b instanceof d&&(a.firstSelector=!0),b=b.toCSS?b.toCSS(a):b,a.firstSelector=c,""===b&&"&"===this.combinator.value.charAt(0)?"":this.combinator.toCSS(a)+b},b.exports=f},{"./combinator":50,"./node":69,"./paren":71}],58:[function(a,b){var c=a("./node"),d=a("./paren"),e=a("./comment"),f=function(a){if(this.value=a,!a)throw new Error("Expression requires an array parameter")};f.prototype=new c,f.prototype.type="Expression",f.prototype.accept=function(a){this.value=a.visitArray(this.value)},f.prototype.eval=function(a){var b,c=this.parens&&!this.parensInOp,e=!1;return c&&a.inParenthesis(),this.value.length>1?b=new f(this.value.map(function(b){return b.eval(a)})):1===this.value.length?(this.value[0].parens&&!this.value[0].parensInOp&&(e=!0),b=this.value[0].eval(a)):b=this,c&&a.outOfParenthesis(),this.parens&&this.parensInOp&&!a.isMathOn()&&!e&&(b=new d(b)),b},f.prototype.genCSS=function(a,b){for(var c=0;this.value.length>c;c++)this.value[c].genCSS(a,b),this.value.length>c+1&&b.add(" ")},f.prototype.throwAwayComments=function(){this.value=this.value.filter(function(a){return!(a instanceof e)})},f.prototype.markReferenced=function(){this.value.forEach(function(a){a.markReferenced&&a.markReferenced()})},b.exports=f},{"./comment":51,"./node":69,"./paren":71}],59:[function(a,b){var c=a("./node"),d=function e(a,b,c){switch(this.selector=a,this.option=b,this.index=c,this.object_id=e.next_id++,this.parent_ids=[this.object_id],b){case"all":this.allowBefore=!0,this.allowAfter=!0;break;default:this.allowBefore=!1,this.allowAfter=!1}};d.next_id=0,d.prototype=new c,d.prototype.type="Extend",d.prototype.accept=function(a){this.selector=a.visit(this.selector)},d.prototype.eval=function(a){return new d(this.selector.eval(a),this.option,this.index)},d.prototype.clone=function(){return new d(this.selector,this.option,this.index)},d.prototype.findSelfSelectors=function(a){var b,c,d=[];for(b=0;a.length>b;b++)c=a[b].elements,b>0&&c.length&&""===c[0].combinator.value&&(c[0].combinator.value=" "),d=d.concat(a[b].elements);this.selfSelectors=[{elements:d}]},b.exports=d},{"./node":69}],60:[function(a,b){var c=a("./node"),d=a("./media"),e=a("./url"),f=a("./quoted"),g=a("./ruleset"),h=a("./anonymous"),i=function(a,b,c,d,e){if(this.options=c,this.index=d,this.path=a,this.features=b,this.currentFileInfo=e,void 0!==this.options.less||this.options.inline)this.css=!this.options.less||this.options.inline;else{var f=this.getPath();f&&/[#\.\&\?\/]css([\?;].*)?$/.test(f)&&(this.css=!0)}};i.prototype=new c,i.prototype.type="Import",i.prototype.accept=function(a){this.features&&(this.features=a.visit(this.features)),this.path=a.visit(this.path),this.options.plugin||this.options.inline||!this.root||(this.root=a.visit(this.root))},i.prototype.genCSS=function(a,b){this.css&&void 0===this.path.currentFileInfo.reference&&(b.add("@import ",this.currentFileInfo,this.index),this.path.genCSS(a,b),this.features&&(b.add(" "),this.features.genCSS(a,b)),b.add(";"))},i.prototype.getPath=function(){return this.path instanceof e?this.path.value.value:this.path.value},i.prototype.isVariableImport=function(){var a=this.path;return a instanceof e&&(a=a.value),a instanceof f?a.containsVariables():!0},i.prototype.evalForImport=function(a){var b=this.path;return b instanceof e&&(b=b.value),new i(b.eval(a),this.features,this.options,this.index,this.currentFileInfo)},i.prototype.evalPath=function(a){var b=this.path.eval(a),c=this.currentFileInfo&&this.currentFileInfo.rootpath;if(!(b instanceof e)){if(c){var d=b.value;d&&a.isPathRelative(d)&&(b.value=c+d)}b.value=a.normalizePath(b.value)}return b},i.prototype.eval=function(a){var b,c,e=this.features&&this.features.eval(a);if(this.options.plugin)return c=a.frames[0]&&a.frames[0].functionRegistry,c&&this.root&&this.root.functions&&c.addMultiple(this.root.functions),[];if(this.skip&&("function"==typeof this.skip&&(this.skip=this.skip()),this.skip))return[];if(this.options.inline){var f=new h(this.root,0,{filename:this.importedFilename,reference:this.path.currentFileInfo&&this.path.currentFileInfo.reference},!0,!0,!1);return this.features?new d([f],this.features.value):[f]}if(this.css){var j=new i(this.evalPath(a),e,this.options,this.index);if(!j.css&&this.error)throw this.error;return j}return b=new g(null,this.root.rules.slice(0)),b.evalImports(a),this.features?new d(b.rules,this.features.value):b.rules},b.exports=i},{"./anonymous":45,"./media":65,"./node":69,"./quoted":72,"./ruleset":75,"./url":79}],61:[function(a,b){var c={};c.Node=a("./node"),c.Alpha=a("./alpha"),c.Color=a("./color"),c.Directive=a("./directive"),c.DetachedRuleset=a("./detached-ruleset"),c.Operation=a("./operation"),c.Dimension=a("./dimension"),c.Unit=a("./unit"),c.Keyword=a("./keyword"),c.Variable=a("./variable"),c.Ruleset=a("./ruleset"),c.Element=a("./element"),c.Attribute=a("./attribute"),c.Combinator=a("./combinator"),c.Selector=a("./selector"),c.Quoted=a("./quoted"),c.Expression=a("./expression"),c.Rule=a("./rule"),c.Call=a("./call"),c.URL=a("./url"),c.Import=a("./import"),c.mixin={Call:a("./mixin-call"),Definition:a("./mixin-definition")},c.Comment=a("./comment"),c.Anonymous=a("./anonymous"),c.Value=a("./value"),c.JavaScript=a("./javascript"),c.Assignment=a("./assignment"),c.Condition=a("./condition"),c.Paren=a("./paren"),c.Media=a("./media"),c.UnicodeDescriptor=a("./unicode-descriptor"),c.Negative=a("./negative"),c.Extend=a("./extend"),c.RulesetCall=a("./ruleset-call"),b.exports=c},{"./alpha":44,"./anonymous":45,"./assignment":46,"./attribute":47,"./call":48,"./color":49,"./combinator":50,"./comment":51,"./condition":52,"./detached-ruleset":54,"./dimension":55,"./directive":56,"./element":57,"./expression":58,"./extend":59,"./import":60,"./javascript":62,"./keyword":64,"./media":65,"./mixin-call":66,"./mixin-definition":67,"./negative":68,"./node":69,"./operation":70,"./paren":71,"./quoted":72,"./rule":73,"./ruleset":75,"./ruleset-call":74,"./selector":76,"./unicode-descriptor":77,"./unit":78,"./url":79,"./value":80,"./variable":81}],62:[function(a,b){var c=a("./js-eval-node"),d=a("./dimension"),e=a("./quoted"),f=a("./anonymous"),g=function(a,b,c,d){this.escaped=b,this.expression=a,this.index=c,this.currentFileInfo=d};g.prototype=new c,g.prototype.type="JavaScript",g.prototype.eval=function(a){var b=this.evaluateJavaScript(this.expression,a);return"number"==typeof b?new d(b):"string"==typeof b?new e('"'+b+'"',b,this.escaped,this.index):new f(Array.isArray(b)?b.join(", "):b)},b.exports=g},{"./anonymous":45,"./dimension":55,"./js-eval-node":63,"./quoted":72}],63:[function(a,b){var c=a("./node"),d=a("./variable"),e=function(){};e.prototype=new c,e.prototype.evaluateJavaScript=function(a,b){var c,e=this,f={};if(void 0!==b.javascriptEnabled&&!b.javascriptEnabled)throw{message:"You are using JavaScript, which has been disabled.",filename:this.currentFileInfo.filename,index:this.index};a=a.replace(/@\{([\w-]+)\}/g,function(a,c){return e.jsify(new d("@"+c,e.index,e.currentFileInfo).eval(b))});try{a=new Function("return ("+a+")")}catch(g){throw{message:"JavaScript evaluation error: "+g.message+" from `"+a+"`",filename:this.currentFileInfo.filename,index:this.index}}var h=b.frames[0].variables();for(var i in h)h.hasOwnProperty(i)&&(f[i.slice(1)]={value:h[i].value,toJS:function(){return this.value.eval(b).toCSS()}});try{c=a.call(f)}catch(g){throw{message:"JavaScript evaluation error: '"+g.name+": "+g.message.replace(/["]/g,"'")+"'",filename:this.currentFileInfo.filename,index:this.index}}return c},e.prototype.jsify=function(a){return Array.isArray(a.value)&&a.value.length>1?"["+a.value.map(function(a){return a.toCSS()}).join(", ")+"]":a.toCSS()},b.exports=e},{"./node":69,"./variable":81}],64:[function(a,b){var c=a("./node"),d=function(a){this.value=a};d.prototype=new c,d.prototype.type="Keyword",d.prototype.genCSS=function(a,b){if("%"===this.value)throw{type:"Syntax",message:"Invalid % without number"};b.add(this.value)},d.True=new d("true"),d.False=new d("false"),b.exports=d},{"./node":69}],65:[function(a,b){var c=a("./ruleset"),d=a("./value"),e=a("./selector"),f=a("./anonymous"),g=a("./expression"),h=a("./directive"),i=function(a,b,f,g){this.index=f,this.currentFileInfo=g;var h=new e([],null,null,this.index,this.currentFileInfo).createEmptySelectors();this.features=new d(b),this.rules=[new c(h,a)],this.rules[0].allowImports=!0};i.prototype=new h,i.prototype.type="Media",i.prototype.isRulesetLike=!0,i.prototype.accept=function(a){this.features&&(this.features=a.visit(this.features)),this.rules&&(this.rules=a.visitArray(this.rules))},i.prototype.genCSS=function(a,b){b.add("@media ",this.currentFileInfo,this.index),this.features.genCSS(a,b),this.outputRuleset(a,b,this.rules)},i.prototype.eval=function(a){a.mediaBlocks||(a.mediaBlocks=[],a.mediaPath=[]);var b=new i(null,[],this.index,this.currentFileInfo);this.debugInfo&&(this.rules[0].debugInfo=this.debugInfo,b.debugInfo=this.debugInfo);var c=!1;a.strictMath||(c=!0,a.strictMath=!0);try{b.features=this.features.eval(a)}finally{c&&(a.strictMath=!1)}return a.mediaPath.push(b),a.mediaBlocks.push(b),this.rules[0].functionRegistry=a.frames[0].functionRegistry.inherit(),a.frames.unshift(this.rules[0]),b.rules=[this.rules[0].eval(a)],a.frames.shift(),a.mediaPath.pop(),0===a.mediaPath.length?b.evalTop(a):b.evalNested(a)},i.prototype.evalTop=function(a){var b=this;if(a.mediaBlocks.length>1){var d=new e([],null,null,this.index,this.currentFileInfo).createEmptySelectors();b=new c(d,a.mediaBlocks),b.multiMedia=!0}return delete a.mediaBlocks,delete a.mediaPath,b},i.prototype.evalNested=function(a){var b,e,h=a.mediaPath.concat([this]);for(b=0;h.length>b;b++)e=h[b].features instanceof d?h[b].features.value:h[b].features,h[b]=Array.isArray(e)?e:[e];return this.features=new d(this.permute(h).map(function(a){for(a=a.map(function(a){return a.toCSS?a:new f(a)}),b=a.length-1;b>0;b--)a.splice(b,0,new f("and"));return new g(a)})),new c([],[])},i.prototype.permute=function(a){if(0===a.length)return[];if(1===a.length)return a[0];for(var b=[],c=this.permute(a.slice(1)),d=0;c.length>d;d++)for(var e=0;a[0].length>e;e++)b.push([a[0][e]].concat(c[d]));return b},i.prototype.bubbleSelectors=function(a){a&&(this.rules=[new c(a.slice(0),[this.rules[0]])])},b.exports=i},{"./anonymous":45,"./directive":56,"./expression":58,"./ruleset":75,"./selector":76,"./value":80}],66:[function(a,b){var c=a("./node"),d=a("./selector"),e=a("./mixin-definition"),f=a("../functions/default"),g=function(a,b,c,e,f){this.selector=new d(a),this.arguments=b||[],this.index=c,this.currentFileInfo=e,this.important=f};g.prototype=new c,g.prototype.type="MixinCall",g.prototype.accept=function(a){this.selector&&(this.selector=a.visit(this.selector)),this.arguments.length&&(this.arguments=a.visitArray(this.arguments))},g.prototype.eval=function(a){function b(b,c){var d,e,g;for(d=0;2>d;d++){for(y[d]=!0,f.value(d),e=0;c.length>e&&y[d];e++)g=c[e],g.matchCondition&&(y[d]=y[d]&&g.matchCondition(null,a));b.matchCondition&&(y[d]=y[d]&&b.matchCondition(u,a))}return y[0]||y[1]?y[0]!=y[1]?y[1]?B:C:A:z}var c,d,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u=[],v=[],w=!1,x=[],y=[],z=-1,A=0,B=1,C=2;for(k=0;this.arguments.length>k;k++)if(h=this.arguments[k],i=h.value.eval(a),h.expand&&Array.isArray(i.value))for(i=i.value,l=0;i.length>l;l++)u.push({value:i[l]});else u.push({name:h.name,value:i});for(t=function(b){return b.matchArgs(null,a)},k=0;a.frames.length>k;k++)if((c=a.frames[k].find(this.selector,null,t)).length>0){for(o=!0,l=0;c.length>l;l++){for(d=c[l].rule,g=c[l].path,n=!1,m=0;a.frames.length>m;m++)if(!(d instanceof e)&&d===(a.frames[m].originalRuleset||a.frames[m])){n=!0;break}n||d.matchArgs(u,a)&&(p={mixin:d,group:b(d,g)},p.group!==z&&x.push(p),w=!0)}for(f.reset(),r=[0,0,0],l=0;x.length>l;l++)r[x[l].group]++;if(r[A]>0)q=C;else if(q=B,r[B]+r[C]>1)throw{type:"Runtime",message:"Ambiguous use of `default()` found when matching for `"+this.format(u)+"`",index:this.index,filename:this.currentFileInfo.filename};for(l=0;x.length>l;l++)if(p=x[l].group,p===A||p===q)try{d=x[l].mixin,d instanceof e||(s=d.originalRuleset||d,d=new e("",[],d.rules,null,!1),d.originalRuleset=s),Array.prototype.push.apply(v,d.evalCall(a,u,this.important).rules)}catch(D){throw{message:D.message,index:this.index,filename:this.currentFileInfo.filename,stack:D.stack}}if(w){if(!this.currentFileInfo||!this.currentFileInfo.reference)for(k=0;v.length>k;k++)j=v[k],j.markReferenced&&j.markReferenced();return v}}throw o?{type:"Runtime",message:"No matching definition was found for `"+this.format(u)+"`",index:this.index,filename:this.currentFileInfo.filename}:{type:"Name",message:this.selector.toCSS().trim()+" is undefined",index:this.index,filename:this.currentFileInfo.filename}},g.prototype.format=function(a){return this.selector.toCSS().trim()+"("+(a?a.map(function(a){var b="";return a.name&&(b+=a.name+":"),b+=a.value.toCSS?a.value.toCSS():"???"}).join(", "):"")+")"},b.exports=g},{"../functions/default":19,"./mixin-definition":67,"./node":69,"./selector":76}],67:[function(a,b){var c=a("./selector"),d=a("./element"),e=a("./ruleset"),f=a("./rule"),g=a("./expression"),h=a("../contexts"),i=function(a,b,e,f,g,h){this.name=a,this.selectors=[new c([new d(null,a,this.index,this.currentFileInfo)])],this.params=b,this.condition=f,this.variadic=g,this.arity=b.length,this.rules=e,this._lookups={};var i=[];this.required=b.reduce(function(a,b){return!b.name||b.name&&!b.value?a+1:(i.push(b.name),a)},0),this.optionalParameters=i,this.frames=h};i.prototype=new e,i.prototype.type="MixinDefinition",i.prototype.evalFirst=!0,i.prototype.accept=function(a){this.params&&this.params.length&&(this.params=a.visitArray(this.params)),this.rules=a.visitArray(this.rules),this.condition&&(this.condition=a.visit(this.condition))},i.prototype.evalParams=function(a,b,c,d){var i,j,k,l,m,n,o,p,q=new e(null,null),r=this.params.slice(0),s=0;if(b.frames&&b.frames[0]&&b.frames[0].functionRegistry&&(q.functionRegistry=b.frames[0].functionRegistry.inherit()),b=new h.Eval(b,[q].concat(b.frames)),c)for(c=c.slice(0),s=c.length,k=0;s>k;k++)if(j=c[k],n=j&&j.name){for(o=!1,l=0;r.length>l;l++)if(!d[l]&&n===r[l].name){d[l]=j.value.eval(a),q.prependRule(new f(n,j.value.eval(a))),o=!0;break}if(o){c.splice(k,1),k--;continue}throw{type:"Runtime",message:"Named argument for "+this.name+" "+c[k].name+" not found"}}for(p=0,k=0;r.length>k;k++)if(!d[k]){if(j=c&&c[p],n=r[k].name)if(r[k].variadic){for(i=[],l=p;s>l;l++)i.push(c[l].value.eval(a));q.prependRule(new f(n,new g(i).eval(a)))}else{if(m=j&&j.value)m=m.eval(a);else{if(!r[k].value)throw{type:"Runtime",message:"wrong number of arguments for "+this.name+" ("+s+" for "+this.arity+")"};m=r[k].value.eval(b),q.resetCache()}q.prependRule(new f(n,m)),d[k]=m}if(r[k].variadic&&c)for(l=p;s>l;l++)d[l]=c[l].value.eval(a);p++}return q},i.prototype.makeImportant=function(){var a=this.rules?this.rules.map(function(a){return a.makeImportant?a.makeImportant(!0):a}):this.rules,b=new i(this.name,this.params,a,this.condition,this.variadic,this.frames);

return b},i.prototype.eval=function(a){return new i(this.name,this.params,this.rules,this.condition,this.variadic,this.frames||a.frames.slice(0))},i.prototype.evalCall=function(a,b,c){var d,i,j=[],k=this.frames?this.frames.concat(a.frames):a.frames,l=this.evalParams(a,new h.Eval(a,k),b,j);return l.prependRule(new f("@arguments",new g(j).eval(a))),d=this.rules.slice(0),i=new e(null,d),i.originalRuleset=this,i=i.eval(new h.Eval(a,[this,l].concat(k))),c&&(i=i.makeImportant()),i},i.prototype.matchCondition=function(a,b){return this.condition&&!this.condition.eval(new h.Eval(b,[this.evalParams(b,new h.Eval(b,this.frames?this.frames.concat(b.frames):b.frames),a,[])].concat(this.frames||[]).concat(b.frames)))?!1:!0},i.prototype.matchArgs=function(a,b){var c,d=a&&a.length||0,e=this.optionalParameters,f=a?a.reduce(function(a,b){return e.indexOf(b.name)<0?a+1:a},0):0;if(this.variadic){if(this.required-1>f)return!1}else{if(this.required>f)return!1;if(d>this.params.length)return!1}c=Math.min(f,this.arity);for(var g=0;c>g;g++)if(!this.params[g].name&&!this.params[g].variadic&&a[g].value.eval(b).toCSS()!=this.params[g].value.eval(b).toCSS())return!1;return!0},b.exports=i},{"../contexts":10,"./element":57,"./expression":58,"./rule":73,"./ruleset":75,"./selector":76}],68:[function(a,b){var c=a("./node"),d=a("./operation"),e=a("./dimension"),f=function(a){this.value=a};f.prototype=new c,f.prototype.type="Negative",f.prototype.genCSS=function(a,b){b.add("-"),this.value.genCSS(a,b)},f.prototype.eval=function(a){return a.isMathOn()?new d("*",[new e(-1),this.value]).eval(a):new f(this.value.eval(a))},b.exports=f},{"./dimension":55,"./node":69,"./operation":70}],69:[function(a,b){var c=function(){};c.prototype.toCSS=function(a){var b=[];return this.genCSS(a,{add:function(a){b.push(a)},isEmpty:function(){return 0===b.length}}),b.join("")},c.prototype.genCSS=function(a,b){b.add(this.value)},c.prototype.accept=function(a){this.value=a.visit(this.value)},c.prototype.eval=function(){return this},c.prototype._operate=function(a,b,c,d){switch(b){case"+":return c+d;case"-":return c-d;case"*":return c*d;case"/":return c/d}},c.prototype.fround=function(a,b){var c=a&&a.numPrecision;return null==c?b:Number((b+2e-16).toFixed(c))},c.compare=function(a,b){if(a.compare&&"Quoted"!==b.type&&"Anonymous"!==b.type)return a.compare(b);if(b.compare)return-b.compare(a);if(a.type!==b.type)return void 0;if(a=a.value,b=b.value,!Array.isArray(a))return a===b?0:void 0;if(a.length!==b.length)return void 0;for(var d=0;a.length>d;d++)if(0!==c.compare(a[d],b[d]))return void 0;return 0},c.numericCompare=function(a,b){return b>a?-1:a===b?0:a>b?1:void 0},b.exports=c},{}],70:[function(a,b){var c=a("./node"),d=a("./color"),e=a("./dimension"),f=function(a,b,c){this.op=a.trim(),this.operands=b,this.isSpaced=c};f.prototype=new c,f.prototype.type="Operation",f.prototype.accept=function(a){this.operands=a.visit(this.operands)},f.prototype.eval=function(a){var b=this.operands[0].eval(a),c=this.operands[1].eval(a);if(a.isMathOn()){if(b instanceof e&&c instanceof d&&(b=b.toColor()),c instanceof e&&b instanceof d&&(c=c.toColor()),!b.operate)throw{type:"Operation",message:"Operation on an invalid type"};return b.operate(a,this.op,c)}return new f(this.op,[b,c],this.isSpaced)},f.prototype.genCSS=function(a,b){this.operands[0].genCSS(a,b),this.isSpaced&&b.add(" "),b.add(this.op),this.isSpaced&&b.add(" "),this.operands[1].genCSS(a,b)},b.exports=f},{"./color":49,"./dimension":55,"./node":69}],71:[function(a,b){var c=a("./node"),d=function(a){this.value=a};d.prototype=new c,d.prototype.type="Paren",d.prototype.genCSS=function(a,b){b.add("("),this.value.genCSS(a,b),b.add(")")},d.prototype.eval=function(a){return new d(this.value.eval(a))},b.exports=d},{"./node":69}],72:[function(a,b){var c=a("./node"),d=a("./js-eval-node"),e=a("./variable"),f=function(a,b,c,d,e){this.escaped=null==c?!0:c,this.value=b||"",this.quote=a.charAt(0),this.index=d,this.currentFileInfo=e};f.prototype=new d,f.prototype.type="Quoted",f.prototype.genCSS=function(a,b){this.escaped||b.add(this.quote,this.currentFileInfo,this.index),b.add(this.value),this.escaped||b.add(this.quote)},f.prototype.containsVariables=function(){return this.value.match(/(`([^`]+)`)|@\{([\w-]+)\}/)},f.prototype.eval=function(a){function b(a,b,c){var d=a;do a=d,d=a.replace(b,c);while(a!==d);return d}var c=this,d=this.value,g=function(b,d){return String(c.evaluateJavaScript(d,a))},h=function(b,d){var g=new e("@"+d,c.index,c.currentFileInfo).eval(a,!0);return g instanceof f?g.value:g.toCSS()};return d=b(d,/`([^`]+)`/g,g),d=b(d,/@\{([\w-]+)\}/g,h),new f(this.quote+d+this.quote,d,this.escaped,this.index,this.currentFileInfo)},f.prototype.compare=function(a){return"Quoted"!==a.type||this.escaped||a.escaped?a.toCSS&&this.toCSS()===a.toCSS()?0:void 0:c.numericCompare(this.value,a.value)},b.exports=f},{"./js-eval-node":63,"./node":69,"./variable":81}],73:[function(a,b){function c(a,b){var c,d="",e=b.length,f={add:function(a){d+=a}};for(c=0;e>c;c++)b[c].eval(a).genCSS(a,f);return d}var d=a("./node"),e=a("./value"),f=a("./keyword"),g=function(a,b,c,f,g,h,i,j){this.name=a,this.value=b instanceof d?b:new e([b]),this.important=c?" "+c.trim():"",this.merge=f,this.index=g,this.currentFileInfo=h,this.inline=i||!1,this.variable=void 0!==j?j:a.charAt&&"@"===a.charAt(0)};g.prototype=new d,g.prototype.type="Rule",g.prototype.genCSS=function(a,b){b.add(this.name+(a.compress?":":": "),this.currentFileInfo,this.index);try{this.value.genCSS(a,b)}catch(c){throw c.index=this.index,c.filename=this.currentFileInfo.filename,c}b.add(this.important+(this.inline||a.lastRule&&a.compress?"":";"),this.currentFileInfo,this.index)},g.prototype.eval=function(a){var b,d=!1,e=this.name,h=this.variable;"string"!=typeof e&&(e=1===e.length&&e[0]instanceof f?e[0].value:c(a,e),h=!1),"font"!==e||a.strictMath||(d=!0,a.strictMath=!0);try{if(a.importantScope.push({}),b=this.value.eval(a),!this.variable&&"DetachedRuleset"===b.type)throw{message:"Rulesets cannot be evaluated on a property.",index:this.index,filename:this.currentFileInfo.filename};var i=this.important,j=a.importantScope.pop();return!i&&j.important&&(i=j.important),new g(e,b,i,this.merge,this.index,this.currentFileInfo,this.inline,h)}catch(k){throw"number"!=typeof k.index&&(k.index=this.index,k.filename=this.currentFileInfo.filename),k}finally{d&&(a.strictMath=!1)}},g.prototype.makeImportant=function(){return new g(this.name,this.value,"!important",this.merge,this.index,this.currentFileInfo,this.inline)};var h=function(a){Array.isArray(a)?a.forEach(function(a){h(a)}):a.markReferenced&&a.markReferenced()};g.prototype.markReferenced=function(){this.value&&h(this.value)},b.exports=g},{"./keyword":64,"./node":69,"./value":80}],74:[function(a,b){var c=a("./node"),d=a("./variable"),e=function(a){this.variable=a};e.prototype=new c,e.prototype.type="RulesetCall",e.prototype.eval=function(a){var b=new d(this.variable).eval(a);return b.callEval(a)},b.exports=e},{"./node":69,"./variable":81}],75:[function(a,b){var c=a("./node"),d=a("./rule"),e=a("./selector"),f=a("./element"),g=a("./paren"),h=a("../contexts"),i=a("../functions/function-registry"),j=a("../functions/default"),k=a("./debug-info"),l=function(a,b,c){this.selectors=a,this.rules=b,this._lookups={},this.strictImports=c};l.prototype=new c,l.prototype.type="Ruleset",l.prototype.isRuleset=!0,l.prototype.isRulesetLike=!0,l.prototype.accept=function(a){this.paths?a.visitArray(this.paths,!0):this.selectors&&(this.selectors=a.visitArray(this.selectors)),this.rules&&this.rules.length&&(this.rules=a.visitArray(this.rules))},l.prototype.eval=function(a){var b,c,e,f,g=this.selectors,h=!1;if(g&&(c=g.length)){for(b=[],j.error({type:"Syntax",message:"it is currently only allowed in parametric mixin guards,"}),f=0;c>f;f++)e=g[f].eval(a),b.push(e),e.evaldCondition&&(h=!0);j.reset()}else h=!0;var k,m,n=this.rules?this.rules.slice(0):null,o=new l(b,n,this.strictImports);o.originalRuleset=this,o.root=this.root,o.firstRoot=this.firstRoot,o.allowImports=this.allowImports,this.debugInfo&&(o.debugInfo=this.debugInfo),h||(n.length=0),o.functionRegistry=function(a){for(var b,c=0,d=a.length;c!==d;++c)if(b=a[c].functionRegistry)return b;return i}(a.frames).inherit();var p=a.frames;p.unshift(o);var q=a.selectors;q||(a.selectors=q=[]),q.unshift(this.selectors),(o.root||o.allowImports||!o.strictImports)&&o.evalImports(a);var r=o.rules,s=r?r.length:0;for(f=0;s>f;f++)r[f].evalFirst&&(r[f]=r[f].eval(a));var t=a.mediaBlocks&&a.mediaBlocks.length||0;for(f=0;s>f;f++)"MixinCall"===r[f].type?(n=r[f].eval(a).filter(function(a){return a instanceof d&&a.variable?!o.variable(a.name):!0}),r.splice.apply(r,[f,1].concat(n)),s+=n.length-1,f+=n.length-1,o.resetCache()):"RulesetCall"===r[f].type&&(n=r[f].eval(a).rules.filter(function(a){return a instanceof d&&a.variable?!1:!0}),r.splice.apply(r,[f,1].concat(n)),s+=n.length-1,f+=n.length-1,o.resetCache());for(f=0;r.length>f;f++)k=r[f],k.evalFirst||(r[f]=k=k.eval?k.eval(a):k);for(f=0;r.length>f;f++)if(k=r[f],k instanceof l&&k.selectors&&1===k.selectors.length&&k.selectors[0].isJustParentSelector()){r.splice(f--,1);for(var u=0;k.rules.length>u;u++)m=k.rules[u],m instanceof d&&m.variable||r.splice(++f,0,m)}if(p.shift(),q.shift(),a.mediaBlocks)for(f=t;a.mediaBlocks.length>f;f++)a.mediaBlocks[f].bubbleSelectors(b);return o},l.prototype.evalImports=function(a){var b,c,d=this.rules;if(d)for(b=0;d.length>b;b++)"Import"===d[b].type&&(c=d[b].eval(a),c&&c.length?(d.splice.apply(d,[b,1].concat(c)),b+=c.length-1):d.splice(b,1,c),this.resetCache())},l.prototype.makeImportant=function(){var a=new l(this.selectors,this.rules.map(function(a){return a.makeImportant?a.makeImportant():a}),this.strictImports);return a},l.prototype.matchArgs=function(a){return!a||0===a.length},l.prototype.matchCondition=function(a,b){var c=this.selectors[this.selectors.length-1];return c.evaldCondition?c.condition&&!c.condition.eval(new h.Eval(b,b.frames))?!1:!0:!1},l.prototype.resetCache=function(){this._rulesets=null,this._variables=null,this._lookups={}},l.prototype.variables=function(){return this._variables||(this._variables=this.rules?this.rules.reduce(function(a,b){if(b instanceof d&&b.variable===!0&&(a[b.name]=b),"Import"===b.type&&b.root&&b.root.variables){var c=b.root.variables();for(var e in c)c.hasOwnProperty(e)&&(a[e]=c[e])}return a},{}):{}),this._variables},l.prototype.variable=function(a){return this.variables()[a]},l.prototype.rulesets=function(){if(!this.rules)return[];var a,b,c=[],d=this.rules,e=d.length;for(a=0;e>a;a++)b=d[a],b.isRuleset&&c.push(b);return c},l.prototype.prependRule=function(a){var b=this.rules;b?b.unshift(a):this.rules=[a]},l.prototype.find=function(a,b,c){b=b||this;var d,f,g=[],h=a.toCSS();return h in this._lookups?this._lookups[h]:(this.rulesets().forEach(function(h){if(h!==b)for(var i=0;h.selectors.length>i;i++)if(d=a.match(h.selectors[i])){if(a.elements.length>d){if(!c||c(h)){f=h.find(new e(a.elements.slice(d)),b,c);for(var j=0;f.length>j;++j)f[j].path.push(h);Array.prototype.push.apply(g,f)}}else g.push({rule:h,path:[]});break}}),this._lookups[h]=g,g)},l.prototype.genCSS=function(a,b){function c(a){return"boolean"==typeof a.isRulesetLike?a.isRulesetLike:"function"==typeof a.isRulesetLike?a.isRulesetLike():!1}var d,e,f,g,h,i=[],j=[];a.tabLevel=a.tabLevel||0,this.root||a.tabLevel++;var l,m=a.compress?"":Array(a.tabLevel+1).join("  "),n=a.compress?"":Array(a.tabLevel).join("  "),o=0,p=0;for(d=0;this.rules.length>d;d++)g=this.rules[d],"Comment"===g.type?(p===d&&p++,j.push(g)):g.isCharset&&g.isCharset()?(j.splice(o,0,g),o++,p++):"Import"===g.type?(j.splice(p,0,g),p++):j.push(g);if(j=i.concat(j),!this.root){f=k(a,this,n),f&&(b.add(f),b.add(n));var q,r=this.paths,s=r.length;for(l=a.compress?",":",\n"+n,d=0;s>d;d++)if(h=r[d],q=h.length)for(d>0&&b.add(l),a.firstSelector=!0,h[0].genCSS(a,b),a.firstSelector=!1,e=1;q>e;e++)h[e].genCSS(a,b);b.add((a.compress?"{":" {\n")+m)}for(d=0;j.length>d;d++){g=j[d],d+1===j.length&&(a.lastRule=!0);var t=a.lastRule;c(g)&&(a.lastRule=!1),g.genCSS?g.genCSS(a,b):g.value&&b.add(g.value.toString()),a.lastRule=t,a.lastRule?a.lastRule=!1:b.add(a.compress?"":"\n"+m)}this.root||(b.add(a.compress?"}":"\n"+n+"}"),a.tabLevel--),b.isEmpty()||a.compress||!this.firstRoot||b.add("\n")},l.prototype.markReferenced=function(){var a;if(this.selectors)for(a=0;this.selectors.length>a;a++)this.selectors[a].markReferenced();if(this.rules)for(a=0;this.rules.length>a;a++)this.rules[a].markReferenced&&this.rules[a].markReferenced()},l.prototype.getIsReferenced=function(){var a,b,c,d;if(this.paths)for(a=0;this.paths.length>a;a++)for(c=this.paths[a],b=0;c.length>b;b++)if(c[b].getIsReferenced&&c[b].getIsReferenced())return!0;if(this.selectors)for(a=0;this.selectors.length>a;a++)if(d=this.selectors[a],d.getIsReferenced&&d.getIsReferenced())return!0;return!1},l.prototype.joinSelectors=function(a,b,c){for(var d=0;c.length>d;d++)this.joinSelector(a,b,c[d])},l.prototype.joinSelector=function(a,b,c){function d(a,b){var c,d;if(0===a.length)c=new g(a[0]);else{var h=[];for(d=0;a.length>d;d++)h.push(new f(null,a[d],b.index,b.currentFileInfo));c=new g(new e(h))}return c}function h(a,b){var c,d;return c=new f(null,a,b.index,b.currentFileInfo),d=new e([c])}function i(a,b,c){function e(a){var b;return"Paren"!==a.value.type?null:(b=a.value.value,"Selector"!==b.type?null:b)}var g,m,n,o,p,q,r,s,t,u,v=!1;for(o=[],p=[[]],g=0;c.elements.length>g;g++)if(s=c.elements[g],"&"!==s.value){var w=e(s);if(null!=w){l(o,p);var x,y=[],z=[];for(x=i(y,b,w),v=v||x,n=0;y.length>n;n++){var A=h(d(y[n],s),s);k(p,[A],s,c,z)}p=z,o=[]}else o.push(s)}else{for(v=!0,q=[],l(o,p),m=0;p.length>m;m++)if(r=p[m],0===b.length)r.length>0&&r[0].elements.push(new f(s.combinator,"",s.index,s.currentFileInfo)),q.push(r);else for(n=0;b.length>n;n++){var B=j(r,b[n],s,c);q.push(B)}p=q,o=[]}for(l(o,p),g=0;p.length>g;g++)t=p[g].length,t>0&&(a.push(p[g]),u=p[g][t-1],p[g][t-1]=u.createDerived(u.elements,c.extendList));return v}function j(a,b,c,d){var e,g,h;if(e=[],a.length>0?(e=a.slice(0),g=e.pop(),h=d.createDerived(g.elements.slice(0))):h=d.createDerived([]),b.length>0){var i=c.combinator,j=b[0].elements[0];i.emptyOrWhitespace&&!j.combinator.emptyOrWhitespace&&(i=j.combinator),h.elements.push(new f(i,j.value,c.index,c.currentFileInfo)),h.elements=h.elements.concat(b[0].elements.slice(1))}return 0!==h.elements.length&&e.push(h),b.length>1&&(e=e.concat(b.slice(1))),e}function k(a,b,c,d,e){var f;for(f=0;a.length>f;f++){var g=j(a[f],b,c,d);e.push(g)}return e}function l(a,b){var c,d;if(0!==a.length){if(0===b.length)return void b.push([new e(a)]);for(c=0;b.length>c;c++)d=b[c],d.length>0?d[d.length-1]=d[d.length-1].createDerived(d[d.length-1].elements.concat(a)):d.push(new e(a))}}var m,n,o;if(n=[],o=i(n,b,c),!o)if(b.length>0)for(n=[],m=0;b.length>m;m++)n.push(b[m].concat(c));else n=[[c]];for(m=0;n.length>m;m++)a.push(n[m])},b.exports=l},{"../contexts":10,"../functions/default":19,"../functions/function-registry":21,"./debug-info":53,"./element":57,"./node":69,"./paren":71,"./rule":73,"./selector":76}],76:[function(a,b){var c=a("./node"),d=a("./element"),e=function(a,b,c,d,e,f){this.elements=a,this.extendList=b,this.condition=c,this.currentFileInfo=e||{},this.isReferenced=f,c||(this.evaldCondition=!0)};e.prototype=new c,e.prototype.type="Selector",e.prototype.accept=function(a){this.elements&&(this.elements=a.visitArray(this.elements)),this.extendList&&(this.extendList=a.visitArray(this.extendList)),this.condition&&(this.condition=a.visit(this.condition))},e.prototype.createDerived=function(a,b,c){c=null!=c?c:this.evaldCondition;var d=new e(a,b||this.extendList,null,this.index,this.currentFileInfo,this.isReferenced);return d.evaldCondition=c,d.mediaEmpty=this.mediaEmpty,d},e.prototype.createEmptySelectors=function(){var a=new d("","&",this.index,this.currentFileInfo),b=[new e([a],null,null,this.index,this.currentFileInfo)];return b[0].mediaEmpty=!0,b},e.prototype.match=function(a){var b,c,d=this.elements,e=d.length;if(a.CacheElements(),b=a._elements.length,0===b||b>e)return 0;for(c=0;b>c;c++)if(d[c].value!==a._elements[c])return 0;return b},e.prototype.CacheElements=function(){if(!this._elements){var a=this.elements.map(function(a){return a.combinator.value+(a.value.value||a.value)}).join("").match(/[,&#\*\.\w-]([\w-]|(\\.))*/g);a?"&"===a[0]&&a.shift():a=[],this._elements=a}},e.prototype.isJustParentSelector=function(){return!this.mediaEmpty&&1===this.elements.length&&"&"===this.elements[0].value&&(" "===this.elements[0].combinator.value||""===this.elements[0].combinator.value)},e.prototype.eval=function(a){var b=this.condition&&this.condition.eval(a),c=this.elements,d=this.extendList;return c=c&&c.map(function(b){return b.eval(a)}),d=d&&d.map(function(b){return b.eval(a)}),this.createDerived(c,d,b)},e.prototype.genCSS=function(a,b){var c,d;if(a&&a.firstSelector||""!==this.elements[0].combinator.value||b.add(" ",this.currentFileInfo,this.index),!this._css)for(c=0;this.elements.length>c;c++)d=this.elements[c],d.genCSS(a,b)},e.prototype.markReferenced=function(){this.isReferenced=!0},e.prototype.getIsReferenced=function(){return!this.currentFileInfo.reference||this.isReferenced},e.prototype.getIsOutput=function(){return this.evaldCondition},b.exports=e},{"./element":57,"./node":69}],77:[function(a,b){var c=a("./node"),d=function(a){this.value=a};d.prototype=new c,d.prototype.type="UnicodeDescriptor",b.exports=d},{"./node":69}],78:[function(a,b){var c=a("./node"),d=a("../data/unit-conversions"),e=function(a,b,c){this.numerator=a?a.slice(0).sort():[],this.denominator=b?b.slice(0).sort():[],c?this.backupUnit=c:a&&a.length&&(this.backupUnit=a[0])};e.prototype=new c,e.prototype.type="Unit",e.prototype.clone=function(){return new e(this.numerator.slice(0),this.denominator.slice(0),this.backupUnit)},e.prototype.genCSS=function(a,b){var c=a&&a.strictUnits;1===this.numerator.length?b.add(this.numerator[0]):!c&&this.backupUnit?b.add(this.backupUnit):!c&&this.denominator.length&&b.add(this.denominator[0])},e.prototype.toString=function(){var a,b=this.numerator.join("*");for(a=0;this.denominator.length>a;a++)b+="/"+this.denominator[a];return b},e.prototype.compare=function(a){return this.is(a.toString())?0:void 0},e.prototype.is=function(a){return this.toString().toUpperCase()===a.toUpperCase()},e.prototype.isLength=function(){return Boolean(this.toCSS().match(/px|em|%|in|cm|mm|pc|pt|ex/))},e.prototype.isEmpty=function(){return 0===this.numerator.length&&0===this.denominator.length},e.prototype.isSingular=function(){return 1>=this.numerator.length&&0===this.denominator.length},e.prototype.map=function(a){var b;for(b=0;this.numerator.length>b;b++)this.numerator[b]=a(this.numerator[b],!1);for(b=0;this.denominator.length>b;b++)this.denominator[b]=a(this.denominator[b],!0)},e.prototype.usedUnits=function(){var a,b,c={};b=function(b){return a.hasOwnProperty(b)&&!c[e]&&(c[e]=b),b};for(var e in d)d.hasOwnProperty(e)&&(a=d[e],this.map(b));return c},e.prototype.cancel=function(){var a,b,c={};for(b=0;this.numerator.length>b;b++)a=this.numerator[b],c[a]=(c[a]||0)+1;for(b=0;this.denominator.length>b;b++)a=this.denominator[b],c[a]=(c[a]||0)-1;this.numerator=[],this.denominator=[];for(a in c)if(c.hasOwnProperty(a)){var d=c[a];if(d>0)for(b=0;d>b;b++)this.numerator.push(a);else if(0>d)for(b=0;-d>b;b++)this.denominator.push(a)}this.numerator.sort(),this.denominator.sort()},b.exports=e},{"../data/unit-conversions":13,"./node":69}],79:[function(a,b){var c=a("./node"),d=function(a,b,c,d){this.value=a,this.currentFileInfo=c,this.index=b,this.isEvald=d};d.prototype=new c,d.prototype.type="Url",d.prototype.accept=function(a){this.value=a.visit(this.value)},d.prototype.genCSS=function(a,b){b.add("url("),this.value.genCSS(a,b),b.add(")")},d.prototype.eval=function(a){var b,c=this.value.eval(a);if(!this.isEvald&&(b=this.currentFileInfo&&this.currentFileInfo.rootpath,b&&"string"==typeof c.value&&a.isPathRelative(c.value)&&(c.quote||(b=b.replace(/[\(\)'"\s]/g,function(a){return"\\"+a})),c.value=b+c.value),c.value=a.normalizePath(c.value),a.urlArgs&&!c.value.match(/^\s*data:/))){var e=-1===c.value.indexOf("?")?"?":"&",f=e+a.urlArgs;-1!==c.value.indexOf("#")?c.value=c.value.replace("#",f+"#"):c.value+=f}return new d(c,this.index,this.currentFileInfo,!0)},b.exports=d},{"./node":69}],80:[function(a,b){var c=a("./node"),d=function(a){if(this.value=a,!a)throw new Error("Value requires an array argument")};d.prototype=new c,d.prototype.type="Value",d.prototype.accept=function(a){this.value&&(this.value=a.visitArray(this.value))},d.prototype.eval=function(a){return 1===this.value.length?this.value[0].eval(a):new d(this.value.map(function(b){return b.eval(a)}))},d.prototype.genCSS=function(a,b){var c;for(c=0;this.value.length>c;c++)this.value[c].genCSS(a,b),this.value.length>c+1&&b.add(a&&a.compress?",":", ")},b.exports=d},{"./node":69}],81:[function(a,b){var c=a("./node"),d=function(a,b,c){this.name=a,this.index=b,this.currentFileInfo=c||{}};d.prototype=new c,d.prototype.type="Variable",d.prototype.eval=function(a){var b,c=this.name;if(0===c.indexOf("@@")&&(c="@"+new d(c.slice(1),this.index,this.currentFileInfo).eval(a).value),this.evaluating)throw{type:"Name",message:"Recursive variable definition for "+c,filename:this.currentFileInfo.filename,index:this.index};if(this.evaluating=!0,b=this.find(a.frames,function(b){var d=b.variable(c);if(d){if(d.important){var e=a.importantScope[a.importantScope.length-1];e.important=d.important}return d.value.eval(a)}}))return this.evaluating=!1,b;throw{type:"Name",message:"variable "+c+" is undefined",filename:this.currentFileInfo.filename,index:this.index}},d.prototype.find=function(a,b){for(var c,d=0;a.length>d;d++)if(c=b.call(a,a[d]))return c;return null},b.exports=d},{"./node":69}],82:[function(a,b){b.exports={getLocation:function(a,b){for(var c=a+1,d=null,e=-1;--c>=0&&"\n"!==b.charAt(c);)e++;return"number"==typeof a&&(d=(b.slice(0,a).match(/\n/g)||"").length),{line:d,column:e}}}},{}],83:[function(a,b){var c=a("../tree"),d=a("./visitor"),e=a("../logger"),f=function(){this._visitor=new d(this),this.contexts=[],this.allExtendsStack=[[]]};f.prototype={run:function(a){return a=this._visitor.visit(a),a.allExtends=this.allExtendsStack[0],a},visitRule:function(a,b){b.visitDeeper=!1},visitMixinDefinition:function(a,b){b.visitDeeper=!1},visitRuleset:function(a){if(!a.root){var b,d,e,f,g=[],h=a.rules,i=h?h.length:0;for(b=0;i>b;b++)a.rules[b]instanceof c.Extend&&(g.push(h[b]),a.extendOnEveryPath=!0);var j=a.paths;for(b=0;j.length>b;b++){var k=j[b],l=k[k.length-1],m=l.extendList;for(f=m?m.slice(0).concat(g):g,f&&(f=f.map(function(a){return a.clone()})),d=0;f.length>d;d++)this.foundExtends=!0,e=f[d],e.findSelfSelectors(k),e.ruleset=a,0===d&&(e.firstExtendOnThisSelectorPath=!0),this.allExtendsStack[this.allExtendsStack.length-1].push(e)}this.contexts.push(a.selectors)}},visitRulesetOut:function(a){a.root||(this.contexts.length=this.contexts.length-1)},visitMedia:function(a){a.allExtends=[],this.allExtendsStack.push(a.allExtends)},visitMediaOut:function(){this.allExtendsStack.length=this.allExtendsStack.length-1},visitDirective:function(a){a.allExtends=[],this.allExtendsStack.push(a.allExtends)},visitDirectiveOut:function(){this.allExtendsStack.length=this.allExtendsStack.length-1}};var g=function(){this._visitor=new d(this)};g.prototype={run:function(a){var b=new f;if(this.extendIndicies={},b.run(a),!b.foundExtends)return a;a.allExtends=a.allExtends.concat(this.doExtendChaining(a.allExtends,a.allExtends)),this.allExtendsStack=[a.allExtends];var c=this._visitor.visit(a);return this.checkExtendsForNonMatched(a.allExtends),c},checkExtendsForNonMatched:function(a){var b=this.extendIndicies;a.filter(function(a){return!a.hasFoundMatches&&1==a.parent_ids.length}).forEach(function(a){var c="_unknown_";try{c=a.selector.toCSS({})}catch(d){}b[a.index+" "+c]||(b[a.index+" "+c]=!0,e.warn("extend '"+c+"' has no matches"))})},doExtendChaining:function(a,b,d){var e,f,g,h,i,j,k,l,m=[],n=this;for(d=d||0,e=0;a.length>e;e++)for(f=0;b.length>f;f++)j=a[e],k=b[f],j.parent_ids.indexOf(k.object_id)>=0||(i=[k.selfSelectors[0]],g=n.findMatch(j,i),g.length&&(j.hasFoundMatches=!0,j.selfSelectors.forEach(function(a){h=n.extendSelector(g,i,a),l=new c.Extend(k.selector,k.option,0),l.selfSelectors=h,h[h.length-1].extendList=[l],m.push(l),l.ruleset=k.ruleset,l.parent_ids=l.parent_ids.concat(k.parent_ids,j.parent_ids),k.firstExtendOnThisSelectorPath&&(l.firstExtendOnThisSelectorPath=!0,k.ruleset.paths.push(h))})));if(m.length){if(this.extendChainCount++,d>100){var o="{unable to calculate}",p="{unable to calculate}";try{o=m[0].selfSelectors[0].toCSS(),p=m[0].selector.toCSS()}catch(q){}throw{message:"extend circular reference detected. One of the circular extends is currently:"+o+":extend("+p+")"}}return m.concat(n.doExtendChaining(m,b,d+1))}return m},visitRule:function(a,b){b.visitDeeper=!1},visitMixinDefinition:function(a,b){b.visitDeeper=!1},visitSelector:function(a,b){b.visitDeeper=!1},visitRuleset:function(a){if(!a.root){var b,c,d,e,f=this.allExtendsStack[this.allExtendsStack.length-1],g=[],h=this;for(d=0;f.length>d;d++)for(c=0;a.paths.length>c;c++)if(e=a.paths[c],!a.extendOnEveryPath){var i=e[e.length-1].extendList;i&&i.length||(b=this.findMatch(f[d],e),b.length&&(f[d].hasFoundMatches=!0,f[d].selfSelectors.forEach(function(a){g.push(h.extendSelector(b,e,a))})))}a.paths=a.paths.concat(g)}},findMatch:function(a,b){var c,d,e,f,g,h,i,j=this,k=a.selector.elements,l=[],m=[];for(c=0;b.length>c;c++)for(d=b[c],e=0;d.elements.length>e;e++)for(f=d.elements[e],(a.allowBefore||0===c&&0===e)&&l.push({pathIndex:c,index:e,matched:0,initialCombinator:f.combinator}),h=0;l.length>h;h++)i=l[h],g=f.combinator.value,""===g&&0===e&&(g=" "),!j.isElementValuesEqual(k[i.matched].value,f.value)||i.matched>0&&k[i.matched].combinator.value!==g?i=null:i.matched++,i&&(i.finished=i.matched===k.length,i.finished&&!a.allowAfter&&(d.elements.length>e+1||b.length>c+1)&&(i=null)),i?i.finished&&(i.length=k.length,i.endPathIndex=c,i.endPathElementIndex=e+1,l.length=0,m.push(i)):(l.splice(h,1),h--);return m},isElementValuesEqual:function(a,b){if("string"==typeof a||"string"==typeof b)return a===b;if(a instanceof c.Attribute)return a.op!==b.op||a.key!==b.key?!1:a.value&&b.value?(a=a.value.value||a.value,b=b.value.value||b.value,a===b):a.value||b.value?!1:!0;if(a=a.value,b=b.value,a instanceof c.Selector){if(!(b instanceof c.Selector)||a.elements.length!==b.elements.length)return!1;for(var d=0;a.elements.length>d;d++){if(a.elements[d].combinator.value!==b.elements[d].combinator.value&&(0!==d||(a.elements[d].combinator.value||" ")!==(b.elements[d].combinator.value||" ")))return!1;if(!this.isElementValuesEqual(a.elements[d].value,b.elements[d].value))return!1}return!0}return!1},extendSelector:function(a,b,d){var e,f,g,h,i,j=0,k=0,l=[];for(e=0;a.length>e;e++)h=a[e],f=b[h.pathIndex],g=new c.Element(h.initialCombinator,d.elements[0].value,d.elements[0].index,d.elements[0].currentFileInfo),h.pathIndex>j&&k>0&&(l[l.length-1].elements=l[l.length-1].elements.concat(b[j].elements.slice(k)),k=0,j++),i=f.elements.slice(k,h.index).concat([g]).concat(d.elements.slice(1)),j===h.pathIndex&&e>0?l[l.length-1].elements=l[l.length-1].elements.concat(i):(l=l.concat(b.slice(j,h.pathIndex)),l.push(new c.Selector(i))),j=h.endPathIndex,k=h.endPathElementIndex,k>=b[j].elements.length&&(k=0,j++);return b.length>j&&k>0&&(l[l.length-1].elements=l[l.length-1].elements.concat(b[j].elements.slice(k)),j++),l=l.concat(b.slice(j,b.length))},visitRulesetOut:function(){},visitMedia:function(a){var b=a.allExtends.concat(this.allExtendsStack[this.allExtendsStack.length-1]);b=b.concat(this.doExtendChaining(b,a.allExtends)),this.allExtendsStack.push(b)},visitMediaOut:function(){var a=this.allExtendsStack.length-1;this.allExtendsStack.length=a},visitDirective:function(a){var b=a.allExtends.concat(this.allExtendsStack[this.allExtendsStack.length-1]);b=b.concat(this.doExtendChaining(b,a.allExtends)),this.allExtendsStack.push(b)},visitDirectiveOut:function(){var a=this.allExtendsStack.length-1;this.allExtendsStack.length=a}},b.exports=g},{"../logger":32,"../tree":61,"./visitor":89}],84:[function(a,b){function c(a){this.imports=[],this.variableImports=[],this._onSequencerEmpty=a,this._currentDepth=0}c.prototype.addImport=function(a){var b=this,c={callback:a,args:null,isReady:!1};return this.imports.push(c),function(){c.args=Array.prototype.slice.call(arguments,0),c.isReady=!0,b.tryRun()}},c.prototype.addVariableImport=function(a){this.variableImports.push(a)},c.prototype.tryRun=function(){this._currentDepth++;try{for(;;){for(;this.imports.length>0;){var a=this.imports[0];if(!a.isReady)return;this.imports=this.imports.slice(1),a.callback.apply(null,a.args)}if(0===this.variableImports.length)break;var b=this.variableImports[0];this.variableImports=this.variableImports.slice(1),b()}}finally{this._currentDepth--}0===this._currentDepth&&this._onSequencerEmpty&&this._onSequencerEmpty()},b.exports=c},{}],85:[function(a,b){var c=a("../contexts"),d=a("./visitor"),e=a("./import-sequencer"),f=function(a,b){this._visitor=new d(this),this._importer=a,this._finish=b,this.context=new c.Eval,this.importCount=0,this.onceFileDetectionMap={},this.recursionDetector={},this._sequencer=new e(this._onSequencerEmpty.bind(this))};f.prototype={isReplacing:!1,run:function(a){try{this._visitor.visit(a)}catch(b){this.error=b}this.isFinished=!0,this._sequencer.tryRun()},_onSequencerEmpty:function(){this.isFinished&&this._finish(this.error)},visitImport:function(a,b){var d=a.options.inline;if(!a.css||d){var e=new c.Eval(this.context,this.context.frames.slice(0)),f=e.frames[0];this.importCount++,a.isVariableImport()?this._sequencer.addVariableImport(this.processImportNode.bind(this,a,e,f)):this.processImportNode(a,e,f)}b.visitDeeper=!1},processImportNode:function(a,b,c){var d,e=a.options.inline;try{d=a.evalForImport(b)}catch(f){f.filename||(f.index=a.index,f.filename=a.currentFileInfo.filename),a.css=!0,a.error=f}if(!d||d.css&&!e)this.importCount--,this.isFinished&&this._sequencer.tryRun();else{d.options.multiple&&(b.importMultiple=!0);for(var g=void 0===d.css,h=0;c.rules.length>h;h++)if(c.rules[h]===a){c.rules[h]=d;break}var i=this.onImported.bind(this,d,b),j=this._sequencer.addImport(i);this._importer.push(d.getPath(),g,d.currentFileInfo,d.options,j)}},onImported:function(a,b,c,d,e,f){c&&(c.filename||(c.index=a.index,c.filename=a.currentFileInfo.filename),this.error=c);var g=this,h=a.options.inline,i=a.options.plugin,j=a.options.optional,k=e||f in g.recursionDetector;if(b.importMultiple||(a.skip=k?!0:function(){return f in g.onceFileDetectionMap?!0:(g.onceFileDetectionMap[f]=!0,!1)}),!f&&j&&(a.skip=!0),d&&(a.root=d,a.importedFilename=f,!(h||i||!b.importMultiple&&k))){g.recursionDetector[f]=!0;var l=this.context;this.context=b;try{this._visitor.visit(d)}catch(c){this.error=c}this.context=l}g.importCount--,g.isFinished&&g._sequencer.tryRun()},visitRule:function(a,b){"DetachedRuleset"===a.value.type?this.context.frames.unshift(a):b.visitDeeper=!1},visitRuleOut:function(a){"DetachedRuleset"===a.value.type&&this.context.frames.shift()},visitDirective:function(a){this.context.frames.unshift(a)},visitDirectiveOut:function(){this.context.frames.shift()},visitMixinDefinition:function(a){this.context.frames.unshift(a)},visitMixinDefinitionOut:function(){this.context.frames.shift()},visitRuleset:function(a){this.context.frames.unshift(a)},visitRulesetOut:function(){this.context.frames.shift()},visitMedia:function(a){this.context.frames.unshift(a.rules[0])},visitMediaOut:function(){this.context.frames.shift()}},b.exports=f},{"../contexts":10,"./import-sequencer":84,"./visitor":89}],86:[function(a,b){var c={Visitor:a("./visitor"),ImportVisitor:a("./import-visitor"),ExtendVisitor:a("./extend-visitor"),JoinSelectorVisitor:a("./join-selector-visitor"),ToCSSVisitor:a("./to-css-visitor")};b.exports=c},{"./extend-visitor":83,"./import-visitor":85,"./join-selector-visitor":87,"./to-css-visitor":88,"./visitor":89
}],87:[function(a,b){var c=a("./visitor"),d=function(){this.contexts=[[]],this._visitor=new c(this)};d.prototype={run:function(a){return this._visitor.visit(a)},visitRule:function(a,b){b.visitDeeper=!1},visitMixinDefinition:function(a,b){b.visitDeeper=!1},visitRuleset:function(a){var b,c=this.contexts[this.contexts.length-1],d=[];this.contexts.push(d),a.root||(b=a.selectors,b&&(b=b.filter(function(a){return a.getIsOutput()}),a.selectors=b.length?b:b=null,b&&a.joinSelectors(d,c,b)),b||(a.rules=null),a.paths=d)},visitRulesetOut:function(){this.contexts.length=this.contexts.length-1},visitMedia:function(a){var b=this.contexts[this.contexts.length-1];a.rules[0].root=0===b.length||b[0].multiMedia},visitDirective:function(a){var b=this.contexts[this.contexts.length-1];a.rules&&a.rules.length&&(a.rules[0].root=a.isRooted||0===b.length||null)}},b.exports=d},{"./visitor":89}],88:[function(a,b){var c=a("../tree"),d=a("./visitor"),e=function(a){this._visitor=new d(this),this._context=a};e.prototype={isReplacing:!0,run:function(a){return this._visitor.visit(a)},visitRule:function(a){return a.variable?void 0:a},visitMixinDefinition:function(a){a.frames=[]},visitExtend:function(){},visitComment:function(a){return a.isSilent(this._context)?void 0:a},visitMedia:function(a,b){return a.accept(this._visitor),b.visitDeeper=!1,a.rules.length?a:void 0},visitImport:function(a){return void 0!==a.path.currentFileInfo.reference&&a.css?void 0:a},visitDirective:function(a,b){function d(a){var b,c=a.rules;1!==c.length||c[0].paths&&0!==c[0].paths.length||(c=c[0].rules);for(var d=0;c.length>d;d++)if(b=c[d],b.getIsReferenced&&b.getIsReferenced())return!0;return!1}if("@charset"===a.name){if(!a.getIsReferenced())return;if(this.charset){if(a.debugInfo){var e=new c.Comment("/* "+a.toCSS(this._context).replace(/\n/g,"")+" */\n");return e.debugInfo=a.debugInfo,this._visitor.visit(e)}return}this.charset=!0}if(a.rules&&a.rules.length){if(this._mergeRules(a.rules[0].rules),a.accept(this._visitor),b.visitDeeper=!1,a.getIsReferenced())return a;if(!a.rules||!a.rules.length)return;if(d(a))return a.markReferenced(),a}else if(a.getIsReferenced())return a},checkPropertiesInRoot:function(a){for(var b,d=0;a.length>d;d++)if(b=a[d],b instanceof c.Rule&&!b.variable)throw{message:"properties must be inside selector blocks, they cannot be in the root.",index:b.index,filename:b.currentFileInfo?b.currentFileInfo.filename:null}},visitRuleset:function(a,b){var d,e=[];if(a.firstRoot&&this.checkPropertiesInRoot(a.rules),a.root)a.accept(this._visitor),b.visitDeeper=!1,(a.firstRoot||a.rules&&a.rules.length>0)&&e.splice(0,0,a);else{a.paths&&(a.paths=a.paths.filter(function(a){var b;for(" "===a[0].elements[0].combinator.value&&(a[0].elements[0].combinator=new c.Combinator("")),b=0;a.length>b;b++)if(a[b].getIsReferenced()&&a[b].getIsOutput())return!0;return!1}));for(var f=a.rules,g=f?f.length:0,h=0;g>h;)d=f[h],d&&d.rules?(e.push(this._visitor.visit(d)),f.splice(h,1),g--):h++;g>0?a.accept(this._visitor):a.rules=null,b.visitDeeper=!1,f=a.rules,f&&(this._mergeRules(f),f=a.rules),f&&(this._removeDuplicateRules(f),f=a.rules),f&&f.length>0&&a.paths.length>0&&e.splice(0,0,a)}return 1===e.length?e[0]:e},_removeDuplicateRules:function(a){if(a){var b,d,e,f={};for(e=a.length-1;e>=0;e--)if(d=a[e],d instanceof c.Rule)if(f[d.name]){b=f[d.name],b instanceof c.Rule&&(b=f[d.name]=[f[d.name].toCSS(this._context)]);var g=d.toCSS(this._context);-1!==b.indexOf(g)?a.splice(e,1):b.push(g)}else f[d.name]=d}},_mergeRules:function(a){if(a){for(var b,d,e,f={},g=0;a.length>g;g++)d=a[g],d instanceof c.Rule&&d.merge&&(e=[d.name,d.important?"!":""].join(","),f[e]?a.splice(g--,1):f[e]=[],f[e].push(d));Object.keys(f).map(function(a){function e(a){return new c.Expression(a.map(function(a){return a.value}))}function g(a){return new c.Value(a.map(function(a){return a}))}if(b=f[a],b.length>1){d=b[0];var h=[],i=[];b.map(function(a){"+"===a.merge&&(i.length>0&&h.push(e(i)),i=[]),i.push(a)}),h.push(e(i)),d.value=g(h)}})}},visitAnonymous:function(a){return a.getIsReferenced()?(a.accept(this._visitor),a):void 0}},b.exports=e},{"../tree":61,"./visitor":89}],89:[function(a,b){function c(a){return a}function d(a,b){var c,e;for(c in a)if(a.hasOwnProperty(c))switch(e=a[c],typeof e){case"function":e.prototype&&e.prototype.type&&(e.prototype.typeIndex=b++);break;case"object":b=d(e,b)}return b}var e=a("../tree"),f={visitDeeper:!0},g=!1,h=function(a){this._implementation=a,this._visitFnCache=[],g||(d(e,1),g=!0)};h.prototype={visit:function(a){if(!a)return a;var b=a.typeIndex;if(!b)return a;var d,e=this._visitFnCache,g=this._implementation,h=b<<1,i=1|h,j=e[h],k=e[i],l=f;if(l.visitDeeper=!0,j||(d="visit"+a.type,j=g[d]||c,k=g[d+"Out"]||c,e[h]=j,e[i]=k),j!==c){var m=j.call(g,a,l);g.isReplacing&&(a=m)}return l.visitDeeper&&a&&a.accept&&a.accept(this),k!=c&&k.call(g,a),a},visitArray:function(a,b){if(!a)return a;var c,d=a.length;if(b||!this._implementation.isReplacing){for(c=0;d>c;c++)this.visit(a[c]);return a}var e=[];for(c=0;d>c;c++){var f=this.visit(a[c]);void 0!==f&&(f.splice?f.length&&this.flatten(f,e):e.push(f))}return e},flatten:function(a,b){b||(b=[]);var c,d,e,f,g,h;for(d=0,c=a.length;c>d;d++)if(e=a[d],void 0!==e)if(e.splice)for(g=0,f=e.length;f>g;g++)h=e[g],void 0!==h&&(h.splice?h.length&&this.flatten(h,b):b.push(h));else b.push(e);return b}},b.exports=h},{"../tree":61}],90:[function(a,b){function c(){if(!g){g=!0;for(var a,b=f.length;b;){a=f,f=[];for(var c=-1;++c<b;)a[c]();b=f.length}g=!1}}function d(){}var e=b.exports={},f=[],g=!1;e.nextTick=function(a){f.push(a),g||setTimeout(c,0)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={},e.on=d,e.addListener=d,e.once=d,e.off=d,e.removeListener=d,e.removeAllListeners=d,e.emit=d,e.binding=function(){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},{}],91:[function(a,b){"use strict";function c(a){function b(a){return null===i?void k.push(a):void f(function(){var b=i?a.onFulfilled:a.onRejected;if(null===b)return void(i?a.resolve:a.reject)(j);var c;try{c=b(j)}catch(d){return void a.reject(d)}a.resolve(c)})}function c(a){try{if(a===l)throw new TypeError("A promise cannot be resolved with itself.");if(a&&("object"==typeof a||"function"==typeof a)){var b=a.then;if("function"==typeof b)return void e(b.bind(a),c,g)}i=!0,j=a,h()}catch(d){g(d)}}function g(a){i=!1,j=a,h()}function h(){for(var a=0,c=k.length;c>a;a++)b(k[a]);k=null}if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof a)throw new TypeError("not a function");var i=null,j=null,k=[],l=this;this.then=function(a,c){return new l.constructor(function(e,f){b(new d(a,c,e,f))})},e(a,c,g)}function d(a,b,c,d){this.onFulfilled="function"==typeof a?a:null,this.onRejected="function"==typeof b?b:null,this.resolve=c,this.reject=d}function e(a,b,c){var d=!1;try{a(function(a){d||(d=!0,b(a))},function(a){d||(d=!0,c(a))})}catch(e){if(d)return;d=!0,c(e)}}var f=a("asap");b.exports=c},{asap:93}],92:[function(a,b){"use strict";function c(a){this.then=function(b){return"function"!=typeof b?this:new d(function(c,d){e(function(){try{c(b(a))}catch(e){d(e)}})})}}var d=a("./core.js"),e=a("asap");b.exports=d,c.prototype=d.prototype;var f=new c(!0),g=new c(!1),h=new c(null),i=new c(void 0),j=new c(0),k=new c("");d.resolve=function(a){if(a instanceof d)return a;if(null===a)return h;if(void 0===a)return i;if(a===!0)return f;if(a===!1)return g;if(0===a)return j;if(""===a)return k;if("object"==typeof a||"function"==typeof a)try{var b=a.then;if("function"==typeof b)return new d(b.bind(a))}catch(e){return new d(function(a,b){b(e)})}return new c(a)},d.all=function(a){var b=Array.prototype.slice.call(a);return new d(function(a,c){function d(f,g){try{if(g&&("object"==typeof g||"function"==typeof g)){var h=g.then;if("function"==typeof h)return void h.call(g,function(a){d(f,a)},c)}b[f]=g,0===--e&&a(b)}catch(i){c(i)}}if(0===b.length)return a([]);for(var e=b.length,f=0;b.length>f;f++)d(f,b[f])})},d.reject=function(a){return new d(function(b,c){c(a)})},d.race=function(a){return new d(function(b,c){a.forEach(function(a){d.resolve(a).then(b,c)})})},d.prototype["catch"]=function(a){return this.then(null,a)}},{"./core.js":91,asap:93}],93:[function(a,b){(function(a){function c(){for(;e.next;){e=e.next;var a=e.task;e.task=void 0;var b=e.domain;b&&(e.domain=void 0,b.enter());try{a()}catch(d){if(i)throw b&&b.exit(),setTimeout(c,0),b&&b.enter(),d;setTimeout(function(){throw d},0)}b&&b.exit()}g=!1}function d(b){f=f.next={task:b,domain:i&&a.domain,next:null},g||(g=!0,h())}var e={task:void 0,next:null},f=e,g=!1,h=void 0,i=!1;if("undefined"!=typeof a&&a.nextTick)i=!0,h=function(){a.nextTick(c)};else if("function"==typeof setImmediate)h="undefined"!=typeof window?setImmediate.bind(window,c):function(){setImmediate(c)};else if("undefined"!=typeof MessageChannel){var j=new MessageChannel;j.port1.onmessage=c,h=function(){j.port2.postMessage(0)}}else h=function(){setTimeout(c,0)};b.exports=d}).call(this,a("_process"))},{_process:90}],94:[function(){"function"!=typeof Promise.prototype.done&&(Promise.prototype.done=function(){var a=arguments.length?this.then.apply(this,arguments):this;a.then(null,function(a){setTimeout(function(){throw a},0)})})},{}],95:[function(a){a("asap");"undefined"==typeof Promise&&(Promise=a("./lib/core.js"),a("./lib/es6-extensions.js")),a("./polyfill-done.js")},{"./lib/core.js":91,"./lib/es6-extensions.js":92,"./polyfill-done.js":94,asap:93}]},{},[2])(2)});

var DemoSettings=pc.createScript("demoSettings"),DEMOSETTING_OFF=-1,DEMOSETTING_LOW=0,DEMOSETTING_MEDIUM=1,DEMOSETTING_HIGH=2;function getQueryVariable(t){for(var e=window.location.search.substring(1).split("&"),i=0;i<e.length;i++){var s=e[i].split("=");if(s[0]==t)return s[1]}return-1}DemoSettings.prototype.initialize=function(){var t=getQueryVariable("quality");if("high"===t)this.skyQuality=2,this.waterQuality=2,this.leavesQuality=2,this.fogQuality=2,this.mirrorQuality=1,this.shadowQuality=2,this.blitColor=!0,this.blitDepth=!0,this.aa=4;else if("medium"===t)this.skyQuality=1,this.waterQuality=1,this.leavesQuality=1,this.fogQuality=1,this.mirrorQuality=1,this.shadowQuality=1,this.blitColor=!0,this.blitDepth=!0,this.aa=2;else if("low"===t)this.skyQuality=-1,this.waterQuality=0,this.leavesQuality=1,this.fogQuality=1,this.mirrorQuality=-1,this.shadowQuality=0,this.blitColor=!0,this.blitDepth=!0,this.aa=1;else if("verylow"===t)this.skyQuality=-1,this.waterQuality=0,this.leavesQuality=1,this.fogQuality=1,this.mirrorQuality=-1,this.shadowQuality=0,this.blitColor=!0,this.blitDepth=!0,this.aa=1;else{this.skyQuality=DEMOSETTING_OFF,this.waterQuality=DEMOSETTING_LOW,this.leavesQuality=DEMOSETTING_MEDIUM,this.fogQuality=DEMOSETTING_MEDIUM,this.mirrorQuality=DEMOSETTING_OFF,this.shadowQuality=DEMOSETTING_MEDIUM,this.blitColor=!0,this.blitDepth=!0;this.isAngle=!1;var e=2;window.mobile&&(e=1),this.aa=e}this.showFps=0,pc.demoSettings=this},Object.defineProperty(DemoSettings.prototype,"renderMirrors",{get:function(){return this._renderMirrors},set:function(t){if(this._renderMirrors!==t){this._renderMirrors=t;for(var e=this.app.root.findByTag("Mirror"),i=0;i<e.length;i++)e[i].script.mirror.setEnabled(t)}}}),Object.defineProperty(DemoSettings.prototype,"renderShadows",{get:function(){return this._renderShadows},set:function(t){if(this._renderShadows!==t){this._renderShadows=t;for(var e=this.app.root.findByTag("ShadowedLight"),i=0;i<e.length;i++)e[i].light.castShadows=t}}}),Object.defineProperty(DemoSettings.prototype,"updateLeaves",{get:function(){return this._updateLeaves},set:function(t){if(this._updateLeaves!==t){this._updateLeaves=t;for(var e=this.app.root.findByTag("LeavesParticle"),i=0;i<e.length;i++)e[i].script.leavesParticle.enabled=t}}}),Object.defineProperty(DemoSettings.prototype,"renderTrees",{get:function(){return this._renderTrees},set:function(t){if(this._renderTrees!==t){this._renderTrees=t;for(var e=this.app.root.findByTag("Tree"),i=0;i<e.length;i++)e[i].model.enabled=t}}}),Object.defineProperty(DemoSettings.prototype,"skyQuality",{get:function(){return this._skyQuality},set:function(t){if(this._skyQuality!==t){var e=this._skyQuality;this._skyQuality=t,localStorage.setItem("webgl2-demo.settings.skyQuality",t),t===DEMOSETTING_OFF&&e>DEMOSETTING_OFF?pc.skyboxToggle.force=!0:(t===DEMOSETTING_OFF||e!==DEMOSETTING_OFF&&void 0!==e||(pc.skyboxToggle.force=!0),this.app.root.children[0].script.sky.setQuality(t))}}}),Object.defineProperty(DemoSettings.prototype,"waterQuality",{get:function(){return this._waterQuality},set:function(t){if(this._waterQuality!==t){this._waterQuality=t,localStorage.setItem("webgl2-demo.settings.waterQuality",t);var e=t;e===DEMOSETTING_MEDIUM?e=DEMOSETTING_LOW:e===DEMOSETTING_LOW&&(e=DEMOSETTING_OFF);for(var i=this.app.root.findByTag("Water"),s=0;s<i.length;s++)i[s].script.water.setQuality(e)}}}),Object.defineProperty(DemoSettings.prototype,"leavesQuality",{get:function(){return this._leavesQuality},set:function(t){if(this._leavesQuality!==t){this._leavesQuality=t,localStorage.setItem("webgl2-demo.settings.leavesQuality",t);var e,i=this.app.root.findByTag("LeavesParticle");for(e=0;e<i.length;e++)i[e].script.leavesParticle.setQuality(t);for(i=this.app.root.findByTag("PlaceLeaves"),e=0;e<i.length;e++)i[e].script.placeLeaves.enabled=t!==DEMOSETTING_LOW,i[e].script.placeLeaves.state=-1}}}),Object.defineProperty(DemoSettings.prototype,"fogQuality",{get:function(){return this._fogQuality},set:function(t){if(this._fogQuality!==t){this._fogQuality=t,localStorage.setItem("webgl2-demo.settings.fogQuality",t);for(var e=this.app.root.findByTag("FogQuad"),i=0;i<e.length;i++)e[i].model.model.meshInstances[0].visible=t===DEMOSETTING_HIGH}}}),Object.defineProperty(DemoSettings.prototype,"mirrorQuality",{get:function(){return this._mirrorQuality},set:function(t){if(this._mirrorQuality!==t){this._mirrorQuality=t,localStorage.setItem("webgl2-demo.settings.mirrorQuality",t);for(var e=this.app.root.findByTag("ActualMirror"),i=0;i<e.length;i++)e[i].script.mirror.setEnabled(t!==DEMOSETTING_OFF)}}}),Object.defineProperty(DemoSettings.prototype,"shadowQuality",{get:function(){return this._shadowQuality},set:function(t){if(this._shadowQuality!==t){this._shadowQuality=t,localStorage.setItem("webgl2-demo.settings.shadowQuality",t);var e,i=this.app.root.findByTag("ShadowedLight");for(e=0;e<i.length;e++)t===DEMOSETTING_HIGH?(i[e].light.shadowType=pc.SHADOW_PCF5,i[e].light.castShadows=!0,i[e].light.shadowUpdateMode="light_shadow_importantE2"===i[e].name?pc.SHADOWUPDATE_REALTIME:pc.SHADOWUPDATE_THISFRAME):t===DEMOSETTING_MEDIUM?(i[e].light.shadowType=pc.SHADOW_VSM8,i[e].light.castShadows=!0,i[e].light.shadowUpdateMode=pc.SHADOWUPDATE_THISFRAME):i[e].light.castShadows=!1;for(i=this.app.root.findByTag("LeavesParticle"),e=0;e<i.length;e++)i[e].script.leavesParticle.setShadowQuality(t);if(t!==DEMOSETTING_LOW)for(e=0;e<_HIDELODS.length;e++)_HIDELODS[e].forcePrewarm()}}}),Object.defineProperty(DemoSettings.prototype,"aa",{get:function(){return this._aa},set:function(t){this._aa!==t&&(this._aa=t,localStorage.setItem("webgl2-demo.settings.aa",t),this.app.root.findByName("Camera").script.postprocess.setAA(t))}}),Object.defineProperty(DemoSettings.prototype,"showFps",{get:function(){return this._showFps},set:function(t){this._showFps!==t&&(this._showFps=t,localStorage.setItem("webgl2-demo.settings.showFps",t),this.app.fire("settings:showFps",t))}});var Sky=pc.createScript("sky");Sky.attributes.add("test",{type:"boolean"}),Sky.attributes.add("shaderSkySamplePS",{type:"asset",assetType:"shader"}),Sky.attributes.add("shaderSkyVS",{type:"asset",assetType:"shader"}),Sky.attributes.add("shaderSkyPS",{type:"asset",assetType:"shader"}),Sky.attributes.add("shaderIncludeTexSkyPS",{type:"asset",assetType:"shader"}),Sky.attributes.add("shaderTexSkyVS",{type:"asset",assetType:"shader"}),Sky.attributes.add("shaderFractalPS",{type:"asset",assetType:"shader"}),Sky.attributes.add("shaderLutConvertPS",{type:"asset",assetType:"shader"}),Sky.attributes.add("shaderDownsampleDensityPS",{type:"asset",assetType:"shader"}),Sky.attributes.add("textureLutSky",{type:"asset",assetType:"texture"}),Sky.attributes.add("textureCurl",{type:"asset",assetType:"texture"}),Sky.attributes.add("textureNoise",{type:"asset",assetType:"texture"}),Sky.attributes.add("textureBlueNoise",{type:"asset",assetType:"texture"}),Sky.attributes.add("cubemapClearSky",{type:"asset",assetType:"cubemap"}),Sky.attributes.add("cubemapClouds",{type:"asset",assetType:"cubemap"});var SPEEDBOOST=2,SKYQUALITY_LOW=0,SKYQUALITY_MEDIUM=1,SKYQUALITY_HIGH=2;function syncToCpu(e,t){var s=t._colorBuffer,r=new Uint8Array(s.width*s.height*4),a=e.gl;a.bindFramebuffer(a.FRAMEBUFFER,t._glFrameBuffer),a.readPixels(0,0,s.width,s.height,a.RGBA,a.UNSIGNED_BYTE,r),s._levels||(s._levels=[]),s._levels[0]=r}function syncToCpuFloat(e,t){var s=t._colorBuffer,r=new Float32Array(s.width*s.height*4),a=e.gl;a.bindFramebuffer(a.FRAMEBUFFER,t._glFrameBuffer),a.readPixels(0,0,s.width,s.height,a.RGBA,a.FLOAT,r),s._levels||(s._levels=[]),s._levels[0]=r}Sky.prototype.initSky=function(){var e,t=this.app.graphicsDevice;if(t.webgl2){var s,r,a,i=this.quality===SKYQUALITY_HIGH?1024:this.quality===SKYQUALITY_MEDIUM?512:256,h=this.quality===SKYQUALITY_HIGH?256:this.quality===SKYQUALITY_MEDIUM?128:64;if(this.numQuads=i/h,this.skyRt)for(e=0;e<3;e++)this.skyRt[e].colorBuffer.destroy(),this.skyRt[e].destroy();for(this.skyRt=[],e=0;e<3;e++)(s=new pc.Texture(t,{width:i,height:i,format:pc.PIXELFORMAT_R8_G8_B8_A8,rgbm:!0,autoMipmap:!1})).addressU=pc.ADDRESS_CLAMP_TO_EDGE,s.addressV=pc.ADDRESS_CLAMP_TO_EDGE,s.magFilter=pc.FILTER_LINEAR,s.minFilter=pc.FILTER_LINEAR,this.skyRt[e]=new pc.RenderTarget(t,s,{depth:!1});for(t.scope.resolve("invSkyJitterSize").setValue(1/(h/16)),this.skyPointer=0,this.prevSkyPointer=0,this.quadPointer=0,this.t=this.numQuads*this.numQuads/60*this.speed,this.rect=[],a=0;a<this.numQuads;a++)for(r=0;r<this.numQuads;r++)this.rect.push({x:r*h,y:a*h,z:h,w:h});this.constSky1.setValue(this.skyRt[0].colorBuffer),this.constSky2.setValue(this.skyRt[1].colorBuffer),this.shaderTime.setValue(0),this.renderSky(),this.constSky1.setValue(this.skyRt[1].colorBuffer),this.constSky2.setValue(this.skyRt[0].colorBuffer),this.shaderTime.setValue(this.t),this.renderSky(),this.t*=2,this.skyBlend=0,this.constSky1.setValue(this.skyRt[0].colorBuffer),this.constSky2.setValue(this.skyRt[1].colorBuffer)}else this.enabled=!1},Sky.prototype.initialize=function(){var e,t=this;this.quality=void 0===this.quality?SKYQUALITY_HIGH:this.quality;var s=this.app,r=s.graphicsDevice,a=pc.shaderChunks;this.speed=.125*SPEEDBOOST;var i=new pc.Material;i.updateShader=function(){var e=pc.programlib.gammaCode(s.scene.gamma)+pc.programlib.tonemapCode(s.scene.toneMapping)+t.shaderSkySamplePS.resource,i=a.createShaderFromCode(r,t.shaderSkyVS.resource,e,"skySample");this.setShader(i)},i.updateShader(),i.cull=pc.CULLFACE_NONE;var h=new pc.GraphNode,p=pc.createBox(r),o=new pc.MeshInstance(h,p,i);o.updateKey=function(){this.material;this.key=0},o.updateKey(),o.cull=!1,o.drawToDepth=!1;var d=new pc.Model;d.graph=h,d.meshInstances=[o],s.scene.addModel(d),this.model=d;var c=a.createShaderFromCode(r,a.fullscreenQuadVS,this.shaderLutConvertPS.resource,"lutConvert"),u=new pc.Texture(r,{width:256,height:16,format:pc.PIXELFORMAT_R8_G8_B8_A8,autoMipmap:!1});u.addressU=pc.ADDRESS_REPEAT,u.addressV=pc.ADDRESS_REPEAT,u.magFilter=pc.FILTER_NEAREST,u.minFilter=pc.FILTER_NEAREST;var l=new pc.RenderTarget(r,u,{depth:!1}),y=this.textureLutSky.resource;y.magFilter=pc.FILTER_NEAREST,y.minFilter=pc.FILTER_NEAREST,r.scope.resolve("skyLutTex").setValue(y),pc.drawQuadWithShader(this.app.graphicsDevice,l,c),syncToCpu(r,l);var S,n,k,T,E=new pc.Texture(r,{width:16,height:16,depth:16,volume:!0,format:pc.PIXELFORMAT_R8_G8_B8_A8,autoMipmap:!1}),R=new Uint8Array(u._levels[0].length),m=16;for(e=0;e<m;e++)for(S=0;S<m;S++)for(n=0;n<m;n++)for(k=m-S-1,T=0;T<4;T++)R[4*(e+S*m+n*m*m)+T]=u._levels[0][4*(n*m+e+k*m*m)+T];E._levels=[R],E.addressU=pc.ADDRESS_REPEAT,E.addressV=pc.ADDRESS_REPEAT,E.addressW=pc.ADDRESS_REPEAT,E.magFilter=pc.FILTER_LINEAR,E.minFilter=pc.FILTER_LINEAR,l.destroy(),r.scope.resolve("noiseTex").setValue(this.textureNoise.resource),r.scope.resolve("curlTex").setValue(this.textureCurl.resource),r.scope.resolve("skyLutTex").setValue(E),r.scope.resolve("cloudMaskTex").setValue(u),r.scope.resolve("jitterNoise").setValue(this.textureBlueNoise.resource),this.Ds=new pc.Vec3(-.04535304009914398,.02094241976737976,.9987514615058899),r.scope.resolve("sunDir").setValue(this.Ds.data);var v=this.cubemapClearSky.resources[3];r.scope.resolve("skyboxLow").setValue(v);var _=pc.shFromCubemap(r,v,!0);r.scope.resolve("skySH[0]").setValue(_);var f=this.cubemapClouds,A=f.resources[1],F=f.resources[3];this.app.graphicsDevice.scope.resolve("skyboxHigh").setValue(A),this.app.graphicsDevice.scope.resolve("skyboxLowCurrent").setValue(F),this.constSky1=r.scope.resolve("skyTex1"),this.constSky2=r.scope.resolve("skyTex2"),this.source=r.scope.resolve("source"),this.shaderSkyBlend=r.scope.resolve("skyBlend"),this.shaderTime=r.scope.resolve("totalTime"),atf.dynSkybox=this;var P=new pc.Texture(this.app.graphicsDevice,{width:4,height:4,format:pc.PIXELFORMAT_R8_G8_B8_A8,mipmaps:!1});return this.constSky1.setValue(P),this.constSky2.setValue(P),void(this.compiled=!1)},Sky.prototype.compileSky=function(){console.log("Compiling sky");var e=this.app.graphicsDevice,t=pc.shaderChunks;if(pc.skyShader)this.texShader=pc.skyShader;else{var s=t.createShaderFromCode(e,t.fullscreenQuadVS,this.shaderFractalPS.resource,"fractal"),r=new pc.Texture(e,{width:2048,height:1024,format:pc.PIXELFORMAT_R8_G8_B8_A8,autoMipmap:!1});r.addressU=pc.ADDRESS_REPEAT,r.addressV=pc.ADDRESS_REPEAT,r.magFilter=pc.FILTER_LINEAR,r.minFilter=pc.FILTER_LINEAR,this.fractalTex=new pc.RenderTarget(e,r,{depth:!1}),pc.drawQuadWithShader(this.app.graphicsDevice,this.fractalTex,s),syncToCpu(e,this.fractalTex);var a=new pc.Texture(e,{width:128,height:128,depth:128,volume:!0,format:pc.PIXELFORMAT_R8_G8_B8_A8,autoMipmap:!1});a._levels=r._levels,a.addressU=pc.ADDRESS_REPEAT,a.addressV=pc.ADDRESS_REPEAT,a.addressW=pc.ADDRESS_REPEAT,a.magFilter=pc.FILTER_LINEAR,a.minFilter=pc.FILTER_LINEAR,this.fractalTex.destroy(),r.destroy(),e.scope.resolve("cloudShapeFractal").setValue(a);var i=this.shaderIncludeTexSkyPS.resource+this.shaderSkyPS.resource;this.texShader=t.createShaderFromCode(e,this.shaderTexSkyVS.resource,i,"texSky"),pc.skyShader=this.texShader}pc.texShader=this.texShader,this.initSky(),this.compiled=!0},Sky.prototype.renderSky=function(e){var t=this.skyPointer,s=(t+1)%3;pc.drawQuadWithShader(this.app.graphicsDevice,this.skyRt[t],this.texShader),this.prevSkyPointer=this.skyPointer,this.skyPointer=s},Sky.prototype.postUpdate=function(e){var t=this.app.graphicsDevice;if(this.compiled||this.quality>=0&&(this.compileSky(),this.compiled=!0),pc.profileSky=0,!pc.disableSky){pc.profileSky=pc.now(),this.skyBlend+=1/(this.numQuads*this.numQuads),this.shaderSkyBlend.setValue(this.skyBlend);var s=this.skyPointer,r=this.quadPointer;if(pc.drawQuadWithShader(t,this.skyRt[s],this.texShader,null,this.rect[r]),this.quadPointer=(this.quadPointer+1)%(this.numQuads*this.numQuads),0===this.quadPointer){var a=this.prevSkyPointer,i=this.skyPointer;this.prevSkyPointer=this.skyPointer,this.skyPointer=(this.skyPointer+1)%3,this.constSky1.setValue(this.skyRt[a].colorBuffer),this.constSky2.setValue(this.skyRt[i].colorBuffer),this.skyBlend=0,this.shaderSkyBlend.setValue(this.skyBlend),this.t+=this.numQuads*this.numQuads/60*this.speed,this.shaderTime.setValue(this.t)}pc.profileSky=pc.now()-pc.profileSky}},Sky.prototype.setQuality=function(e){this.quality=e,this.skyRt&&this.initSky()};var FlyCamera=pc.createScript("flyCamera");FlyCamera.attributes.add("speed",{type:"number",default:10}),FlyCamera.attributes.add("fastSpeed",{type:"number",default:20}),FlyCamera.attributes.add("mode",{type:"number",default:0,enum:[{Lock:0},{Drag:1}]}),FlyCamera.prototype.initialize=function(){var e=this.entity.getLocalEulerAngles();this.ex=e.x,this.ey=e.y,this.moved=!1,this.lmbDown=!1,this.app.mouse.disableContextMenu(),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this)},FlyCamera.prototype.update=function(e){this.entity.setLocalEulerAngles(this.ex,this.ey,0);var t=this.app,s=this.speed;t.keyboard.isPressed(pc.KEY_SHIFT)&&(s=this.fastSpeed),t.keyboard.isPressed(pc.KEY_UP)||t.keyboard.isPressed(pc.KEY_W)?this.entity.translateLocal(0,0,-s*e):(t.keyboard.isPressed(pc.KEY_DOWN)||t.keyboard.isPressed(pc.KEY_S))&&this.entity.translateLocal(0,0,s*e),t.keyboard.isPressed(pc.KEY_LEFT)||t.keyboard.isPressed(pc.KEY_A)?this.entity.translateLocal(-s*e,0,0):(t.keyboard.isPressed(pc.KEY_RIGHT)||t.keyboard.isPressed(pc.KEY_D))&&this.entity.translateLocal(s*e,0,0)},FlyCamera.prototype.onMouseMove=function(e){if(this.mode){if(!this.lmbDown)return}else if(!pc.Mouse.isPointerLocked())return;this.moved?(this.ex-=e.dy/5,this.ex=pc.math.clamp(this.ex,-90,90),this.ey-=e.dx/5):this.moved=!0},FlyCamera.prototype.onMouseDown=function(e){0===e.button&&(this.lmbDown=!0,this.mode||pc.Mouse.isPointerLocked()||this.app.mouse.enablePointerLock())},FlyCamera.prototype.onMouseUp=function(e){0===e.button&&(this.lmbDown=!1)};var TotalTime=pc.createScript("totalTime");TotalTime.prototype.initialize=function(){this.t=0,this.shaderTime=this.app.graphicsDevice.scope.resolve("globalTime")},TotalTime.prototype.update=function(t){this.t+=1*t,this.shaderTime.setValue(this.t)},TotalTime.prototype.swap=function(t){};var Fps=pc.createScript("fps");Fps.prototype.initialize=function(){this.app.on("ui:fpsCounter",(function(t){this.fpsCounter=t}),this),this.ticks=0,this.lastFps=0},Fps.prototype.update=function(t){this.ticks&&pc.now()-this.lastFps>1e3&&(this.fpsCounter&&(this.fpsCounter.textContent=this.ticks),this.lastFps=pc.now(),this.ticks=0),this.ticks++};var planeAW,planeBW,planeCW,planeDW,planeAV,planeBV,planeCV,planeDV,world2refl,Water=pc.createScript("water"),planePosW=new pc.Vec3,planeNormalW=new pc.Vec3,WATERQUALITY_VERYLOW=-1,WATERQUALITY_LOW=0,WATERQUALITY_MEDIUM=1,WATERQUALITY_HIGH=2,tmpView=new pc.Mat4,planePosV=new pc.Vec3,planeNormalV=new pc.Vec3,planeQ=new pc.Vec4,projInv=new pc.Mat4,planeV=new pc.Vec4;function reflectionMatrix(e,t,a,r){var i=new pc.Mat4;return i.data[0]=1-2*e*e,i.data[1]=-2*e*t,i.data[2]=-2*e*a,i.data[3]=-2*e*r,i.data[4]=-2*e*t,i.data[5]=1-2*t*t,i.data[6]=-2*t*a,i.data[7]=-2*t*r,i.data[8]=-2*e*a,i.data[9]=-2*t*a,i.data[10]=1-2*a*a,i.data[11]=-2*a*r,i.data[12]=0,i.data[13]=0,i.data[14]=0,i.data[15]=1,i.transpose(),i}function sgn(e){return e>0?1:e<0?-1:0}function customTransformFunc(e,t){var a=this.node.getPosition(),r=this.node.getRotation();e.setTRS(a,r,pc.Vec3.ONE),e.mul2(world2reflGlobal,e),e.mul2(world2refl,e)}function customProjFunc(e,t){this.camera;var a=this;if(a.projection===pc.PROJECTION_PERSPECTIVE)e.setPerspective(a.fov,a.aspectRatio,a.nearClip,a.farClip,a.horizontalFov);else{var r=a.orthoHeight,i=r*a.aspect;e.setOrtho(-i,i,-r,r,a.nearClip,a.farClip)}var s=a.node.getPosition(),l=a.node.getRotation();tmpView.setTRS(s,l,pc.Vec3.ONE).invert(),tmpView.transformPoint(planePosW,planePosV),tmpView.transformVector(planeNormalW,planeNormalV).normalize(),planeAV=planeNormalV.x,planeBV=planeNormalV.y,planeCV=planeNormalV.z,planeDV=-planePosV.dot(planeNormalV),planeV.set(planeAV,planeBV,planeCV,planeDV),projInv.copy(e).invert(),planeQ.set(sgn(planeAV),sgn(planeBV),1,1),projInv.transformVec4(planeQ,planeQ),planeV.scale(2/planeV.dot(planeQ));var n=e.data;n[2]=planeV.x-n[3],n[6]=planeV.y-n[7],n[10]=planeV.z-n[11],n[14]=planeV.w-n[15]}Water.prototype.initWater=function(){var e=this.app.graphicsDevice;this.rt&&(this.rt.colorBuffer.destroy(),this.rt.destroy());var t=pc.PIXELFORMAT_R8_G8_B8_A8;e.webgl2&&e.extTextureFloatRenderable?t=pc.PIXELFORMAT_111110F:e.extTextureHalfFloatRenderable&&e.extTextureHalfFloatLinear&&(t=pc.PIXELFORMAT_RGBA16F);var a,r=new pc.Texture(e,{width:e.width/2,height:e.height/2,format:t,mipmaps:!1});if(r.addressU=pc.ADDRESS_CLAMP_TO_EDGE,r.addressV=pc.ADDRESS_CLAMP_TO_EDGE,r.magFilter=pc.FILTER_LINEAR,r.minFilter=pc.FILTER_LINEAR,this.rt=new pc.RenderTarget(e,r,{depth:!0}),this.rtH&&(this.rtH.colorBuffer.destroy(),this.rtH.destroy(),this.rtBlur.colorBuffer.destroy(),this.rtBlur.destroy()),this.quality>WATERQUALITY_LOW){var i=new pc.Texture(e,{width:r.width/2,height:r.height,format:t,mipmaps:!1});i.addressU=pc.ADDRESS_CLAMP_TO_EDGE,i.addressV=pc.ADDRESS_CLAMP_TO_EDGE,i.magFilter=pc.FILTER_LINEAR,i.minFilter=pc.FILTER_LINEAR,this.rtH=new pc.RenderTarget(e,i,{depth:!1}),(a=new pc.Texture(e,{width:r.width/2,height:r.height/2,format:t,mipmaps:!1})).addressU=pc.ADDRESS_CLAMP_TO_EDGE,a.addressV=pc.ADDRESS_CLAMP_TO_EDGE,a.magFilter=pc.FILTER_LINEAR,a.minFilter=pc.FILTER_LINEAR,this.rtBlur=new pc.RenderTarget(e,a,{depth:!1})}e.scope.resolve("waterReflTex").setValue(r),e.scope.resolve("waterReflTexBlur").setValue(this.quality>WATERQUALITY_LOW?a:r),this.entity.model.model.meshInstances[0].material=this.material=this.quality===WATERQUALITY_HIGH?this.highMaterial:this.quality===WATERQUALITY_MEDIUM?this.mediumMaterial:this.lowMaterial,this.simpleMaterial=this.quality===WATERQUALITY_HIGH?this.simpleMaterialHigh:this.simpleMaterialLow,this.timeToUpdate=0;var s=this.app,l=pc.shaderChunks;if(this.quality===WATERQUALITY_VERYLOW){if(!this.waterTile){this.waterTile=this.app.assets.find("waterTile.png").resource,this.waterTile2=new pc.Texture(e,{width:1,height:1,format:pc.PIXELFORMAT_R8_G8_B8_A8,mipmaps:!1});var n=this.waterTile2.lock();n[0]=128,n[1]=128,n[2]=128,n[3]=128,this.waterTile2.unlock()}e.scope.resolve("waterNormalTex").setValue(this.waterTile),e.scope.resolve("waterNormalTex2").setValue(this.waterTile2),e.scope.resolve("uvOffsetAmount").setValue(-.2)}else{if(!this.normalShader){console.log("Compiling water normal 1"),this.normalShader=l.createShaderFromCode(e,l.fullscreenQuadVS,s.assets.find("waterNormalPS").resource,"waterNormal");var o=new pc.Texture(e,{width:256,height:256,format:pc.PIXELFORMAT_R8_G8_B8_A8,autoMipmap:!0});o.addressU=pc.ADDRESS_REPEAT,o.addressV=pc.ADDRESS_REPEAT,o.magFilter=pc.FILTER_LINEAR,o.minFilter=pc.FILTER_LINEAR,this.rtNormal=new pc.RenderTarget(e,o,{depth:!1})}if(e.scope.resolve("waterNormalTex").setValue(this.rtNormal.colorBuffer),!this.normalShader2){console.log("Compiling water normal 2"),this.normalShader2=l.createShaderFromCode(e,l.fullscreenQuadVS,s.assets.find("waterNormal2PS").resource,"waterNormal2");var p=new pc.Texture(e,{width:256,height:256,format:pc.PIXELFORMAT_R8_G8_B8_A8,autoMipmap:!1});p.addressU=pc.ADDRESS_REPEAT,p.addressV=pc.ADDRESS_REPEAT,p.magFilter=pc.FILTER_LINEAR,p.minFilter=pc.FILTER_LINEAR,this.rtNormal2=new pc.RenderTarget(e,p,{depth:!1})}e.scope.resolve("waterNormalTex2").setValue(this.rtNormal2.colorBuffer),e.scope.resolve("uvOffsetAmount").setValue(0)}this.cam=this.app.root.findByName("Camera").camera,this._init=!1},Water.prototype.postInitialize=function(){this.quality=void 0===this.quality?WATERQUALITY_HIGH:this.quality;var e=this.app,t=e.graphicsDevice,a=pc.shaderChunks;this.entity.model.model.meshInstances[0].drawToDepth=!1;var r=this.entity.model.model.meshInstances[0].material;r.customFragmentShader=pc.programlib.gammaCode(e.scene.gamma)+pc.programlib.tonemapCode(e.scene.toneMapping)+pc.shaderChunks.rgbmPS+pc.shaderChunks.screenDepthPS+e.assets.find("waterPS").resource,r.blendType=pc.BLEND_NORMAL,r.depthWrite=!1,r.update(),this.material=r,this.skyTex=t.scope.resolve("waterSkyTexture"),t.scope.resolve("waterHeight").setValue(.01),this.highMaterial=r,this.mediumMaterial=r.clone(),this.mediumMaterial.customFragmentShader="#define NOAA\n"+r.customFragmentShader,this.lowMaterial=this.mediumMaterial,this.simpleMaterialHigh=r.clone(),this.simpleMaterialHigh.customFragmentShader="#define SIMPLE\n"+r.customFragmentShader,this.simpleMaterialLow=r.clone(),this.simpleMaterialLow.customFragmentShader="#define SIMPLE\n#define NOAA\n"+r.customFragmentShader,this.app.graphicsDevice.on("resizecanvas",this.initWater,this),this.initWater();var i=this.rt.colorBuffer;this.blurShader=a.createShaderFromCode(t,a.fullscreenQuadVS,e.assets.find("blurPS").resource,"waterBlur"),this.constantSource=t.scope.resolve("source"),this.constantOffset=t.scope.resolve("pixelOffset"),this.pixelOffsetH=new pc.Vec2(1.5/i.width,0),this.pixelOffsetV=new pc.Vec2(0,1.5/i.height),world2refl=reflectionMatrix(planeAW=0,planeBW=-1,planeCW=0,planeDW=0),planeDW=-.1,planePosW.set(planeAW*planeDW,planeBW*planeDW,planeCW*planeDW),planeNormalW.set(planeAW,planeBW,planeCW),this._init=!0,this.init=!1,pc.water=this;var s=this.cam,l=this,n=this.app.scene.layers,o=n.getLayerByName("WaterReflectionZPrepass"),p=n.getLayerByName("WaterReflection"),c=n.getLayerByName("WaterReflectionOuterGlass");o.renderTarget=c.renderTarget=p.renderTarget=this.rt,o.onPreRender=o.onPreCull=p.onPreRender=p.onPreCull=c.onPreRender=c.onPreCull=function(){s.calculateTransform=customTransformFunc,s.calculateProjection=customProjFunc,s.cullFaces=!1,l.app.renderer.updateCameraFrustum(s.camera)},o.onPostCull=p.onPostCull=c.onPostCull=function(){s.calculateTransform=null,s.calculateProjection=null,s.cullFaces=!0,l.app.renderer.updateCameraFrustum(s.camera)},c.onPostRender=function(){s.calculateTransform=null,s.calculateProjection=null,s.cullFaces=!0,l.app.renderer.updateCameraFrustum(s.camera),l.quality>WATERQUALITY_LOW&&(l.constantSource.setValue(l.rt.colorBuffer),l.constantOffset.setValue(l.pixelOffsetH.data),pc.drawQuadWithShader(t,l.rtH,l.blurShader),l.constantSource.setValue(l.rtH.colorBuffer),l.constantOffset.setValue(l.pixelOffsetV.data),pc.drawQuadWithShader(t,l.rtBlur,l.blurShader))},this.app.scene.on("set:skybox",(function(){p.addMeshInstances(l.app.scene.skyboxModel.meshInstances)}));var h=n.getLayerByName("Depth");h&&h.incrementCounter()},Water.prototype.update=function(e){if(this._init){var t=this.app.graphicsDevice,a=pc.now();this.quality>WATERQUALITY_VERYLOW&&a>this.timeToUpdate&&(pc.drawQuadWithShader(t,this.rtNormal,this.normalShader),pc.drawQuadWithShader(t,this.rtNormal2,this.normalShader2),this.quality<WATERQUALITY_HIGH&&(this.timeToUpdate=a+(this.quality===WATERQUALITY_MEDIUM?1e3/30:50)))}else this.postInitialize()},Water.prototype.setQuality=function(e){this.quality=e,this.rt&&this.initWater()};var Postprocess=pc.createScript("postprocess");Postprocess.attributes.add("shaderPS",{type:"asset",assetType:"shader"});var HDRFORMAT=pc.PIXELFORMAT_111110F;Postprocess.prototype.initRT=function(){this.app.graphicsDevice;this.rt&&this.rt.destroy(),this.rt=new pc.RenderTarget({samples:this.aa,colorBuffer:this.tex,depthBuffer:this.texD,autoResolve:!1}),this.rt_copy&&this.rt_copy.destroy(),this.aa<=1&&(this.rt_copy=new pc.RenderTarget({samples:this.aa,colorBuffer:null,depthBuffer:this.texD_copy,autoResolve:!1})),this.cam.renderTarget=this.rt},Postprocess.prototype.initRTs=function(){var e=this.app.graphicsDevice;this.tex&&this.tex.destroy(),this.texD&&this.texD.destroy(),this.texD_copy&&this.texD_copy.destroy();var t=e.width/e.height;t!==this.cam.aspectRatio&&(this.cam.aspectRatio=t);var s=new pc.Texture(e,{width:e.width,height:e.height,format:e.extTextureFloatRenderable?HDRFORMAT:pc.PIXELFORMAT_R8_G8_B8_A8,autoMipmap:!1});this.tex=s,s.addressU=pc.ADDRESS_CLAMP_TO_EDGE,s.addressV=pc.ADDRESS_CLAMP_TO_EDGE,s.magFilter=pc.FILTER_NEAREST,s.minFilter=pc.FILTER_NEAREST;var r=new pc.Texture(e,{width:e.width,height:e.height,format:pc.PIXELFORMAT_DEPTH,autoMipmap:!1});if(this.texD=r,r.addressU=pc.ADDRESS_CLAMP_TO_EDGE,r.addressV=pc.ADDRESS_CLAMP_TO_EDGE,r.magFilter=pc.FILTER_NEAREST,r.minFilter=pc.FILTER_NEAREST,e.scope.resolve("uScreen").setValue(s),this.aa<=1){var i=new pc.Texture(e,{width:e.width,height:e.height,format:pc.PIXELFORMAT_DEPTH,autoMipmap:!1});this.texD_copy=i,i.addressU=pc.ADDRESS_CLAMP_TO_EDGE,i.addressV=pc.ADDRESS_CLAMP_TO_EDGE,i.magFilter=pc.FILTER_NEAREST,i.minFilter=pc.FILTER_NEAREST,e.scope.resolve("uScreenDepth").setValue(i)}else e.scope.resolve("uScreenDepth").setValue(r);this.initRT()},Postprocess.prototype.initialize=function(){var e=this.app,t=e.graphicsDevice,s=pc.shaderChunks;this.aa=this.aa||4;var r=this.entity.camera;this.cam=r,this.initRTs(),this.app.graphicsDevice.on("resizecanvas",this.initRTs,this);this.tex,this.texD,this.rt;var i=pc.programlib.gammaCode(e.scene.gammaCorrection)+pc.programlib.tonemapCode(e.scene.toneMapping)+this.shaderPS.resource,a=s.createShaderFromCode(t,s.fullscreenQuadVS,i,"postprocess"),p=this,o=new pc.Command(pc.LAYER_WORLD,pc.BLEND_NORMAL,function(){t.renderTarget._samples>1?t.renderTarget.resolve(!1,!0):p.rt_copy&&p.rt_copy.copy(t.renderTarget,!1,!0)}.bind(this));e.scene.drawCalls.push(o),this.commandD=o;var c=new pc.Command(pc.LAYER_FX,pc.BLEND_NONE,function(){t.renderTarget._samples>1&&t.renderTarget.resolve(!0,!1),p.constExposure.setValue(p.exposure),pc.drawQuadWithShader(t,null,a)}.bind(this));e.scene.drawCalls.push(c),this.command=c,pc.shaderr=a,this.exposure=1,this.constExposure=t.scope.resolve("exposure")},Postprocess.prototype.setEnabledColor=function(e){e?this.rt&&(this.cam.renderTarget=this.rt,this.app.scene.drawCalls.push(this.command)):(this.cam.renderTarget=null,index=this.app.scene.drawCalls.indexOf(this.command),-1!==index&&this.app.scene.drawCalls.splice(index,1))},Postprocess.prototype.setEnabledDepth=function(e){e?this.rt&&(this.rt._resolveDepth=!0,this.app.scene.drawCalls.push(this.commandD)):(this.rt._resolveDepth=!1,index=this.app.scene.drawCalls.indexOf(this.commandD),-1!==index&&this.app.scene.drawCalls.splice(index,1))},Postprocess.prototype.setAA=function(e){this.aa=e>1?e:1,this.rt&&this.initRTs()},Postprocess.prototype.update=function(e){this.exposure=this.app.scene.exposure};var SpecularAa=pc.createScript("specularAa");SpecularAa.prototype.initialize=function(){var a=this.entity.model.model.meshInstances[0].material;a.specularAntialias=!1,a.update()},SpecularAa.prototype.update=function(a){};var SetLayer=pc.createScript("setLayer");SetLayer.attributes.add("layer",{type:"number",default:15}),SetLayer.prototype.initialize=function(){if(this.entity.model&&this.entity.model.model)for(var e=this.entity.model.model.meshInstances,t=0;t<e.length;t++)e[t].layer=this.layer},SetLayer.prototype.update=function(e){};var PatchCubemap=pc.createScript("patchCubemap");PatchCubemap.prototype.initialize=function(){pc._patchCubemap||(pc._patchCubemap=[]),pc._patchCubemap.push(this.entity.model.model.meshInstances[0].material)},PatchCubemap.prototype.update=function(p){};var OpacityFresnel=pc.createScript("opacityFresnel");OpacityFresnel.prototype.initialize=function(){this.entity.model.model.meshInstances[0].material.update()};var Controller=pc.createScript("controller");Controller.attributes.add("collision",{type:"boolean"});var CHAR_IDLE=0,CHAR_WALK=1,CHAR_START=2,CHAR_LTURN=3;Controller.prototype.initialize=function(){this.speed=1.5,this.rotSpeed=.25;this.minDist=-.1,this.maxDist=-.099,this.xoffset=0,this.maxYoffset=.15,this.minYoffset=.15;var t=this.app,s=this.entity;this.charVis=t.root.findByName("char");var i=t.root.findByName("Camera"),e=new pc.GraphNode;e.setLocalEulerAngles(0,180+s.getEulerAngles().y,0),e.setLocalPosition(s.getPosition().x,.5+.832+s.getPosition().y,s.getPosition().z);var a=new pc.GraphNode;e.addChild(a),a.setLocalPosition(this.xoffset,0,this.maxDist),this.dist=this.maxDist,i.setPosition(a.getPosition()),i.setRotation(a.getRotation()),this.pivot=e,this.camPoint=a,this.camNode=i,this.tmpVec=new pc.Vec3,this.moveVec=new pc.Vec3,this.tmpQuat=new pc.Quat;var o=t.root.findByName("navmesh").model.model.meshInstances[0];this.navmesh=o.mesh;for(var n,h=this.navmesh.vertexBuffer,r=h.format.elements,c=(h.numVertices,h.format.size),d=0;d<r.length;d++)r[d].name===pc.SEMANTIC_POSITION&&(n=r[d].offset);var p=new Float32Array(h.storage),l=n/4,m=c/4,u=this.navmesh.indexBuffer[0],P=u.storage;1===u.bytesPerIndex?P=new Uint8Array(P):2===u.bytesPerIndex?P=new Uint16Array(P):4===u.bytesPerIndex&&(P=new Uint32Array(P));var v=P.length/3;this.navVb=p,this.navVertSizeF=m,this.navOffsetPF=l,this.navIb=P,this.navTris=v,this.navVec=[new pc.Vec3,new pc.Vec3,new pc.Vec3,new pc.Vec3,new pc.Vec3,new pc.Vec3,new pc.Vec3,new pc.Vec3,new pc.Vec3,new pc.Vec3],this.navTransform=o.node.getWorldTransform(),this.navInvTransform=this.navTransform.clone().invert(),t.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),t.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),t.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.lmbDown=!1,this.state=CHAR_IDLE,this.anims=["chartest_idle_full.json","chartest_nomove_cloth.json","chartest_turn180L.json","chartest_leftturn.json"],this.stateStart=0,this.stateStartDist=this.maxDist,this.tmpRot=new pc.Quat,this.yaw=0,this.pitch=0,this.persistentPos=new pc.Vec3,this.persistentQuat=new pc.Quat,pc.charController=this,this.lockControls=!1,this.lockCamera=!1,this.navClosestPos(this.tmpVec,this.entity.getPosition()),this.entity.setPosition(this.tmpVec),this.cinematic=!0,this.currentPath=null,this.currentPathTarget=null,this.paths=this.app.root.findByTag("camera-path"),this.pathInd=0,this.pathTime=0,this.paths.length&&(this.currentPath=this.paths[0],this.currentPathTarget=this.currentPath.children[0])},Controller.prototype.onMouseMove=function(t){if(!this.cinematic&&pc.Mouse.isPointerLocked()&&!this.lockControls){this.entity,this.camNode;this.pivot.rotateLocal(0,-t.dx*this.rotSpeed,0),this.pitch+=-t.dy*this.rotSpeed,this.pitch=pc.math.clamp(this.pitch,-89,89),this.camPoint.setLocalEulerAngles(this.pitch,0,0)}},Controller.prototype.onMouseDown=function(t){this.cinematic||0!==t.button||(this.lmbDown=!0,pc.Mouse.isPointerLocked()||this.app.mouse.enablePointerLock())},Controller.prototype.onMouseUp=function(t){this.cinematic||0!==t.button||(this.lmbDown=!1)},Controller.prototype.triClosestPos=function(t,s,i,e,a){var o,n,h,r,c,d,p,l,m,u,P,v,f=this.navVec[3],y=this.navVec[4],V=this.navVec[5],g=this.navVec[6],C=this.navVec[7];if(f.sub2(e,i),y.sub2(a,i),V.sub2(s,i),o=f.dot(V),n=y.dot(V),o<=0&&n<=0)t.copy(i);else if(g.sub2(s,e),h=f.dot(g),r=y.dot(g),h>=0&&r<=h)t.copy(e);else{if((c=o*r-h*n)<=0&&o>=0&&h<=0)return d=o/(o-h),t.data[0]=i.data[0]+d*f.data[0],t.data[1]=i.data[1]+d*f.data[1],void(t.data[2]=i.data[2]+d*f.data[2]);if(C.sub2(s,a),p=f.dot(C),(l=y.dot(C))>=0&&p<=l)t.copy(a);else{if((m=p*n-o*l)<=0&&n>=0&&l<=0)return d=n/(n-l),t.data[0]=i.data[0]+d*y.data[0],t.data[1]=i.data[1]+d*y.data[1],void(t.data[2]=i.data[2]+d*y.data[2]);if((u=h*l-p*r)<=0&&r-h>=0&&p-l>=0)return d=(r-h)/(r-h+(p-l)),t.data[0]=e.data[0]+d*(a.data[0]-e.data[0]),t.data[1]=e.data[1]+d*(a.data[1]-e.data[1]),void(t.data[2]=e.data[2]+d*(a.data[2]-e.data[2]));d=m*(P=1/(u+m+c)),v=c*P,t.data[0]=i.data[0]+f.data[0]*d+y.data[0]*v,t.data[1]=i.data[1]+f.data[1]*d+y.data[1]*v,t.data[2]=i.data[2]+f.data[2]*d+y.data[2]*v}}},Controller.prototype.navClosestPos=function(t,s){var i,e=this.navTris,a=this.navIb,o=this.navVb,n=this.navVertSizeF,h=this.navOffsetPF,r=this.navVec[0],c=this.navVec[1],d=this.navVec[2],p=this.navVec[8],l=this.navVec[9],m=Number.MAX_VALUE;this.navInvTransform.transformPoint(s,l);for(var u=0;u<e;u++)i=a[3*u],r.data[0]=o[i*n+h],r.data[1]=o[i*n+h+1],r.data[2]=o[i*n+h+2],i=a[3*u+1],c.data[0]=o[i*n+h],c.data[1]=o[i*n+h+1],c.data[2]=o[i*n+h+2],i=a[3*u+2],d.data[0]=o[i*n+h],d.data[1]=o[i*n+h+1],d.data[2]=o[i*n+h+2],this.triClosestPos(p,l,r,c,d),dist=r.sub2(l,p).lengthSq(),dist<m&&(m=dist,t.copy(p));this.navTransform.transformPoint(t,t)},Controller.prototype.updateCamera=function(t){var s=this.camPoint,i=this.camNode;i.setPosition(s.getPosition()),i.setRotation(s.getRotation())},Controller.prototype.update=function(t){var s=this.app,i=this.pivot,e=this.camPoint,a=this.camNode,o=this.entity,n=this.charVis,h=this.moveVec,r=this.tmpVec,c=!1;if(this.cinematic){this.pathTime+=t,this.pathTime>=8&&(this.pathInd=(this.pathInd+1)%this.paths.length,this.currentPath=this.paths[this.pathInd],this.currentPathTarget=this.currentPath.children[0],this.pathTime=0);var d=this.pathTime/8;return this.tmpVec.lerp(this.currentPath.getPosition(),this.currentPathTarget.getPosition(),d),this.tmpQuat.slerp(this.currentPath.getRotation(),this.currentPathTarget.getRotation(),d),this.camNode.setPosition(this.tmpVec),void this.camNode.setRotation(this.tmpQuat)}h.set(0,0,0),this.lockControls||(s.keyboard.isPressed(pc.KEY_W)||s.keyboard.isPressed(pc.KEY_UP)?(h.add(a.forward),c=!0):(s.keyboard.isPressed(pc.KEY_S)||s.keyboard.isPressed(pc.KEY_DOWN))&&(h.sub(a.forward),c=!0),s.keyboard.isPressed(pc.KEY_A)||s.keyboard.isPressed(pc.KEY_LEFT)?(h.sub(a.right),c=!0):(s.keyboard.isPressed(pc.KEY_D)||s.keyboard.isPressed(pc.KEY_RIGHT))&&(h.add(a.right),c=!0),h.y=0,h.normalize().scale(1.45),s.keyboard.isPressed(pc.KEY_SHIFT)&&h.scale(1.5*(this.collision?1:2)));var p,l=c?CHAR_WALK:CHAR_IDLE;if(this.state!==l&&(this.stateStart=pc.now(),this.stateStartDist=this.dist,n.animation.play(this.anims[l],.3),this.state=l),l!==CHAR_START&&l!==CHAR_WALK||(this.tmpRot.copy(o.getRotation()),o.setRotation(i.getRotation()),o.rotate(0,180,0),this.tmpRot.slerp(this.tmpRot,o.getRotation(),10*t),o.setRotation(this.tmpRot)),l===CHAR_WALK){var m=1-n.animation.data.blendTimeRemaining/.3;m*=m,o.translate(h.scale(this.speed*t*m)),this.collision&&(this.navClosestPos(r,o.getPosition()),o.setPosition(r)),p=(pc.now()-this.stateStart)/5e3,p-=1-(this.stateStartDist-this.minDist)/this.maxDist,this.dist=pc.math.lerp(this.stateStartDist,this.minDist,p)}else this.dist=pc.math.lerp(this.dist,this.maxDist,.25*t);var u=1-(this.dist-this.minDist)/(this.maxDist-this.minDist),P=pc.math.lerp(this.minYoffset,this.maxYoffset,u);e.setLocalPosition(this.xoffset,P,this.dist),i.setLocalPosition(o.getPosition().x,.5+.832+o.getPosition().y,o.getPosition().z),this.lockCamera||(a.setPosition(e.getPosition()),a.setRotation(e.getRotation())),this.persistentPos.copy(o.getPosition()),world2reflGlobal.transformPoint(this.persistentPos,this.persistentPos),this.persistentQuat.copy(o.getRotation()),this.persistentQuat.mul2(world2reflGlobalQuat,this.persistentQuat),n.setPosition(this.persistentPos),n.setRotation(this.persistentQuat)},Controller.prototype.idle=function(){this.charVis.animation.play(this.anims[CHAR_IDLE],.3)};var RecordShaders=pc.createScript("recordShaders");RecordShaders.prototype.initialize=function(){this.ext=this.app.graphicsDevice.gl.getExtension("WEBGL_debug_shaders")},RecordShaders.prototype.download=function(e,t){var r=document.createElement("a");r.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),r.setAttribute("download",e),r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r)},RecordShaders.prototype.update=function(e){if(this.app.keyboard.wasPressed(pc.KEY_TAB)){var t="",r=pc.app.graphicsDevice.programLib._cache;for(var a in r)if(r.hasOwnProperty(a)){var o=r[a].definition;if(o.transformFeedback)continue;var d=o.vshader,i=o.fshader,n=o.attributes;for(var s in t+="^SH^",t+=a,t+="^VS^",t+=d,t+="^PS^",t+=i,t+="^AT^",n)n.hasOwnProperty(s)&&(t+=s,t+=",",t+=n[s],t+=",")}this.download("shaders.txt",t)}};var LoadShaders=pc.createScript("loadShaders");LoadShaders.attributes.add("cache",{type:"asset",assetType:"text"}),LoadShaders.prototype.initialize=function(){for(var e=this.app.graphicsDevice,a=e.programLib._cache,t=this.cache.resource.split("^SH^"),r=1;r<t.length;r++){var s=t[r],i=s.indexOf("^VS^"),d=s.indexOf("^PS^"),h=s.indexOf("^AT^"),n=s.substring(0,i);if(!a[n]){for(var p=s.substring(i+4,d),c=s.substring(d+4,h),o=s.substring(h+4,s.length).split(","),S={},u=0;u<o.length-1;u+=2)S[o[u]]=o[u+1];var f={vshader:p,fshader:c,attributes:S};a[n]=new pc.Shader(e,f),e.setShader(a[n])}}},LoadShaders.prototype.update=function(e){};var ObjExportLib=pc.createScript("objExportLib");function convertToObj(e){var t,n,r,o,a,i,f=new pc.Vec3,d=1,s="";for(t=0;t<e.length;t++){if(e[t].model){var c=e[t].model.model.meshInstances;for(n=0;n<c.length;n++){var m,p,l,b=c[n].mesh,u=b.vertexBuffer,v=u.format.elements,y=u.numVertices,x=u.format.size;for(r=0;r<v.length;r++)v[r].name===pc.SEMANTIC_POSITION?m=v[r].offset:v[r].name===pc.SEMANTIC_NORMAL?p=v[r].offset:v[r].name===pc.SEMANTIC_TEXCOORD1&&(l=v[r].offset);var h=new Float32Array(u.storage),A=m/4,I=p/4,O=l/4,E=x/4,T=b.indexBuffer[0],g=T.storage;1===T.bytesPerIndex?g=new Uint8Array(g):2===T.bytesPerIndex?g=new Uint16Array(g):4===T.bytesPerIndex&&(g=new Uint32Array(g));var w=b.primitive[0].base,C=b.primitive[0].count/3,j=c[n].node.getWorldTransform();for(s+="g "+e[t].name+"_"+c[n].node.name+"_"+t+"_"+n+"\n",r=0;r<y;r++)f.set(h[r*E+A],h[r*E+A+1],h[r*E+A+2]),j.transformPoint(f,f),s+="v "+f.x+" "+f.y+" "+f.z+"\n";for(r=0;r<y;r++)f.set(h[r*E+I],h[r*E+I+1],h[r*E+I+2]),j.transformVector(f,f).normalize(),s+="vn "+f.x+" "+f.y+" "+f.z+"\n";for(r=0;r<y;r++)s+="vt "+h[r*E+O]+" "+h[r*E+O+1]+"\n";for(r=0;r<C;r++)s+="f "+(o=g[3*r+w]+d)+"/"+o+"/"+o+" "+(a=g[3*r+1+w]+d)+"/"+a+"/"+a+" "+(i=g[3*r+2+w]+d)+"/"+i+"/"+i+"\n";d+=y}}}return s}function download(e,t){var n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),n.setAttribute("download",e),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}ObjExportLib.prototype.initialize=function(){download("test.txt",convertToObj(this.app.root.findByTag("interiors2")))},ObjExportLib.prototype.update=function(e){};var ChangeCamera=pc.createScript("changeCamera");ChangeCamera.prototype.initialize=function(){this.char=this.app.root.findByName("char").script.controller,this.mouselook=this.app.root.findByName("Camera").script.flyCamera,this.state=!0},ChangeCamera.prototype.update=function(a){};var LeavesParticle=pc.createScript("leavesParticle"),LEAVESQUALITY_LOW=0,LEAVESQUALITY_MEDIUM=1,LEAVESQUALITY_HIGH=2;LeavesParticle.attributes.add("shadowedLightName",{type:"string",default:""}),LeavesParticle.attributes.add("collisionTag",{type:"string",default:""}),LeavesParticle.attributes.add("spawnSphere",{type:"string",default:""}),LeavesParticle.attributes.add("textureDiffuse",{type:"asset",assetType:"texture"}),LeavesParticle.attributes.add("textureOpacity",{type:"asset",assetType:"texture"}),LeavesParticle.prototype.initShader=function(){var t=pc.shaderChunks,e=this.app,s=e.graphicsDevice,a=e.assets.find("leavesPS").resource,i="leaves";""!==this.shadowedLightName&&(this.shadowQuality===LEAVESQUALITY_HIGH?(a="#define SHADOWEDLIGHT\n"+a,i+="Shadowed"):this.shadowQuality===LEAVESQUALITY_MEDIUM?(a="#define SHADOWEDLIGHT\n#define VSM\n"+a,i+="ShadowedVSM"):(a="#define LIGHT\n"+a,i+="Light")),this.mat.clearVariants();var h=e.assets.find("leavesVS").resource;this.mat.setShader(t.createShaderFromCode(s,h,a,i))},LeavesParticle.prototype.initialize=function(){var t,e,s,a=[],i=[],h=[],r=[],o=[],c=this.app,p=c.scene.layers;void 0===this.quality&&(this.quality=LEAVESQUALITY_HIGH);var n=0;this.vortexPos=new pc.Vec3,this.oldVortexPos=new pc.Vec3,this.calcVortexPos(),this.oldVortexPos.copy(this.vortexPos);var l=c.graphicsDevice;for(t=0;t<1024;t++){var d=Math.random(),u=Math.random()*Math.PI,y=8*(2*Math.random()-1),m=8*(2*Math.random()-1);for(s=0;s<5;s++){var L=s/4,P=pc.math.lerp(-.5,.5,L);for(e=0;e<2;e++){var g=e/1,v=pc.math.lerp(-.5,.5,g);a.push(v),a.push(P),a.push(0),i.push(y),i.push(.01),i.push(m),h.push(0),h.push(0),r.push(u),r.push(d)}}for(s=0;s<4;s++)for(e=0;e<1;e++){var V=e+2*s,E=(V+=n)+1,_=V+2,f=_+1;o.push(V),o.push(E),o.push(f),o.push(f),o.push(_),o.push(V)}n+=10}var C=pc.createMesh(l,a,{normals:i,uvs:h,uvs1:r,indices:o}),w=(pc.shaderChunks,new pc.Material);w.alphaWrite=!1,w.alphaToCoverage=!0,w.depthWrite=!0,w.cull=pc.CULLFACE_NONE,this.mat=w,void 0===this.shadowQuality&&(this.shadowQuality=LEAVESQUALITY_HIGH),this.initShader();var S=new pc.MeshInstance(this.entity,C,w);if(S.cull=!1,this.instance=S,""!==this.shadowedLightName){var A=this.app.root.findByName(this.shadowedLightName),T=A.light,M=A.getPosition(),I=T.light._linearFinalColor,x=T.range,D=T.light._direction;A.getWorldTransform().getY(D).scale(-1).normalize();var O=T.light._innerConeAngleCos,H=T.light._outerConeAngleCos,b=new pc.Vec4(M.x,M.y,M.z,x),R=new pc.Vec4(D.x,D.y,D.z,O),N=new pc.Vec4(I.x,I.y,I.z,H);this.colorOuter=N,S.setParameter("light_posRadius",b.data),S.setParameter("light_directionInner",R.data),S.setParameter("light_colorOuter",N.data),this.light=T}if(p.getLayerById(pc.LAYERID_WORLD).addMeshInstances([S]),p.getLayerByName("MirrorWorld").addMeshInstances([S]),this.sposr=new pc.Vec4(-100,-100,-100,-1),""!==this.spawnSphere){var Q=this.app.root.findByName(this.spawnSphere),B=Q.getPosition(),F=.5*Q.getLocalScale().x;this.sposr.set(B.x,B.y,B.z,F)}this.constSph=l.scope.resolve("spawnSphere"),l.webgl2&&(this.tf=new pc.TransformFeedback(C.vertexBuffer),this.shader=pc.shaderChunks.createShaderFromCode(c.graphicsDevice,c.assets.find("tf_leaves").resource,pc.shaderChunks.dummyPS,"tf_leaves",!0));var U=c.assets.find("leavesVS").resource;l.webgl2&&(U="#define GL2\n"+U);var z=pc.shaderChunks.createShaderFromCode(l,U,c.assets.find("leavesTopPS").resource,"leavesTop"),W=new pc.Material;W.alphaWrite=!0,W.blend=!0,W.blendType=pc.BLEND_ADDITIVE,W.separateAlphaBlend=!0,W.blendSrcAlpha=pc.BLENDMODE_ONE,W.blendDstAlpha=pc.BLENDMODE_ZERO,W.blendAlphaEquation=pc.BLENDEQUATION_MAX,W.depthWrite=!1,W.cull=pc.CULLFACE_NONE,W.setShader(z),this.mat2=W;var G=new pc.MeshInstance(this.entity,C,W);G.cull=!1;var Y=new pc.Texture(l,{width:256,height:256,format:pc.PIXELFORMAT_R8_G8_B8_A8,mipmaps:!1});Y.addressU=pc.ADDRESS_CLAMP_TO_EDGE,Y.addressV=pc.ADDRESS_CLAMP_TO_EDGE,Y.magFilter=pc.FILTER_LINEAR,Y.minFilter=pc.FILTER_LINEAR,this.rt=new pc.RenderTarget(l,Y,{depth:!1}),this.radius=8;var q=this.entity.getPosition(),k=new pc.Entity;k.addComponent("camera"),this.topCam=k.camera,this.topCam.projection=pc.PROJECTION_ORTHOGRAPHIC,this.topCam.nearClip=0,this.topCam.farClip=1e3,this.topCam.orthoHeight=16,this.topCam.frustumCulling=!1,this.topCam.clearColor=new pc.Color(0,0,0,0),this.topCam.clearColorBuffer=!0,this.topCam.clearDepthBuffer=!1,this.topCam.clearStencilBuffer=!1,k.setPosition(q.x,100,q.z),k.setEulerAngles(-90,0,0);var X=k.clone();this.topCamH=X.camera,this.topCamH.clearColor=new pc.Color(254/255,254/255,254/255,254/255),this.topCamH.clearDepthBuffer=!0,this.topComp=new pc.LayerComposition,this.topLayer=new pc.Layer({name:"LeavesTopPass"}),this.topLayer.opaqueSortMode=pc.SORTMODE_NONE,this.topLayer.renderTarget=this.rt,this.topLayer.simple=!0,this.topLayer.addMeshInstances([G]),this.topLayer.addCamera(this.topCam),this.topComp.pushTransparent(this.topLayer);var j=new pc.Texture(l,{width:256,height:256,format:pc.PIXELFORMAT_R8_G8_B8_A8,mipmaps:!1});j.addressU=pc.ADDRESS_CLAMP_TO_EDGE,j.addressV=pc.ADDRESS_CLAMP_TO_EDGE,j.magFilter=pc.FILTER_LINEAR,j.minFilter=pc.FILTER_LINEAR,this.rtH=new pc.RenderTarget(l,j,{depth:!0}),this.heightComp=new pc.LayerComposition,this.heightLayer=new pc.Layer({name:"LeavesHeightmap"}),this.heightLayer.renderTarget=this.rtH,this.heightLayer.shaderPass=pc.SHADER_DEPTH,this.heightLayer.addCamera(this.topCamH),newLayers=this.topCamH.layers,newLayers.push(this.heightLayer.id),newLayers.push(this.topLayer.id),this.topCamH.layers=newLayers;var J,Z,K=c.root.findByTag(this.collisionTag),$=[];for(t=0;t<K.length;t++)for(J=K[t].model.meshInstances,Z=0;Z<J.length;Z++)$.push(J[Z]);this.heightLayer.addMeshInstances($),this.heightComp.pushOpaque(this.heightLayer),w.setParameter("diffuseMap",this.textureDiffuse.resource),w.setParameter("topMap",Y),w.setParameter("opacityMap",this.textureOpacity.resource),W.setParameter("opacityMap",this.textureOpacity.resource),w.setParameter("sceneHeightmap",j),W.setParameter("sceneHeightmap",j),this.needsPostInit=!0},LeavesParticle.prototype._postInitialize=function(){var t=this.app,e=t.graphicsDevice;this.mat,this.mat2;t.renderer.renderComposition(this.heightComp),this.char=t.root.findByName("charController"),this.charPrevPos=new pc.Vec3,this.charPrevPos.copy(this.char.getPosition()),this.charVelocity=new pc.Vec3,this.charSmoothVelocity=new pc.Vec3,this.charForwardPos=new pc.Vec3,this.constVortexPos=e.scope.resolve("vortexPos"),this.constOldVortexPos=e.scope.resolve("oldVortexPos"),this.constTopMap=e.scope.resolve("topMap"),this.constHeightmap=e.scope.resolve("sceneHeightmap"),this.constPlayerPos=e.scope.resolve("playerPos"),this.constPlayerVel=e.scope.resolve("playerVel"),this.constDeltaTime=e.scope.resolve("deltaTime"),this.mat.setParameter("cubeMap",t.scene._skyboxPrefiltered4),this.init=!1,this.initPos=!1},LeavesParticle.prototype.calcVortexPos=function(){var t=pc.now()/100;t/=this.radius/4,this.vortexPos.x=3*Math.sin(.05*t)*(this.radius/4),this.vortexPos.y=Math.abs(25*Math.sin(.06*t))+5,this.vortexPos.z=3*Math.sin(.04*t)*(this.radius/4)},LeavesParticle.prototype.update=function(t){if(this.quality===LEAVESQUALITY_LOW&&(this.instance.visible=!1),this._init){1===this._init&&(this._postInitialize(),this._init=2);var e=this.app,s=e.graphicsDevice;this.init=!1,this.init||(""!==this.shadowedLightName&&(this.shadowQuality!==LEAVESQUALITY_LOW?this.light.light._shadowCamera&&(this.light.shadowType===pc.SHADOW_PCF5?this.instance.setParameter("light_shadowMap",this.light.light._shadowCamera.renderTarget.depthBuffer):this.instance.setParameter("light_shadowMap",this.light.light._shadowCamera.renderTarget.colorBuffer),this.instance.setParameter("light_shadowMatrix",this.light.light._shadowMatrix.data)):(this.instance.setParameter("light_shadowMap",null),this.instance.setParameter("light_shadowMatrix",null))),this.init=!0),this.calcVortexPos(),this.oldVortexPos.lerp(this.oldVortexPos,this.vortexPos,.5*t),e.scene._activeCamera&&(this.charVelocity.copy(this.char.getPosition()).sub(this.charPrevPos),this.charVelocity.y=1.125*this.charVelocity.length(),this.charSmoothVelocity.scale(1-t),this.charSmoothVelocity.x=Math.abs(this.charSmoothVelocity.x)>Math.abs(this.charVelocity.x)?this.charSmoothVelocity.x:this.charVelocity.x,this.charSmoothVelocity.y=Math.abs(this.charSmoothVelocity.y)>Math.abs(this.charVelocity.y)?this.charSmoothVelocity.y:this.charVelocity.y,this.charSmoothVelocity.z=Math.abs(this.charSmoothVelocity.z)>Math.abs(this.charVelocity.z)?this.charSmoothVelocity.z:this.charVelocity.z,this.charForwardPos.copy(this.charSmoothVelocity).normalize().scale(2.25).add(this.char.position).sub(this.entity.getPosition()),this.constPlayerPos.setValue(this.charForwardPos.data),this.constPlayerVel.setValue(this.charSmoothVelocity.data),this.charPrevPos.copy(this.char.position),s.webgl2&&(this.quality>LEAVESQUALITY_LOW||!this.initPos)&&(this.constVortexPos.setValue(this.vortexPos.data),this.mat.setParameter("vortexPos",this.vortexPos.data),this.constOldVortexPos.setValue(this.oldVortexPos.data),this.constTopMap.setValue(this.rt.colorBuffer),this.constHeightmap.setValue(this.rtH.colorBuffer),this.constDeltaTime.setValue(this.quality===LEAVESQUALITY_LOW?10:t),this.constSph.setValue(this.sposr.data),this.tf.process(this.shader)),(this.quality>LEAVESQUALITY_MEDIUM||!this.initPos)&&(this.app.renderer.renderComposition(this.topComp),this.initPos=!0))}else this._init=1},LeavesParticle.prototype.setQuality=function(t){this.quality!==t&&(this.quality=t,t===LEAVESQUALITY_LOW&&this.instance&&(this.instance.visible=!1))},LeavesParticle.prototype.setShadowQuality=function(t){this.shadowQuality!==t&&(this.shadowQuality=t,this.mat&&this.initShader())},LeavesParticle.prototype.updateLightColor=function(){var t=this.light.light._linearFinalColor;this.colorOuter.x=.3*t.x,this.colorOuter.y=.3*t.y,this.colorOuter.z=.3*t.z,this.instance.setParameter("light_colorOuter",this.colorOuter.data)},LeavesParticle.prototype.swap=function(t){};var world2reflMirror,Mirror=pc.createScript("mirror");Mirror.attributes.add("interactive",{type:"boolean"}),Mirror.attributes.add("primitive",{type:"boolean"}),Mirror.attributes.add("density",{type:"number"}),Mirror.attributes.add("onlyTag",{type:"string"}),Mirror.attributes.add("shaderPS",{type:"asset",assetType:"shader"});var planePosWM,planeNormalWM,planeAV,planeBV,planeCV,planeDV,tmpView=new pc.Mat4,tmpView2=new pc.Mat4,tmpView3=new pc.Mat4,planeQ=new pc.Vec4,planeV=new pc.Vec4,planePosV=new pc.Vec3,planeNormalV=new pc.Vec3,projInv=new pc.Mat4,pointsV=[new pc.Vec4,new pc.Vec4,new pc.Vec4,new pc.Vec4],prevGlobalMatrix=new pc.Mat4,tmpQuat=new pc.Quat,mirrorLookAt=new pc.Vec3,localPlayerPos=new pc.Vec3,afterTransitionPos=new pc.Vec3,reflectedCamPos=new pc.Vec3,reflectedCamDir=new pc.Vec3,invPortalPlane=new pc.Vec3,activeMirror=null,mirrorFrustum=new pc.Frustum,tempSphereMirror={center:null,radius:0},mirrorBit=0,MAX3D_SCALE=1,MIRRORSTATE_FAR=0,MIRRORSTATE_NEAR=1,MIRRORSTATE_TOUCH=2,MIRRORSTATE_SWITCH=3,MIRRORSTATE_POST=4,MIRRORSTATE_OFF=5,mirrorTransition=0,mirrorDefaultFov=0;function reflectionMatrix(e,t,r,a){var i=new pc.Mat4;return i.data[0]=1-2*e*e,i.data[1]=-2*e*t,i.data[2]=-2*e*r,i.data[3]=-2*e*a,i.data[4]=-2*e*t,i.data[5]=1-2*t*t,i.data[6]=-2*t*r,i.data[7]=-2*t*a,i.data[8]=-2*e*r,i.data[9]=-2*t*r,i.data[10]=1-2*r*r,i.data[11]=-2*r*a,i.data[12]=0,i.data[13]=0,i.data[14]=0,i.data[15]=1,i.transpose(),i}var smoothstep=function(e){return e*e*(3-2*e)},mirrorCurve=function(e){return e};function customTransformFuncMirror(e,t){var r=this.node.getPosition(),a=this.node.getRotation();e.setTRS(r,a,pc.Vec3.ONE),e.mul2(world2reflMirror,e)}function customProjFuncMirror(e,t){if(this.projection===pc.PROJECTION_PERSPECTIVE)e.setPerspective(this.fov,this.aspectRatio,this.nearClip,this.farClip,this.horizontalFov);else{var r=this.orthoHeight,a=r*this.aspectRatio;e.setOrtho(-a,a,-r,r,this.nearClip,this.farClip)}var i=this.node.getPosition(),s=this.node.getRotation();tmpView.setTRS(i,s,pc.Vec3.ONE).invert(),tmpView.transformPoint(planePosWM,planePosV),tmpView.transformVector(planeNormalWM,planeNormalV).normalize(),planeAV=planeNormalV.x,planeBV=planeNormalV.y,planeCV=planeNormalV.z,planeDV=-planePosV.dot(planeNormalV),planeV.set(planeAV,planeBV,planeCV,planeDV),projInv.copy(e).invert(),planeQ.set(sgn(planeAV),sgn(planeBV),1,1),projInv.transformVec4(planeQ,planeQ),planeV.scale(2/planeV.dot(planeQ));var n=e.data;n[2]=planeV.x-n[3],n[6]=planeV.y-n[7],n[10]=planeV.z-n[11],n[14]=planeV.w-n[15]}function getInvViewMirror(e){var t=this._node.getPosition(),r=this._node.getRotation();e.setTRS(t,r,pc.Vec3.ONE),e.mul2(world2reflMirror,e)}function getViewPositionMirror(){var e=this._node.getPosition();return tmpView2.copy(world2reflMirror).invert(),tmpView2.transformPoint(e,reflectedViewPos),reflectedViewPos}function setStencilTestMirror(){var e=!0;if(this.stencil!==e){var t=this.gl;t.enable(t.STENCIL_TEST),this.stencil=e}this.setStencilFunc(pc.FUNC_EQUAL,mirrorBit,255),this.setStencilOperation(pc.STENCILOP_KEEP,pc.STENCILOP_KEEP,pc.STENCILOP_KEEP)}function setCullModeMirror(e){if(reflGlobalFlip||(e===pc.CULLFACE_BACK?e=pc.CULLFACE_FRONT:e===pc.CULLFACE_FRONT&&(e=pc.CULLFACE_BACK)),this.cullMode!==e){if(e===pc.CULLFACE_NONE)this.gl.disable(this.gl.CULL_FACE);else{this.cullMode===pc.CULLFACE_NONE&&this.gl.enable(this.gl.CULL_FACE);var t=this.glCull[e];this.cullFace!==t&&(this.gl.cullFace(t),this.cullFace=t)}this.cullMode=e}}function setDepthTestMirror(e){var t=this.gl;t.disable(t.DEPTH_TEST),this.depthTest=!1}function sgn(e){return e>0?1:e<0?-1:0}var pdiff1=new pc.Vec3,pdiff2=new pc.Vec3,pnormal=new pc.Vec3;function getObliqueProjectionMatrixMirror(){if(this._projection===pc.PROJECTION_PERSPECTIVE)this._projMat.setPerspective(this._fov,this._aspect,this._nearClip,this._farClip,this._horizontalFov);else{var e=this._orthoHeight,t=e*this._aspect;this._projMat.setOrtho(-t,t,-e,e,this._nearClip,this._farClip)}var r=this._node.getPosition(),a=this._node.getRotation();tmpView.setTRS(r,a,pc.Vec3.ONE).invert(),tmpView.transformPoint(planePosWM,planePosV),tmpView.transformVector(planeNormalWM,planeNormalV).normalize(),planeAV=planeNormalV.x,planeBV=planeNormalV.y,planeCV=planeNormalV.z,planeDV=-planePosV.dot(planeNormalV),planeV.set(planeAV,planeBV,planeCV,planeDV),projInv.copy(this._projMat).invert(),planeQ.set(sgn(planeAV),sgn(planeBV),1,1),projInv.transformVec4(planeQ,planeQ),planeV.scale(2/planeV.dot(planeQ));var i=this._projMat.data;return i[2]=planeV.x-i[3],i[6]=planeV.y-i[7],i[10]=planeV.z-i[11],i[14]=planeV.w-i[15],this._projMatDirty=!0,this._projMat}function isVisibleInMirror(e,t){return!!t.visible&&(meshPos=t.aabb.center,t._aabb._radiusVer!==t._aabbVer&&(t._aabb._radius=t._aabb.halfExtents.length(),t._aabb._radiusVer=t._aabbVer),tempSphereMirror.radius=t._aabb._radius,tempSphereMirror.center=meshPos,!!e.frustum.containsSphere(tempSphereMirror)&&mirrorFrustum.containsSphere(tempSphereMirror))}function frustumUpdateMirror(e,t){var r=pc.app.scene._activeCamera._node;activeMirror.world2refl.transformPoint(r.position,reflectedCamPos),activeMirror.world2refl.transformVector(r.forward,reflectedCamDir),invPortalPlane.copy(activeMirror.planeNormalW).scale(-1),activeMirror.setPortal(this,reflectedCamPos,reflectedCamDir,activeMirror.pointsW[1],activeMirror.pointsW[3],activeMirror.pointsW[2],activeMirror.pointsW[0],invPortalPlane,r._farClip)}function aabbInFrontOfPlane(e,t,r,a,i){var s=e.center.x-e.halfExtents.x,n=e.center.y-e.halfExtents.y,o=e.center.z-e.halfExtents.z,l=e.center.x+e.halfExtents.x,p=e.center.y+e.halfExtents.y,c=e.center.z+e.halfExtents.z;return s*t+n*r+o*a+i>0||(l*t+n*r+o*a+i>0||(l*t+p*r+o*a+i>0||(s*t+p*r+o*a+i>0||(s*t+n*r+c*a+i>0||(l*t+n*r+c*a+i>0||(l*t+p*r+c*a+i>0||s*t+p*r+c*a+i>0))))))}Mirror.prototype.setPortal=function(e,t,r,a,i,s,n,o,l){var p,c,h;p=i,c=n,pdiff1.sub2(p,c),pdiff2.sub2(c,t),pnormal.cross(pdiff1,pdiff2).normalize(),h=t.dot(pnormal),e.planes[0][0]=pnormal.x,e.planes[0][1]=pnormal.y,e.planes[0][2]=pnormal.z,e.planes[0][3]=-h,p=s,c=a,pdiff1.sub2(p,c),pdiff2.sub2(c,t),pnormal.cross(pdiff1,pdiff2).normalize(),h=t.dot(pnormal),e.planes[1][0]=pnormal.x,e.planes[1][1]=pnormal.y,e.planes[1][2]=pnormal.z,e.planes[1][3]=-h,p=a,c=i,pdiff1.sub2(p,c),pdiff2.sub2(c,t),pnormal.cross(pdiff1,pdiff2).normalize(),h=t.dot(pnormal),e.planes[2][0]=pnormal.x,e.planes[2][1]=pnormal.y,e.planes[2][2]=pnormal.z,e.planes[2][3]=-h,p=n,c=s,pdiff1.sub2(p,c),pdiff2.sub2(c,t),pnormal.cross(pdiff1,pdiff2).normalize(),h=t.dot(pnormal),e.planes[3][0]=pnormal.x,e.planes[3][1]=pnormal.y,e.planes[3][2]=pnormal.z,e.planes[3][3]=-h,e.planes[5][0]=o.x,e.planes[5][1]=o.y,e.planes[5][2]=o.z,e.planes[5][3]=-o.dot(n),e.planes[4][0]=r.x,e.planes[4][1]=r.y,e.planes[4][2]=r.z,e.planes[4][3]=l},Mirror.prototype.isVisible=function(e){var t,r,a,i=e.frustum,s=this.pointsW,n=e.projectionMatrix,o=e.entity.getPosition(),l=e.entity.getRotation();for(tmpView2.setTRS(o,l,pc.Vec3.ONE),i.update(n,tmpView2),r=0;r<6;r++){if(t=i.planes[r][0]*s[0].x+i.planes[r][1]*s[0].y+i.planes[r][2]*s[0].z+i.planes[r][3]<=0)for(a=1;a<4;a++)if(i.planes[r][0]*s[a].x+i.planes[r][1]*s[a].y+i.planes[r][2]*s[a].z+i.planes[r][3]>0){t=!1;break}if(t)return!1}return!0},Mirror.prototype.initialize=function(){var e,t,r,a,i=this.app,s=i.graphicsDevice;pc.shaderChunks;this.cam=i.root.findByName("Camera").camera,this.nearDist=3;var n=atf.mirrorRt;if(!n){var o=this.entity.model.model.meshInstances[0].material;o.customFragmentShader=this.shaderPS.resource,o.blendType=pc.BLEND_NORMAL,o.update(),pc.mirrorMaterial=o,pc.fallbackMirrorMaterial=o.clone(),this.setSky(localStorage.getItem("webgl2-demo.settings.skyQuality")>=0);var l=pc.PIXELFORMAT_R8_G8_B8_A8;s.webgl2&&s.extTextureFloatRenderable?l=pc.PIXELFORMAT_111110F:s.extTextureHalfFloatRenderable&&s.extTextureHalfFloatLinear&&(l=pc.PIXELFORMAT_RGBA16F);var p=new pc.Texture(s,{width:s.width,height:s.height,format:l,autoMipmap:!1});p.addressU=pc.ADDRESS_CLAMP_TO_EDGE,p.addressV=pc.ADDRESS_CLAMP_TO_EDGE,p.magFilter=pc.FILTER_LINEAR,p.minFilter=pc.FILTER_LINEAR,atf.mirrorRt=n=new pc.RenderTarget(s,p,{samples:4,depth:!0,stencil:!0}),s.scope.resolve("mirrorTex").setValue(p)}this.rt=n,this.entity.model.model.meshInstances[0].setParameter("mirrorDepthOffset",0),this.entity.model.model.meshInstances[0].setParameter("mirrorDensity",0===this.density?1:this.density);var c=this.primitive?this.entity:this.entity.children[0].children[0];this.planePosW=c.getPosition(),this.planeNormalW=c.forward,this.planeRightW=c.right,this.planeNormalWOrig=this.planeNormalW.clone(),e=this.planeNormalW.x,t=this.planeNormalW.y,r=this.planeNormalW.z,a=-this.planePosW.dot(this.planeNormalW),this.world2refl=reflectionMatrix(e,t,r,a),this.planeDW=a,this.maxXdiff=.5*c.getLocalScale().x*MAX3D_SCALE;var h,d=i.scene.drawCalls;this.dipsReflect=[],this.dipsReflect2=[];var m=this.entity.model.model.meshInstances[0].material,f=this.entity.name+"_off",u=this.onlyTag,V=void 0!==u&&""!==u&&null!==u;for(h=0;h<d.length;h++)if(d[h].node){if(d[h].material===m)continue;for(var M=d[h].node,y=!1,_=!1,g=!1;M;)M.tags&&M.tags.has(f)&&(y=!0),M.tags&&M.tags.has("DontMirror")&&(_=!0),V&&M.tags&&M.tags.has(u)&&(g=!0),M=M.getParent();d[h].node.getWorldTransform(),d[h].aabb,V?(g||d[h].command)&&this.dipsReflect.push(d[h]):(y||_||this.dipsReflect.push(d[h]),this.dipsReflect2.push(d[h]))}var v,P,w=this,addAsyncEntity=function(e){var t=e.model.asset;if(t){var r=i.assets.get(t);r&&(r.once("load",(function(){for(P=e.model.model.meshInstances,v=0;v<P.length;v++)w.dipsReflect.push(P[v]),w.dipsReflect2.push(P[v])})),i.assets.load(r))}},E=i.root.findByTag("MirrorOnly");for(h=0;h<E.length;h++)if(E[h].enabled)if(E[h].model.model)for(P=E[h].model.model.meshInstances,v=0;v<P.length;v++)this.dipsReflect.push(P[v]),this.dipsReflect2.push(P[v]);else addAsyncEntity(E[h]);for(E=i.root.findByTag(this.entity.name+"_on"),h=0;h<E.length;h++)if(E[h].enabled)for(P=E[h].model.model.meshInstances,v=0;v<P.length;v++)this.dipsReflect.push(P[v]);this.objectsOn=E,this.objectsOff=i.root.findByTag(f),this.init=!1,pc.mirrorCount?this.first=!1:(pc.mirrorCount=0,pc.mirrorsToRender=0,pc.mirrorList=[],pc.dipsMirror=[],pc.distortionNearFade=1,pc.isMirrorClose=!1,pc.mirrorsDrawn=0,this.first=!0),pc.mirrorCount++,pc.mirrorList.push(this);var C=this.entity.model.model.meshInstances[0],b=new pc.BasicMaterial;b.redWrite=!1,b.greenWrite=!1,b.blueWrite=!1,b.alphaWrite=!1,b.depthWrite=!1,b.depthTest=!1,b.stencilBack=b.stencilFront=new pc.StencilParameters({zpass:pc.STENCILOP_REPLACE,ref:pc.mirrorCount});var T=new pc.MeshInstance(C.node,C.mesh,b);pc.dipsMirror.push(T),this.bit=pc.mirrorCount,this.srect={x:0,y:0,width:1,height:1},this.pointsW=[new pc.Vec3,new pc.Vec3,new pc.Vec3,new pc.Vec3];var R=c.getLocalScale(),L=c.right,A=c.up,S=new pc.Vec3;for(this.pointsW[0].copy(L).scale(.5*R.x*MAX3D_SCALE),S.copy(A).scale(.5*R.y*MAX3D_SCALE),this.pointsW[0].add(S).add(this.planePosW),this.pointsW[1].copy(L).scale(-.5*R.x*MAX3D_SCALE),S.copy(A).scale(-.5*R.y*MAX3D_SCALE),this.pointsW[1].add(S).add(this.planePosW),this.pointsW[2].copy(L).scale(-.5*R.x*MAX3D_SCALE),S.copy(A).scale(.5*R.y*MAX3D_SCALE),this.pointsW[2].add(S).add(this.planePosW),this.pointsW[3].copy(A).scale(-.5*R.y*MAX3D_SCALE),S.copy(L).scale(.5*R.x*MAX3D_SCALE),this.pointsW[3].add(S).add(this.planePosW),this.pointsW4=[new pc.Vec4,new pc.Vec4,new pc.Vec4,new pc.Vec4],h=0;h<4;h++)this.pointsW4[h].x=this.pointsW[h].x,this.pointsW4[h].y=this.pointsW[h].y,this.pointsW4[h].z=this.pointsW[h].z,this.pointsW4[h].w=1;this.clear={flags:0},this.clearFirst={color:[1,0,0,1],depth:1,stencil:0,flags:pc.CLEARFLAG_DEPTH|pc.CLEARFLAG_STENCIL},this.state=MIRRORSTATE_FAR,this.constDist=s.scope.resolve("distortionNearFade"),this.constTrans=s.scope.resolve("mirrorTransition");var N=C.aabb.getMin().data,F=C._aabb.getMax().data,W=[new pc.Vec3,new pc.Vec3,new pc.Vec3,new pc.Vec3,new pc.Vec3,new pc.Vec3,new pc.Vec3,new pc.Vec3];W[0].set(N[0],N[1],N[2]),W[1].set(F[0],N[1],N[2]),W[2].set(F[0],F[1],N[2]),W[3].set(N[0],F[1],N[2]),W[4].set(N[0],N[1],F[2]),W[5].set(F[0],N[1],F[2]),W[6].set(F[0],F[1],F[2]),W[7].set(N[0],F[1],F[2]),this.bp=W,this.mConst=this.app.graphicsDevice.scope.resolve("world2refl");var I=this.cam,x=this.app.scene.layers,O=x.getLayerByName("MirrorZPrepass"),D=x.getLayerByName("MirrorWorld"),z=[O,D,x.getLayerByName("MirrorInnerGlass"),x.getLayerByName("MirrorThinSticks"),x.getLayerByName("MirrorOuterGlass"),x.getLayerByName("MirrorFinal")],preFunction=function(){planePosWM=w.planePosW,planeNormalWM=w.planeNormalW,world2reflMirror=w.world2refl,I.calculateTransform=customTransformFuncMirror,I.calculateProjection=customProjFuncMirror,I.flipFaces=!0,w.app.renderer.updateCameraFrustum(I.camera)},postFunction=function(){I.calculateTransform=null,I.calculateProjection=null,I.flipFaces=!1,w.app.renderer.updateCameraFrustum(I.camera)};for(h=0;h<z.length;h++)z[h].renderTarget=this.rt,z[h].onPreCull=z[h].onPreRender=preFunction,z[h].onPostCull=z[h].onPostRender=postFunction,z[h].enabled=!0;this.mirrorLayers=z,D.addMeshInstances(w.app.scene.skyboxModel.meshInstances),this.wasVisible=!0},Mirror.prototype.update=function(e){if(this._init){1===this._init&&(this.initialize(),this._init=2);var t=this.isVisible(this.cam);if(t!==this.wasVisible){for(var r=0;r<this.mirrorLayers.length;r++)this.mirrorLayers[r].enabled=t;this.wasVisible=t}}else this._init=1},Mirror.prototype.setEnabled=function(e){if(this.enabled!==e){if(this.enabled=e,this.rt)this.entity.model.model.meshInstances[0].material=e?pc.mirrorMaterial:pc.fallbackMirrorMaterial;else if(!e&&!pc.fallbackMirrorMaterial){var t=this.app.graphicsDevice,r=this.entity.model.model.meshInstances[0].material;r.blendType=pc.BLEND_NORMAL,pc.fallbackMirrorMaterial=r,this.setSky(localStorage.getItem("webgl2-demo.settings.skyQuality")>=0),t.scope.resolve("distortionNearFade").setValue(0),t.scope.resolve("mirrorTransition").setValue(0),this.entity.model.model.meshInstances[0].setParameter("mirrorDensity",0===this.density?1:this.density)}var a=this.mirrorLayers;if(a)for(var i=0;i<a.length;i++)a[i].enabled=e}},Mirror.prototype.setSky=function(e){this.skyIsOn=e,pc.fallbackMirrorMaterial&&(pc.fallbackMirrorMaterial.customFragmentShader=(e?"#define SKY\n":"")+"#define SIMPLE\n"+pc.shaderChunks.rgbmPS+this.shaderPS.resource,pc.fallbackMirrorMaterial.update())};var ReflectableWorld=pc.createScript("reflectableWorld"),world2reflGlobal=new pc.Mat4,world2reflGlobalQuat=new pc.Quat,reflectedViewPos=new pc.Vec3,reflGlobalFlip=!1;function getInvViewReflWorld(e){var l=this._node.getPosition(),t=this._node.getRotation();e.setTRS(l,t,pc.Vec3.ONE),e.mul2(world2reflGlobal,e)}function getViewPositionReflWorld(){var e=this._node.getPosition();return world2reflGlobal.transformPoint(e,reflectedViewPos),reflectedViewPos}function setCullModeReflWorld(e){if(reflGlobalFlip&&(e===pc.CULLFACE_BACK?e=pc.CULLFACE_FRONT:e===pc.CULLFACE_FRONT&&(e=pc.CULLFACE_BACK)),this.cullMode!==e){if(e===pc.CULLFACE_NONE)this.gl.disable(this.gl.CULL_FACE);else{this.cullMode===pc.CULLFACE_NONE&&this.gl.enable(this.gl.CULL_FACE);var l=this.glCull[e];this.cullFace!==l&&(this.gl.cullFace(l),this.cullFace=l)}this.cullMode=e}}ReflectableWorld.prototype.initialize=function(){this.entity.camera.camera.getInvView=getInvViewReflWorld,this.app.graphicsDevice.setCullMode=setCullModeReflWorld},ReflectableWorld.prototype.update=function(e){};var NoAlphaTest=pc.createScript("noAlphaTest");NoAlphaTest.prototype.initialize=function(){this.done=!1},NoAlphaTest.prototype.update=function(t){if(!this.done&&this.entity.model.model){this.done=!0;for(var e=this.entity.model.model.meshInstances,a=0;a<e.length;a++)e[a].material.chunks.alphaTestPS="void alphaTest(float a) {}\n",e[a].material.update()}};var Wire=pc.createScript("wire");Wire.attributes.add("radius",{type:"number",default:.02539999969303608}),Wire.attributes.add("shaderVS",{type:"asset",assetType:"shader"}),Wire.attributes.add("shaderPS",{type:"asset",assetType:"shader"}),Wire.prototype.initialize=function(){this.done=!1},Wire.prototype.update=function(){if(!this.done&&this.entity.model.model){for(var e=this.entity.model.meshInstances,t=0;t<e.length;t++)e[t].material.chunks.transformVS=this.shaderVS.resource,e[t].material.chunks.opacityConstPS=this.shaderPS.resource,e[t].material.update(),e[t].setParameter("WIRERADIUS",this.radius);this.done=!0}};var WireUpdate=pc.createScript("wireUpdate");WireUpdate.prototype.initialize=function(){this.constValue=this.app.graphicsDevice.scope.resolve("wirePixelScale")},WireUpdate.prototype.update=function(e){var t=this.app.scene._activeCamera;if(t){var a=t._fov*pc.math.DEG_TO_RAD,i=this.app.graphicsDevice.height,p=Math.tan(.5*a)/i;this.constValue.setValue(p)}};var FinalScene=pc.createScript("finalScene");FinalScene.attributes.add("matLightHouse",{type:"asset",assetType:"material"}),FinalScene.attributes.add("matLightHouse2",{type:"asset",assetType:"material"}),FinalScene.attributes.add("matLightHouse3",{type:"asset",assetType:"material"}),FinalScene.prototype.initialize=function(){this.pos=this.entity.getPosition(),this.tmp=new pc.Vec3,this.state=0,this.cam=null,this.startPos=new pc.Vec3,this.endPos=new pc.Vec3,this.endPos2=new pc.Vec3,this.startRot=new pc.Quat,this.endRot=new pc.Quat,this.percent=0,this.dtMul=1,this.finalCam1=this.app.root.findByName("finalCam1"),this.finalCam2=this.app.root.findByName("finalCam2"),this.char=this.app.root.findByName("char"),this.flyDir=this.finalCam2.forward,this.ray1obj=this.app.root.findByName("RayIslandRLighthouse1").model.model.meshInstances[0],this.ray2obj=this.app.root.findByName("RayIslandRLighthouse2").model.model.meshInstances[0],this.lightFinal=this.app.root.findByName("light_final").light,this.rayFinal=this.app.root.findByName("PlaneFinal").model.model.meshInstances[0],this.ray1obj.setParameter("material_opacity",0),this.leaves=this.app.root.findByName("leavesParticleE3").script.leavesParticle,this.ray2obj.setParameter("material_opacity",0),this.rayFinal.setParameter("material_opacity",0),this.startVolume=.125,this.prevPos=new pc.Vec3,this.motionDir=new pc.Vec3;var t=this;this.enableLight=function(){t.lightFinal.intensity=32,t.rayFinal.setParameter("material_opacity",.99),t.leaves.updateLightColor(),t.app.fire("finalScene:enableLight")};this.app.root.findByName("Camera");this.fadeToBlack=function(){t.app.fire("finalScene:fadeOut")},this.fadeAmbientIn=function(){pc.demoAmbient.enabled=!0,pc.demoAmbient.audio.play(),pc.demoAmbient.audio.volume=1e-4,pc.demoAmbient.fadeInMode=!0,t.app.fire("finalScene:end")},this.cutToBlack=function(){t.state=0,t.percent=0,pc.charController.entity.setPosition(t.charStart),pc.charController.enabled=!0,pc.charController.cinematic=!0,pc.charController.pathInd=0,pc.charController.pathTime=0,pc.charController.currentPath=pc.charController.paths[0],pc.charController.currentPathTarget=pc.charController.currentPath.children[0],setTimeout(t.fadeAmbientIn,5e3),t.ray1obj.setParameter("material_opacity",0),t.ray2obj.setParameter("material_opacity",0),t.rayFinal.setParameter("material_opacity",0),t.lightFinal.intensity=.001,t.matLightHouse.resource.opacity=0,t.matLightHouse2.resource.opacity=0,t.matLightHouse3.resource.opacity=0,t.matLightHouse.resource.update(),t.matLightHouse2.resource.update(),t.matLightHouse3.resource.update()},this.showLogo=function(){};var e=this.app.root.findByName("FinalTrigger").model.model.meshInstances[0];e.node.getWorldTransform(),this.bbox=e.aabb,this.app.on("finalScene:testEnd",(function(t){pc.charController.entity.setPosition(this.bbox.center)}),this)},FinalScene.prototype.postInitialize=function(){this.charStart=pc.charController.entity.getPosition().clone()};var Curve1=function(t){return t*t*(3-2*t)},Spline1=function(t,e,i,s){var a=1-s;return a*a*t+2*a*s*e+s*s*i};FinalScene.prototype.postUpdate=function(t){var e,i;if(0===this.state){var s=pc.charController.entity.getPosition();this.tmp.copy(this.pos).sub(s),this.bbox.containsPoint(s)&&(pc.charController.idle(),pc.charController.enabled=!1,this.app.fire("finalScene:start"),this.entity.sound.play("Final"),pc.demoAmbient.enabled=!1,this.startVolume=pc.demoAmbient.audio.volume,this.state=-1,this.cam=this.app.scene._activeCamera,this.startPos.copy(this.cam._node.getPosition()),this.endPos.copy(this.finalCam1.getPosition()),this.endPos2.copy(this.finalCam2.getPosition()),this.startRot.copy(this.cam._node.getRotation()),this.endRot.copy(this.finalCam1.getRotation()),this.percent=0,e=9,this.dtMul=1/e,setTimeout(this.enableLight,28e3),setTimeout(this.fadeToBlack,45200),setTimeout(this.cutToBlack,46200))}else if(-1===this.state)this.app.scene.exposure=pc.math.clamp(1-this.percent,0,1),this.percent+=t,this.percent>1&&(this.percent=0,this.state=1);else if(1===this.state){this.app.scene.exposure=pc.math.clamp(2*this.percent-.5,0,1);var a=Spline1(this.startPos.x,this.endPos.x,this.endPos2.x,this.percent),o=Spline1(this.startPos.y,this.endPos.y,this.endPos2.y,this.percent),r=Spline1(this.startPos.z,this.endPos.z,this.endPos2.z,this.percent);this.prevPos.copy(this.cam._node.getPosition()),this.cam._node.setPosition(this.cam._node.getPosition().set(a,o,r)),this.cam._node.setRotation(this.cam._node.getRotation().slerp(this.startRot,this.endRot,1)),pc.demoAmbient.audio.volume=pc.math.lerp(this.startVolume,0,this.percent),this.percent+=t*this.dtMul,this.percent>1&&(this.percent=0,this.state=2,e=5,this.dtMul=1/e,pc.demoAmbient.audio.pause(),this.motionDir.set(a,o,r).sub(this.prevPos).normalize(),this.prevPos.set(a,o,r),this.app.fire("finalScene:state:2"))}else if(2===this.state){i=3*this.percent+1,this.flyDir.copy(this.finalCam2.forward),this.flyDir.lerp(this.motionDir,this.flyDir,this.percent).normalize(),this.flyDir.scale(t*i),this.cam._node.translate(this.flyDir),(n=this.cam._node.getPosition()).y=pc.math.lerp(n.y,this.prevPos.y,.1*this.percent),this.cam._node.setPosition(n),this.percent+=t*this.dtMul,this.percent>1&&(this.percent=0,this.state=3,this.app.fire("finalScene:state:3"))}else if(3===this.state){i=4,this.cam._node.translate(this.flyDir.copy(this.finalCam2.forward).scale(t*i)),(n=this.cam._node.getPosition()).y=pc.math.lerp(n.y,this.prevPos.y,.1*this.percent),this.cam._node.setPosition(n);var n=this.cam._node.getPosition();this.percent=1-(n.x- -165)/100,this.matLightHouse&&this.matLightHouse.resource&&(this.matLightHouse.resource.opacity=pc.math.lerp(.001,.999,this.percent),this.ray1obj.setParameter("material_opacity",this.matLightHouse.resource.opacity),this.ray2obj.setParameter("material_opacity",this.matLightHouse.resource.opacity),this.matLightHouse.resource.update()),this.matLightHouse2&&this.matLightHouse2.resource&&(this.matLightHouse2.resource.opacity=pc.math.lerp(.001,.999,this.percent),this.matLightHouse2.resource.update()),this.matLightHouse3&&this.matLightHouse3.resource&&(this.matLightHouse3.resource.opacity=pc.math.lerp(.001,.999,this.percent),this.matLightHouse3.resource.update())}};var SoftParticle=pc.createScript("softParticle");SoftParticle.attributes.add("softening",{type:"number",default:200}),SoftParticle.attributes.add("shaderPS",{type:"asset",assetType:"shader"}),SoftParticle.prototype.initialize=function(){for(var t=pc.shaderChunks.screenDepthPS+this.shaderPS.resource,e=this.entity.model.model.meshInstances,a=0;a<e.length;a++)e[a].material.chunks.opacityTexPS=t,e[a].material.chunks.opacityTexConstPS=t,e[a].setParameter("softening",10*this.softening),e[a].material.update()},SoftParticle.prototype.update=function(t){};var SkyboxToggle=pc.createScript("skyboxToggle");SkyboxToggle.attributes.add("shaderPS",{type:"asset",assetType:"shader"}),SkyboxToggle.prototype.initialize=function(){this.sky=this.app.scene.skybox,this.force=!1,pc.skyboxToggle=this,pc.disableSky=!0,this.skyEnabled=!1,this.init=!1},SkyboxToggle.prototype.update=function(e){if(this.app.scene.skyboxModel&&(this.init||(this.dynMaterial=atf.dynSkybox.model.meshInstances[0].material,this.staticMaterial=this.app.scene.skyboxModel.meshInstances[0].material,this.init=!0),pc.skyboxToggle.force)){this.skyEnabled=!this.skyEnabled,this.app.scene.skyboxModel.meshInstances[0].material=this.skyEnabled?this.dynMaterial:this.staticMaterial,pc.disableSky=!this.skyEnabled,pc.skyboxToggle.force=!1;var s=pc._patchCubemap;if(!s)return;for(var t=this.shaderPS.resource,i=0;i<s.length;i++)s[i].chunks.reflectionCubePS=s[i].chunks.reflectionDpAtlasPS=s[i].chunks.reflectionPrefilteredCubePS=s[i].chunks.reflectionPrefilteredCubeLodPS=this.skyEnabled?t:null,s[i].update()}};var SubMirror=pc.createScript("subMirror");SubMirror.prototype.postInitialize=function(){if(this.entity.model.model&&pc.mirrorMaterial)for(var r=this.entity.model.model.meshInstances,t=0;t<r.length;t++)r[t].material=pc.mirrorMaterial,r[t].setParameter("mirrorDepthOffset",1)},SubMirror.prototype.update=function(r){};var AlphaTocoverage=pc.createScript("alphaTocoverage");AlphaTocoverage.prototype.initialize=function(){if(this.entity.model.model)for(var e=this.entity.model.model.meshInstances,a=0;a<e.length;a++)e[a].material.opacityMap&&(e[a].material.alphaToCoverage=!0),e[a].material.update()},AlphaTocoverage.prototype.update=function(e){};var Tree=pc.createScript("tree");Tree.attributes.add("treeSize",{type:"vec3"}),Tree.attributes.add("amplitude",{type:"number",default:1}),Tree.attributes.add("bush",{type:"boolean",default:!1}),Tree.attributes.add("shaderTransformVS",{type:"asset",assetType:"shader"}),Tree.attributes.add("shaderVertexColorPS",{type:"asset",assetType:"shader"}),Tree.attributes.add("shaderDiffuseLeavesPS",{type:"asset",assetType:"shader"}),Tree.attributes.add("shaderEmissiveLeavesPS",{type:"asset",assetType:"shader"}),Tree.prototype.initialize=function(){var e=this.shaderTransformVS.resource,t=(this.shaderVertexColorPS.resource,this.shaderDiffuseLeavesPS.resource),a=this.shaderEmissiveLeavesPS.resource;this.bush&&(e="#define BUSH\n"+e);var s=this.treeSize;if(null!=s&&0!==s.x&&0!==s.y&&0!==s.z||(s=new pc.Vec3(254.516,240.405,320.419)),this.entity.model.model)for(var r=this.entity.model.model.meshInstances,i=0;i<r.length;i++){r[i].material.chunks.transformVS=e;var d=r[i].material.opacityMap&&!this.bush;r[i].material.setParameter("isLeaves",d?1:0,4294967295),r[i].material.forceUv1=!0,r[i].material.chunks.diffuseTexPS=t,r[i].material.chunks.emissiveTexConstFloatPS=a,r[i].material.update(),pc.treeMaterial=r[i].material,r[i].setParameter("treeSize",s.data,4294967295),r[i].setParameter("windAmplitude",this.amplitude,4294967295)}},Tree.prototype.update=function(e){};var DontDrawTodepth=pc.createScript("dontDrawTodepth");DontDrawTodepth.prototype.initialize=function(){if(this.entity.model&&this.entity.model.model)for(var t=this.entity.model.model.meshInstances,e=0;e<t.length;e++)t[e]._noDepthDrawGl1=!0},DontDrawTodepth.prototype.update=function(t){};var Foliage=pc.createScript("foliage");Foliage.prototype.initialize=function(){for(var t=this.entity.model.model.meshInstances,e=0;e<t.length;e++){var o=t[e].material;o.chunks.basePS=pc.shaderChunks.basePS+"\nvec3 mod289(vec3 x) {  return x - floor(x * (1.0 / 289.0)) * 289.0;}vec4 mod289(vec4 x) {  return x - floor(x * (1.0 / 289.0)) * 289.0;}vec4 permute(vec4 x) {     return mod289(((x*34.0)+1.0)*x);}vec4 taylorInvSqrt(vec4 r){  return 1.79284291400159 - 0.85373472095314 * r;}float snoise(vec3 v)  {   const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);  vec3 i  = floor(v + dot(v, C.yyy) );  vec3 x0 =   v - i + dot(i, C.xxx) ;  vec3 g = step(x0.yzx, x0.xyz);  vec3 l = 1.0 - g;  vec3 i1 = min( g.xyz, l.zxy );  vec3 i2 = max( g.xyz, l.zxy );  vec3 x1 = x0 - i1 + C.xxx;  vec3 x2 = x0 - i2 + C.yyy;  vec3 x3 = x0 - D.yyy;  i = mod289(i);   vec4 p = permute( permute( permute(              i.z + vec4(0.0, i1.z, i2.z, 1.0 ))           + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))            + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));  float n_ = 0.142857142857;  vec3  ns = n_ * D.wyz - D.xzx;  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  vec4 x_ = floor(j * ns.z);  vec4 y_ = floor(j - 7.0 * x_ );  vec4 x = x_ *ns.x + ns.yyyy;  vec4 y = y_ *ns.x + ns.yyyy;  vec4 h = 1.0 - abs(x) - abs(y);  vec4 b0 = vec4( x.xy, y.xy );  vec4 b1 = vec4( x.zw, y.zw );  vec4 s0 = floor(b0)*2.0 + 1.0;  vec4 s1 = floor(b1)*2.0 + 1.0;  vec4 sh = -step(h, vec4(0.0));  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;  vec3 p0 = vec3(a0.xy,h.x);  vec3 p1 = vec3(a0.zw,h.y);  vec3 p2 = vec3(a1.xy,h.z);  vec3 p3 = vec3(a1.zw,h.w);  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));  p0 *= norm.x;  p1 *= norm.y;  p2 *= norm.z;  p3 *= norm.w;  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);  m = m * m;  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),                                 dot(p2,x2), dot(p3,x3) ) );  }\n",o.chunks.emissiveConstPS="\n                \t\t\t\t\t\tuniform vec3 material_emissive;\t\t\t\t\t\t\t\t\t\tvec3 getEmission() {\t\t\t\t\t\t\t\t\t\t\tfloat dt = saturate(dot(dViewDirW, dNormalW));\t\t\t\t\t\t\t\t\t\t\tfloat fr = 1.0 - dt;\t\t\t\t\t\t\t\t\t\t\tfr *= fr;vec3 dx = normalize(dFdx(vPositionW));vec3 dy = normalize(dFdy(vPositionW));vec3 faceN = normalize(cross(dx, dy));float faceFactor = 1.0 - saturate(dot(dViewDirW, faceN));faceFactor *= faceFactor * faceFactor * faceFactor * 2.0;                                            float noiz = snoise(vPositionW * 20.0);                                            float alphaMod = noiz - faceFactor + dt * dt * dt * 3.0;                                            dAlpha *= saturate(alphaMod);\t\t\t\t\t\t\t\t\t\t\tgl_FragColor.rgb *= saturate(fr * 5.0 + 0.75) * (material_emissive * (saturate(dNormalW.y) + fr * 0.25) * 8.0 * dAo + vec3(1.0));    \t\t\t\t\t\t\t\t\t\treturn gl_FragColor.rgb;\t\t\t\t\t\t\t\t\t\t}\n",o.chunks.endPS="    gl_FragColor.rgb = combineColor();                                       gl_FragColor.rgb = getEmission();                                       gl_FragColor.rgb = addFog(gl_FragColor.rgb);                                       gl_FragColor.rgb = toneMap(gl_FragColor.rgb);                                       gl_FragColor.rgb = gammaCorrectOutput(gl_FragColor.rgb);",o.update()}},Foliage.prototype.update=function(t){};var LeavesShadows=pc.createScript("leavesShadows");LeavesShadows.attributes.add("objectName",{type:"string",default:""}),LeavesShadows.attributes.add("shaderPS",{type:"asset",assetType:"shader"}),LeavesShadows.prototype.initialize=function(){for(var e=this.entity.model.model.meshInstances,a=0;a<e.length;a++){var t=e[a].material;t.chunks.startPS="uniform sampler2D topMap;\nuniform vec3 leavesPos;\n"+pc.shaderChunks.startPS,t.chunks.endPS=this.shaderPS.resource,""!==this.objectName&&t.setParameter("leavesPos",this.app.root.findByName(this.objectName).getPosition().data),t.update()}},LeavesShadows.prototype.update=function(e){};var PatchFog=pc.createScript("patchFog");PatchFog.attributes.add("shaderFogPS",{type:"asset",assetType:"shader"}),PatchFog.prototype.initialize=function(){pc.shaderChunks.fogExpPS=this.shaderFogPS.resource};var Volumelight=pc.createScript("volumelight");Volumelight.attributes.add("shaderVS",{type:"asset",assetType:"shader"}),Volumelight.attributes.add("shaderPS",{type:"asset",assetType:"shader"}),Volumelight.prototype.initialize=function(){var e=this.entity.model.model.meshInstances[0].material;e.chunks.transformVS=this.shaderVS.resource,e.chunks.opacityTexConstPS=this.shaderPS.resource,e.update()};var FinalTempLamp=pc.createScript("finalTempLamp");FinalTempLamp.prototype.initialize=function(){this.ray=this.app.root.findByName("Final_temp_ray").model,this.light1=this.app.root.findByName("Final_temp_light1").light,this.light2=this.app.root.findByName("Final_temp_light2").light,this.int1=this.light1.intensity,this.int2=this.light2.intensity,this.state=0,this.valA=1,this.valB=0,this.timeToRandom=0,this.timeToEnd=0,this.lodMaterial=this.app.root.findByName("payphone2_lod01").model.model.meshInstances[0].material,this.lampMaterial=this.app.root.findByName("hanginglamp").model.model.meshInstances[0].material},FinalTempLamp.prototype.update=function(t){if(1===this.state){var i=pc.now();if(i>this.timeToEnd)return this.light1.intensity=0,this.light2.intensity=0,this.ray.enabled=!1,this.lodMaterial.emissiveIntensity=.01,this.lodMaterial.update(),this.lampMaterial.emissiveIntensity=.01,this.lampMaterial.update(),void(this.enabled=!1);i>this.timeToRandom&&(this.valB=Math.random(),this.timeToRandom=i+100);var a=pc.math.lerp(this.valA,this.valB,20*t);return this.light1.intensity=this.int1*a,this.light2.intensity=this.int2*a,void this.ray.material.setParameter("material_opacity",a)}pc.charController&&(pc.charController.pivot.getPosition().z>24.484&&(this.state=1,this.timeToEnd=pc.now()+1e3))};var ReplaceMipmappedTexture=pc.createScript("replaceMipmappedTexture");ReplaceMipmappedTexture.attributes.add("texName",{type:"string",default:"leavs.png"}),ReplaceMipmappedTexture.attributes.add("mips",{type:"asset",assetType:"texture",array:!0}),ReplaceMipmappedTexture.prototype.initialize=function(){var e,p=this.mips,t=this.app.graphicsDevice,a=p[0].resource,i=new pc.Texture(t,{width:a.width,height:a.height,format:a.format,mipmaps:!0});for(i.anisotropy=4,e=0;e<p.length;e++){var r=p[e].resource;i._levels[e]=r._levels[0]}t.setTexture(i,0),pc._mippedTex||(pc._mippedTex={}),pc._mippedTex[this.texName]=i;var s=this.entity.model.model.meshInstances;for(e=0;e<s.length;e++)s[e].material.opacityMap&&s[e].material.opacityMap.name===this.texName&&(s[e].material.opacityMap=i)},ReplaceMipmappedTexture.prototype.update=function(e){};var AssignLight=pc.createScript("assignLight");AssignLight.attributes.add("lightName",{type:"string",default:""}),AssignLight.prototype.initialize=function(){var t=this.app.root.findByName(this.lightName);if(t){for(var i=[t=(t=t.light).light],e=this.entity.model.model.meshInstances,s=0;s<e.length;s++)e[s]._staticLightList=i;"zebra"===this.entity.name&&(pc.zebra=this.entity)}},AssignLight.prototype.update=function(t){};var AssignLights=pc.createScript("assignLights");AssignLights.attributes.add("lightName",{type:"string",array:!0}),AssignLights.prototype.initialize=function(){var t,i=[];for(t=0;t<this.lightName.length;t++)i[t]=this.app.root.findByName(this.lightName[t]).light.light;var s=this.entity.model.model.meshInstances;for(t=0;t<s.length;t++)s[t]._staticLightList=i},AssignLights.prototype.update=function(t){};var PlaceLeaves=pc.createScript("placeLeaves");PlaceLeaves.prototype.initialize=function(){this.state=-2,pc.placeLeaves=this},PlaceLeaves.prototype.update=function(i){var e=this.app.scene._activeCamera;if(e){if(-2===this.state)return this.p0=this.app.root.findByName("leavesParticleE1").script.leavesParticle,this.p1=this.app.root.findByName("leavesParticleE2").script.leavesParticle,this.p2=this.app.root.findByName("leavesParticleE3").script.leavesParticle,this.p0.enabled=this.p0.instance.visible=!0,this.p1.enabled=this.p1.instance.visible=!0,this.p2.enabled=this.p2.instance.visible=!0,void(this.state=-1);if(-1===this.state)return this.p0.enabled=this.p0.instance.visible=!0,this.p1.enabled=this.p1.instance.visible=!1,this.p2.enabled=this.p2.instance.visible=!1,void(this.state=0);var t=e._node.getPosition();if(t.x<-60)return this.p0.enabled=this.p0.instance.visible=!1,this.p1.enabled=this.p1.instance.visible=!1,void(this.p2.enabled=this.p2.instance.visible=!0);0===this.state?t.x<-40&&(this.state=1,this.p0.enabled=this.p0.instance.visible=!1,this.p1.enabled=this.p1.instance.visible=!0,this.p2.enabled=this.p2.instance.visible=!1):t.x>-40&&(this.state=0,this.p0.enabled=this.p0.instance.visible=!0,this.p1.enabled=this.p1.instance.visible=!1,this.p2.enabled=this.p2.instance.visible=!1)}};var Zprepass=pc.createScript("zprepass");Zprepass.prototype.initialize=function(){var e=this.entity.model;e.enabled=!0;var t=e.model.meshInstances[0].material;t.redWrite=!1,t.greenWrite=!1,t.blueWrite=!1,t.alphaWrite=!1},Zprepass.prototype.update=function(e){};var ShaderBuild=pc.createScript("shaderBuild");ShaderBuild.attributes.add("shaderVS",{type:"asset",assetType:"shader"}),ShaderBuild.attributes.add("shaderPS",{type:"asset",assetType:"shader"}),ShaderBuild.attributes.add("shaderTransformVS",{type:"asset",assetType:"shader"}),ShaderBuild.attributes.add("textureMounting",{type:"asset",assetType:"texture"}),ShaderBuild.attributes.add("textureLamp",{type:"asset",assetType:"texture"}),ShaderBuild.prototype.postInitialize=function(){var e=this.entity.model.model.meshInstances[0],t=e.material;t.customFragmentShader=this.shaderPS.resource,t.chunks.transformVS=this.shaderTransformVS.resource,t.chunks.normalVS=this.shaderVS.resource,t.setParameter("texture_mounting",this.textureMounting.resource),t.setParameter("texture_lamp",this.textureLamp.resource);var r=this.entity.getWorldTransform().clone().invert();e.setParameter("matrix_invModel",r.data)};var HideDistance=pc.createScript("hideDistance"),_HIDELODS=[],_lodDiff=new pc.Vec3,_lodDist=0;HideDistance.attributes.add("distance",{type:"number",default:25}),HideDistance.attributes.add("invert",{type:"boolean",default:!1}),HideDistance.attributes.add("maxx",{type:"number",default:1e3}),HideDistance.attributes.add("maxz",{type:"number",default:1e3}),HideDistance.attributes.add("minz",{type:"number",default:-1e3}),HideDistance.attributes.add("prewarm",{type:"boolean",default:!1}),HideDistance.attributes.add("debug",{type:"boolean",default:!1}),HideDistance.prototype.initialize=function(){this.sqDist=this.distance*this.distance,this.pos=this.entity.getPosition(),this.stateLod=!0,this.stateX=!0,this.stateZ=!0,this.state=!0,this.init=!1,this.meshes=this.entity.model.meshInstances,this.needsPrewarm=this.prewarm,this.waitForStatic=!0,_HIDELODS.push(this),this.cam=this.app.root.findByName("Camera")},HideDistance.prototype.postUpdate=function(t){var s=this.cam;if(this.waitForStatic)this.waitForStatic=!1;else if(this.needsPrewarm)this.needsPrewarm=!1;else{if(!this.meshes){if(!this.entity.model.model)return;this.meshes=this.entity.model.meshInstances}var i=!1;if(!this.init){if(this.entity.model.isStatic){var e,a=this.meshes,h=this.app.scene.drawCalls;for(o=0;o<a.length;o++)for(e=0;e<h.length;e++)h[e]._staticSource===a[o]&&this.meshes.push(h[e])}this.init=!0,i=!0}var d=s.getPosition();if(this.stateX&&d.x>this.maxx?(i=!0,this.stateX=!1):!this.stateX&&d.x<this.maxx&&(i=!0,this.stateX=!0),this.stateZ&&d.z>this.maxz?(i=!0,this.stateZ=!1):!this.stateZ&&d.z<this.maxz&&(i=!0,this.stateZ=!0),_lodDiff.copy(this.pos).sub(d),_lodDist=_lodDiff.dot(_lodDiff),this.stateLod&&_lodDist>this.sqDist?(i=!0,this.stateLod=!1):!this.stateLod&&_lodDist<this.sqDist&&(i=!0,this.stateLod=!0),i){this.debug&&console.log("switch "+this.stateX+" "+this.stateLod+" "+this.entity.name);var n=this.invert?!this.stateLod:this.stateLod;if(this.stateX&&this.stateZ||(n=!1),this.state!==n){for(var o=0;o<this.meshes.length;o++)this.meshes[o].visible=n;this.state=n}}}},HideDistance.prototype.forcePrewarm=function(){this.needsPrewarm=!0,this.stateLod=this.invert,this.stateX=!0,this.stateZ=!0,this.state=!0;for(var t=0;t<this.meshes.length;t++)this.meshes[t].visible=!this.invert};var SingleMesh=pc.createScript("singleMesh");SingleMesh.prototype.initialize=function(){var e,t,r,s,n,i=pc.now(),o=this.entity.children,a=[];for(e=0;e<o.length;e++)if((s=o[e]).model){for(n=s.model.model.meshInstances,t=0;t<n.length;t++)a.push(n[t]);s.model.enabled=!1}var p,h,c,f,l,m,u,v,S,d,g,y,z,F,I,M,w,A,x,b,C,T,N=new pc.Vec3,O=0,P=[],E=[],U=[],V=[];for(e=0;e<a.length;e++){for(v=(u=(m=a[t].mesh).vertexBuffer).format.elements,S=u.numVertices,d=u.format.size,r=0;r<v.length;r++)v[r].name===pc.SEMANTIC_POSITION?g=v[r].offset:v[r].name===pc.SEMANTIC_NORMAL?y=v[r].offset:v[r].name===pc.SEMANTIC_TEXCOORD1&&(z=v[r].offset);for(F=new Float32Array(u.storage),I=g/4,M=y/4,w=z/4,vertSizeF=d/4,x=(A=m.indexBuffer[0]).storage,1===A.bytesPerIndex?x=new Uint8Array(x):2===A.bytesPerIndex?x=new Uint16Array(x):4===A.bytesPerIndex&&(x=new Uint32Array(x)),b=m.primitive[0].base,C=m.primitive[0].count/3,T=a[t].node.getWorldTransform(),r=0;r<S;r++)N.set(F[r*vertSizeF+I],F[r*vertSizeF+I+1],F[r*vertSizeF+I+2]),T.transformPoint(N,N),P.push(N.x),P.push(N.y),P.push(N.z);for(r=0;r<S;r++)N.set(F[r*vertSizeF+M],F[r*vertSizeF+M+1],F[r*vertSizeF+M+2]),T.transformVector(N,N).normalize(),E.push(N.x),E.push(N.y),E.push(N.z);for(r=0;r<S;r++)p=F[r*vertSizeF+w],h=F[r*vertSizeF+w+1],U.push(p),U.push(h);for(r=0;r<C;r++)c=x[3*r+b]+O,f=x[3*r+1+b]+O,l=x[3*r+2+b]+O,V.push(c),V.push(f),V.push(l);O+=S}var _=this.app.graphicsDevice;m=pc.createMesh(_,P,{normals:E,uvs:U,indices:V});var B=a[0].material,D=new pc.MeshInstance(this.entity,m,B);this.app.scene.drawCalls.push(D),i=pc.now()-i,console.log("Combining meshes ("+this.entity.name+") took "+i+"ms")},SingleMesh.prototype.update=function(e){};var InstancingGroup=pc.createScript("instancingGroup");InstancingGroup.attributes.add("lightName",{type:"string",array:!0}),InstancingGroup.prototype.initialize=function(){var t,n,a,i,e=this.entity.children,s=[];for(t=0;t<e.length;t++)if((a=e[t]).model){for(i=a.model.model.meshInstances,n=0;n<i.length;n++)s.push(i[n]);a.model.enabled=!1}var o=new pc.BoundingBox(s[0].node.getPosition(),pc.Vec3.ZERO),r=new pc.MeshInstance(this.entity,s[0].mesh,s[0].material);for(r.instancingData=new pc.InstancingData(s.length,!1),t=0;t<s.length;t++)r.instancingData.buffer.set(s[t].node.getWorldTransform().data,16*t),o.add(s[t].aabb);var c=[];for(t=0;t<this.lightName.length;t++)c[t]=this.app.root.findByName(this.lightName[t]).light.light;r._staticLightList=c,this.instance=r,this.instance._updateAabb=!1,this.instance._aabb=o,this.app.scene.drawCalls.push(r)},InstancingGroup.prototype.update=function(t){};var Xlimit=pc.createScript("xlimit");Xlimit.attributes.add("x",{type:"number",default:-46}),Xlimit.prototype.initialize=function(){this.state=1},Xlimit.prototype.update=function(t){var i=this.app.scene._activeCamera;if(i){var e=i._node.getPosition();if(1===this.state&&e.x>this.x){for(var s=this.entity.model.model.meshInstances,a=0;a<s.length;a++)s[a].visible=!1;this.state=0}else if(0===this.state&&e.x<this.x){for(s=this.entity.model.model.meshInstances,a=0;a<s.length;a++)s[a].visible=!0;this.state=1}}};var Ambient=pc.createScript("ambient");Ambient.attributes.add("music",{type:"asset",assetType:"audio"}),Ambient.prototype.initialize=function(){var e=this.music;if(e){var t=e.getFileUrl(),i=document.createElement("AUDIO");i.canPlayType("audio/mpeg")?(i.oncanplay=function(){i.play()},i.setAttribute("src",t),i.loop=!0,i.autoplay=!0,this.audio=i,this.fadeInMode=!1,pc.demoAmbient=this):console.log("Can't play mp3!")}else console.log("Can't find music!")},Ambient.prototype.update=function(e){var t;if(this.fadeInMode)return t=this.audio.volume,void((t+=e/3)<1?this.audio.volume=t:(this.audio.volume=t=1,this.fadeInMode=!1));if(!pc.charController.cinematic){var i=this.app.scene._activeCamera;if(i){var a=i._node.getPosition();t=pc.math.lerp(1,.125,(a.z-9)/35),this.audio.volume=t}}};var RenderDebug=pc.createScript("renderDebug");RenderDebug.prototype.initialize=function(){var e=this.app.root.findByName("Camera").camera.camera;pc.skipRenderCamera=e,pc.skipRenderAfter=0,this.enabled=!1},RenderDebug.prototype.update=function(e){};var Ui=pc.createScript("ui");Ui.attributes.add("html",{type:"asset",assetType:"html"}),Ui.attributes.add("less",{type:"asset",assetType:"css"}),Ui.prototype.initialize=function(){this.element=document.createElement("div"),this.element.classList.add("ui"),document.body.appendChild(this.element),this.style=document.createElement("style"),document.head.appendChild(this.style),this.html.on("load",this.templateHtml,this),this.less.on("load",this.templateCss,this),this.app.ui={},this.templateHtml(),this.templateCss(),this.frames=0,this.done=!1},Ui.prototype.replaceTags=function(e){var t=e.match(/\{.+?\}/g);if(!t)return e;for(var i=0;i<t.length;i++){var s=t[i].match(/\{asset\[(.+?)\]\.(.+?)\}/i);if(s){var a=s[1],n=s[2].split("."),o=this.app.assets.findByTag(a);if(!o||!o.length){console.error("Could not find asset with tag "+a);continue}for(var c=o[0],r=0;r<n.length;r++)c="function"==typeof c[n[r]]?c[n[r]].call(c):c[n[r]];e=e.replace(t[i],c)}}return e},Ui.prototype.templateHtml=function(){var e=this;this.element.innerHTML=this.html&&this.replaceTags(this.html.resource)||"";var t=!1,i=this.element.querySelector(".overlay"),s=this.element.querySelector(".overlay > .fade"),a=this.element.querySelector(":scope > .header"),n=this.element.querySelector(".overlay > .menu"),o=this.element.querySelector(".overlay > .panel.settings"),c=this.element.querySelector(".overlay > .panel.info"),r=this.element.querySelector(".overlay > .menu > .play"),l=this.element.querySelector(".smallButton.settings"),d=this.element.querySelector(".smallButton.info"),u=this.element.querySelector(".overlay > .panel.settings > .button.close"),p=this.element.querySelector(".overlay > .panel.info > .button.close"),v=this.element.querySelector(".footer > .playcanvas"),m=this.element.querySelector(".footer > .mozilla"),f=this.element.querySelectorAll(".overlay > .menu > .quality > .options > div[data-name]"),h=this.app.ui.fpsCounter=this.element.querySelector(".fpsCounter");this.app.fire("ui:fpsCounter",h),this.app.on("settings:showFps",(function(e){h&&(e?h.classList.add("active"):h.classList.remove("active"))})),h&&pc.demoSettings.showFps&&h.classList.add("active"),i&&i.addEventListener("mousedown",(function(e){e.stopPropagation()}),!1),this.app.on("finalScene:start",(function(){t=!0,n&&n.classList.add("final"),i&&i.classList.add("active","final"),a&&a.classList.add("hidden"),e.app.mouse.disablePointerLock()})),this.app.on("finalScene:state:3",(function(){n&&n.classList.add("active"),requestAnimationFrame((function(){n&&n.classList.add("logo")}))})),this.app.on("finalScene:fadeOut",(function(){s&&s.classList.add("active")})),this.app.on("finalScene:end",(function(){t=!1,i&&i.classList.remove("final"),s&&s.classList.remove("active")})),n&&n.addEventListener("mousedown",(function(e){e.stopPropagation()}),!1);var y={high:{skyQuality:2,waterQuality:2,shadowQuality:2,leavesQuality:2,fogQuality:2,mirrorQuality:1,aa:pc.demoSettings.isAngle?1:4},medium:{skyQuality:1,waterQuality:1,shadowQuality:1,leavesQuality:1,fogQuality:1,mirrorQuality:1,aa:pc.demoSettings.isAngle?1:2},low:{skyQuality:-1,waterQuality:0,shadowQuality:1,leavesQuality:1,fogQuality:1,mirrorQuality:-1,aa:pc.demoSettings.isAngle||window.mobile?1:2}},L=null;for(var g in y){var S=!0;for(var w in y[g])if(pc.demoSettings[w]!==y[g][w]){S=!1;break}if(S){L=g;break}}for(var q=0;q<f.length;q++)f[q].addEventListener("click",(function(e){var t=this.getAttribute("data-name");if(y[t])for(var i in y[t]){E[i]&&E[i].options[pc.demoSettings[i]]&&E[i].options[pc.demoSettings[i]].classList.remove("active"),pc.demoSettings[i]=y[t][i],E[i]&&E[i].options[pc.demoSettings[i]]&&E[i].options[pc.demoSettings[i]].classList.add("active");for(var s=0;s<f.length;s++)f[s].classList.remove("active");this.classList.add("active")}}),!1),f[q].getAttribute("data-name")===L&&f[q].classList.add("active");o&&o.addEventListener("mousedown",(function(e){e.stopPropagation()}),!1),c&&c.addEventListener("mousedown",(function(e){e.stopPropagation()}),!1),r&&r.addEventListener("click",(function(){i&&i.classList.remove("active"),pc.charController.cinematic=!1,requestAnimationFrame((function(){setTimeout((function(){requestAnimationFrame((function(){n&&n.classList.remove("active")}))}),200)})),e.app.mouse.enablePointerLock()}),!1),l&&(l.addEventListener("mousedown",(function(e){e.stopPropagation()}),!1),l.addEventListener("click",(function(e){i&&i.classList.add("active"),n&&n.classList.remove("active"),c&&c.classList.remove("active"),o&&o.classList.add("active")}),!1),window.addEventListener("keydown",(function(t){9===t.keyCode&&(t.preventDefault(),o&&(o.classList.contains("active")?u&&u.click():(l&&l.click(),e.app.mouse.disablePointerLock())))}),!1)),d&&(d.addEventListener("mousedown",(function(e){e.stopPropagation()}),!1),d.addEventListener("click",(function(e){i&&i.classList.add("active"),n&&n.classList.remove("active"),o&&o.classList.remove("active"),c&&c.classList.add("active")}),!1));var k={},E={},b=this.element.querySelectorAll(".overlay > .panel.settings > .rows > div[data-name]");for(q=0;q<b.length;q++){var C=b[q].getAttribute("data-name"),A=b[q].getAttribute("data-property"),Q=b[q].querySelectorAll(".options > div[data-name]");k[C]={property:A||null,options:{}},A&&(E[A]=k[C]);for(var P=0;P<Q.length;P++){var F=Q[P].getAttribute("data-name");k[C].options[F]=Q[P]}}var bindSettingToProperty=function(e){var t=pc.demoSettings[e.property];for(var i in e.options[t]&&e.options[t].classList.add("active"),e.options)e.options[i].addEventListener("click",(function(t){var i=parseInt(this.getAttribute("data-name"),10),s=pc.demoSettings[e.property];s!==i&&(e.options[s]&&e.options[s].classList.remove("active"),this.classList.add("active"),pc.demoSettings[e.property]=i)}),!1)};for(var w in k)k[w].property&&bindSettingToProperty(k[w]);k.fullscreen&&(this.app.isFullscreen()?k.fullscreen.options.on.classList.add("active"):k.fullscreen.options.off.classList.add("active"),k.fullscreen.options.on.addEventListener("click",(function(t){e.app.enableFullscreen(document.body)}),!1),k.fullscreen.options.off.addEventListener("click",(function(t){e.app.disableFullscreen()}),!1),document.addEventListener("fullscreenchange",(function(){e.app.isFullscreen()?(k.fullscreen.options.on.classList.add("active"),k.fullscreen.options.off.classList.remove("active")):(k.fullscreen.options.on.classList.remove("active"),k.fullscreen.options.off.classList.add("active"))}))),u&&u.addEventListener("click",(function(s){pc.charController.cinematic||t?(n&&n.classList.add("active"),o&&o.classList.remove("active")):(i&&i.classList.remove("active"),requestAnimationFrame((function(){setTimeout((function(){requestAnimationFrame((function(){o&&o.classList.remove("active")}))}),200)})),e.app.mouse.enablePointerLock())})),p&&p.addEventListener("click",(function(s){pc.charController.cinematic||t?(n&&n.classList.add("active"),c&&c.classList.remove("active")):(i&&i.classList.remove("active"),requestAnimationFrame((function(){setTimeout((function(){requestAnimationFrame((function(){c&&c.classList.remove("active")}))}),200)})),e.app.mouse.enablePointerLock())})),v&&v.addEventListener("mousedown",(function(e){e.stopPropagation()}),!1),m&&m.addEventListener("mousedown",(function(e){e.stopPropagation()}),!1),window.addEventListener("keydown",(function(e){27===e.keyCode&&i&&i.classList.contains("active")&&(n.classList.contains("active")&&r&&(r.click(),e.preventDefault()),o.classList.contains("active")&&u&&(u.click(),e.preventDefault()),c.classList.contains("active")&&p&&(p.click(),e.preventDefault()))}),!1)},Ui.prototype.templateCss=function(){var e=this;less.render(this.less&&this.replaceTags(this.less.resource)||"").then((function(t){e.style.innerHTML=t.css}),(function(e){console.log(e)}))},Ui.prototype.update=function(){if(!this.done&&3==this.frames++){var e=this.element.querySelector(".overlay > .fade");e&&e.classList.remove("active"),pc.charController.pathInd=0,pc.charController.pathTime=0,pc.charController.paths.length&&(pc.charController.currentPath=pc.charController.paths[0],pc.charController.currentPathTarget=pc.charController.currentPath.children[0]),this.done=!0}},function(e,t){try{e.querySelector(":scope body")}catch(i){["querySelector","querySelectorAll"].forEach((function(i){var s=t[i];t[i]=function(t){if(/(^|,)\s*:scope/.test(t)){var a=this.id;this.id="ID_"+Date.now(),t=t.replace(/((^|,)\s*):scope/g,"$1#"+this.id);var n=e[i](t);return this.id=a,n}return s.call(this,t)}}))}}(window.document,Element.prototype);var ShaderComplexity=pc.createScript("shaderComplexity");ShaderComplexity.prototype.initialize=function(){this.material=new pc.StandardMaterial,this.material.diffuse.set(0,0,0),this.material.useGammaTonemap=!1,this.material.useFog=!1,this.material.useLighting=!1,this.material.useSkybox=!1,this.material.update(),this.drawCalls=[],this.programs=[],this.colors=[],this.app.on("shaderProfile",this.trigger,this);var e=this;window.addEventListener("keydown",(function(a){82===a.keyCode&&e.trigger("random"),67===a.keyCode&&e.trigger("characters"),86===a.keyCode&&e.trigger("charactersVertex"),80===a.keyCode&&e.trigger("charactersPixel"),75===a.keyCode&&e.trigger("key"),76===a.keyCode&&e.trigger("shaderLinkTime")}),!1)},ShaderComplexity.prototype.addMesh=function(e){if(e._shader&&e._shader[1]&&(e.material.redWrite||e.material.greenWrite||e.material.blueWrite||e.material.alphaWrite)&&-1===this.drawCalls.indexOf(e)){this.drawCalls.push(e);var a=e._shader[1].program,r=this.programs.indexOf(a);-1===r?(this.programs.push(a),this.colors.push(new Float32Array([Math.random(),Math.random(),Math.random()])),e._programInd=this.programs.length-1):e._programInd=r;for(var t=0;t<window.shadersLinked.length;t++)if(window.shadersLinked[t].shader===e._shader[1]){e._shaderLinkTime=window.shadersLinked[t].time;break}}},ShaderComplexity.prototype.collectMeshes=function(e){if(e.model&&e.model.meshInstances)for(var a=0;a<e.model.meshInstances.length;a++)this.addMesh(e.model.meshInstances[a]);for(var r=0;r<e.children.length;r++)this.collectMeshes(e.children[r])},ShaderComplexity.prototype.trigger=function(e){for(var a=1,r=1,t=1,s=1,i=this.app.scene.drawCalls,l=0;l<i.length;l++)this.addMesh(i[l]);this.collectMeshes(this.app.root);for(l=0;l<this.drawCalls.length;l++){this.drawCalls[l]._shaderVertex||(this.drawCalls[l]._shaderVertex=this.drawCalls[l]._shader[1].definition.vshader.length,this.drawCalls[l]._shaderPixel=this.drawCalls[l]._shader[1].definition.fshader.length,this.drawCalls[l].parameters={}),r<(h=this.drawCalls[l]._shaderVertex)&&(r=h),t<(d=this.drawCalls[l]._shaderPixel)&&(t=d),a<h+d&&(a=h+d),s<(i[l]._shaderLinkTime||1)&&(s=i[l]._shaderLinkTime)}for(l=0;l<this.drawCalls.length;l++){var h=this.drawCalls[l]._shaderVertex,d=this.drawCalls[l]._shaderPixel;if(this.material.shader||this.material.updateShader(this.app.graphicsDevice,this.app.scene,0,null,1),this.drawCalls[l]._shader[1]=this.material.shader,this.drawCalls[l].material.blend=!1,this.drawCalls[l].material.blendType=3,this.drawCalls[l].material.blendDst=0,this.drawCalls[l].material.blendSrc=1,this.drawCalls[l].material.blendEquation=0,this.drawCalls[l].material.depthTest=!0,this.drawCalls[l].material.depthWrite=!0,"characters"===e)this.drawCalls[l].setParameter("material_emissive",new Float32Array([Math.pow((h+d)/a,2),0,0]));else if("charactersVertex"===e)this.drawCalls[l].setParameter("material_emissive",new Float32Array([Math.pow(h/r,2),0,0]));else if("charactersPixel"===e)this.drawCalls[l].setParameter("material_emissive",new Float32Array([Math.pow(d/t,2),0,0]));else if("key"===e)this.drawCalls[l].setParameter("material_emissive",this.colors[this.drawCalls[l]._programInd]);else if("shaderLinkTime"===e){var o=(this.drawCalls[l]._shaderLinkTime||0)/s;o<.33?this.drawCalls[l].setParameter("material_emissive",new Float32Array([0,0,Math.pow(o/.33*.9+.1,2)])):o<.66?this.drawCalls[l].setParameter("material_emissive",new Float32Array([0,Math.pow((o-.33)/.33*.9+.1,2),0])):this.drawCalls[l].setParameter("material_emissive",new Float32Array([Math.pow((o-.66)/.34*.9+.1,2),0,0]))}else this.drawCalls[l].setParameter("material_emissive",new Float32Array([Math.random(),Math.random(),Math.random()]))}console.log("profile",e)};var ShadowCasterControl=pc.createScript("shadowCasterControl");ShadowCasterControl.prototype.initialize=function(){this.shadowCasters=this.app.scene.shadowCasters.slice(),pc.shadowCasterControl=this},ShadowCasterControl.prototype.apply=function(){this.app.scene.shadowCasters=this.shadowCasters.slice()};var FindIdenticalShaders=pc.createScript("findIdenticalShaders");function editDistance(e,a){e=e.toLowerCase(),a=a.toLowerCase();for(var r=new Array,t=0;t<=e.length;t++){for(var n=t,i=0;i<=a.length;i++)if(0==t)r[i]=i;else if(i>0){var s=r[i-1];e.charAt(t-1)!=a.charAt(i-1)&&(s=Math.min(Math.min(s,n),r[i])+1),r[i-1]=n,n=s}t>0&&(r[a.length]=n)}return r[a.length]}function similarity(e,a){var r=e,t=a;e.length<a.length&&(r=a,t=e);var n=r.length;return 0===n?1:(n-editDistance(r,t))/parseFloat(n)}FindIdenticalShaders.prototype.initialize=function(){},FindIdenticalShaders.prototype.update=function(e){if(this.app.keyboard.wasPressed(pc.KEY_5)){var a,r,t,n,i,s=this.app.scene.drawCalls,d={},h={},o={};for(a=0;a<s.length;a++)(r=s[a])._shader&&r._shader[1]&&(d[t=r.material.name+"_"+r._shaderDefs]=r._shader[1].definition.fshader,h[t]=r._shader[1],o[t]=r);for(n in d)if(d.hasOwnProperty(n))for(i in d)n!==i&&d.hasOwnProperty(i)&&d[n]==d[i]&&h[n]!==h[i]&&(console.log(n+" == "+i),pc._debugA=o[n],pc._debugB=o[i])}};var DebugShaderExplosion=pc.createScript("debugShaderExplosion");DebugShaderExplosion.prototype.initialize=function(){},DebugShaderExplosion.prototype.update=function(e){if(this.app.keyboard.wasPressed(pc.KEY_6)){var a,t,i,o,r,n,s,h=this.app.scene.drawCalls,l={},p={};for(a=0;a<h.length;a++)if((t=h[a])._shader&&t._shader[1]){for((i=l[t.material.name])||(l[t.material.name]=i=[t._shader[1]],p[t.material.name]=[t]),r=i.length,n=!0,o=0;o<r;o++)if(i[o]===t._shader[1]){n=!1;break}n&&(i.push(t._shader[1]),p[t.material.name].push(t))}for(s in l)if(l.hasOwnProperty(s)&&l[s].length>1)for(console.log(l[s].length+": "+s),o=0;o<l[s].length;o++)console.log(" - "+(p[s][o]._staticLightList?p[s][o]._staticLightList.length:"No")+" lights ("+(p[s][o].node?p[s][o].node.name:"?")+")")}};var LayerSetup=pc.createScript("layerSetup");LayerSetup.prototype.initialize=function(){var e=this.app.scene.layers,r=0,a=new pc.Layer({name:"WaterReflectionZPrepass"});e.insertOpaque(a,r),r++;var n=new pc.Layer({name:"WaterReflection"});e.insertOpaque(n,r),r++,e.insertTransparent(n,r),r++;var t=new pc.Layer({name:"WaterReflectionOuterGlass"});e.insertTransparent(t,r),r++;var s=new pc.Layer({name:"MirrorZPrepass",enabled:!1});e.insertOpaque(s,r),r++;var p=new pc.Layer({name:"MirrorWorld",enabled:!1});e.insertOpaque(p,r),r++,e.insertTransparent(p,r),r++;var i=new pc.Layer({name:"MirrorInnerGlass",enabled:!1});e.insertTransparent(i,r),r++;var c=new pc.Layer({name:"MirrorThinSticks",enabled:!1});e.insertOpaque(c,r),r++;var y=new pc.Layer({name:"MirrorOuterGlass",enabled:!1});e.insertTransparent(y,r),r++;var L=new pc.Layer({name:"MirrorFinal",enabled:!1});e.insertOpaque(L,r),r++,e.insertTransparent(L,r),r++;var v=new pc.Layer({name:"ZPrepass"});e.insertOpaque(v,r),r++,r+=3;var u=e.getLayerById(pc.LAYERID_DEPTH);e.remove(u);var m=new pc.Layer({name:"ZPrepassAfterTransparent"});e.insertOpaque(m,r),r++,e.insertOpaque(u,r),r++;var o=new pc.Layer({name:"InnerGlass"});e.insertTransparent(o,r),r++;var w=new pc.Layer({name:"ThinSticks"});e.insertOpaque(w,r),r++;var l=new pc.Layer({name:"OuterGlass"});e.insertTransparent(l,r),r++;var T=new pc.Layer({name:"Water"});e.insertTransparent(T,r),r++;var O=new pc.Layer({name:"PhoneBooth"});e.insertOpaque(O,r),r++,e.insertTransparent(O,r),r++;var q=new pc.Layer({name:"VolumeLights"});e.insertTransparent(q,r),r++;var d=new pc.Layer({name:"TreeLeaves"});e.insertOpaque(d,r),r++;var f=new pc.Layer({name:"Wires"});e.insertTransparent(f,r),r++;var S=new pc.Layer({name:"Refractives"});e.insertOpaque(S,r),r++;var b=new pc.Layer({name:"Fog"});e.insertTransparent(b,r),r++},LayerSetup.prototype.update=function(e){};var SetNewLayers=pc.createScript("setNewLayers");SetNewLayers.attributes.add("layers",{type:"string",array:!0}),SetNewLayers.prototype.postInitialize=function(){for(var e=this.app.scene.layers,t=[],a=0;a<this.layers.length;a++)t.push(e.getLayerByName(this.layers[a]).id);this.entity.model&&(this.entity.model.layers=t),this.entity.camera&&(this.entity.camera.layers=t),this.entity.light&&(this.entity.light.layers=t)},SetNewLayers.prototype.update=function(e){};var Post2colorCorrection=pc.createScript("post2colorCorrection");Post2colorCorrection.attributes.add("order",{type:"number",default:7}),Post2colorCorrection.attributes.add("toneMapping",{type:"number",default:0}),Post2colorCorrection.attributes.add("gammaCorrection",{type:"number",default:0}),Post2colorCorrection.attributes.add("lutTexture",{type:"asset",assetType:"texture"}),Post2colorCorrection.attributes.add("hdr",{type:"boolean",default:!0}),Post2colorCorrection.prototype.syncToCpu=function(e,t){var r=t._colorBuffer,o=new Uint8Array(r.width*r.height*4),s=e.gl;s.bindFramebuffer(s.FRAMEBUFFER,t._glFrameBuffer),s.readPixels(0,0,r.width,r.height,s.RGBA,s.UNSIGNED_BYTE,o),r._levels||(r._levels=[]),r._levels[0]=o},Post2colorCorrection.prototype.initialize=function(){var e=this.app.graphicsDevice,t=pc.shaderChunks;this.app.scene.gammaCorrection=pc.GAMMA_SRGBHDR,this.app.scene.toneMapping=-1;var r=pc.programlib.gammaCode(this.gammaCorrection)+pc.programlib.tonemapCode(this.toneMapping)+this.app.assets.find("post2ccPS").resource;if(this.lutTexture&&(r="#define CC\n"+r),this.shader=t.createShaderFromCode(e,t.fullscreenQuadVS,r,"ColorCorrection_"+this.toneMapping+"_"+this.gammaCorrection+"_"+(this.lutTexture?1:0)),this.lutTexture){var o=this.lutTexture.resource;o.magFilter=pc.FILTER_NEAREST,o.minFilter=pc.FILTER_NEAREST,this.constLut=e.scope.resolve("lutTex"),this.constLut.setValue(o);var s=t.createShaderFromCode(e,t.fullscreenQuadVS,this.app.assets.find("lutConvertPS").resource,"lutConvert"),a=new pc.Texture(e,{width:256,height:16,format:pc.PIXELFORMAT_R8_G8_B8_A8,mipmaps:!1});a.addressU=pc.ADDRESS_REPEAT,a.addressV=pc.ADDRESS_REPEAT,a.magFilter=pc.FILTER_NEAREST,a.minFilter=pc.FILTER_NEAREST;var p=new pc.RenderTarget(e,a,{depth:!1});pc.drawQuadWithShader(this.app.graphicsDevice,p,s),this.syncToCpu(e,p);var c,n,d,l,h=new pc.Texture(e,{width:16,height:16,depth:16,volume:!0,format:pc.PIXELFORMAT_R8_G8_B8_A8,mipmaps:!1}),u=new Uint8Array(a._levels[0].length),E=16;for(i=0;i<E;i++)for(c=0;c<E;c++)for(n=0;n<E;n++)for(d=E-c-1,l=0;l<4;l++)u[4*(i+c*E+n*E*E)+l]=a._levels[0][4*(n*E+i+d*E*E)+l];h._levels=[u],h.addressU=pc.ADDRESS_REPEAT,h.addressV=pc.ADDRESS_REPEAT,h.addressW=pc.ADDRESS_REPEAT,h.magFilter=pc.FILTER_LINEAR,h.minFilter=pc.FILTER_LINEAR,p.destroy(),this.constLut.setValue(h)}this.post=new pc.PostEffectPass(this.app,{shader:this.shader,name:"ColorCorrection",hdr:this.hdr,unmodifiedUvs:!0}),this.post.addToComposition(this.order)};var Post2grabColor=pc.createScript("post2grabColor");Post2grabColor.attributes.add("order",{type:"number",default:7}),Post2grabColor.attributes.add("hdr",{type:"boolean",default:!0}),Post2grabColor.prototype.createTex=function(e){var r=this.app.graphicsDevice,t=this.hdr?r.webgl2&&r.extTextureFloatRenderable?pc.PIXELFORMAT_111110F:r.extTextureHalfFloatLinear&&r.extTextureHalfFloatRenderable?pc.PIXELFORMAT_RGBA16F:pc.PIXELFORMAT_R8_G8_B8_A8:pc.PIXELFORMAT_R8_G8_B8_A8,o=new pc.Texture(r,{format:t,width:e?e.width:r.width,height:e?e.height:r.height});return o.minFilter=pc.FILTER_LINEAR,o.magFilter=pc.FILTER_LINEAR,o.addressU=pc.ADDRESS_CLAMP_TO_EDGE,o.addressV=pc.ADDRESS_CLAMP_TO_EDGE,o},Post2grabColor.prototype.initialize=function(){var e=this.app.graphicsDevice,r=this.createTex(null),t=new pc.RenderTarget(e,r);this.constGrabColorTexture=e.scope.resolve("uGrabColorBuffer");var o=this;this.post=new pc.PostEffectPass(this.app,{shader:null,name:"GrabColor",hdr:this.hdr,destRenderTarget:t,setup:function(e,r,t,a,s){a.width===s.width&&a.height===s.height||(s.colorBuffer.destroy(),s.destroy(),s._colorBuffer=o.createTex(a),r.layer.renderTarget=s),e.webgl2&&a._samples>1?o.constGrabColorTexture.setValue(a.colorBuffer):(e.copyRenderTarget(a,s,!0,!1),o.constGrabColorTexture.setValue(s.colorBuffer))}}),this.post.addToComposition(this.order)};var RefractiveMaterial=pc.createScript("refractiveMaterial");RefractiveMaterial.prototype.initialize=function(){var e=this.entity.model.meshInstances[0].material;e.chunks.refractionPS=this.app.assets.find("refractionScenePS").resource,e.update()},RefractiveMaterial.prototype.update=function(e){};var Post2bloom=pc.createScript("post2bloom");Post2bloom.attributes.add("order",{type:"number",default:7}),Post2bloom.attributes.add("hdr",{type:"boolean",default:!1}),Post2bloom.attributes.add("iterations",{type:"number",default:2}),Post2bloom.attributes.add("thresholdMin",{type:"number",default:.5}),Post2bloom.attributes.add("thresholdMax",{type:"number",default:.25}),Post2bloom.attributes.add("amount",{type:"number",default:.5}),Post2bloom.prototype.createTex=function(e){var t=this.app.graphicsDevice,s=this.srcRt,i=this.hdr?t.webgl2&&t.extTextureFloatRenderable?pc.PIXELFORMAT_111110F:t.extTextureHalfFloatLinear&&t.extTextureHalfFloatRenderable?pc.PIXELFORMAT_RGBA16F:pc.PIXELFORMAT_R8_G8_B8_A8:pc.PIXELFORMAT_R8_G8_B8_A8,o=new pc.Texture(t,{format:i,width:Math.floor((s?s.width:t.width)*e),height:Math.floor((s?s.height:t.height)*e)});return o.minFilter=pc.FILTER_LINEAR,o.magFilter=pc.FILTER_LINEAR,o.addressU=pc.ADDRESS_CLAMP_TO_EDGE,o.addressV=pc.ADDRESS_CLAMP_TO_EDGE,o},Post2bloom.prototype.initialize=function(){var e=this.app.graphicsDevice;this.srcRt=null,this.constPixelOffset=e.scope.resolve("uPixelOffset"),this.constPixelOffsetValue=new pc.Vec4,this.constThreshold=e.scope.resolve("uThreshold"),this.constBloomImage=e.scope.resolve("uBloomImage"),this.constAmount=e.scope.resolve("uAmount"),this.threshold=new pc.Vec2;var t,s,i=this,setup=function(e,t,s){i.renderSetup(e,t,s)},o=this.order,h=this.app.assets.find("post2downsamplePS").resource,a=pc.shaderChunks.createShaderFromCode(e,pc.shaderChunks.fullscreenQuadVS,h,"downsample"),r=pc.shaderChunks.createShaderFromCode(e,pc.shaderChunks.fullscreenQuadVS,"#define THRESHOLD\n"+h,"downsampleThreshold"),l=[],n=1,d=this.srcRt;for(this.downsamplePasses=[],t=0;t<this.iterations;t++)n*=.5,s=new pc.PostEffectPass(this.app,{shader:0===t?r:a,name:"Downsample",unmodifiedUvs:!1,bilinear:!0,hdr:this.hdr,srcRenderTarget:0===t?d:l[t-1],setup:setup}),this.downsamplePasses.push(s),l[t]=new pc.RenderTarget({colorBuffer:this.createTex(n)}),l[t].name="lowRt"+t,s.layer.renderTarget=l[t],s.addToComposition(o),o++,s.iteration=0===t?-2:-1;this.lowRt=l,this.width=d?d.width:e.width,this.height=d?d.height:e.height;var c=pc.shaderChunks.createShaderFromCode(e,pc.shaderChunks.fullscreenQuadVS,this.app.assets.find("post2upsamplePS").resource,"upsample");for(this.upsamplePasses=[],t=this.iterations-1;t>0;t--)s=new pc.PostEffectPass(this.app,{shader:c,name:"UpsampleAdditive",unmodifiedUvs:!1,bilinear:!0,hdr:this.hdr,srcRenderTarget:l[t],blending:!0,setup:setup}),this.upsamplePasses[t]=s,s.layer.renderTarget=l[t-1],s.addToComposition(o),o++,s.iteration=-3;var u=pc.shaderChunks.createShaderFromCode(e,pc.shaderChunks.fullscreenQuadVS,this.app.assets.find("post2blendBloomPS").resource,"blendBloom");(s=new pc.PostEffectPass(this.app,{shader:u,name:"BlendBloom",unmodifiedUvs:!0,srcRenderTarget:d,setup:setup})).addToComposition(o),o++,s.iteration=-4},Post2bloom.prototype.renderSetup=function(e,t,s){var i,o,h=this.srcRt?this.srcRt:e;if(this.width!==h.width||this.height!==h.height){var a,r=.5;for(this.width=h.width,this.height=h.height,a=0;a<this.lowRt.length;a++)this.lowRt[a].colorBuffer.destroy(),this.lowRt[a].destroy(),this.lowRt[a]._colorBuffer=this.createTex(r),r*=.5,this.downsamplePasses[a].srcRenderTarget=0===a?this.srcRt:this.lowRt[a-1];for(a=this.iterations-1;a>0;a--)this.upsamplePasses[a].srcRenderTarget=this.lowRt[a]}return-4===t.iteration?(this.constBloomImage.setValue(this.lowRt[0].colorBuffer),this.constAmount.setValue(this.amount),i=s.z,o=s.w,this.constPixelOffsetValue.x=.5*i,this.constPixelOffsetValue.y=.5*o,this.constPixelOffsetValue.z=i,this.constPixelOffsetValue.w=o,void this.constPixelOffset.setValue(this.constPixelOffsetValue.data)):-1===t.iteration||-2===t.iteration?(i=s.z,o=s.w,this.constPixelOffsetValue.x=i,this.constPixelOffsetValue.y=o,this.constPixelOffsetValue.z=-i,this.constPixelOffsetValue.w=o,this.constPixelOffset.setValue(this.constPixelOffsetValue.data),void(-2===t.iteration&&(this.threshold.x=this.thresholdMax-this.thresholdMin,this.threshold.y=-this.thresholdMin*(this.thresholdMax-this.thresholdMin),this.constThreshold.setValue(this.threshold.data)))):-3===t.iteration?(i=s.z,o=s.w,this.constPixelOffsetValue.x=.5*i,this.constPixelOffsetValue.y=.5*o,this.constPixelOffsetValue.z=i,this.constPixelOffsetValue.w=o,this.constPixelOffset.setValue(this.constPixelOffsetValue.data),e.setBlending(!0),void e.setBlendFunction(pc.BLENDMODE_ONE,pc.BLENDMODE_ONE)):void 0};var MakeBrighter=pc.createScript("makeBrighter");MakeBrighter.prototype.initialize=function(){this.entity.model.meshInstances[0].material.emissiveIntensity=100},MakeBrighter.prototype.update=function(e){};var atf={},Namespace=pc.createScript("namespace");Namespace.prototype.initialize=function(){},Namespace.prototype.update=function(e){};var TestExample=pc.createScript("testExample");TestExample.prototype.initialize=function(){this.app.scene.on("set:layers",(function(e,t){for(var a,p=t.layerList,s=0;s<p.length;s++)switch((a=p[s]).name){case"World":case"Depth":a.shaderPass=pc.SHADER_DEPTH}}))},TestExample.prototype.update=function(e){};