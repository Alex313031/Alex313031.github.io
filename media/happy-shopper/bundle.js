!function r(a,s,l){function c(t,e){if(!s[t]){if(!a[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(u)return u(t,!0);var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}var i=s[t]={exports:{}};a[t][0].call(i.exports,function(e){return c(a[t][1][e]||e)},i,i.exports,r,a,s,l)}return s[t].exports}for(var u="function"==typeof require&&require,e=0;e<l.length;e++)c(l[e]);return c}({1:[function(e,t,n){"use strict";var o=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}();var i=new THREE.Vector3,r=new THREE.Quaternion,a=new THREE.Vector3,s=function(){function n(e){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),e=Object.assign(this,{attenuation:.99,fixedTimeStep:1/60,maxSubSteps:3,lastTime:0,solverIterations:10,world:void 0,smoothing:.5},e||{}),!this.world){var t=new CANNON.World;t.quatNormalizeSkip=0,t.quatNormalizeFast=!1,t.gravity.set(0,-98,0),t.broadphase=new CANNON.NaiveBroadphase,t.solver.iterations=this.solverIterations,this.world=t}}return o(n,[{key:"update",value:function(e){var t=this;this.world.step(this.fixedTimeStep,e-this.lastTime,this.maxSubSteps),this.lastTime=e,this.world.bodies.forEach(function(e){e.velocity.scale(t.attenuation,e.velocity),e.angularVelocity.scale(t.attenuation,e.angularVelocity),e.mesh&&e.mesh.visible&&(0<e.mass?(e.mesh.position.copy(e.position),e.mesh.quaternion.copy(e.quaternion)):(e.mesh.matrixWorld.decompose(i,r,a),e.position.copy(i),e.quaternion.copy(r)))})}},{key:"addBody",value:function(e,t){var n=new CANNON.Body(Object.assign({mass:1},t));return n.addShape(e),this.world.add(n),n}},{key:"addParticle",value:function(e,t){t=Object.assign({radius:.1},t||{});var n=new CANNON.Particle;n.boundingSphereRadius=t.radius,console.log(n);var o=this.addBody(n,t);return o.position.copy(e.position),(o.mesh=e).collider=o}},{key:"addSphereMesh",value:function(e,t){e.geometry.boundingSphere||e.geometry.computeBoundingSphere();var n=Math.max(e.scale.x,Math.max(e.scale.y,e.scale.z)),o=this.addSphere(e.geometry.boundingSphere.radius*n,t);return o.position.copy(e.position),o.quaternion.copy(e.quaternion),(o.mesh=e).collider=o}},{key:"addSphere",value:function(e,t){return this.addBody(new CANNON.Sphere(e),t)}},{key:"addBoxMesh",value:function(e,t){e.geometry.boundingBox||e.geometry.computeBoundingBox();var n=new THREE.Vector3;e.geometry.boundingBox.getSize(n),n.multiply(e.scale);var o=new CANNON.Vec3(.5*n.x,.5*n.y,.5*n.z),i=this.addBox(o,t);return i.position.copy(e.position),i.quaternion.copy(e.quaternion),(i.mesh=e).collider=i}},{key:"addBox",value:function(e,t){var n=new CANNON.Box(e||v3(.5,.5,.5));return this.addBody(n,t)}},{key:"addPlane",value:function(e){var t=new CANNON.Plane;return this.addBody(t,e)}},{key:"removeBody",value:function(e){return this.world.removeBody(e),e}},{key:"removeConstraint",value:function(e){this.world.removeConstraint(e)}},{key:"addConstraint",value:function(e){return this.world.addConstraint(e),e}},{key:"addPointConstraint",value:function(e,t,n,o,i,r){var a=new CANNON.PointToPointConstraint(e,t,n,o);return a.collideConnected=void 0!==i&&i,this.addConstraint(a)}},{key:"addPlaneMesh",value:function(e,t){var n=new CANNON.Quaternion;n.copy(e.quaternion);var o=new CANNON.Vec3;o.copy(e.position);var i=this.addPlane(Object.assign({mass:0,quaternion:n,position:o},t||{}));return(i.mesh=e).collider=i}},{key:"addGround",value:function(e,t){var n=new CANNON.Quaternion;n.copy(e.quaternion);var o=new CANNON.Vec3;o.copy(e.position);var i=this.addPlane(Object.assign({mass:0,quaternion:n,position:o},t||{}));return(i.mesh=e).collider=i}}]),n}();t.exports=s},{}],2:[function(e,t,n){"use strict";var o=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}();var i=new THREE.Quaternion,r=new THREE.Vector3(1,1,1),a=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Object.assign(this,{transform:new THREE.Matrix4,offset:new THREE.Matrix4,bodyMatrix:new THREE.Matrix4,localMatrix:new THREE.Matrix4,matrixWorld:new THREE.Matrix4,body:null,debugMesh:null},e||{}),this.setup(this.transform)}return o(t,[{key:"setup",value:function(e){this.composeBodyMatrix();var t=(new THREE.Matrix4).getInverse(this.bodyMatrix);this.localMatrix.copy(t).multiply(e),this.offset.getInverse(e)}},{key:"update",value:function(){this.updateMatrixWorld(),this.debugMesh&&this.matrixWorld.decompose(this.debugMesh.position,this.debugMesh.quaternion,this.debugMesh.scale),this.transform.copy(this.matrixWorld).multiply(this.offset)}},{key:"updateMatrixWorld",value:function(){this.composeBodyMatrix(),this.matrixWorld.copy(this.bodyMatrix).multiply(this.localMatrix)}},{key:"composeBodyMatrix",value:function(){this.bodyMatrix.compose(this.body.position,i.copy(this.body.quaternion),r)}}]),t}();t.exports=a},{}],3:[function(e,t,n){"use strict";var o=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}();function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e){return e}var a=new(function(){function e(){i(this,e),this.tweens=[],this.elapsedTime=0}return o(e,[{key:"start",value:function(){this.updateTweens(0)}},{key:"updateTweens",value:function(){var e=performance.now();this.elapsedTime=e;for(var t=0;t<this.tweens.length;t++)this.tweens[t].update(e);window.requestAnimationFrame(this.updateTweens.bind(this))}},{key:"addTween",value:function(e){this.tweens.push(e)}},{key:"removeTween",value:function(e){var t=this.tweens.indexOf(e);-1!==t&&this.tweens.splice(t,1)}}]),e}());a.start();var s=function(){function n(e){i(this,n),Object.assign(this,{from:0,to:1,delay:0,duration:1e3,ease:r,elapsedTime:0,onStart:null,onUpdate:null,onComplete:null,repeat:!1,startTime:performance.now(),_started:!1,_stopped:!1,u:0,value:0,chainedTweens:[],target:null},e||{}),a.addTween(this)}return o(n,[{key:"chain",value:function(e){return this.chainedTweens.push(e),this}},{key:"start",value:function(){return this.startTime=a.elapsedTime+this.delay,this._stopped=!1,this._started=!1,this.update(a.elapsedTime),this}},{key:"stop",value:function(){return this._stopped=!0,this}},{key:"isDelayed",value:function(){return this.elapsedTime<=0}},{key:"update",value:function(e){var t,n,o;this._stopped||(this.elapsedTime=e-this.startTime,this.elapsedTime<=0||(this.elapsedTime<=this.duration?(this._started||(this._started=!0,this.onStart&&this.onStart(this)),this.u=this.elapsedTime/this.duration,this.value=(t=this.from,n=this.to,(1-(o=this.u))*t+o*n),this.onUpdate&&this.onUpdate(this.value,this.u)):(this.value=this.to,this.onUpdate&&this.onUpdate(this.value,1),this.onComplete&&this.onComplete(this),this.chainedTweens.length&&this.chainedTweens.forEach(function(e){e.start()}),this.repeat?this.start():this._stopped=!0)))}},{key:"clone",value:function(e){var t=new n(this);return e&&Object.assign(t,e),t}},{key:"remove",value:function(){a.removeTween(this)}}]),n}();t.exports=s},{}],4:[function(e,t,n){"use strict";t.exports=function(e,t){var n=this;t=Object.assign({antialias:!0,autoClearColor:!1,alpha:!0},t||{}),Object.assign(this,{width:window.innerWidth,height:window.innerHeight,aspect:window.innerWidth/window.innerHeight,renderer:e&&e.renderer?e.renderer:new THREE.WebGLRenderer(t),setSize:function(e,t){n.width=e||window.innerWidth,n.height=t||window.innerHeight,n.aspect=n.width/n.height,n.renderer&&n.renderer.setSize(n.width,n.height)},onResize:function(e){}},e||{}),this.container&&("string"==typeof this.container&&(this.container=document.getElementById(this.container)),this.container.appendChild(this.renderer.domElement)),function(e,t,n){n=n||window;var o=!1;n.addEventListener(e,function(){o||(o=!0,requestAnimationFrame(function(){n.dispatchEvent(new CustomEvent(t)),o=!1}))})}("resize","optimizedResize");var o=null;window.addEventListener("optimizedResize",function(e){o||(o=setTimeout(function(){o=null,n.setSize(),n.onResize(e,n.width,n.height)},50))}),this.setSize()}},{}],5:[function(e,t,n){"use strict";var o,i=e("./xmas.js"),r=(o=i)&&o.__esModule?o:{default:o};window.onload=function(){(0,r.default)()}},{"./xmas.js":8}],6:[function(e,t,n){"use strict";var o,i=e("./Joint.js"),m=(o=i)&&o.__esModule?o:{default:o};var v={skins:[],scene:void 0,cannon:void 0};t.exports={handleRig:function(e,t,o,d,n,i,r){if(o=o||v.scene,d=d||v.cannon,r=r||!1,o&&d){o.add(e);var a=e.getObjectByProperty("type","SkinnedMesh");a.castShadow=!0,a.receiveShadow=!0,a.material=t||new THREE.MeshNormalMaterial({skinning:!0}),a.skeleton.joints=[];for(var s=new THREE.Vector3,l=new THREE.Quaternion,c=new THREE.Vector3,u=(new THREE.Matrix4,0);u<a.skeleton.bones.length;u++)for(var h=a.skeleton.bones[u],f=0;f<h.children.length;f++)if("Mesh"===h.children[f].type){var p=h.children[f];p.updateMatrixWorld(),p.matrixWorld.clone().decompose(s,l,c),p.position.copy(s),p.quaternion.copy(l),p.scale.copy(c),o.add(p),p.material.wireframe=!0,p.visible=r,h.collider=d.addBoxMesh(p,{mass:1})}a.skeleton.bones.forEach(function(e,t){void 0===e.collider&&(e.collider=e.parent.collider),void 0===e.parent.collider&&(e.parent.collider=e.collider)}),a.skeleton.bones.forEach(function(e,t){if("Bone"===e.parent.type)if(e.collider&&e.parent.collider){var n=new THREE.Vector3(0,0,0);e.localToWorld(n);var o=new CANNON.Vec3(n.x,n.y,n.z),i=e.collider,r=e.parent.collider,a=new CANNON.Vec3,s=new CANNON.Vec3;i.pointToLocalFrame(o,a),r.pointToLocalFrame(o,s);var l=a.clone();l.normalize();var c=s.clone();c.normalize(),c.negate(c);var u=new CANNON.ConeTwistConstraint(i,r,{collideConnected:!1,maxForce:1/0,pivotA:a,pivotB:s,axisA:l,axisB:c,angle:1,twistAngle:1});d.addConstraint(u)}else console.log("shit "+t,e.parent.collider,e.collider)}),new THREE.Mesh(new THREE.BoxGeometry(.5,.05,.05),new THREE.MeshBasicMaterial({color:"red",wireframe:!0})),a.skeleton.bones.forEach(function(e,t){if(e.updateMatrixWorld(),e.matrixWorld.decompose(e.position,e.quaternion,e.scale),o.add(e),a.skeleton.boneInverses[t]=new THREE.Matrix4,e.collider){var n=new m.default({transform:e.matrixWorld,body:e.collider});a.skeleton.joints.push(n)}else console.log("NO COLLIDER!!: ",e)}),a.skeleton.bones.forEach(function(e,t){e.collider.position.x+=i.x,e.collider.position.y+=i.y,e.collider.position.z+=i.z}),n&&n(a),a.frustumCulled=!1,v.skins.push(a)}else console.error("we need to set the scene and cannon")},activeRigs:v}},{"./Joint.js":2}],7:[function(e,t,n){t.exports={allJoints:["head","neck","abdomen","chest","leftEye","rightEye","lFoot","lShin","lThigh","lCollar","lShldr","lForeArm","lHand","lMid1","rFoot","rShin","rThigh","rCollar","rShldr","rForeArm","rHand","rMid1"],curves:[["rFoot","rShin","rThigh","abdomen","chest","rCollar","head"],["lFoot","lShin","lThigh","lCollar","head"],["rFoot","rShin","rThigh","rCollar","neck","head"],["lFoot","lShin","lThigh","abdomen","lCollar","lShldr","lForeArm","lMid1"],["rFoot","rShin","rThigh","abdomen","rCollar","rShldr","rForeArm","rMid1"],["lFoot","lShin","lThigh","abdomen","chest","lCollar","lShldr","lForeArm","lHand","lMid1"],["rFoot","rShin","rThigh","abdomen","chest","rCollar","rShldr","rForeArm","rHand","rMid1"]]}},{}],8:[function(e,t,n){"use strict";var i=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}(),F=(a(e("save-as")),a(e("./ThreeView.js"))),q=a(e("../lsr/randomElement.js")),z=a(e("./CannonHelper.js")),V=a(e("./LilTween.js")),o=a(e("../lsr/coolorsToArray.js")),r=(a(e("./Joint.js")),a(e("startaudiocontext"))),D=(a(e("../lsr/AnimationCurve.js")),e("./rigHandler.js")),W=(e("../lsr/eases.js"),a(e("./static/controlCurveJoints.json")));function a(e){return e&&e.__esModule?e:{default:e}}(0,r.default)(Tone.context,"#container",function(){console.log("started audio context")});var U=new THREE.LoadingManager;U.onError=console.error;var G=new THREE.TextureLoader(U),Q=new THREE.FBXLoader(U),J=new THREE.FBXLoader(U),X=0,Y={actions:{},controlCurves:[],cvPoints:[],currentAction:null,debugSplines:[],jointAnchors:{},mixer:null,rig:null,attractables:[],DEBUG:!1,paused:!0,onDebugChange:function(e){var t=this;this.controlCurves.forEach(function(e){e.visible=t.DEBUG})}},s=new THREE.Mesh(new THREE.BoxGeometry(1,1,1),new THREE.MeshNormalMaterial({wireframe:!0}));s.scale.multiplyScalar(4),s.visible=Y.DEBUG,W.default.allJoints.forEach(function(e){Y.jointAnchors[e]=new THREE.Object3D({name:e+"_Anchor"});var t=s.clone();s.clone(),Y.jointAnchors[e].add(t)});var K=new THREE.Clock,Z=Math.PI,$=(Math.PI,.5*Math.PI),ee=THREE.Math.randFloat,l=THREE.Math.randInt;THREE.Math.lerp,THREE.Math.mapLinear;var te=(0,o.default)("https://coolors.co/0c0f0a-ff206e-40c5e6-b3e3f1-ffffff"),ne=["./static/91_23.fbx","./static/91_62.fbx","./static/104_45.fbx","./static/91_12.fbx","./static/144_04.fbx"],c=new THREE.Vector3,oe=function(){function o(e,t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),Object.assign(this,{collider:e,curveIndex:l(0,W.default.curves.length-1),u:0,seed:Math.random(),duration:2,point:new THREE.Vector3,isPaused:!1},t||{}),this.tween=new V.default({from:-.1,to:1,duration:ee(3e3,9e3),delay:ee(2e3,400),repeat:!0}),n&&Object.assign(this.tween,n),this.tween.start()}return i(o,[{key:"update",value:function(){var e=Y.controlCurves[this.curveIndex];e&&(this.isPaused||this.tween.isDelayed()||(this.u=THREE.Math.clamp(this.tween.value,0,1),e.getPointAt(this.u,this.point),c.copy(this.collider.position).sub(this.point),c.multiplyScalar(4),100<c.lengthSq()&&c.normalize().multiplyScalar(10),this.collider.velocity.scale(.8,this.collider.velocity),this.collider.velocity.vsub(c,this.collider.velocity)))}}]),o}();t.exports=function(e){var o=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.1,1e3);o.position.set(26.999946561312772,7.858134058508252,-8.185608902782029);var i=new F.default({container:"container"}),t=i.renderer;t.setClearColor(te[4],1),t.autoClear=!1,t.shadowMap.enabled=!0,t.shadowMap.type=THREE.PCFSoftShadowMap,D.activeRigs.scene=a;var n=new THREE.OrbitControls(o,t.domElement);n.target.set(0,10,0),n.update(),n.enabled=!1,n.enableDamping=!0,n.enableKeys=!1,n.enablePan=!1,n.enableRotate=!0,n.enableZoom=!0,n.maxPolarAngle=.9*Z,n.minPolarAngle=.1*Z,n.maxDistance=55,n.minDistance=10,n.dampingFactor=.95;var a=new THREE.Scene,m=new THREE.Object3D;m.visible=!1,a.add(m);var r=G.load("./static/boxRamp.png"),s=G.load("./static/wallPBR/tiledHeight.png",function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,e.anisotropy=16});Q.load("./static/drawingRoom.fbx",function(e){e.position.copy(v.position),e.traverse(function(e){"painting"===e.name?(e.material=(new THREE.MeshStandardMaterial).copy(e.material),e.material.roughness=.8,e.castShadow=!0):"frame"===e.name&&(e.castShadow=e.receiveShadow=!0)}),e.children.forEach(function(e){"floorBoards1"===e.name&&(e.material=new THREE.MeshStandardMaterial({color:"white",roughness:1,metalness:0}),e.receiveShadow=!0)}),a.add(e)});var l=new Tone.Player("static/TerrySnyder&JackCooper_C'estSiBon.mp3",function(){l.autostart=!0,l.loop=!0,l.playbackRate=.96,Y.currentAction&&(Y.currentAction.playbackRate=.96)}).toMaster();l.playbackRate=0,U.onLoad=function(e){document.getElementById("container").classList.remove("container-transparent"),setTimeout(function(){document.getElementById("loading").style.display="none",n.enabled=!0,Y.paused=!1,K.getDelta(),m.visible=!0,l.autostart=!0,l.playbackRate=.96},1500)};var c=document.getElementsByClassName("audio-toggle")[0],u=!0;c.onclick=function(e){u=!u,Tone.Master.mute=!u,Array.from(e.srcElement.children).forEach(function(e){u?e.classList.add("animate-audio"):e.classList.remove("animate-audio")})};var d=new THREE.DirectionalLight(te[4],.75);d.position.set(2,40,1),d.lookAt(new THREE.Vector3(0,0,0)),a.add(d);var h=41.25;d.castShadow=!0,d.shadow.mapSize.width=d.shadow.mapSize.height=1024,d.shadow.camera.near=1,d.shadow.camera.far=100,d.shadow.camera.left=-h,d.shadow.camera.right=h,d.shadow.camera.bottom=-h,d.shadow.camera.top=h,d.bias=0;var f=new THREE.PointLight(te[4],.9);f.power=2,f.position.y=27.5,a.add(f);var p=new THREE.AmbientLight(te[4],.66);a.add(p);var v=new THREE.Mesh(new THREE.PlaneGeometry(55,55,10,10),new THREE.MeshStandardMaterial({color:te[4].clone().multiplyScalar(.5),roughness:.95,metalness:0,map:r}));v.receiveShadow=!0,v.position.y=1,v.quaternion.setFromAxisAngle(new THREE.Vector3(1,0,0),-Z/2),a.add(v);var w=new z.default({solverIterations:2});w.world.gravity.set(0,-100,0),w.addGround(v),(D.activeRigs.cannon=w).addGround(v);var E=new THREE.MeshStandardMaterial({roughness:.35,metalness:0,map:r,color:te[3],bumpMap:s,bumpScale:-.4}),y=v.clone();y.quaternion.set(0,0,0,1),y.position.y=v.position.y+55/4,y.position.z=-27.5,y.scale.y=.5,a.add(y);var g=y.clone();g.quaternion.setFromAxisAngle(new THREE.Vector3(1,0,0),-Z),g.position.y=y.position.y,g.position.z=27.5,g.scale.y=y.scale.y,a.add(g);var b=v.clone();b.quaternion.setFromAxisAngle(new THREE.Vector3(0,1,0),$),b.position.y=y.position.y,b.position.x=-27.5,b.scale.y=y.scale.y,a.add(b);var T=v.clone();T.quaternion.setFromAxisAngle(new THREE.Vector3(0,1,0),-$),T.position.y=y.position.y,T.position.x=27.5,T.scale.y=y.scale.y,a.add(T),w.addPlaneMesh(y),w.addPlaneMesh(g),w.addPlaneMesh(b),w.addPlaneMesh(T),y.material=E,g.material=E,b.material=E,T.material=E,y.frustumCulled=!1,g.frustumCulled=!1,b.frustumCulled=!1,T.frustumCulled=!1;var M=new V.default({duration:1e3,delay:3e3,onStart:function(){Y.currentAction&&(Y.currentAction.reset().play(),Y.currentAction.getRoot().traverse(function(e){Y.jointAnchors[e.name]&&e.add(Y.jointAnchors[e.name])}),x.start()),Y.attractables.forEach(function(e){e.isPaused=!1})}}),R=new V.default({from:.96,to:0,duration:2e3,onUpdate:function(e){l.playbackRate=e}}),x=new V.default({from:0,to:.96,duration:300,onUpdate:function(e){l.playbackRate=e}}),S=[];function H(e,t){S.push({action:e,name:t})}function k(e,i,r,a,t){Q.load(e,function(e){(0,D.handleRig)(e,t||new THREE.MeshNormalMaterial({skinning:!0}),m,w,function(e){var o=e.skeleton.bones;o.forEach(function(e,t){if(e.collider.mass=a,t%3){var n=new oe(e.collider,{curveIndex:i},{duration:r,delay:1*r*t/o.length,onComplete:function(){this.delay=1.25*this.duration}});Y.attractables.push(n)}})},new THREE.Vector3(ee(-10,10),ee(20,40),ee(-10,10)),!1)},void 0,console.error)}Q.load(ne[0],function(e){!function(){for(var e=1;e<ne.length;e++)J.load(ne[e],function(e){var t=new THREE.Group;t.scale.set(.1,.1,.1),t.add(e),m.add(t),new THREE.AnimationMixer(e);var n=Y.mixer.clipAction(e.animations[0],e);n.timeScale=1,H(Y.actions[e.name]=n,e.name),n.loop=THREE.LoopOnce,n.clampWhenFinished=!0},void 0,console.error)}(),null===Y.mixer&&(Y.mixer=new THREE.AnimationMixer(e),Y.mixer.addEventListener("finished",function(e){var t=(S.push(S.shift()),S[0]).action;Y.currentAction=t,Y.attractables.forEach(function(e){e.isPaused=!0}),M.start(),R.start()}));var t=Y.mixer.clipAction(e.animations[0],e);t.timeScale=1,H(Y.actions[e.name]=t,e.name),Y.mixerRoot=e,t.loop=THREE.LoopOnce,t.clampWhenFinished=!0,null===Y.currentAction&&(Y.currentAction=t,Y.currentAction.play(),Y.currentAction.playbackRate=l.playbackRate),null===Y.rig&&(e.scale.multiplyScalar(.1),m.add(e),(Y.rig=e).traverse(function(e){Y.jointAnchors[e.name]&&e.add(Y.jointAnchors[e.name])}),W.default.curves.forEach(function(e,t){var n=e.map(function(e){var t=new THREE.Vector3(ee(-1,1),ee(-1,1),ee(-1,1));t.multiplyScalar(4);var n={transform:Y.jointAnchors[e],pos:new THREE.Vector3(0,0,0),offset:t};return Y.cvPoints.push(n),n.pos}),o=new THREE.CatmullRomCurve3(n);Y.controlCurves.push(o);var i=(new THREE.BufferGeometry).setFromPoints(o.getPoints(50)),r=new THREE.LineBasicMaterial({color:(new THREE.Color).setHSL(t/(W.default.curves.length-1),1,.5)});o.line=new THREE.Line(i,r),o.line.frustumCulled=!1,a.add(o.line)}))},void 0,console.error);var C=new THREE.MeshStandardMaterial({color:16717591,roughness:1,metalness:.3,skinning:!0});C.clone().color.set(16777215);var A=new THREE.MeshPhysicalMaterial({skinning:!0,color:new THREE.Color(15934243),metalness:.75,roughness:.25,side:2,reflectivity:2}),N=A.clone();N.color.set(10070698);var O=A.clone();O.color.set(2359295);k("./static/ribbonSkinShort.fbx",1,17e3,.1,C),k("./static/ribbonSkinShort.fbx",3,5e3,.1,C),k("./static/ribbonSkinShort.fbx",4,7e3,.1,C),k("./static/ribbonSkinShort.fbx",3,15e3,.1,C),k("./static/ribbonSkinShort.fbx",4,3e3,.1,C),k("./static/tinselSkin.fbx",5,6e3,.1,A),k("./static/tinselSkin.fbx",6,3e3,.1,N),k("./static/tinselSkin.fbx",2,8e3,.1,O),k("./static/tinselSkin.fbx",3,12e3,.1,O),k("./static/tinselSkinLong.fbx",4,9e3,.1,N);var P=new THREE.MeshStandardMaterial({color:10066329,metalness:.66,roughness:.7}),j=[.25,.25,.25,.25,.75,.25,.25,.5,.5],B=[].map(function(e){return new THREE.MeshStandardMaterial({metalness:.5,map:G.load(e),color:16777215})});B.push(new THREE.MeshStandardMaterial({color:15934243,metalness:.75,roughness:.65})),B.push(new THREE.MeshStandardMaterial({color:2359295,metalness:.75,roughness:.65})),B.push(new THREE.MeshStandardMaterial({color:"silver",metalness:.25})),Q.load("./static/ornament.fbx",function(e){for(var t=0;t<37;t++){var n=(0,q.default)(j),o=e.clone(),i=o.getObjectByName("hook"),r=o.getObjectByName("ball");i.castShadow=i.receiveShadow=!0,r.castShadow=r.receiveShadow=!0,i.material=P,r.material=(0,q.default)(B),o.position.set(ee(-10,10),ee(10,20),ee(-10,10)),o.rotation.x=ee(-2,2),o.rotation.y=ee(-2,2),o.scale.multiplyScalar(n);var a=w.addSphere(n,{mass:.05});a.position.copy(o.position),a.quaternion.copy(o.quaternion),(a.mesh=o).collider=a;var s=new oe(o.collider);Y.attractables.push(s),m.add(o)}},void 0,console.error),Q.load("./static/gifts.fbx",function(e){var t=new THREE.MeshStandardMaterial({color:16717591,roughness:.86,metalness:.3,side:2}),n=new THREE.MeshStandardMaterial({color:15987703}),o=G.load("./static/diagnolStripes.png"),i=new THREE.MeshStandardMaterial({color:new THREE.Color("silver"),roughness:.125,metalness:.5,metalnessMap:o,bumpScale:.005,bumpMap:o}),r=G.load("./static/dots.png"),a=new THREE.MeshStandardMaterial({color:1570815,map:r,roughness:.125,metalness:.5,metalnessMap:r,bumpScale:.005,bumpMap:r});a.metalnessMap=a.bumpMap=r;var s=[a,n,n,i,a,n,i],l=[t,t.clone(),t.clone()];l[0].color.set("silver"),l[1].color.set(1550271),e.traverse(function(e){"bow"===e.name||"ribbon"===e.name?(e.material=t,e.castShadow=e.receiveShadow=!0):"box"===e.name&&(e.geometry.computeBoundingBox(),e.castShadow=e.receiveShadow=!0)});for(var c=0;c<37;c++){var u=(0,q.default)(e.children).clone();u.position.set(ee(-10,10),ee(5,12),ee(-10,10)),u.rotation.x=ee(-2,2),u.rotation.y=ee(-2,2),m.add(u),u.children[0].material=u.children[2].material=(0,q.default)(l),.35<Math.random()&&(u.children[0].visible=!1),u.children[1].material=(0,q.default)(s);var d=new THREE.Vector3;u.children[1].geometry.boundingBox.getSize(d);var h=new CANNON.Vec3(.5*d.x,.5*d.y,.5*d.z),f=w.addBox(h,{mass:.4});f.position.copy(u.position),f.quaternion.copy(u.quaternion),(f.mesh=u).collider=f;var p=new oe(u.collider);Y.attractables.push(p)}},void 0,console.error);new CANNON.Vec3,new CANNON.Vec3(0,5,0);var I=new THREE.Vector3,_=(new THREE.Vector3,new THREE.Quaternion,new THREE.Vector3,function(){if(!Y.paused){var e=K.getDelta();X=K.getElapsedTime(),Y.mixer&&Y.mixer.update(e),w.update(X),Y.DEBUG&&Y.controlCurves.forEach(function(e){e.line.geometry.setFromPoints(e.getPoints(50))}),Y.cvPoints.forEach(function(e){e.pos.copy(e.offset),e.transform.localToWorld(e.pos)}),Y.attractables.forEach(function(e){e.update()}),Y.jointAnchors.abdomen&&(I.set(0,0,0),Y.jointAnchors.abdomen.localToWorld(I),I.y-=3,n.target.lerp(I,.05),o.position.x=THREE.Math.clamp(o.position.x,-27,27),o.position.y=Math.max(v.position.y+1,o.position.y),o.position.z=THREE.Math.clamp(o.position.z,-27,27),n.update()),D.activeRigs.skins.forEach(function(o){o.skeleton.joints.forEach(function(e,t){e.update();var n=o.skeleton.bones[t];e.transform.decompose(n.position,n.quaternion,new THREE.Vector3)})})}}),L=function(){t.render(a,o,null,!0)};i.onResize=function(e,t,n){o.aspect=i.aspect,o.updateProjectionMatrix()},window.addEventListener("keypress",function(e){switch(e.key){case"s":break;case"c":return void console.log(o.position.toArray().join(", "));default:return}}),document.addEventListener("visibilitychange",function(e){console.log(e.type,document.hidden),document.hidden?(Y.paused=!0,l.playbackRate=0):(Y.paused=!1,l.playbackRate=.96,K.getDelta())},!1),console.log("%cMRRY\nXMAS","color: #ff1717; font-size: 120px;"),function e(){requestAnimationFrame(e),_(),L()}()}},{"../lsr/AnimationCurve.js":9,"../lsr/coolorsToArray.js":10,"../lsr/eases.js":11,"../lsr/randomElement.js":12,"./CannonHelper.js":1,"./Joint.js":2,"./LilTween.js":3,"./ThreeView.js":4,"./rigHandler.js":6,"./static/controlCurveJoints.json":7,"save-as":13,startaudiocontext:14}],9:[function(e,t,n){"use strict";var o=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}();var i=function(e,t,n,o,i){return t===n?.5*(o+i):o+(e-t)*(i-o)/(n-t)},r=function(e,t,n){return(1-n)*e+n*t},a=function(e){return e<=0?0:1<=e?1:e*e*(3-2*e)},s=function(e,t){return e.u-t.u},l=0,c=0,u=0,d=0,h=0,f=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Object.assign(this,{controlPoints:[],curveIsNumeric:null,defaultEase:a,needsUpdate:!0,sortFunc:s,u:0,value:0},e||{})}return o(t,[{key:"sample",value:function(e){var t=this;return 0===this.controlPoints.length?0:(this.needsUpdate&&this.updateCurve(),this.u=e,l=this.getLowIndex(e),c=Math.min(this.controlPoints.length-1,l+1),u=this.controlPoints[l],d=this.controlPoints[c],h=u.ease(i(e,u.u,d.u,0,1)),this.curveIsNumeric?this.value=r(u.value,d.value,h):Object.keys(this.value).forEach(function(e){t.value[e]=r(u.value[e],d.value[e],h)}),this.value)}},{key:"getLowIndex",value:function(e){if(e<=this.controlPoints[0].u)return 0;for(var t=0;t<this.controlPoints.length-1;t++)if(e<this.controlPoints[t+1].u)return t;return Math.max(0,this.controlPoints.length-1)}},{key:"add",value:function(e,t,n){var o={value:e,u:t,ease:n||this.defaultEase};this.controlPoints.push(o),this.needsUpdate=!0}},{key:"updateCurve",value:function(){this.needsUpdate=!1,this.curveIsNumeric=!isNaN(this.controlPoints[0].value),0!==this.controlPoints.length&&this.controlPoints.sort(this.sortFunc)}},{key:"normalize",value:function(){this.needsUpdate&&this.updateCurve();var t=this.controlPoints[0].u,n=this.controlPoints[this.controlPoints.length-1].u;this.controlPoints.forEach(function(e){e.u=i(e.u,t,n,0,1)})}},{key:"pointsFromArray",value:function(e){var n=this;return e.map(function(e,t){return{u:t,value:e,ease:n.defaultEase||a}})}}]),t}();t.exports=f},{}],10:[function(e,t,n){"use strict";t.exports=function(e){return e.split("/").pop().split("-").map(function(e){return new THREE.Color("#"+e)})}},{}],11:[function(e,t,n){"use strict";var o=function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},i=function(e){return 1-o(1-e)};t.exports={zero:function(){return 0},one:function(){return 1},linear:function(e){return e},smooth:function(e){return e<=0?0:1<=e?1:e*e*(3-2*e)},smoother:function(e){return e<=0?0:1<=e?1:e*e*e*(e*(6*e-15)+10)},QuadraticIn:function(e){return e*e},QuadraticOut:function(e){return e*(2-e)},QuadraticInOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)},CubicIn:function(e){return e*e*e},CubicOut:function(e){return--e*e*e+1},CubicInOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)},QuarticIn:function(e){return e*e*e*e},QuarticOut:function(e){return 1- --e*e*e*e},QuarticInOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)},QuinticIn:function(e){return e*e*e*e*e},QuinticOut:function(e){return--e*e*e*e*e+1},QuinticInOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)},SinusoidalIn:function(e){return 1-Math.cos(e*Math.PI/2)},SinusoidalOut:function(e){return Math.sin(e*Math.PI/2)},SinusoidalInOut:function(e){return.5*(1-Math.cos(Math.PI*e))},ExponentialIn:function(e){return 0===e?0:Math.pow(1024,e-1)},ExponentialOut:function(e){return 1===e?1:1-Math.pow(2,-10*e)},ExponentialInOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))},CircularIn:function(e){return 1-Math.sqrt(1-e*e)},CircularOut:function(e){return Math.sqrt(1- --e*e)},CircularInOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},ElasticIn:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},ElasticOut:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},ElasticInOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1},BackIn:function(e){return e*e*(2.70158*e-1.70158)},BackOut:function(e){return--e*e*(2.70158*e+1.70158)+1},BackInOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)},BounceOut:o,BounceIn:i,BounceInOut:function(e){return e<.5?.5*i(2*e):.5*o(2*e-1)+.5}}},{}],12:[function(e,t,n){"use strict";t.exports=function(e){if(Array.isArray(e))return e[Math.floor(Math.random()*e.length)];if(e instanceof Object){var t=Object.keys(e);return e[t[Math.floor(Math.random()*t.length)]]}return e}},{}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=n.saveAs=window.saveAs||function(p){if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var e=p.document,m=function(){return p.URL||p.webkitURL||p},v=e.createElementNS("http://www.w3.org/1999/xhtml","a"),w="download"in v,E=/Version\/[\d\.]+.*Safari/.test(navigator.userAgent),y=p.webkitRequestFileSystem,g=p.requestFileSystem||y||p.mozRequestFileSystem,r=function(e){(p.setImmediate||p.setTimeout)(function(){throw e},0)},b="application/octet-stream",T=0,M=function(e){setTimeout(function(){"string"==typeof e?m().revokeObjectURL(e):e.remove()},4e4)},R=function(e,t,n){for(var o=(t=[].concat(t)).length;o--;){var i=e["on"+t[o]];if("function"==typeof i)try{i.call(e,n||e)}catch(e){r(e)}}},x=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e},o=function e(o,n,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t||(o=x(o));var i,r,a,s=this,l=o.type,c=!1,u=function(){R(s,"writestart progress write writeend".split(" "))},d=function(){if(r&&E&&"undefined"!=typeof FileReader){var t=new FileReader;return t.onloadend=function(){var e=t.result;r.location.href="data:attachment/file"+e.slice(e.search(/[,;]/)),s.readyState=s.DONE,u()},t.readAsDataURL(o),void(s.readyState=s.INIT)}(!c&&i||(i=m().createObjectURL(o)),r)?r.location.href=i:void 0===p.open(i,"_blank")&&E&&(p.location.href=i);s.readyState=s.DONE,u(),M(i)},h=function(e){return function(){if(s.readyState!==s.DONE)return e.apply(this,arguments)}},f={create:!0,exclusive:!1};if(s.readyState=s.INIT,n||(n="download"),w)return i=m().createObjectURL(o),void setTimeout(function(){var e,t;v.href=i,v.download=n,e=v,t=new MouseEvent("click"),e.dispatchEvent(t),u(),M(i),s.readyState=s.DONE});p.chrome&&l&&l!==b&&(a=o.slice||o.webkitSlice,o=a.call(o,0,o.size,b),c=!0),y&&"download"!==n&&(n+=".download"),(l===b||y)&&(r=p),g?(T+=o.size,g(p.TEMPORARY,T,h(function(e){e.root.getDirectory("saved",f,h(function(e){var t=function(){e.getFile(n,f,h(function(n){n.createWriter(h(function(t){t.onwriteend=function(e){r.location.href=n.toURL(),s.readyState=s.DONE,R(s,"writeend",e),M(n)},t.onerror=function(){var e=t.error;e.code!==e.ABORT_ERR&&d()},"writestart progress write abort".split(" ").forEach(function(e){t["on"+e]=s["on"+e]}),t.write(o),s.abort=function(){t.abort(),s.readyState=s.DONE},s.readyState=s.WRITING}),d)}),d)};e.getFile(n,{create:!1},h(function(e){e.remove(),t()}),h(function(e){e.code===e.NOT_FOUND_ERR?t():d()}))}),d)}),d)):d()},t=o.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return n||(e=x(e)),navigator.msSaveOrOpenBlob(e,t||"download")}:(t.abort=function(){this.readyState=this.DONE,R(this,"abort")},t.readyState=t.INIT=0,t.WRITING=1,t.DONE=2,t.error=t.onwritestart=t.onprogress=t.onwrite=t.onabort=t.onerror=t.onwriteend=null,function(e,t,n){return new o(e,t,n)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||(void 0).content);n.default=o},{}],14:[function(e,t,n){var o,i;o=this,i=function(){var a=function(e,t){this._dragged=!1,this._element=e,this._bindedMove=this._moved.bind(this),this._bindedEnd=this._ended.bind(this,t),e.addEventListener("touchstart",this._bindedEnd),e.addEventListener("touchmove",this._bindedMove),e.addEventListener("touchend",this._bindedEnd),e.addEventListener("mouseup",this._bindedEnd)};function r(e){return"running"===e.state}return a.prototype._moved=function(e){this._dragged=!0},a.prototype._ended=function(e){var t,n,o;this._dragged||(n=(t=e).createBuffer(1,1,t.sampleRate),(o=t.createBufferSource()).buffer=n,o.connect(t.destination),o.start(0),t.resume&&t.resume()),this._dragged=!1},a.prototype.dispose=function(){this._element.removeEventListener("touchstart",this._bindedEnd),this._element.removeEventListener("touchmove",this._bindedMove),this._element.removeEventListener("touchend",this._bindedEnd),this._element.removeEventListener("mouseup",this._bindedEnd),this._bindedMove=null,this._bindedEnd=null,this._element=null},function(o,e,t){var n=new Promise(function(e){var t,n;n=e,r(t=o)?n():function e(){r(t)?n():(requestAnimationFrame(e),t.resume&&t.resume())}()}),i=[];return e||(e=document.body),function e(t,n,o){if(Array.isArray(t)||NodeList&&t instanceof NodeList)for(var i=0;i<t.length;i++)e(t[i],n,o);else if("string"==typeof t)e(document.querySelectorAll(t),n,o);else if(t.jquery&&"function"==typeof t.toArray)e(t.toArray(),n,o);else if(Element&&t instanceof Element){var r=new a(t,o);n.push(r)}}(e,i,o),n.then(function(){for(var e=0;e<i.length;e++)i[e].dispose();i=null,t&&t()}),n}},"function"==typeof define&&define.amd?define([],i):"object"==typeof t&&t.exports?t.exports=i():o.StartAudioContext=i()},{}]},{},[5]);
//# sourceMappingURL=bundle.js.map
