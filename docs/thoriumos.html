<!DOCTYPE html>
<html lang="en-US" itemscope itemtype="http://schema.org/WebPage">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>ThoriumOS Developer Guide</title>
        <link rel="stylesheet" type="text/css" href="static/base.css" />
        <link rel="stylesheet" type="text/css" href="static/doc.css" />
        <link rel="stylesheet" type="text/css" href="static/prettify/prettify.css" />
        <meta name="color-scheme" content="light dark">
        <!-- default customHeadTagPart -->
    </head>
    <body class="Site">
        <div class="Site-content Site-Content--markdown">
            <div class="Container">
                <div class="doc">
                    <h1>
                        <a class="h" name="ThoriumOS-Developer-Guide" href="#ThoriumOS-Developer-Guide"><span></span></a><a class="h" name="chromiumos-developer-guide" href="#chromiumos-developer-guide"><span></span></a>ThoriumOS
                        Developer Guide
                    </h1>
                    <h2>
                        <a class="h" name="Introduction" href="#Introduction"><span></span></a><a class="h" name="introduction" href="#introduction"><span></span></a>Introduction
                    </h2>
                    <p>This guide describes how to work on ThoriumOS. If you want to help develop ThoriumOS and you&lsquo;re looking for detailed information about how to get started, you&rsquo;re in the right place.</p>
                    <div class="toc" role="navigation">
                        <h2>Contents</h2>
                        <div class="toc-aux">
                            <ul>
                                <li><a href="#Introduction">Introduction</a></li>
                                <ul>
                                    <li><a href="#Target-audience">Target audience</a></li>
                                    <li><a href="#Organization-content">Organization &amp; content</a></li>
                                    <li><a href="#Typography-conventions">Typography conventions</a></li>
                                    <li><a href="#Modifying-this-document">Modifying this document</a></li>
                                    <li><a href="#More-information">More information</a></li>
                                </ul>
                                <li><a href="#Prerequisites">Prerequisites</a></li>
                                <ul>
                                    <li><a href="#Python">Python</a></li>
                                    <li><a href="#Install-development-tools">Install development tools</a></li>
                                    <li><a href="#Install-depot_tools">Install depot_tools</a></li>
                                    <li><a href="#Tweak-your-sudoers-configuration">Tweak your sudoers configuration</a></li>
                                    <li><a href="#Set-locale">Set locale</a></li>
                                    <li><a href="#Configure-git">Configure git</a></li>
                                    <li><a href="#Get-credentials-to-access-source-repos">Get credentials to access source repos</a></li>
                                    <li><a href="#Double_check-that-you-are-running-a-64_bit-architecture">Double-check that you are running a 64-bit architecture</a></li>
                                    <li><a href="#Verify-that-your-default-file-permissions-umask_setting-is-correct">Verify that your default file permissions (umask) setting is correct</a></li>
                                </ul>
                                <li><a href="#Get-the-Source">Get the Source</a></li>
                                <ul>
                                    <li><a href="#Decide-where-your-source-will-live">Decide where your source will live</a></li>
                                    <li><a href="#Get-the-source-code">Get the source code</a></li>
                                    <li><a href="#Make-sure-you-are-authorized-to-access-Google-Storage-GS_buckets">Make sure you are authorized to access Google Storage (GS) buckets</a></li>
                                    <li><a href="#Authenticate-for-remote-Bazel-caching-with-RBE_if-applicable">Authenticate for remote Bazel caching with RBE, if applicable</a></li>
                                </ul>
                                <li><a href="#Building-ThoriumOS">Building ThoriumOS</a></li>
                                <ul>
                                    <li><a href="#Create-a-chroot">Create a chroot</a></li>
                                    <li><a href="#Select-a-board">Select a board</a></li>
                                    <li><a href="#Set-the-chronos-user-password">Set the chronos user password</a></li>
                                    <li><a href="#Build-the-packages-for-your-board">Build the packages for your board</a></li>
                                    <li><a href="#Build-a-disk-image-for-your-board">Build a disk image for your board</a></li>
                                    <li><a href="#Look-at-your-disk-image-optional">Look at your disk image (optional)</a></li>
                                </ul>
                                <li><a href="#Installing-ThoriumOS-on-your-Device">Installing ThoriumOS on your Device</a></li>
                                <ul>
                                    <li><a href="#Put-your-image-on-a-USB-disk">Put your image on a USB disk</a></li>
                                    <li><a href="#Enter-Developer-Mode">Enter Developer Mode</a></li>
                                    <li><a href="#Boot-from-your-USB-disk">Boot from your USB disk</a></li>
                                    <li><a href="#Getting-to-a-command-prompt-on-ThoriumOS">Getting to a command prompt on ThoriumOS</a></li>
                                    <li><a href="#Installing-your-ThoriumOS-image-to-your-hard-disk">Installing your ThoriumOS image to your hard disk</a></li>
                                    <li><a href="#vm">Running an image in a virtual machine</a></li>
                                </ul>
                                <li><a href="#Making-changes-to-packages-whose-source-code-is-checked-into-ThoriumOS-git-repositories">Making changes to packages whose source code is checked into ThoriumOS git repositories</a></li>
                                <ul>
                                    <li><a href="#Keep-the-tree-green">Keep the tree green</a></li>
                                    <li><a href="#Run-cros-workon-start">Run cros workon start</a></li>
                                    <li><a href="#Run-repo-sync">Run repo sync</a></li>
                                    <li><a href="#Find-out-which-ebuilds-map-to-which-directories">Find out which ebuilds map to which directories</a></li>
                                    <li><a href="#Create-a-branch-for-your-changes">Create a branch for your changes</a></li>
                                    <li><a href="#Make-your-changes">Make your changes</a></li>
                                    <li><a href="#Set-your-editor">Set your editor</a></li>
                                    <li><a href="#Submit-changes-locally">Submit changes locally</a></li>
                                    <li><a href="#Upload-your-changes-and-get-a-code-review">Upload your changes and get a code review</a></li>
                                    <li><a href="#Clean-up-after-you_re-done-with-your-changes">Clean up after you&#39;re done with your changes</a></li>
                                </ul>
                                <li><a href="#Making-changes-to-non_cros_workon_able-packages">Making changes to non-cros-workon-able packages</a></li>
                                <ul>
                                    <li><a href="#Adding-small-patches-to-existing-packages">Adding small patches to existing packages</a></li>
                                    <li><a href="#Making-changes-to-the-way-that-the-chroot-is-constructed">Making changes to the way that the chroot is constructed</a></li>
                                    <li><a href="#Building-an-individual-package">Building an individual package</a></li>
                                    <li><a href="#Making-changes-to-the-Chromium-web-browser-on-ThoriumOS">Making changes to the Chromium web browser on ThoriumOS</a></li>
                                </ul>
                                <li><a href="#Local-Debugging">Local Debugging</a></li>
                                <ul>
                                    <li><a href="#Debugging-both-x86-and-non_x86-binaries-on-your-workstation">Debugging both x86 and non-x86 binaries on your workstation</a></li>
                                    <li><a href="#Printing-stack-traces-at-runtime">Printing stack traces at runtime</a></li>
                                </ul>
                                <li><a href="#Remote-Debugging">Remote Debugging</a></li>
                                <ul>
                                    <li><a href="#Setting-up-remote-debugging-by-hand">Setting up remote debugging by hand</a></li>
                                    <li><a href="#Automated-remote-debugging-using-gdb_BOARD_script-gdb_lumpy_gdb_daisy_gdb_parrot_etc">Automated remote debugging using gdb-${BOARD} script (gdb-lumpy, gdb-daisy, gdb-parrot, etc)</a></li>
                                    <li><a href="#Edit_Debug-cycle">Edit/Debug cycle</a></li>
                                    <li><a href="#Examples-of-debugging-using-the-gdb_BOARD_script">Examples of debugging using the gdb-${BOARD} script</a></li>
                                </ul>
                                <li><a href="#Building-Chrome-for-ThoriumOS">Building Chrome for ThoriumOS</a></li>
                                <li><a href="#Troubleshooting">Troubleshooting</a></li>
                                <ul>
                                    <li><a href="#I-lost-my-developer-tools-on-the-stateful-partition_can-I-get-them-back">I lost my developer tools on the stateful partition, can I get them back?</a></li>
                                    <li><a href="#Disabling-Enterprise-Enrollment">Disabling Enterprise Enrollment</a></li>
                                </ul>
                                <li><a href="#Running-Tests">Running Tests</a></li>
                                <ul>
                                    <li><a href="#Set-up-SSH-connection-between-chroot-and-DUT">Set up SSH connection between chroot and DUT</a></li>
                                    <li><a href="#Tast">Tast</a></li>
                                    <li><a href="#Autotest">Autotest</a></li>
                                    <li><a href="#Creating-a-normal-image-that-has-been-modified-for-test">Creating a normal image that has been modified for test</a></li>
                                    <li><a href="#Creating-a-recovery-image-that-has-been-modified-for-test">Creating a recovery image that has been modified for test</a></li>
                                </ul>
                                <li><a href="#Additional-information">Additional information</a></li>
                                <ul>
                                    <li><a href="#Entering-a-shell-in-the-chroot">Entering a shell in the chroot</a></li>
                                    <li><a href="#Updating-the-chroot">Updating the chroot</a></li>
                                    <li><a href="#Documentation-on-this-site">Documentation on this site</a></li>
                                    <li><a href="#External-documentation">External documentation</a></li>
                                </ul>
                            </ul>
                        </div>
                    </div>
                    <h3>
                        <a class="h" name="Target-audience" href="#Target-audience"><span></span></a><a class="h" name="target-audience" href="#target-audience"><span></span></a>Target audience
                    </h3>
                    <p>
                        The target audience of this guide is anyone who wants to obtain, build, or contribute to ThoriumOS. That includes new developers who are interested in the project and who simply want to browse through the ThoriumOS
                        code, as well as developers who have been working on ThoriumOS for a long time.
                    </p>
                    <h3>
                        <a class="h" name="Organization-content" href="#Organization-content"><span></span></a><a class="h" name="organization-content" href="#organization-content"><span></span></a>Organization &amp; content
                    </h3>
                    <p>
                        This guide describes the common tasks required to develop ThoriumOS. The guide is organized linearly, so that developers who are new to ThoriumOS can follow the tasks in sequence. The tasks are grouped into the
                        following sections:
                    </p>
                    <ul>
                        <li><a href="#Prerequisites">Prerequisites</a></li>
                        <li><a href="#Get-the-Source">Getting the source code</a></li>
                        <li><a href="#Building-ThoriumOS">Building ThoriumOS</a></li>
                        <li><a href="#Installing-ThoriumOS-on-your-Device">Installing ThoriumOS on your Device</a></li>
                        <li><a href="#Making-changes-to-packages-whose-source-code-is-checked-into-ThoriumOS-git-repositories">Making changes to packages whose source code is checked into ThoriumOS git repositories</a></li>
                        <li><a href="#Making-changes-to-non_cros-workon_able-packages">Making changes to non-cros-workon-able packages</a></li>
                        <li><a href="#Local-Debugging">Local Debugging</a></li>
                        <li><a href="#Remote-Debugging">Remote Debugging</a></li>
                        <li><a href="#Troubleshooting">Troubleshooting</a></li>
                        <li><a href="#Running-Tests">Running Tests</a></li>
                        <li><a href="#Additional-information">Additional information</a></li>
                    </ul>
                    <h3>
                        <a class="h" name="Typography-conventions" href="#Typography-conventions"><span></span></a><a class="h" name="typography-conventions" href="#typography-conventions"><span></span></a>Typography conventions
                    </h3>
                    <ul>
                        <li>
                            <strong>Commands</strong> are shown with different labels to indicate whether they apply to (1) your build computer (the computer on which you&#39;re doing development), or (2) your ThoriumOS computer (the
                            device on which you run the images you build):
                        </li>
                    </ul>
                    <table>
                        <thead>
                            <tr>
                                <th>Label</th>
                                <th>Commands</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code class="code">(outside)</code></td>
                                <td>on your build computer, outside the chroot</td>
                            </tr>
                            <tr>
                                <td><code class="code">(device)</code></td>
                                <td>on your ThoriumOS computer</td>
                            </tr>
                        </tbody>
                    </table>
                    <p>Beneath the label, the command(s) you should type are prefixed with a generic shell prompt, <code class="code">$ </code>. This distinguishes input from the output of commands, which is not so prefixed.</p>
                    <ul>
                        <li>
                            <strong>Notes</strong> are shown using the following conventions:
                            <ul>
                                <li><strong>IMPORTANT NOTE</strong> describes required actions and critical information</li>
                                <li><strong>SIDE NOTE</strong> describes explanations, related information, and alternative options</li>
                            </ul>
                        </li>
                        <li><strong>TODO</strong> describes questions or work that is needed on this document</li>
                    </ul>
                    <h3>
                        <a class="h" name="Modifying-this-document" href="#Modifying-this-document"><span></span></a><a class="h" name="modifying-this-document" href="#modifying-this-document"><span></span></a>Modifying this document
                    </h3>
                    <p>If you&#39;re a ThoriumOS developer, <strong>YOU SHOULD UPDATE THIS DOCUMENT</strong> and fix things as appropriate. See <a href="README.md">README.md</a> for how to update this document. Bias towards action:</p>
                    <ul>
                        <li>If you see a TODO and you know the right answer, fix it!</li>
                        <li>If you see something wrong, fix it.</li>
                        <li>If you&lsquo;re not sure of the perfect answer, still fix it. Stick in a TODO noting your uncertainty if you aren&rsquo;t sure, but don&#39;t let anything you know to be wrong stick around.</li>
                    </ul>
                    <p>Please try to abide by the following guidelines when you modify this document:</p>
                    <ul>
                        <li>Put all general &ldquo;getting started&rdquo; information directly on this page. It&#39;s OK if this document grows big.</li>
                        <li>
                            If some information is also relevant for other documents, put the information in this document and add links from the other documents to this document. If you do not have a choice and must put information
                            relevant to getting started in other documents, add links in this document to discrete chunks of information in the other documents. Following a web of links can be very confusing, especially for people who are
                            new to a project, so it&#39;s very important to maintain a linear flow as much as possible.
                        </li>
                        <li>
                            Where possible, describe a single way of doing things. If you specify multiple options, provide a clear explanation why someone following the instructions would pick one option over the others. If there is
                            disagreement about how to do things, consider listing alternative options in a SIDE NOTE.
                        </li>
                        <li>
                            Keep Google-specific references to a minimum. A large number of the people working on ThoriumOS work at Google, and this document may occasionally contain references that are only relevant to engineers at
                            Google. Google engineers, please keep such references to a minimum – ThoriumOS is an open source project that should stay as open as possible.
                        </li>
                    </ul>
                    <h3>
                        <a class="h" name="More-information" href="#More-information"><span></span></a><a class="h" name="more-information" href="#more-information"><span></span></a>More information
                    </h3>
                    <p>
                        This document provides an overview of the tasks required to develop ThoriumOS. After you&#39;ve learned the basics, check out the links in the <a href="#Additional-information">Additional information</a> section at
                        the end of this document for tips and tricks, FAQs, and important details (e.g., the ThoriumOS directory structure, using the dev server, etc.).
                    </p>
                    <p>Finally, if you build a ThoriumOS image, please read this important note about <a href="#Attribution-requirements">Attribution requirements</a>.</p>
                    <h2>
                        <a class="h" name="Prerequisites" href="#Prerequisites"><span></span></a><a class="h" name="prerequisites" href="#prerequisites"><span></span></a>Prerequisites
                    </h2>
                    <p>
                        You must have Linux to develop ThoriumOS. Any recent or up-to-date distribution should work. However, we can&lsquo;t support everyone and their dog&rsquo;s Linux distro, so the only official supported environment is
                        listed below. If you encounter issues with other setups, patches are generally welcomed, but please do not expect us to figure out your distro.
                    </p>
                    <ul>
                        <li>
                            <p><a href="https://www.ubuntu.com/">Ubuntu</a> Linux (version 20.04 - Focal)</p>
                            <p>
                                Most developers working on ThoriumOS are using Focal (the 20.04 LTS version of Ubuntu) and Debian testing (Buster). Things might work if you&lsquo;re running a different Linux distribution, but you will
                                probably find life easier if you&rsquo;re on one of these.
                            </p>
                        </li>
                        <li><p>an x86_64 64-bit system for performing the build</p></li>
                        <li>
                            <p>an account with <code class="code">sudo</code> access</p>
                            <p>
                                You need root access to run the <code class="code">chroot</code> command and to modify the mount table. <strong>NOTE:</strong> Do not run any of the commands listed in this document as root – the commands
                                themselves will run sudo to get root access when needed.
                            </p>
                        </li>
                        <li>
                            <p>many gigabytes of RAM</p>
                            <p>
                                Per <a href="https://groups.google.com/a/chromium.org/d/topic/chromium-os-dev/ZcbP-33Smiw/discussion">this thread</a>, linking Chrome requires somewhere between 8 GB and 28 GB of RAM as of March 2017; you may
                                be able to get by with less at the cost of slower builds with adequate swap space. Seeing an error like <code class="code">error: ld terminated with signal 9 [Killed]</code> while building the
                                <code class="code">chromeos-chrome</code> package indicates that you need more RAM. If you are not building your own copy of Chrome, the RAM requirements will be substantially lower.
                            </p>
                        </li>
                    </ul>
                    <p>You will have a much nicer time if you also have:</p>
                    <ul>
                        <li>
                            <p>a fast multi-processor machine with lots of memory</p>
                            <p>The build system is optimized to make good use of all processors, and an 8 core machine will build nearly 8x faster than a single core machine.</p>
                        </li>
                        <li>
                            <p>a good Internet connection</p>
                            <p>This will help for the initial download (minimum of about 2 GB) and any further updates.</p>
                        </li>
                    </ul>
                    <h3>
                        <a class="h" name="Python" href="#Python"><span></span></a><a class="h" name="python" href="#python"><span></span></a>Python
                    </h3>
                    <p>If your system does not have a compatible Python version installed, you&#39;ll need to install Python 3.8 or greater.</p>
                    <p>To check your python version:</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ python3 </span><span class="pun">-</span><span class="pln">V
</span></pre>
                    <p>If an error or a version lower than 3.8 is returned, proceed with the rest of the section. If not, skip this section.</p>
                    <p>If your system supports newer specific Python versions, you can install it. If an incompatible version is present, uninstall it:</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ sudo apt</span><span class="pun">-</span><span class="pln">get remove </span><span class="pun">&lt;</span><span class="pln">current </span><span class="typ">Python</span><span class="pln"> package</span><span class="pun">&gt;</span><span class="pln">
</span></pre>
                    <p>And install a new version:</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ sudo apt</span><span class="pun">-</span><span class="pln">get install python3</span><span class="pun">.</span><span class="lit">9</span><span class="pln">
</span></pre>
                    <h3>
                        <a class="h" name="Install-development-tools" href="#Install-development-tools"><span></span></a><a class="h" name="install-development-tools" href="#install-development-tools"><span></span></a>Install development
                        tools
                    </h3>
                    <p>Some host OS tools are needed to manipulate code, bootstrap the development environment, and run preupload hooks later on.</p>
                    <p>Install the git revision control system, the curl download helper, and more.</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
</span><span class="com"># On Ubuntu, make sure to enable the universe repository.</span><span class="pln">
$ sudo add</span><span class="pun">-</span><span class="pln">apt</span><span class="pun">-</span><span class="pln">repository universe
$ sudo apt</span><span class="pun">-</span><span class="pln">get install git gitk git</span><span class="pun">-</span><span class="pln">gui curl xz</span><span class="pun">-</span><span class="pln">utils
</span></pre>
                    <p>These commands also installs git&#39;s graphical front end (<code class="code">git gui</code>) and revision history browser (<code class="code">gitk</code>).</p>
                    <h3>
                        <a class="h" name="Install-depot_tools" href="#Install-depot_tools"><span></span></a><a class="h" name="install-depot_tools" href="#install-depot_tools"><span></span></a>Install depot_tools
                    </h3>
                    <p>
                        To get started, follow the initial instructions at <a href="https://commondatastorage.googleapis.com/chrome-infra-docs/flat/depot_tools/docs/html/depot_tools_tutorial.html#_setting_up">install depot_tools</a>. You
                        only need to clone the repo &amp; setup your PATH -- the rest of the document is for browser developers.
                    </p>
                    <p>This step is required so that you can use the <code class="code">repo</code> to get/sync the source code, as well as other CrOS specific tools.</p>
                    <h3>
                        <a class="h" name="Tweak-your-sudoers-configuration" href="#Tweak-your-sudoers-configuration"><span></span></a>
                        <a class="h" name="tweak-your-sudoers-configuration" href="#tweak-your-sudoers-configuration"><span></span></a>Tweak your sudoers configuration
                    </h3>
                    <p>
                        You can tweak your sudoers configuration to make <code class="code">sudo</code> request your password less frequently as described in
                        <a href="tips-and-tricks.md#How-to-make-sudo-a-little-more-permissive">Making sudo a little more permissive</a>.
                    </p>
                    <h3>
                        <a class="h" name="Set-locale" href="#Set-locale"><span></span></a><a class="h" name="set-locale" href="#set-locale"><span></span></a>Set locale
                    </h3>
                    <p>These may not be needed if you are building on a system that you already use, however if you have a clean instance on GCE, you&#39;ll need to set a better locale. For example, on Debian Buster on GCE, do:</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ sudo apt</span><span class="pun">-</span><span class="pln">get install locales
$ sudo dpkg</span><span class="pun">-</span><span class="pln">reconfigure locales
</span></pre>
                    <p>
                        When running <code class="code">dpkg-reconfigure locales</code>, choose a language with UTF-8, e.g. <code class="code">en_US.UTF-8</code>. For this change to take effect, you will need to log out and back in (closing
                        all terminal windows, tmux/screen sessions, etc.).
                    </p>
                    <h3>
                        <a class="h" name="Configure-git" href="#Configure-git"><span></span></a><a class="h" name="configure-git" href="#configure-git"><span></span></a>Configure git
                    </h3>
                    <p>Setup git now. If you don&#39;t do this, you may run into errors/issues later. Replace <code class="code">you@example.com</code> and <code class="code">Your Name</code> with your information:</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ git config </span><span class="pun">--</span><span class="pln">global user</span><span class="pun">.</span><span class="pln">email </span><span class="str">&quot;you@example.com&quot;</span><span class="pln">
$ git config </span><span class="pun">--</span><span class="pln">global user</span><span class="pun">.</span><span class="pln">name </span><span class="str">&quot;Your Name&quot;</span><span class="pln">
</span></pre>
                    <h3>
                        <a class="h" name="Get-credentials-to-access-source-repos" href="#Get-credentials-to-access-source-repos"><span></span></a>
                        <a class="h" name="get-credentials-to-access-source-repos" href="#get-credentials-to-access-source-repos"><span></span></a>Get credentials to access source repos
                    </h3>
                    <p>Follow the <a href="https://www.chromium.org/chromium-os/developer-guide/gerrit-guide">Gerrit guide</a> to get machine access credentials for the source repos.</p>
                    <p>
                        This will also set up your code review account(s), which you can use to upstream changes back to ThoriumOS. This will be discussed in more detail in the &ldquo;
                        <a href="#Making-changes-to-packages-whose-source-code-is-checked-into-ThoriumOS-git-repositories">Making changes to packages whose source code is checked into ThoriumOS git repositories</a>&rdquo; section.
                    </p>
                    <h3>
                        <a class="h" name="Double_check-that-you-are-running-a-64_bit-architecture" href="#Double_check-that-you-are-running-a-64_bit-architecture"><span></span></a>
                        <a class="h" name="double_check-that-you-are-running-a-64_bit-architecture" href="#double_check-that-you-are-running-a-64_bit-architecture"><span></span></a>Double-check that you are running a 64-bit architecture
                    </h3>
                    <p>Run the following command:</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ uname </span><span class="pun">-</span><span class="pln">m
</span></pre>
                    <p>You should see the result: <code class="code">x86_64</code></p>
                    <p>
                        If you see something else (for example, <code class="code">i686</code>, which means you are on a 32-bit machine or a 64-bit machine running a 32-bit OS) then you won&#39;t be able to build ThoriumOS. The project
                        would happily welcome patches to fix this.
                    </p>
                    <h3>
                        <a class="h" name="Verify-that-your-default-file-permissions-umask_setting-is-correct" href="#Verify-that-your-default-file-permissions-umask_setting-is-correct"><span></span></a>
                        <a class="h" name="verify-that-your-default-file-permissions-umask_setting-is-correct" href="#verify-that-your-default-file-permissions-umask_setting-is-correct"><span></span></a>Verify that your default file
                        permissions (umask) setting is correct
                    </h3>
                    <p>
                        Sources need to be world-readable to properly function inside the chroot (described later). For that reason, the last digit of your umask should not be higher than 2, e.g. 002 or 022. Many distros have this by
                        default; Ubuntu, for instance, does not. It is essential to put the following line into your <code class="code">~/.bashrc</code> file before you checkout or sync your sources.
                    </p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ umask </span><span class="lit">022</span><span class="pln">
</span></pre>
                    <p>You can verify that this works by creating any file and checking if its permissions are correct.</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ touch </span><span class="pun">~/</span><span class="pln">foo
$ ls </span><span class="pun">-</span><span class="pln">la </span><span class="pun">~/</span><span class="pln">foo
</span><span class="pun">-</span><span class="pln">rw</span><span class="pun">-</span><span class="pln">r</span><span class="pun">--</span><span class="pln">r</span><span class="pun">--</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> user group </span><span class="lit">0</span><span class="pln"> </span><span class="lit">2012</span><span class="pun">-</span><span class="lit">08</span><span class="pun">-</span><span class="lit">30</span><span class="pln"> </span><span class="lit">23</span><span class="pun">:</span><span class="lit">09</span><span class="pln"> </span><span class="pun">/</span><span class="pln">home</span><span class="pun">/</span><span class="pln">user</span><span class="pun">/</span><span class="pln">foo
</span></pre>
                    <h2>
                        <a class="h" name="Get-the-Source" href="#Get-the-Source"><span></span></a><a class="h" name="get-the-source" href="#get-the-source"><span></span></a>Get the Source
                    </h2>
                    <h3>
                        <a class="h" name="Decide-where-your-source-will-live" href="#Decide-where-your-source-will-live"><span></span></a>
                        <a class="h" name="decide-where-your-source-will-live" href="#decide-where-your-source-will-live"><span></span></a>Decide where your source will live
                    </h3>
                    <p>
                        ThoriumOS developers commonly put their source code in <code class="code">~/chromiumos</code>. If you feel strongly, put your own source elsewhere, but note that
                        <strong>all commands in this document assume that your source code is in</strong> <code class="code">~/chromiumos</code>.
                    </p>
                    <p>Create the directory for your source code with this command:</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ mkdir </span><span class="pun">-</span><span class="pln">p </span><span class="pun">~/</span><span class="pln">chromiumos
</span></pre>
                    <p>
                        <strong>IMPORTANT NOTE:</strong> If your home directory is on NFS, you <strong>must</strong> place your code somewhere else. Not only is it a bad idea to build directly from NFS for performance reasons, but builds
                        won&lsquo;t actually work (builds use sudo, and root doesn&rsquo;t have access to your NFS mount, unless your NFS server has the <code class="code">no_root_squash</code> option). Wherever you place your source, you
                        can still add a symbolic link to it from your home directory (this is suggested), like so:
                    </p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ mkdir </span><span class="pun">-</span><span class="pln">p </span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="kwd">local</span><span class="pun">/</span><span class="pln">path</span><span class="pun">/</span><span class="pln">to</span><span class="pun">/</span><span class="pln">source</span><span class="pun">/</span><span class="pln">chromiumos
$ ln </span><span class="pun">-</span><span class="pln">s </span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="kwd">local</span><span class="pun">/</span><span class="pln">path</span><span class="pun">/</span><span class="pln">to</span><span class="pun">/</span><span class="pln">source</span><span class="pun">/</span><span class="pln">chromiumos </span><span class="pun">~/</span><span class="pln">chromiumos
</span></pre>
                    <h3>
                        <a class="h" name="Get-the-source-code" href="#Get-the-source-code"><span></span></a><a class="h" name="get-the-source-code" href="#get-the-source-code"><span></span></a>Get the source code
                    </h3>
                    <p>
                        ThoriumOS uses <a href="https://code.google.com/p/git-repo/">repo</a> to sync down source code. <code class="code">repo</code> is a wrapper for the <a href="https://git-scm.com/">git</a> that helps deal with a large
                        number of <code class="code">git</code> repositories. You already installed <code class="code">repo</code> when you
                        <a href="https://commondatastorage.googleapis.com/chrome-infra-docs/flat/depot_tools/docs/html/depot_tools_tutorial.html#_setting_up">installed <code class="code">depot_tools</code> above</a>.
                    </p>
                    <p><strong>Public:</strong></p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cd </span><span class="pun">~/</span><span class="pln">chromiumos
$ repo init </span><span class="pun">-</span><span class="pln">u https</span><span class="pun">://</span><span class="pln">chromium</span><span class="pun">.</span><span class="pln">googlesource</span><span class="pun">.</span><span class="pln">com</span><span class="pun">/</span><span class="pln">chromiumos</span><span class="pun">/</span><span class="pln">manifest </span><span class="pun">-</span><span class="pln">b main
$ repo sync </span><span class="pun">-</span><span class="pln">j4
</span></pre>
                    <div class="note">
                        <strong>Note:</strong> If you are using public manifest with devices that have restricted binary prebuilts, such as GPU drivers on ARM devices, you&#39;ll have to explicitly accept licenses. Read more at
                        <a href="https://www.chromium.org/chromium-os/licensing/building-a-distro/">https://www.chromium.org/chromium-os/licensing/building-a-distro/</a>
                    </div>
                    <p><strong>Googlers/internal manifest:</strong></p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cd </span><span class="pun">~/</span><span class="pln">chromiumos
$ repo init </span><span class="pun">-</span><span class="pln">u https</span><span class="pun">:</span><span class="com">//chrome-internal.googlesource.com/chromeos/manifest-internal -b main</span><span class="pln">
$ repo sync </span><span class="pun">-</span><span class="pln">j4
</span></pre>
                    <div class="note">
                        <strong>Note:</strong> <code class="code">-j4</code> tells <code class="code">repo</code> to concurrently sync up to 4 repositories at once. You can adjust the number based on how fast your internet connection is.
                        For the initial sync, it&#39;s generally requested that you use no more than 8 concurrent jobs. (For later syncs, when you already have the majority of the source local, using -j16 or so is generally okay.)
                    </div>
                    <div class="note">
                        <strong>Note:</strong> If you are on a slow network connection or have low disk space, you can use the <code class="code">-g minilayout</code> option. This starts you out with a minimum amount of source code. This
                        isn&#39;t a particularly well tested configuration and has been known to break from time-to-time, so we usually recommend against it.
                    </div>
                    <h4>
                        <a class="h" name="Optionally-add-Google-API-keys" href="#Optionally-add-Google-API-keys"><span></span></a>
                        <a class="h" name="optionally-add-google-api-keys" href="#optionally-add-google-api-keys"><span></span></a>Optionally add Google API keys
                    </h4>
                    <div class="note">
                        <strong>Note:</strong> If you plan to build the image with Chrome, you can skip this step. These keys are only necessary when you build the image with Chromium and need to use features that access Google APIs (
                        <strong>signing in</strong>, translating web pages, geolocation, etc).
                    </div>
                    <p>
                        You will need to have keys (see <a href="https://www.chromium.org/developers/how-tos/api-keys">API Keys</a>) either in your include.gypi, or in a file in your home directory called &ldquo;.googleapikeys&rdquo;. If
                        either of these file are present for step 1 of building (below) they will be included automatically. If you don&#39;t have these keys, these features of Chromium will be quietly disabled.
                    </p>
                    <h4>
                        <a class="h" name="Branch-Builds" href="#Branch-Builds"><span></span></a><a class="h" name="branch-builds" href="#branch-builds"><span></span></a>Branch Builds
                    </h4>
                    <p>If you want to build on a branch, pass the branch name to repo init (e.g: <code class="code">repo init -u &lt;URL&gt; [-g minilayout] -b release-R80-12739.B</code>).</p>
                    <p>
                        When you use <code class="code">repo init</code> you will be asked to confirm your name, email address, and whether you want color in your terminal. This command runs quickly. The
                        <code class="code">repo sync</code> command takes a lot longer.
                    </p>
                    <p>More info can be found in the <a href="work_on_branch.md">working on a branch page</a>.</p>
                    <h3>
                        <a class="h" name="Make-sure-you-are-authorized-to-access-Google-Storage-GS_buckets" href="#Make-sure-you-are-authorized-to-access-Google-Storage-GS_buckets"><span></span></a>
                        <a class="h" name="make-sure-you-are-authorized-to-access-google-storage-gs_buckets" href="#make-sure-you-are-authorized-to-access-google-storage-gs_buckets"><span></span></a>Make sure you are authorized to access
                        Google Storage (GS) buckets
                    </h3>
                    <p>
                        Building and testing ThoriumOS requires access to Google Storage. This is done via <a href="gsutil.md">gsutil</a>. Once configured, an authorization key is placed in <code class="code">~/.boto</code>. Every time you
                        access the <a href="https://en.wikipedia.org/wiki/Chroot">chroot</a> via <code class="code">cros_sdk</code>, the <code class="code">.boto</code> file is copied to the
                        <a href="https://en.wikipedia.org/wiki/Chroot">chroot</a>. If you run <a href="gsutil.md">gsutil</a> inside the chroot, it will configure the key in the chroot version of <code class="code">~/.boto</code>, but every
                        time you re-run <code class="code">cros_sdk</code>, it will overwrite the <code class="code">~/.boto</code> file in the chroot.
                    </p>
                    <h3>
                        <a class="h" name="Authenticate-for-remote-Bazel-caching-with-RBE_if-applicable" href="#Authenticate-for-remote-Bazel-caching-with-RBE_if-applicable"><span></span></a>
                        <a class="h" name="authenticate-for-remote-bazel-caching-with-rbe_if-applicable" href="#authenticate-for-remote-bazel-caching-with-rbe_if-applicable"><span></span></a>Authenticate for remote Bazel caching with RBE,
                        if applicable
                    </h3>
                    <p>
                        Some ThoriumOS packages use Bazel to build, which can interact with a remote cache such as RBE for faster builds. If your organization (Google, and maybe eventually others) has enabled remote caching in RBE for your
                        Bazel-based builds, you&#39;ll need to install the <code class="code">gcloud</code> CLI (<a href="https://cloud.google.com/sdk/docs/install">https://cloud.google.com/sdk/docs/install</a>, or
                        <a href="https://goto.google.com/installgcloud">go/installgcloud</a> for Googlers) and run:
                    </p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ gcloud auth application</span><span class="pun">-</span><span class="pln">default login
$ gcloud auth application</span><span class="pun">-</span><span class="pln">default </span><span class="kwd">set</span><span class="pun">-</span><span class="pln">quota</span><span class="pun">-</span><span class="pln">project chromeos</span><span class="pun">-</span><span class="pln">bot
</span></pre>
                    <p>
                        This will store authentication credentials in <code class="code">~${HOME}/.config/gcloud</code> that will be mapped into the chroot, and which will allow Bazel executions within your builds to authenticate as you to
                        RBE to access the remote cache it hosts.
                    </p>
                    <p>More details about configuring remote caching for non-Google organizations is available at <a href="bazel_remote_caching.md">bazel_remote_caching</a>.</p>
                    <h2>
                        <a class="h" name="Building-ThoriumOS" href="#Building-ThoriumOS"><span></span></a><a class="h" name="building-chromiumos" href="#building-chromiumos"><span></span></a>Building ThoriumOS
                    </h2>
                    <h3>
                        <a class="h" name="Create-a-chroot" href="#Create-a-chroot"><span></span></a><a class="h" name="create-a-chroot" href="#create-a-chroot"><span></span></a>Create a chroot
                    </h3>
                    <p>
                        To make sure everyone uses the same exact environment and tools to build ThoriumOS, all building is done inside a <a href="https://en.wikipedia.org/wiki/Chroot">chroot</a>. This chroot is its own little world: it
                        contains its own compiler, its own tools (its own copy of bash, its own copy of sudo), etc. Now that you&lsquo;ve synced down the source code, you need to create this chroot. Assuming you&rsquo;re already in
                        <code class="code">~/chromiumos</code> (or wherever your source lives), the command to download and install the chroot is:
                    </p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cros_sdk </span><span class="pun">--</span><span class="pln">create
</span></pre>
                    <p>If this does not work, make sure you&#39;ve added the depot_tools directory to your PATH already (as was needed above with using <code class="code">repo</code>).</p>
                    <p>
                        This will download and setup a prebuilt chroot from ThoriumOS mirrors (under 400MB). If you prefer to build it from source, or have trouble accessing the servers, use <code class="code">cros_sdk --bootstrap</code>.
                        Note that this will also enter the chroot. If you prefer to build only, use <code class="code">--download</code>.
                    </p>
                    <p>
                        The command with <code class="code">--bootstrap</code> takes about half an hour to run on a four core machine. It compiles quite a bit of software, which it installs into your chroot, and downloads some additional
                        items (around 300MB). While it is building you will see a regular update of the number of packages left to build. Once the command finishes, the chroot will take up total disk space of a little over 3GB.
                    </p>
                    <p>
                        The chroot lives by default at <code class="code">~/chromiumos/chroot</code>. Inside that directory you will find system directories like <code class="code">/usr/bin</code> and <code class="code">/etc</code>. These
                        are local to the chroot and are separate from the system directories on your machine. For example, the chroot has its own version of the <code class="code">ls</code> utility. It will be very similar, but it is
                        actually a different binary than the normal one you use on your machine.
                    </p>
                    <p><strong>IMPORTANT NOTES</strong>:</p>
                    <ul>
                        <li>
                            <strong>If you need to delete your chroot</strong>, use <code class="code">cros_sdk --delete</code> to delete it properly. Using <code class="code">rm -rf</code> could end up deleting your source tree due to the
                            active bind mounts.
                        </li>
                    </ul>
                    <p><strong>SIDE NOTES:</strong></p>
                    <ul>
                        <li>You shouldn&#39;t have to create the chroot very often. Most developers create it once and never touch it again unless someone explicitly sends out an email telling them to recreate their chroot.</li>
                        <li>The <code class="code">cros_sdk</code> command currently doesn&#39;t work behind a proxy server, but there is a <a href="https://crbug.com/192478">workaround</a>.</li>
                    </ul>
                    <h3>
                        <a class="h" name="Select-a-board" href="#Select-a-board"><span></span></a><a class="h" name="select-a-board" href="#select-a-board"><span></span></a>Select a board
                    </h3>
                    <p>
                        Building ThoriumOS produces a disk image (usually just called an &ldquo;image&rdquo;) that can be copied directly onto the boot disk of a computer intended to run ThoriumOS. Depending on the specifics of that
                        computer, you may want different files in the disk image. For example, if your computer has an ARM processor, you&lsquo;ll want to make sure that all executables in the image are compiled for the ARM instruction set.
                        Similarly, if your computer has special hardware, you&rsquo;ll want to include a matching set of device drivers.
                    </p>
                    <p>Different classes of computers are referred to by ThoriumOS as different target &ldquo;boards&rdquo;. The following are some example boards:</p>
                    <ul>
                        <li><strong>amd64-generic</strong> - builds a generic image suitable for computers with an x86_64-compatible CPU (64 bit) or for running in a VM</li>
                        <li><strong>arm-generic</strong> - builds a generic image suitable for computers with an ARM CPU (32 bit)</li>
                        <li><strong>arm64-generic</strong> - builds a generic image suitable for computers with an ARM CPU (64 bit)</li>
                        <li>
                            <strong>samus, eve, &lt;your board name&gt;</strong> - builds an image specific to the chosen device (find your board name
                            <a href="https://dev.chromium.org/chromium-os/developer-information-for-chrome-os-devices">here</a>); recommended for deploying to official hardware
                        </li>
                        <li><strong>betty</strong> - (Googlers only) builds an ARC++-enabled image for running in a VM</li>
                    </ul>
                    <p>To list all known boards in your checkout, run this command:</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cros query boards
</span></pre>
                    <p>
                        You need to choose a board for your first build. Be aware that the generic images may not work well (or not at all) when run on official hardware. Don&#39;t worry too much about this choice, though – you can always
                        build for another board later. If you want a list of known boards, you can look in <code class="code">~/chromiumos/src/overlays</code>.
                    </p>
                    <p>
                        Each command in the build processes takes a <code class="code">--board</code> parameter. To facilitate this, it can be helpful to keep the name of the board in a shell variable. This is not strictly necessary, but if
                        you do this, you can simply copy and paste the commands below into your terminal program. Enter the following inside your shell:
                    </p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ BOARD</span><span class="pun">=&lt;</span><span class="pln">your pick of board</span><span class="pun">&gt;</span><span class="pln">
</span></pre>
                    <p>This setting only holds while you stay in the chroot. If you leave and come back, you need to specify this setting again.</p>
                    <h3>
                        <a class="h" name="Set-the-chronos-user-password" href="#Set-the-chronos-user-password"><span></span></a><a class="h" name="set-the-chronos-user-password" href="#set-the-chronos-user-password"><span></span></a>Set
                        the chronos user password
                    </h3>
                    <p>
                        On a ThoriumOS computer, you can get command line access (and root access through the <code class="code">sudo</code> command) by logging in with the shared user account <code class="code">&quot;chronos&quot;</code>.
                        You should set a password for the <code class="code">chronos</code> user by entering the command below:
                    </p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cros_sdk </span><span class="pun">./</span><span class="pln">set_shared_user_password</span><span class="pun">.</span><span class="pln">sh
</span></pre>
                    <p>You will be prompted for a password, which will be stored in encrypted form in <code class="code">/etc/shared_user_passwd.txt</code> in the chroot.</p>
                    <p><strong>SIDE NOTES:</strong></p>
                    <ul>
                        <li>The encrypted password is stored inside chroot. That means that if you recreate your chroot, you have to run this command again.</li>
                        <li>
                            If you don&#39;t set a shared user password, the password for the chronos account may end up being any number of things depending on some complicated (and constantly evolving) formula that includes whether you
                            build a developer image, whether you boot into <a href="developer_mode.md">Developer Mode</a>, and the current state of the scripts. The password might be empty, or a well-known string (such as
                            <code class="code">&quot;test0000&quot;</code> on test images), or it might be impossible to login with chronos. It is strongly recommended that you simply set a shared user password. TODO: put a link to some
                            place with more info about this.
                        </li>
                    </ul>
                    <h3>
                        <a class="h" name="Build-the-packages-for-your-board" href="#Build-the-packages-for-your-board"><span></span></a>
                        <a class="h" name="build-the-packages-for-your-board" href="#build-the-packages-for-your-board"><span></span></a>Build the packages for your board
                    </h3>
                    <p>To build all the packages for your board, run the following command:</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cros build</span><span class="pun">-</span><span class="pln">packages </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln">
</span></pre>
                    <p>
                        This step is the rough equivalent of <code class="code">make all</code> in a standard Makefile system. This command handles incremental builds; you should run it whenever you change something and need to rebuild it
                        (or after you run <code class="code">repo sync</code>).
                    </p>
                    <p>
                        Normally, the <code class="code">cros build-packages</code> command builds the stable version of a package (i.e. from committed git sources), unless you are working on a package (with
                        <code class="code">cros workon</code>). If you are working on a package, <code class="code">cros build-packages</code> will build using your local sources. See below for information about
                        <code class="code">cros workon</code>.
                    </p>
                    <p><strong>SIDE NOTES:</strong></p>
                    <ul>
                        <li>
                            <p>
                                The first time you run <code class="code">cros build-packages</code>, you should use <code class="code">--autosetgov --autosetgov-sticky</code>. If your system uses a power-saving
                                <a href="https://www.kernel.org/doc/Documentation/cpu-freq/governors.txt">CPU governor</a>, these options will temporarily switch to <code class="code">performance</code> for faster builds.
                                <code class="code">--autosetgov-sticky</code> makes <code class="code">cros build-packages</code> remember to always use <code class="code">--autosetgov</code>.
                            </p>
                        </li>
                        <li>
                            <p>
                                (For Googlers) <code class="code">cros build-packages</code> is generally enough to include Chrome in your image if you have included the internal manifest when initializing the repo. However, there may be
                                some cases where the build produces Chromium instead. Running the command again including the flags <code class="code">--internal</code> and <code class="code">--no-use-any-chrome</code> guarantees Chrome is
                                included in the build. <code class="code">--no-use-any-chrome</code> creates a fresh build of Chromium/Chrome instead of reusing an existing prebuilt, making the build process slower.
                            </p>
                        </li>
                        <li>
                            <p><code class="code">cros build-packages</code> automatically calls <code class="code">update_chroot</code>, which will keep the SDK up-to-date with any possible changes.</p>
                        </li>
                        <li>
                            <p>
                                By default, packages other than Chrome will be compiled in debug mode; that is, with <code class="code">NDEBUG</code> undefined and with debugging constructs like <code class="code">DCHECK</code>,
                                <code class="code">DLOG</code>, and the red &ldquo;Debug image&rdquo; message present. If you supply <code class="code">--no-withdebug</code>, then <code class="code">NDEBUG</code> will be defined and the
                                debugging constructs will be removed.
                            </p>
                        </li>
                        <li>
                            <p>
                                The first time you run the <code class="code">cros build-packages</code> command, it will take a long time (around 90 minutes on a four core machine), as it must build every package, and also download about
                                1.7GB of source packages and 1.3GB of binary packages. <a href="portage/ebuild_faq.md#what-does-build-packages-do">See here</a> for more information about what the
                                <code class="code">cros build-packages</code> command actually does. In short, it tries to download existing binary packages to avoid building anything (and puts them in
                                <code class="code">/build/${BOARD}/packages</code> for subsequent builds). Failing that, it downloads source packages, puts them in <code class="code">/var/lib/portage/distfiles-target</code>, and builds
                                them.
                            </p>
                        </li>
                        <li>
                            <p>Should you want a clean build, pass <code class="code">--cleanbuild</code>.</p>
                        </li>
                        <li>
                            <p>
                                If you don&#39;t want to have to pass <code class="code">--board</code> to this and following commands, you can set a default board by creating the file <code class="code">.default_board</code> in the
                                <code class="code">~/chromiumos/src/scripts</code> directory:
                            </p>
                            <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
echo $</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">~</span><span class="str">/chromiumos/</span><span class="pln">src</span><span class="pun">/</span><span class="pln">scripts</span><span class="pun">/.</span><span class="pln">default_board
</span></pre>
                        </li>
                    </ul>
                    <h3>
                        <a class="h" name="Build-a-disk-image-for-your-board" href="#Build-a-disk-image-for-your-board"><span></span></a>
                        <a class="h" name="build-a-disk-image-for-your-board" href="#build-a-disk-image-for-your-board"><span></span></a>Build a disk image for your board
                    </h3>
                    <p>Once the <code class="code">cros build-packages</code> step is finished, you can build a ThoriumOS-base developer image by running the command below:</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cros build</span><span class="pun">-</span><span class="pln">image </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> </span><span class="pun">--</span><span class="pln">no</span><span class="pun">-</span><span class="pln">enable</span><span class="pun">-</span><span class="pln">rootfs</span><span class="pun">-</span><span class="pln">verification test
</span></pre>
                    <p>
                        The arguments for <code class="code">cros build-image</code> specify what type of build you want. A test image (in the example above) has additional test-specific packages and also accepts incoming SSH connections.
                        It is more convenient to use test images, but developers could also build developer images. A developer image provides a ThoriumOS-based image with additional developer packages. To build it use
                        <code class="code">dev</code> instead of <code class="code">test</code>. If building a test image, the password set using <code class="code">set_shared_user_password.sh</code> will be ignored and
                        <code class="code">&quot;test0000&quot;</code> will be the password instead. The <code class="code">--no-enable-rootfs-verification</code> turns off verified boot allowing you to freely modify the root file system.
                        The system is less secure using this flag, however, for rapid development you may want to set this flag. If you would like a more secure, locked-down version of ThoriumOS, then simply remove the
                        <code class="code">--no-enable-rootfs-verification</code> flag. Finally if you want just the pristine ThoriumOS-based image (closest to ChromeOS but not quite the same), pass in <code class="code">base</code> rather
                        than <code class="code">test</code> or <code class="code">dev</code>. Use <code class="code">cros build-image --help</code> for more information.
                    </p>
                    <p>
                        The image produced by <code class="code">cros build-image</code> will be located in <code class="code">~/chromiumos/src/build/images/${BOARD}/versionNum/</code> (where <code class="code">versionNum</code> will
                        actually be a version number). The most recent image produced for a given board will be symlinked to <code class="code">~/chromiumos/src/build/images/${BOARD}/latest</code>.
                    </p>
                    <p>At the end of <code class="code">cros build-image</code>&#39;s output, it will print a command you can run to start the image in a <code class="code">cros vm</code> virtual machine. It will print something like:</p>
                    <pre class="code">
To run the image in a virtual machine, use:
cros vm --start --image-path=../build/images/amd64-generic/R111-15301.0.0-d2023_01_04_103804-a1/chromiumos_test_image.bin --board=amd64-generic

                    </pre>
                    <p>Remember this command for future use; see <a href="#running-an-image-in-a-virtual-machine">Running an image in a virtual machine</a>.</p>
                    <p>
                        <strong>IMPORTANT NOTE:</strong> It&lsquo;s up to you to delete old builds that you don&rsquo;t need. Every time you run <code class="code">cros build-image</code>, the command creates files that take up to
                        <strong>8GB of space (!)</strong>.
                    </p>
                    <h3>
                        <a class="h" name="Look-at-your-disk-image-optional" href="#Look-at-your-disk-image-optional"><span></span></a>
                        <a class="h" name="look-at-your-disk-image-optional" href="#look-at-your-disk-image-optional"><span></span></a>Look at your disk image (optional)
                    </h3>
                    <p>The preferred way to mount the image you just built to look at its contents is:</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cros_sdk </span><span class="pun">./</span><span class="pln">mount_gpt_image</span><span class="pun">.</span><span class="pln">sh </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> </span><span class="pun">--</span><span class="pln">safe </span><span class="pun">--</span><span class="pln">most_recent
</span></pre>
                    <p>If you built a test image, also make sure to add <code class="code">-i chromiumos_test_image.bin</code> to this command.</p>
                    <p>The <code class="code">--safe</code> option ensures you do not make accidental changes to the Root FS.</p>
                    <p>Again, don&lsquo;t forget to unmount the root filesystem when you&rsquo;re done:</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cros_sdk </span><span class="pun">./</span><span class="pln">mount_gpt_image</span><span class="pun">.</span><span class="pln">sh </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> </span><span class="pun">-</span><span class="pln">u
</span></pre>
                    <p>Optionally, you can unpack the partition as separate files and mount them directly:</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cd </span><span class="pun">~/</span><span class="pln">chromiumos</span><span class="pun">/</span><span class="pln">src</span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">images</span><span class="pun">/</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}/</span><span class="pln">latest
$ </span><span class="pun">./</span><span class="pln">unpack_partitions</span><span class="pun">.</span><span class="pln">sh chromiumos_image</span><span class="pun">.</span><span class="pln">bin
$ mkdir </span><span class="pun">-</span><span class="pln">p rootfs
$ sudo mount </span><span class="pun">-</span><span class="pln">o loop</span><span class="pun">,</span><span class="pln">ro part_3 rootfs
</span></pre>
                    <p>This will do a loopback mount of the rootfs from your image to the location <code class="code">~/chromiumos/src/build/images/${BOARD}/latest/rootfs</code> in your chroot.</p>
                    <p>If you built with <code class="code">--no-enable-rootfs-verification</code> you can omit the <code class="code">ro</code> option to mount it read write.</p>
                    <p>If you built an x86 ThoriumOS image, you can probably even try chrooting into the image:</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ sudo chroot </span><span class="pun">~/</span><span class="pln">chromiumos</span><span class="pun">/</span><span class="pln">src</span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">images</span><span class="pun">/</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}/</span><span class="pln">latest</span><span class="pun">/</span><span class="pln">rootfs
</span></pre>
                    <p>
                        This is a little hacky (the ThoriumOS rootfs isn&lsquo;t really designed to be a chroot for your host machine), but it seems to work pretty well. Don&rsquo;t forget to <code class="code">exit</code> this chroot when
                        you&#39;re done.
                    </p>
                    <p>When you&#39;re done, unmount the root filesystem:</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ sudo umount </span><span class="pun">~/</span><span class="pln">chromiumos</span><span class="pun">/</span><span class="pln">src</span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">images</span><span class="pun">/</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}/</span><span class="pln">latest</span><span class="pun">/</span><span class="pln">rootfs
</span></pre>
                    <h2>
                        <a class="h" name="Installing-ThoriumOS-on-your-Device" href="#Installing-ThoriumOS-on-your-Device"><span></span></a>
                        <a class="h" name="installing-chromiumos-on-your-device" href="#installing-chromiumos-on-your-device"><span></span></a>Installing ThoriumOS on your Device
                    </h2>
                    <h3>
                        <a class="h" name="Put-your-image-on-a-USB-disk" href="#Put-your-image-on-a-USB-disk"><span></span></a><a class="h" name="put-your-image-on-a-usb-disk" href="#put-your-image-on-a-usb-disk"><span></span></a>Put your
                        image on a USB disk
                    </h3>
                    <p>The easiest way to get your image running on your target computer is to put the image on a USB flash disk (sometimes called a USB key), and boot the target computer from the flash disk.</p>
                    <p>The first step is to disable auto-mounting of USB devices on your build computer as it may corrupt the disk image while it&#39;s being written. On systems that use GNOME or Cinnamon, run the following:</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ gsettings </span><span class="kwd">set</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">gnome</span><span class="pun">.</span><span class="pln">desktop</span><span class="pun">.</span><span class="pln">media</span><span class="pun">-</span><span class="pln">handling automount false
$ gsettings </span><span class="kwd">set</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">gnome</span><span class="pun">.</span><span class="pln">desktop</span><span class="pun">.</span><span class="pln">media</span><span class="pun">-</span><span class="pln">handling automount</span><span class="pun">-</span><span class="pln">open false
$ gsettings </span><span class="kwd">set</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">cinnamon</span><span class="pun">.</span><span class="pln">desktop</span><span class="pun">.</span><span class="pln">media</span><span class="pun">-</span><span class="pln">handling automount false
$ gsettings </span><span class="kwd">set</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">cinnamon</span><span class="pun">.</span><span class="pln">desktop</span><span class="pun">.</span><span class="pln">media</span><span class="pun">-</span><span class="pln">handling automount</span><span class="pun">-</span><span class="pln">open false
</span></pre>
                    <p>
                        Next, insert a USB flash disk (8GB or bigger) into your build computer. <strong>This disk will be completely erased, so make sure it doesn&#39;t have anything important on it</strong>. Wait ~10 seconds for the USB
                        disk to register, then type the following command:
                    </p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cros flash usb</span><span class="pun">://</span><span class="pln"> $</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}/</span><span class="pln">latest
</span></pre>
                    <p>For more details on using this tool, see the <a href="cros_flash.md">CrOS Flash page</a>.</p>
                    <p>When the <code class="code">cros flash</code> command finishes, you can simply unplug your USB key and it&#39;s ready to boot from.</p>
                    <p>
                        <strong>IMPORTANT NOTE:</strong> To emphasize again, <code class="code">cros flash</code> completely replaces the contents of your USB disk. Make sure there is nothing important on your USB disk before you run this
                        command.
                    </p>
                    <p><strong>SIDE NOTES:</strong></p>
                    <ul>
                        <li>If you want to create a test image (used for integration testing), see the <a href="#Running-Tests">Running Tests</a> section.</li>
                    </ul>
                    <h3>
                        <a class="h" name="Enter-Developer-Mode" href="#Enter-Developer-Mode"><span></span></a><a class="h" name="enter-developer-mode" href="#enter-developer-mode"><span></span></a>Enter Developer Mode
                    </h3>
                    <p>See the <a href="developer_mode.md">Developer Mode</a> documentation.</p>
                    <h3>
                        <a class="h" name="Boot-from-your-USB-disk" href="#Boot-from-your-USB-disk"><span></span></a><a class="h" name="boot-from-your-usb-disk" href="#boot-from-your-usb-disk"><span></span></a>Boot from your USB disk
                    </h3>
                    <p>After enabling <a href="developer_mode.md">Developer Mode</a>, you should set your system to boot from USB.</p>
                    <p>Let the device boot, login and open a shell (or switch to terminal 2 via Ctrl+Alt+F2).</p>
                    <p>Run the following command:</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">device</span><span class="pun">)</span><span class="pln">
$ sudo crossystem
</span></pre>
                    <p>You should see <code class="code">dev_boot_usb</code> equal to 0. Set it to 1 to enable USB boot:</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">device</span><span class="pun">)</span><span class="pln">
$ sudo crossystem dev_boot_usb</span><span class="pun">=</span><span class="lit">1</span><span class="pln">
$ sudo crossystem dev_boot_signed_only</span><span class="pun">=</span><span class="lit">0</span><span class="pln">
</span></pre>
                    <p>
                        Now reboot. On the white screen (indicating <a href="developer_mode.md">Developer Mode</a> is enabled), plug-in the USB disk and press <code class="code">Ctrl+U</code> (
                        <a href="debug_buttons.md">Debug Button Shortcuts</a>).
                    </p>
                    <h3>
                        <a class="h" name="Getting-to-a-command-prompt-on-ThoriumOS" href="#Getting-to-a-command-prompt-on-ThoriumOS"><span></span></a>
                        <a class="h" name="getting-to-a-command-prompt-on-chromiumos" href="#getting-to-a-command-prompt-on-chromiumos"><span></span></a>Getting to a command prompt on ThoriumOS
                    </h3>
                    <p>Since you set the shared user password (with <code class="code">set_shared_user_password.sh</code>) when you built your image, you have the ability to login as the chronos user:</p>
                    <ol>
                        <li>
                            After your computer has booted to the ThoriumOS login screen, press <code class="code">[ Ctrl ] [ Alt ] [ F2 ]</code> to get a text-based login prompt. ( <code class="code">[ F2 ]</code> may appear as
                            <code class="code">[ → ]</code> on your Notebook keyboard.)
                        </li>
                        <li>Log in with the chronos user and enter the password you set earlier.</li>
                    </ol>
                    <p>
                        Because you built an image with developer tools, you also have an alternate way to get a terminal prompt. The alternate shell is a little nicer (in the very least, it keeps your screen from dimming on you), even if
                        it is a little harder to get to. To use this alternate shell:
                    </p>
                    <ol>
                        <li>Go through the standard ThoriumOS login screen (you&lsquo;ll need to setup a network, etc.) and get to the web browser. It&rsquo;s OK to login as guest.</li>
                        <li>Press <code class="code">[ Ctrl ] [ Alt ] [ T ]</code> to get the <a href="https://chromium.googlesource.com/chromiumos/platform2/+/HEAD/crosh/">crosh</a> shell.</li>
                        <li>
                            Use the <code class="code">shell</code> command to get the shell prompt. NOTE: you <strong>don&#39;t</strong> need to enter the <code class="code">chronos</code> password here, though you will still need the
                            password if you want to use the <code class="code">sudo</code> command.
                        </li>
                    </ol>
                    <h3>
                        <a class="h" name="Installing-your-ThoriumOS-image-to-your-hard-disk" href="#Installing-your-ThoriumOS-image-to-your-hard-disk"><span></span></a>
                        <a class="h" name="installing-your-chromiumos-image-to-your-hard-disk" href="#installing-your-chromiumos-image-to-your-hard-disk"><span></span></a>Installing your ThoriumOS image to your hard disk
                    </h3>
                    <p>Once you&#39;ve booted from your USB key and gotten to the command prompt, you can install your ThoriumOS image to the hard disk on your computer with this command:</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">device</span><span class="pun">)</span><span class="pln">
$ </span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="pln">sbin</span><span class="pun">/</span><span class="pln">chromeos</span><span class="pun">-</span><span class="pln">install
</span></pre>
                    <p><strong>IMPORTANT NOTE:</strong> Installing ThoriumOS onto your hard disk will <strong>WIPE YOUR HARD DISK CLEAN</strong>.</p>
                    <h3>
                        <a class="h" name="vm" href="#vm"><span></span></a>Running an image in a virtual machine
                    </h3>
                    <p>
                        Many times it is easier to simply run ThoriumOS in a virtual machine like QEMU. You can use the <a href="cros_vm.md#launch-a-locally-built-vm-from-within-the-chroot">cros_vm</a> command to start a VM with the
                        previously built image.
                    </p>
                    <p>When you start the VM, <code class="code">cros_vm</code> will print out information about how to connect to the running image via SSH and VNC.</p>
                    <p>
                        For VNC it will normally say <code class="code">VNC server running on ::1:5900</code> which means it&#39;s serving on localhost on the default VNC port (5900). You can connect to
                        <code class="code">localhost</code> with a VNC viewer to connect.
                    </p>
                    <p>
                        A good VNC client for Linux is the package tigervnc-viewer (available on at least Debian); its command line program is <code class="code">vncviewer</code>. Note that before you use it, you should click
                        <strong>Options</strong> → <strong>Misc</strong> → <strong>Show dot when no cursor</strong>. Other options include the VNC feature in
                        <a href="https://chromium.googlesource.com/chromiumos/chromite/+/HEAD/ide_tooling/docs/quickstart.md">ChromiumIDE</a>&#39;s device management, and
                        <a href="https://chromium.googlesource.com/chromiumos/platform2/+/HEAD/screen-capture-utils/README.md#kmsvnc">novnc</a>, which makes the device accessible via a web browser.
                    </p>
                    <div class="note">
                        <p><strong>SIDE NOTES:</strong></p>
                        <ul>
                            <li>The output of the <code class="code">cros build-image</code> command will also contain a full command to start a VM with that image.</li>
                            <li>
                                Only KVM/QEMU VMs are actively supported at the moment.
                                <ul>
                                    <li>Non-KVM VMs often &ldquo;work&rdquo;, but are unbearably slow.</li>
                                </ul>
                            </li>
                            <li>If you&#39;re interested in creating a test image (used for integration testing), see the <a href="#Running-Tests">Running Tests</a> section.</li>
                        </ul>
                    </div>
                    <h2>
                        <a class="h" name="Making-changes-to-packages-whose-source-code-is-checked-into-ThoriumOS-git-repositories" href="#Making-changes-to-packages-whose-source-code-is-checked-into-ThoriumOS-git-repositories">
                            <span></span>
                        </a>
                        <a class="h" name="making-changes-to-packages-whose-source-code-is-checked-into-chromiumos-git-repositories" href="#making-changes-to-packages-whose-source-code-is-checked-into-chromiumos-git-repositories">
                            <span></span>
                        </a>
                        Making changes to packages whose source code is checked into ThoriumOS git repositories
                    </h2>
                    <p>
                        Now that you can build and run ThoriumOS, you&#39;re ready to start making changes to the code. For further hands on with making changes, you can check out the
                        <a href="https://chromium.googlesource.com/chromiumos/platform2/+/HEAD/codelab/README.md">build codelab</a>.
                    </p>
                    <p>
                        <strong>NOTE:</strong> If you skipped to this section without building your own system image, you may run into hard-to-fix dependency problems if you build your own versions of system packages and try to deploy them
                        to a system image that was built by a builder. If you run into trouble, try going through the full <a href="#Building-ThoriumOS">Building ThoriumOS</a> process first and installing your own system image.
                    </p>
                    <h3>
                        <a class="h" name="Keep-the-tree-green" href="#Keep-the-tree-green"><span></span></a><a class="h" name="keep-the-tree-green" href="#keep-the-tree-green"><span></span></a>Keep the tree green
                    </h3>
                    <p>Before you start, take a moment to understand Chromium&#39;s source management strategy of &ldquo;keeping the tree green&rdquo;. For the ThoriumOS project, <strong>keeping the tree green</strong> means:</p>
                    <ol>
                        <li>
                            Any new commits should not destabilize the build:
                            <ul>
                                <li>Images built from the tree should always have basic functionality working.</li>
                                <li>There may be minor functionality not working, and it may be the case, for example, that you will need to use Terminal to fix or work around some of the problems.</li>
                            </ul>
                        </li>
                        <li>
                            If you must introduce unstable changes to the tree (which should happen infrequently), you should use parameterization to hide new, unstable functionality behind a flag that&#39;s turned off by default. The
                            ThoriumOS team leaders may need to develop mechanisms for parameterizing different parts of the system (such as the init script).
                        </li>
                        <li>
                            Internal &ldquo;dev channel&rdquo; releases will be produced directly from the tree, with a quick branch to check-point the release version. Any fixes required for a release will be pulled from the tree, avoiding
                            merges back to tree.
                        </li>
                    </ol>
                    <p>This strategy has many benefits, including avoiding separate build trains for parallel development (and the cost of supporting such development), as well as avoiding large, costly merges from forked branches.</p>
                    <p><strong>SIDE NOTE</strong>: &ldquo;Keep the tree green&rdquo; means something a bit different for ThoriumOS than for Chromium, which is much further along in its life cycle.</p>
                    <p>The steps in this section describe how to make changes to a ThoriumOS package whose source is checked into the ThoriumOS source control system. Specifically, this is a package where:</p>
                    <ul>
                        <li>The <code class="code">**ebuild**</code> for the package lives in the <code class="code">src/third_party/chromiumos-overlay</code> or <code class="code">src/overlays/overlay-${BOARD}</code> directories.</li>
                        <li>There is an ebuild for the package that ends with <code class="code">9999.ebuild</code>.</li>
                        <li>The ebuild inherits from the <code class="code">cros-workon</code> class.</li>
                        <li>The ebuild has a <code class="code">KEYWORDS</code> in the ebuild containing this architecture name (like &ldquo;<code class="code">x86</code>&rdquo;).</li>
                    </ul>
                    <p>You can see a list of all such packages by running the following command:</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cros workon </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> </span><span class="pun">--</span><span class="pln">all list
</span></pre>
                    <h3>
                        <a class="h" name="Run-cros-workon-start" href="#Run-cros-workon-start"><span></span></a><a class="h" name="run-cros-workon-start" href="#run-cros-workon-start"><span></span></a>Run cros workon start
                    </h3>
                    <p>The first thing you need to do is to mark the package as active. Use the command below, replacing <code class="code">${PACKAGE_NAME}</code> with your package name (e.g., <code class="code">chromeos-wm</code>):</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cros workon </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> start $</span><span class="pun">{</span><span class="pln">PACKAGE_NAME</span><span class="pun">}</span><span class="pln">
</span></pre>
                    <p>This command:</p>
                    <ul>
                        <li>Indicates that you&#39;d like to build the <code class="code">9999</code> version of the <code class="code">ebuild</code> instead of the stable, committed version.</li>
                        <li>Indicates that you&#39;d like to build from source every time.</li>
                        <li>
                            If you specified that you wanted the <code class="code">minilayout</code> when you did your <code class="code">repo init</code>, this command adds a clause to your
                            <code class="code">.repo/local_manifest.xml</code> to tell <code class="code">repo</code> to sync down the source code for this package next time you do a <code class="code">repo sync</code>.
                        </li>
                    </ul>
                    <h3>
                        <a class="h" name="Run-repo-sync" href="#Run-repo-sync"><span></span></a><a class="h" name="run-repo-sync" href="#run-repo-sync"><span></span></a>Run repo sync
                    </h3>
                    <p>
                        After running <code class="code">cros workon</code>, sync down the sources. This is critical if you&lsquo;re using the <code class="code">minilayout</code>, but is probably a good idea in any case to make sure that
                        you&rsquo;re working with the latest code (it&#39;ll help avoid merge conflicts later). Run the command below anywhere under your <code class="code">~/chromiumos</code> directory:
                    </p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ repo sync
</span></pre>
                    <div class="note">
                        <strong>Note:</strong> Make sure your <code class="code">umask</code> is <a href="#Verify-that-your-default-file-permissions-umask_setting-is-correct">set to a supported value</a> (e.g. 022); otherwise, you may end
                        up with bad file permissions in your source tree.
                    </div>
                    <h3>
                        <a class="h" name="Find-out-which-ebuilds-map-to-which-directories" href="#Find-out-which-ebuilds-map-to-which-directories"><span></span></a>
                        <a class="h" name="find-out-which-ebuilds-map-to-which-directories" href="#find-out-which-ebuilds-map-to-which-directories"><span></span></a>Find out which ebuilds map to which directories
                    </h3>
                    <p>The <code class="code">cros workon</code> tool can help you find out what ebuilds map to each directory. You can view a full list of ebuilds and directories using the following command:</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cros workon </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> </span><span class="pun">--</span><span class="pln">all info
</span></pre>
                    <p>If you want to find out which ebuilds use source code from a specific directory, you can use grep to find them. For example:</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cros workon </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> </span><span class="pun">--</span><span class="pln">all info </span><span class="pun">|</span><span class="pln"> grep platform</span><span class="pun">/</span><span class="pln">ec
</span></pre>
                    <p>This returns the following output:</p>
                    <pre
                        class="code"
                    ><span class="pln">chromeos</span><span class="pun">-</span><span class="pln">base</span><span class="pun">/</span><span class="pln">ec</span><span class="pun">-</span><span class="pln">utils chromiumos</span><span class="pun">/</span><span class="pln">platform</span><span class="pun">/</span><span class="pln">ec src</span><span class="pun">/</span><span class="pln">platform</span><span class="pun">/</span><span class="pln">ec
</span></pre>
                    <p>This tells you the following information:</p>
                    <ol>
                        <li>The name of the ebuild is <code class="code">chromeos-base/ec-utils</code></li>
                        <li>The path to the git repository on the server is <code class="code">chromiumos/platform/ec</code></li>
                        <li>The path to the source code on your system is <code class="code">src/platform/ec</code></li>
                    </ol>
                    <p>You can similarly find what source code is associated with a given ebuild by grepping for the ebuild name in the list.</p>
                    <p>To find out where the ebuild lives:</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cros_sdk equery</span><span class="pun">-</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> which $</span><span class="pun">{</span><span class="pln">PACKAGE_NAME</span><span class="pun">}</span><span class="pln">
</span></pre>
                    <p>As an example, for <code class="code">PACKAGE_NAME=ec-utils</code>, the above command might display:</p>
                    <pre
                        class="code"
                    ><span class="pun">/</span><span class="pln">home</span><span class="pun">/.../</span><span class="pln">chromiumos</span><span class="pun">/</span><span class="pln">src</span><span class="pun">/</span><span class="pln">third_party</span><span class="pun">/</span><span class="pln">chromiumos</span><span class="pun">-</span><span class="pln">overlay</span><span class="pun">/</span><span class="pln">chromeos</span><span class="pun">-</span><span class="pln">base</span><span class="pun">/</span><span class="pln">ec</span><span class="pun">-</span><span class="pln">utils</span><span class="pun">/</span><span class="pln">ec</span><span class="pun">-</span><span class="pln">utils</span><span class="pun">-</span><span class="lit">9999.ebuild</span><span class="pln">
</span></pre>
                    <p><strong>SIDE NOTE:</strong> If you run the same command <strong>without</strong> running <code class="code">cros workon</code> first, you can see the difference:</p>
                    <pre
                        class="code"
                    ><span class="pun">/</span><span class="pln">home</span><span class="pun">/.../</span><span class="pln">chromiumos</span><span class="pun">/</span><span class="pln">src</span><span class="pun">/</span><span class="pln">third_party</span><span class="pun">/</span><span class="pln">chromiumos</span><span class="pun">-</span><span class="pln">overlay</span><span class="pun">/</span><span class="pln">chromeos</span><span class="pun">-</span><span class="pln">base</span><span class="pun">/</span><span class="pln">ec</span><span class="pun">-</span><span class="pln">utils</span><span class="pun">/</span><span class="pln">ec</span><span class="pun">-</span><span class="pln">utils</span><span class="pun">-</span><span class="lit">0.0</span><span class="pun">.</span><span class="lit">1</span><span class="pun">-</span><span class="pln">r134</span><span class="pun">.</span><span class="pln">ebuild
</span></pre>
                    <h3>
                        <a class="h" name="Create-a-branch-for-your-changes" href="#Create-a-branch-for-your-changes"><span></span></a>
                        <a class="h" name="create-a-branch-for-your-changes" href="#create-a-branch-for-your-changes"><span></span></a>Create a branch for your changes
                    </h3>
                    <p>Since ThoriumOS uses <code class="code">repo</code>/<code class="code">git</code>, you should always create a local branch whenever you make changes.</p>
                    <p>
                        First, find the source directory for the project you just used <code class="code">cros workon</code> on. This isn&lsquo;t directly related to the project name you used with <code class="code">cros workon</code>.
                        (TODO: This isn&rsquo;t very helpful - someone with more experience, actually tell us how to find it reliably? --Meredydd)
                    </p>
                    <p>
                        cd into that directory, in particular the <code class="code">&quot;files/&quot;</code> directory in which the actual source resides. In the command below, replace <code class="code">${BRANCH_NAME}</code> with a name
                        that is meaningful to you and that describes your changes (nobody else will see this name):
                    </p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ repo start $</span><span class="pun">{</span><span class="pln">BRANCH_NAME</span><span class="pun">}</span><span class="pln"> </span><span class="pun">.</span><span class="pln">
</span></pre>
                    <p>The branch that this creates will be based on the remote branch (TODO: which one? --Meredydd). If you&#39;ve made any other local changes, they will not be present in this branch.</p>
                    <h3>
                        <a class="h" name="Make-your-changes" href="#Make-your-changes"><span></span></a><a class="h" name="make-your-changes" href="#make-your-changes"><span></span></a>Make your changes
                    </h3>
                    <p>
                        You should be able to make your changes to the source code now. To incrementally compile your changes, use either <code class="code">cros_workon_make</code> or <code class="code">emerge-${BOARD}</code>. To use
                        <code class="code">cros_workon_make</code>, run
                    </p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cros_sdk cros_workon_make </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> $</span><span class="pun">{</span><span class="pln">PACKAGE_NAME</span><span class="pun">}</span><span class="pln">
</span></pre>
                    <p>This will build your package inside your source directory. Change a single file, and it will rebuild only that file and re-link. If your package contains test binaries, using</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cros_sdk cros_workon_make </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> $</span><span class="pun">{</span><span class="pln">PACKAGE_NAME</span><span class="pun">}</span><span class="pln"> </span><span class="pun">--</span><span class="pln">test
</span></pre>
                    <p>will build and run those binaries as well. In case your tests have out-of-package dependencies, you&#39;ll first need to run</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cros_sdk USE</span><span class="pun">=</span><span class="pln">test emerge</span><span class="pun">-</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> $</span><span class="pun">{</span><span class="pln">PACKAGE_NAME</span><span class="pun">}</span><span class="pln">
</span></pre>
                    <p>to pull them in.</p>
                    <p>Call <code class="code">cros_workon_make --help</code> to see other options that are supported.</p>
                    <p>You probably want to get your changes onto your device now. You need to install the changes you made by using</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cros_sdk cros_workon_make </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> $</span><span class="pun">{</span><span class="pln">PACKAGE_NAME</span><span class="pun">}</span><span class="pln"> </span><span class="pun">--</span><span class="pln">install
</span></pre>
                    <p>You can then rebuild an image with <code class="code">cros build-image</code> and reimage your device.</p>
                    <p>Alternatively, you can build your package using <code class="code">emerge-${BOARD}</code> and quickly install it to the device by using <a href="cros_deploy.md">cros deploy</a>.</p>
                    <p>For example, if you want to build <code class="code">ec-utils</code> to test on your device, use</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cros_sdk emerge</span><span class="pun">-</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> ec</span><span class="pun">-</span><span class="pln">utils
</span></pre>
                    <p>To install the package to the device, use</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cros deploy $</span><span class="pun">{</span><span class="pln">IP</span><span class="pun">}</span><span class="pln"> ec</span><span class="pun">-</span><span class="pln">utils
</span></pre>
                    <h3>
                        <a class="h" name="Set-your-editor" href="#Set-your-editor"><span></span></a><a class="h" name="set-your-editor" href="#set-your-editor"><span></span></a>Set your editor
                    </h3>
                    <p>Many of the commands below (in particular <code class="code">git</code>) open up an editor. You probably want to run one of the three commands below depending on your favorite editor.</p>
                    <p>If you&#39;re not a *nix expert, <code class="code">nano</code> is a reasonable editor:</p>
                    <pre class="code"><span class="pln">$ export EDITOR</span><span class="pun">=</span><span class="str">&#39;nano&#39;</span><span class="pln">
</span></pre>
                    <p>If you love <code class="code">vi</code>:</p>
                    <pre class="code"><span class="pln">$ export EDITOR</span><span class="pun">=</span><span class="str">&#39;vi&#39;</span><span class="pln">
</span></pre>
                    <p>If you love <code class="code">emacs</code> (and don&#39;t want an X window to open up every time you do something):</p>
                    <pre class="code"><span class="pln">$ export EDITOR</span><span class="pun">=</span><span class="str">&#39;emacs -nw&#39;</span><span class="pln">
</span></pre>
                    <p>You should probably add one of those lines to your <code class="code">.bashrc</code> (or similar file) too.</p>
                    <h3>
                        <a class="h" name="Submit-changes-locally" href="#Submit-changes-locally"><span></span></a><a class="h" name="submit-changes-locally" href="#submit-changes-locally"><span></span></a>Submit changes locally
                    </h3>
                    <p>
                        When your changes look good, commit them to your local branch using <code class="code">git</code>. Full documentation of how to use git is beyond the scope of this guide, but you might be able to commit your changes
                        by running something like the command below from the project directory:
                    </p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ git commit </span><span class="pun">-</span><span class="pln">a
</span></pre>
                    <p>
                        The git commit command brings up a text editor. You should describe your changes, save, and exit the editor. Note that the description you provide is only for your own use. When you upload your changes for code
                        review, the repo upload command grabs all of your previous descriptions, and gives you a chance to edit them.
                    </p>
                    <h3>
                        <a class="h" name="Upload-your-changes-and-get-a-code-review" href="#Upload-your-changes-and-get-a-code-review"><span></span></a>
                        <a class="h" name="upload-your-changes-and-get-a-code-review" href="#upload-your-changes-and-get-a-code-review"><span></span></a>Upload your changes and get a code review
                    </h3>
                    <p>Check out our <a href="contributing.md">Gerrit Workflow</a> guide for details on our review process.</p>
                    <h3>
                        <a class="h" name="Clean-up-after-you_re-done-with-your-changes" href="#Clean-up-after-you_re-done-with-your-changes"><span></span></a>
                        <a class="h" name="clean-up-after-you_re-done-with-your-changes" href="#clean-up-after-you_re-done-with-your-changes"><span></span></a>Clean up after you&#39;re done with your changes
                    </h3>
                    <p>After you&lsquo;re done with your changes, you&rsquo;re ready to clean up. The most important thing to do is to tell <code class="code">cros workon</code> that you&#39;re done by running the following command:</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cros workon </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> stop $</span><span class="pun">{</span><span class="pln">PACKAGE_NAME</span><span class="pun">}</span><span class="pln">
</span></pre>
                    <p>This command tells <code class="code">cros workon</code> to stop forcing the <code class="code">-9999.ebuild</code> and to stop forcing a build from source every time.</p>
                    <p>
                        If you&#39;re using the <code class="code">minilayout</code>, doing a <code class="code">cros workon</code> stop <strong>will not</strong> remove your source code. The code will continue to stay on your hard disk and
                        get synced down.
                    </p>
                    <h2>
                        <a class="h" name="Making-changes-to-non_cros_workon_able-packages" href="#Making-changes-to-non_cros_workon_able-packages"><span></span></a>
                        <a class="h" name="making-changes-to-non_cros_workon_able-packages" href="#making-changes-to-non_cros_workon_able-packages"><span></span></a>Making changes to non-cros-workon-able packages
                    </h2>
                    <p>
                        If you want to make changes to something other than packages which source is checked into the ThoriumOS source control system, you can follow the instructions in the previous section, but skip the
                        <code class="code">cros workon</code> step. Note specifically that you still need to run <code class="code">repo start</code> to <a href="#Create-a-branch-for-your-changes">Create a branch for your changes</a>.
                    </p>
                    <p>The types of changes that fall into this category include:</p>
                    <ul>
                        <li>changes to build scripts (pretty much anything in <code class="code">src/scripts</code>)</li>
                        <li>
                            changes to <code class="code">ebuild</code> files themselves (like the ones in <code class="code">src/third_party/chromiumos-overlay</code>)
                            <ul>
                                <li>To change these files, you need to &ldquo;manually uprev&rdquo; the package. For example, if we&#39;re making a modification to for the Pixel overlay (link), then</li>
                                <li><code class="code">cd src/overlays/overlay-link/chromeos-base/chromeos-bsp-link</code></li>
                                <li><code class="code">mv chromeos-bsp-link-0.0.2-r29.ebuild chromeos-bsp-link-0.0.2-r30.ebuild</code></li>
                                <li>
                                    <code class="code">chromeos-bsp-link-0.0.2-r29.ebuild</code> is a symlink that points to <code class="code">chromeos-bsp-link-0.0.2.ebuild</code>. To uprev the package, simply increment the revision (r29)
                                    number.
                                </li>
                                <li>
                                    Note: Upreving should not be done when there is an ebuild for the package that ends with <code class="code">9999.ebuild</code>. Changes to the ebuild should usually be done in the
                                    <code class="code">9999.ebuild</code> file.
                                </li>
                            </ul>
                        </li>
                        <li>adding small patches to existing packages whose source code is NOT checked into ThoriumOS git repositories</li>
                        <li>changes to <code class="code">eclass</code> files (like the ones in <code class="code">src/third_party/chromiumos-overlay/eclass</code>)</li>
                        <li>changes to the buildbot infrastructure (in <code class="code">crostools</code>)</li>
                        <li>changes to ThoriumOS project documentation (in <code class="code">docs</code>)</li>
                        <li>TODO: anything else?</li>
                    </ul>
                    <h3>
                        <a class="h" name="Adding-small-patches-to-existing-packages" href="#Adding-small-patches-to-existing-packages"><span></span></a>
                        <a class="h" name="adding-small-patches-to-existing-packages" href="#adding-small-patches-to-existing-packages"><span></span></a>Adding small patches to existing packages
                    </h3>
                    <p>
                        When you need to add small patches to existing packages whose source code is not checked into a ThoriumOS git repository (e.g. it comes from portage, and is not a <code class="code">cros workon</code>-able package),
                        you need to do the following:
                    </p>
                    <p>First, find the package ebuild file under <code class="code">third_party/chromiumos-overlay</code>.</p>
                    <p>
                        Then, <a href="portage/how_to_patch_an_ebuild.md">create a patch file</a> from the exact version of the package that is used by the current ebuild. If other patches are already in the ebuild, you&#39;ll want to add
                        your patch LAST, and build the patch off of the source that has already had the existing patches applied (either do it by hand, or set <code class="code">FEATURES=noclean</code> and build your patch off of the temp
                        source). Note that patch order is significant, since the ebuild expects each patch line number to be accurate after the previous patch is applied.
                    </p>
                    <p>
                        Place your patch in the &ldquo;files&rdquo; subdir of the directory that contains the ebuild file (e.g.
                        <code class="code">third_party/chromiumos-overlay/dev-libs/mypackage/files/mypackage-1.0.0-my-little-patch.patch</code>).
                    </p>
                    <p>Then, in the <code class="code">prepare()</code> section of the ebuild (create one if it doesn&#39;t exist), add an epatch line:</p>
                    <pre
                        class="code"
                    ><span class="pln">$ epatch </span><span class="str">&quot;${FILESDIR}&quot;</span><span class="pun">/</span><span class="pln">$</span><span class="pun">{</span><span class="pln">P</span><span class="pun">}-</span><span class="pln">my</span><span class="pun">-</span><span class="pln">little</span><span class="pun">-</span><span class="pln">patch</span><span class="pun">.</span><span class="pln">patch
</span></pre>
                    <p>
                        Lastly, you&#39;ll need to bump the revision number in the name of the ebuild file (or symlink) so the build system picks up the change. The current wisdom is that the ebuild file should be symlinked instead of being
                        renamed. For example, if the original ebuild file is <code class="code">&quot;mypackage-1.0.0.ebuild&quot;</code>, you should create a <code class="code">&quot;mypackage-1.0.0-r1.ebuild&quot;</code> symbolic link
                        that points at the original ebuild file. If that symlink already exists, create the next higher &ldquo;rN&rdquo; symlink.
                    </p>
                    <h3>
                        <a class="h" name="Making-changes-to-the-way-that-the-chroot-is-constructed" href="#Making-changes-to-the-way-that-the-chroot-is-constructed"><span></span></a>
                        <a class="h" name="making-changes-to-the-way-that-the-chroot-is-constructed" href="#making-changes-to-the-way-that-the-chroot-is-constructed"><span></span></a>Making changes to the way that the chroot is constructed
                    </h3>
                    <p>TODO: This section is currently a placeholder, waiting for someone to fill it in. However, a few notes:</p>
                    <ul>
                        <li>
                            Many of the commands that take a <code class="code">--board=${BOARD}</code> parameter also take a <code class="code">--host</code> parameter, which makes the commands affect the host (i.e. the chroot) rather than
                            the board.
                            <ul>
                                <li>Most notably, <code class="code">cros workon --host</code> says that you want to build a package used in the chroot from source.</li>
                            </ul>
                        </li>
                    </ul>
                    <h3>
                        <a class="h" name="Building-an-individual-package" href="#Building-an-individual-package"><span></span></a>
                        <a class="h" name="building-an-individual-package" href="#building-an-individual-package"><span></span></a>Building an individual package
                    </h3>
                    <p>TODO: Document this better, and add the new <code class="code">cros_workon_make</code>.</p>
                    <p><strong>SIDE NOTE:</strong> To build an individual portage package, for a particular board, use <code class="code">emerge-${BOARD}</code>.</p>
                    <p>For example, if you want to build dash to test on your device:</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cros_sdk emerge</span><span class="pun">-</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> dash
</span></pre>
                    <p>To install the package to the device, see <a href="cros_deploy.md">cros deploy</a>.</p>
                    <p><strong>SIDE NOTE:</strong></p>
                    <ul>
                        <li>
                            Typically, when building a package with <code class="code">emerge-${BOARD}</code>, the dependencies have already been built. However, in some situations dependencies will need to be built as well. When that
                            happens, <code class="code">-jN</code> can be passed to <code class="code">emerge-${BOARD}</code> to build different packages in parallel.
                        </li>
                    </ul>
                    <h3>
                        <a class="h" name="Making-changes-to-the-Chromium-web-browser-on-ThoriumOS" href="#Making-changes-to-the-Chromium-web-browser-on-ThoriumOS"><span></span></a>
                        <a class="h" name="making-changes-to-the-chromium-web-browser-on-chromiumos" href="#making-changes-to-the-chromium-web-browser-on-chromiumos"><span></span></a>Making changes to the Chromium web browser on ThoriumOS
                    </h3>
                    <p>
                        If you want to make modifications to the Chromium web browser and quickly deploy your changes to an already-built ThoriumOS image, see
                        <a href="simple_chrome_workflow.md">Making changes to the Chromium web browser on ThoriumOS</a>. Or if you have a pending Chromium change that you&lsquo;d like tested remotely on CrOS&rsquo;s CQ before submitting
                        it, see the <a href="simple_chrome_workflow.md#testing-a-chromium-cl-remotely-on-cros-cq">chromeos-uprev-tester</a> trybot.
                    </p>
                    <p>There are other, historical/obsolete ways to build Chromium for ThoriumOS but they are unsupported and will break in confusing ways.</p>
                    <h2>
                        <a class="h" name="Local-Debugging" href="#Local-Debugging"><span></span></a><a class="h" name="local-debugging" href="#local-debugging"><span></span></a>Local Debugging
                    </h2>
                    <h3>
                        <a class="h" name="Debugging-both-x86-and-non_x86-binaries-on-your-workstation" href="#Debugging-both-x86-and-non_x86-binaries-on-your-workstation"><span></span></a>
                        <a class="h" name="debugging-both-x86-and-non_x86-binaries-on-your-workstation" href="#debugging-both-x86-and-non_x86-binaries-on-your-workstation"><span></span></a>Debugging both x86 and non-x86 binaries on your
                        workstation
                    </h3>
                    <p>If you build your projects incrementally, write unit tests and use them to drive your development, you may want to debug your code without shipping it over to a running device or VM.</p>
                    <p><code class="code">gdb-${BOARD}</code> sets up gdb in your board sysroot and ensures that gdb is using the proper libraries, debug files, etc. for debugging, allowing you to run your target-compiled binaries.</p>
                    <p>It should already be installed in your chroot. If you do not have the script, update your repository to get the latest changes, then re-build your packages:</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ repo sync

</span><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cros build</span><span class="pun">-</span><span class="pln">packages </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=...</span><span class="pln">
</span></pre>
                    <p>
                        This should install <code class="code">gdb-${BOARD}</code> in the <code class="code">/usr/local/bin</code> directory inside the chroot. These board-specific gdb wrapper scripts correctly handle
                        <em>both local and remote debugging</em> (see next section for more information on remote debugging). When used for local debugging, these scripts will run inside a special chroot-inside-your-chroot, rooted in the
                        board&#39;s sysroot. For example if you are using <code class="code">gdb-lumpy</code>, it will run inside a chroot based entirely in your <code class="code">/build/lumpy</code> sysroot.
                        <em>The libraries that it will load and use are the libraries in the sysroot,</em> i.e. the target libraries for the board; the gdb binary it will use is the gdb binary in that tree. While debugging with
                        <code class="code">gdb-lumpy</code> (for local debugging), you will not be able to see/access any files outside of the <code class="code">/build/lumpy</code> tree. While for the most part this is very good, as it
                        ensures the correct debugging environment, it does mean that if you want to use this script to debug a lumpy binary, such as a unit test, that you built outside of the <code class="code">/build/lumpy</code> tree, you
                        will need to copy the binary to the <code class="code">/build/lumpy</code> tree first. Also, if you want the debugger to be able to see the source files when debugging, you will need to make sure they exist inside
                        the <code class="code">/build/lumpy</code> tree as well (see example below).
                    </p>
                    <p><strong>IMPORTANT NOTE 1</strong>: Local and remote debugging functionality are combined in this single script. Some of the options shown below only work for remote debugging.</p>
                    <p>
                        <strong>IMPORTANT NOTE 2</strong>: When doing local debugging of x86 binaries, they will try to execute on your desktop machine (using the appropriate libraries and gdb binaries). It is possible that for some x86
                        boards, the binaries may use instructions not understood by your hardware (particularly some vector instructions), in which case you will need to do remote debugging with the actual hardware instead.
                    </p>
                    <p>
                        <strong>IMPORTANT NOTE 3</strong>: You can use this script with *some* debugging functionality for local debugging of non-x86 binaries. The script loads QEMU and runs the non-x86 binaries in QEMU. However QEMU has
                        some unfortunate limitations. For example you can &ldquo;set&rdquo; breakpoints in the binary (to see what addresses correspond to locations in the source), examine the source or assembly code, and execute the
                        program. But QEMU does not actually hit the breakpoints, so you cannot suspend execution in the middle when running under QEMU. For full debugging functionality with non-x86 binaries, you must debug them remotely
                        running on the correct hardware (see next section on remote debugging). You can see this in the example below, where gdb-daisy does not actually stop at the breakpoint it appears to set, although it does correctly
                        execute the program.
                    </p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cros_sdk gdb</span><span class="pun">-</span><span class="pln">daisy </span><span class="pun">-</span><span class="pln">h

usage</span><span class="pun">:</span><span class="pln"> cros_gdb </span><span class="pun">[-</span><span class="pln">h</span><span class="pun">]</span><span class="pln">
                </span><span class="pun">[--</span><span class="pln">log</span><span class="pun">-</span><span class="pln">level </span><span class="pun">{</span><span class="pln">fatal</span><span class="pun">,</span><span class="pln">critical</span><span class="pun">,</span><span class="pln">error</span><span class="pun">,</span><span class="pln">warning</span><span class="pun">,</span><span class="pln">notice</span><span class="pun">,</span><span class="pln">info</span><span class="pun">,</span><span class="pln">debug</span><span class="pun">}]</span><span class="pln">
                </span><span class="pun">[--</span><span class="pln">log_format LOG_FORMAT</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[--</span><span class="pln">debug</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[--</span><span class="pln">nocolor</span><span class="pun">]</span><span class="pln">
                </span><span class="pun">[--</span><span class="pln">board BOARD</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[-</span><span class="pln">g GDB_ARGS</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[--</span><span class="pln">remote REMOTE</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[--</span><span class="pln">pid PID</span><span class="pun">]</span><span class="pln">
                </span><span class="pun">[--</span><span class="pln">remote_pid PID</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[--</span><span class="pln">no</span><span class="pun">-</span><span class="pln">ping</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[--</span><span class="pln">attach ATTACH_NAME</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[--</span><span class="pln">cgdb</span><span class="pun">]</span><span class="pln">
                </span><span class="pun">[</span><span class="pln">binary</span><span class="pun">-</span><span class="pln">to</span><span class="pun">-</span><span class="pln">be</span><span class="pun">-</span><span class="pln">debugged</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[</span><span class="pln">args</span><span class="pun">-</span><span class="kwd">for</span><span class="pun">-</span><span class="pln">binary</span><span class="pun">-</span><span class="pln">being</span><span class="pun">-</span><span class="pln">debugged</span><span class="pun">]</span><span class="pln">

</span><span class="typ">Wrapper</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> running gdb</span><span class="pun">.</span><span class="pln">

</span><span class="typ">This</span><span class="pln"> handles the fun details like running against the right sysroot</span><span class="pun">,</span><span class="pln"> via
QEMU</span><span class="pun">,</span><span class="pln"> bind mounts</span><span class="pun">,</span><span class="pln"> etc</span><span class="pun">...</span><span class="pln">

positional arguments</span><span class="pun">:</span><span class="pln">
  inf_args              </span><span class="typ">Arguments</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> gdb to pass to the program being
                        debugged</span><span class="pun">.</span><span class="pln"> </span><span class="typ">These</span><span class="pln"> are positional and must come at the
                        end of the command line</span><span class="pun">.</span><span class="pln"> </span><span class="typ">This</span><span class="pln"> will not work </span><span class="kwd">if</span><span class="pln">
                        attaching to an already running program</span><span class="pun">.</span><span class="pln">
</span><span class="pun">...</span><span class="pln">

$ cros_sdk gdb</span><span class="pun">-</span><span class="pln">daisy </span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">grep shebang </span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">ls
</span><span class="lit">15</span><span class="pun">:</span><span class="lit">51</span><span class="pun">:</span><span class="lit">06</span><span class="pun">:</span><span class="pln"> INFO</span><span class="pun">:</span><span class="pln"> run</span><span class="pun">:</span><span class="pln"> file </span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">daisy</span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">grep
</span><span class="typ">Reading</span><span class="pln"> symbols from </span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">grep</span><span class="pun">...</span><span class="typ">Reading</span><span class="pln"> symbols from </span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="pln">lib</span><span class="pun">/</span><span class="pln">debug</span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">grep</span><span class="pun">.</span><span class="pln">debug</span><span class="pun">...</span><span class="kwd">done</span><span class="pun">.</span><span class="pln">
</span><span class="kwd">done</span><span class="pun">.</span><span class="pln">
</span><span class="pun">(</span><span class="pln">daisy</span><span class="pun">-</span><span class="pln">gdb</span><span class="pun">)</span><span class="pln"> b main
</span><span class="typ">Breakpoint</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> at </span><span class="lit">0x2814</span><span class="pun">:</span><span class="pln"> file grep</span><span class="pun">.</span><span class="pln">c</span><span class="pun">,</span><span class="pln"> line </span><span class="lit">2111.</span><span class="pln">
</span><span class="pun">(</span><span class="pln">daisy</span><span class="pun">-</span><span class="pln">gdb</span><span class="pun">)</span><span class="pln"> disass main
</span><span class="typ">Dump</span><span class="pln"> of assembler code </span><span class="kwd">for</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> main</span><span class="pun">:</span><span class="pln">
   </span><span class="lit">0x00002814</span><span class="pln"> </span><span class="pun">&lt;+</span><span class="lit">0</span><span class="pun">&gt;:</span><span class="pln"> ldr</span><span class="pun">.</span><span class="pln">w r2</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="pln">pc</span><span class="pun">,</span><span class="pln"> </span><span class="com">#3408] ; 0x3568 &lt;main+3412&gt;</span><span class="pln">
   </span><span class="lit">0x00002818</span><span class="pln"> </span><span class="pun">&lt;+</span><span class="lit">4</span><span class="pun">&gt;:</span><span class="pln"> str</span><span class="pun">.</span><span class="pln">w r4</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="pln">sp</span><span class="pun">,</span><span class="pln"> </span><span class="com">#-36]!</span><span class="pln">
   </span><span class="lit">0x0000281c</span><span class="pln"> </span><span class="pun">&lt;+</span><span class="lit">8</span><span class="pun">&gt;:</span><span class="pln"> movs r4</span><span class="pun">,</span><span class="pln"> </span><span class="com">#0</span><span class="pln">
   </span><span class="lit">0x0000281e</span><span class="pln"> </span><span class="pun">&lt;+</span><span class="lit">10</span><span class="pun">&gt;:</span><span class="pln"> strd r5</span><span class="pun">,</span><span class="pln"> r6</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="pln">sp</span><span class="pun">,</span><span class="pln"> </span><span class="com">#4]</span><span class="pln">
   </span><span class="lit">0x00002822</span><span class="pln"> </span><span class="pun">&lt;+</span><span class="lit">14</span><span class="pun">&gt;:</span><span class="pln"> ldr</span><span class="pun">.</span><span class="pln">w r3</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="pln">pc</span><span class="pun">,</span><span class="pln"> </span><span class="com">#3400] ; 0x356c &lt;main+3416&gt;</span><span class="pln">
   </span><span class="lit">0x00002826</span><span class="pln"> </span><span class="pun">&lt;+</span><span class="lit">18</span><span class="pun">&gt;:</span><span class="pln"> movs r5</span><span class="pun">,</span><span class="pln"> </span><span class="com">#2</span><span class="pln">
   </span><span class="lit">0x00002828</span><span class="pln"> </span><span class="pun">&lt;+</span><span class="lit">20</span><span class="pun">&gt;:</span><span class="pln"> strd r7</span><span class="pun">,</span><span class="pln"> r8</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="pln">sp</span><span class="pun">,</span><span class="pln"> </span><span class="com">#12]</span><span class="pln">
</span><span class="pun">...</span><span class="pln">
</span><span class="pun">(</span><span class="pln">daisy</span><span class="pun">-</span><span class="pln">gdb</span><span class="pun">)</span><span class="pln"> run
</span><span class="typ">Starting</span><span class="pln"> program</span><span class="pun">:</span><span class="pln"> </span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">grep shebang </span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">ls
qemu</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Unsupported</span><span class="pln"> syscall</span><span class="pun">:</span><span class="pln"> </span><span class="lit">26</span><span class="pln">
</span><span class="com">#!/usr/bin/coreutils --coreutils-prog-shebang=ls</span><span class="pln">
qemu</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Unsupported</span><span class="pln"> syscall</span><span class="pun">:</span><span class="pln"> </span><span class="lit">26</span><span class="pln">
</span><span class="typ">During</span><span class="pln"> startup program exited normally</span><span class="pun">.</span><span class="pln">
</span><span class="pun">(</span><span class="pln">daisy</span><span class="pun">-</span><span class="pln">gdb</span><span class="pun">)</span><span class="pln"> quit
</span></pre>
                    <p>
                        Note in the example above that, like &ldquo;regular&rdquo; gdb when given <code class="code">--args</code>, you can pass the arguments for the program being debugged to the gdb wrapper script just by adding them to
                        the command line after the name of the program being debugged (except that <code class="code">--args</code> isn&#39;t needed).
                    </p>
                    <p>The commands below show how to copy your incrementally-compiled unit test binary and source file(s) to the appropriate sysroot and then start gdb with that binary (using the correct libraries, etc).</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cd </span><span class="pun">~/</span><span class="pln">chromiumos</span><span class="pun">/</span><span class="pln">chroot</span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">lumpy</span><span class="pun">/</span><span class="pln">tmp</span><span class="pun">/</span><span class="pln">portage
$ mkdir shill</span><span class="pun">-</span><span class="pln">test
$ cd shill</span><span class="pun">-</span><span class="pln">test
$ cp </span><span class="pun">&lt;</span><span class="pln">path</span><span class="pun">-</span><span class="pln">to</span><span class="pun">-</span><span class="pln">binary</span><span class="pun">&gt;/</span><span class="pln">shill_unittest </span><span class="pun">.</span><span class="pln">
$ cp </span><span class="pun">&lt;</span><span class="pln">path</span><span class="pun">-</span><span class="pln">to</span><span class="pun">-</span><span class="pln">src</span><span class="pun">&gt;/</span><span class="pln">shill_unittest</span><span class="pun">.</span><span class="pln">cc </span><span class="pun">.</span><span class="pln">
$ cros_sdk gdb</span><span class="pun">-</span><span class="pln">lumpy
</span><span class="pun">(</span><span class="pln">gdb</span><span class="pun">-</span><span class="pln">lumpy</span><span class="pun">)</span><span class="pln"> directory </span><span class="pun">/</span><span class="pln">tmp</span><span class="pun">/</span><span class="pln">portage</span><span class="pun">/</span><span class="pln">shill</span><span class="pun">-</span><span class="pln">test </span><span class="com"># Tell gdb to add /tmp/portage/shill-test to the paths it searches for source files</span><span class="pln">
</span><span class="pun">(</span><span class="pln">gdb</span><span class="pun">-</span><span class="pln">lumpy</span><span class="pun">)</span><span class="pln"> file </span><span class="pun">./</span><span class="pln">shill_unittest
</span></pre>
                    <p>
                        If gdb is still looking for the source file in the wrong directory path, you can use <code class="code">set substitute-path &lt;from&gt; &lt;to&gt;</code> inside gdb to help it find the right path (inside your
                        sysroot) for searching for source files.
                    </p>
                    <h3>
                        <a class="h" name="Printing-stack-traces-at-runtime" href="#Printing-stack-traces-at-runtime"><span></span></a>
                        <a class="h" name="printing-stack-traces-at-runtime" href="#printing-stack-traces-at-runtime"><span></span></a>Printing stack traces at runtime
                    </h3>
                    <p>See <a href="stack_traces.md">./stack_traces.md</a> for how to print stack traces at runtime.</p>
                    <h2>
                        <a class="h" name="Remote-Debugging" href="#Remote-Debugging"><span></span></a><a class="h" name="remote-debugging" href="#remote-debugging"><span></span></a>Remote Debugging
                    </h2>
                    <h3>
                        <a class="h" name="Setting-up-remote-debugging-by-hand" href="#Setting-up-remote-debugging-by-hand"><span></span></a>
                        <a class="h" name="setting-up-remote-debugging-by-hand" href="#setting-up-remote-debugging-by-hand"><span></span></a>Setting up remote debugging by hand
                    </h3>
                    <p>
                        If you want to manually run through all the steps necessary to set up your system for remote debugging and start the debugger, see
                        <a href="https://www.chromium.org/chromium-os/how-tos-and-troubleshooting/remote-debugging">Remote Debugging in ThoriumOS</a>.
                    </p>
                    <h3>
                        <a class="h" name="Automated-remote-debugging-using-gdb_BOARD_script-gdb_lumpy_gdb_daisy_gdb_parrot_etc" href="#Automated-remote-debugging-using-gdb_BOARD_script-gdb_lumpy_gdb_daisy_gdb_parrot_etc"><span></span></a>
                        <a class="h" name="automated-remote-debugging-using-gdb_board_script-gdb_lumpy_gdb_daisy_gdb_parrot_etc" href="#automated-remote-debugging-using-gdb_board_script-gdb_lumpy_gdb_daisy_gdb_parrot_etc"><span></span></a>
                        Automated remote debugging using gdb-${BOARD} script (gdb-lumpy, gdb-daisy, gdb-parrot, etc)
                    </h3>
                    <p>
                        <code class="code">gdb-${BOARD}</code> is a script that automates many of the steps necessary for setting up remote debugging with gdb. It should already be installed in your chroot. If you do not have the script,
                        update your repository to get the latest changes, then re-build your packages:
                    </p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ repo sync

</span><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cros build</span><span class="pun">-</span><span class="pln">packages </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=...</span><span class="pln">
</span></pre>
                    <p>
                        This should install <code class="code">gdb_remote</code> in the <code class="code">/usr/bin</code> directory inside the chroot. The <code class="code">gdb-${BOARD}</code> script takes several options. The most
                        important ones are mentioned below.
                    </p>
                    <p>
                        <code class="code">--gdb_args</code> (<code class="code">-g</code>) are arguments to be passed to gdb itself (rather than to the program gdb is debugging). If multiple arguments are passed, each argument requires a
                        separate -g flag.
                    </p>
                    <p>E.g <code class="code">gdb-lumpy --remote=123.45.67.765 -g &quot;-core=/tmp/core&quot; -g &quot;-directory=/tmp/source&quot;</code></p>
                    <p>
                        <code class="code">--remote</code> is the ip_address or name for your Chromebook, if you are doing remote debugging. If you omit this argument, the assumption is you are doing local debugging in the sysroot on your
                        desktop (see section above). if you are debugging in the VM, then you need to specify either <code class="code">:vm:</code> or <code class="code">localhost:9222</code>.
                    </p>
                    <p><code class="code">--pid</code> is the PID of a running process on the remote device to which you want gdb/gdbserver to attach.</p>
                    <p>
                        <code class="code">--attach</code> is the name of the running process on the remote device to which you want gdb/gdbserver to attach. If you want to attach to the Chrome browser itself, there are three special names
                        you can use: <code class="code">browser</code> will attach to the main browser process; <code class="code">gpu-process</code> will attach to the GPU process; and <code class="code">renderer</code> will attach to the
                        renderer process if there is only one. If there is more than one renderer process <code class="code">--attach=renderer</code> will return a list of the renderer PIDs and stop.
                    </p>
                    <p>To have gdb/gdbserver start and attach to a new (not already running) binary, give the name of the binary, followed by any arguments for the binary, at the end of the command line:</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cros_sdk gdb</span><span class="pun">-</span><span class="pln">daisy </span><span class="pun">--</span><span class="pln">remote</span><span class="pun">=</span><span class="lit">123.45</span><span class="pun">.</span><span class="lit">67.809</span><span class="pln"> </span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">grep </span><span class="str">&quot;test&quot;</span><span class="pln"> </span><span class="pun">/</span><span class="pln">tmp</span><span class="pun">/</span><span class="pln">myfile
</span></pre>
                    <p>
                        When doing remote debugging you *must* use the <code class="code">--pid</code> or the <code class="code">--attach</code> option, or specify the name of a new binary to start. You cannot start a remote debugging
                        session without having specified the program to debug in one of these three ways.
                    </p>
                    <p>
                        When you invoke <code class="code">gdb-${BOARD} --remote=...</code>, it will connect to the notebook or VM (automatically setting up port-forwarding on the VM), make sure the port is entered into the iptables, and
                        start up gdbserver, using the correct port and binary, either attaching to the binary (if a remote PID or name was specified) or starting up the binary. It will also start the appropriate version of gdb (for
                        whichever type of board you are debugging) on your desktop and connect the gdb on your desktop to the gdbserver on the remote device.
                    </p>
                    <h3>
                        <a class="h" name="Edit_Debug-cycle" href="#Edit_Debug-cycle"><span></span></a><a class="h" name="edit_debug-cycle" href="#edit_debug-cycle"><span></span></a>Edit/Debug cycle
                    </h3>
                    <p>If you want to edit code and debug it on the DUT you can follow this procedure</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cros_sdk CFLAGS</span><span class="pun">=</span><span class="str">&quot;-ggdb&quot;</span><span class="pln"> FEATURES</span><span class="pun">=</span><span class="str">&quot;noclean&quot;</span><span class="pln"> emerge</span><span class="pun">-</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> </span><span class="pun">-</span><span class="pln">v sys</span><span class="pun">-</span><span class="pln">apps</span><span class="pun">/</span><span class="pln">mosys
$ cros deploy </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> $</span><span class="pun">{</span><span class="pln">IP</span><span class="pun">}</span><span class="pln"> sys</span><span class="pun">-</span><span class="pln">apps</span><span class="pun">/</span><span class="pln">mosys
$ cros_sdk gdb</span><span class="pun">-</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> </span><span class="pun">--</span><span class="pln">cgdb </span><span class="pun">--</span><span class="pln">remote </span><span class="str">&quot;${IP}&quot;</span><span class="pln"> \
  </span><span class="pun">-</span><span class="pln">g </span><span class="str">&quot;--eval-command=directory /build/${BOARD}/tmp/portage/sys-apps/mosys-9999/work/&quot;</span><span class="pln"> \
  </span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="pln">sbin</span><span class="pun">/</span><span class="pln">mosys </span><span class="pun">-</span><span class="pln">V
</span></pre>
                    <p>
                        This will build your package with debug symbols (assuming your package respects <code class="code">CFLAGS</code>). We need to use the <code class="code">noclean</code> feature so that we have access to the original
                        sourcecode that was used to build the package. Some packages will generate build artifacts and have different directory structures then the tar/git repo. This ensures all the paths line up correctly and the source
                        code can be located. Ideally we would use the <code class="code">installsources</code> feature, but we don&#39;t have support for the debugedit package (yet!). Portage by default will strip the symbols and install
                        the debug symbols in <code class="code">/usr/lib/debug/</code>. <code class="code">gdb-${BOARD}</code> will handle setting up the correct debug symbol path. cros deploy will then update the rootfs on the DUT. We pass
                        the work directory into <code class="code">gdb-${BOARD}</code> so that <a href="https://cgdb.github.io/">cgdb</a> can display the sourcecode inline.
                    </p>
                    <p>Quick primer on cgdb:</p>
                    <ul>
                        <li>ESC: moves to the source window.</li>
                        <li>i: moves from source window to gdb window.</li>
                    </ul>
                    <h3>
                        <a class="h" name="Examples-of-debugging-using-the-gdb_BOARD_script" href="#Examples-of-debugging-using-the-gdb_BOARD_script"><span></span></a>
                        <a class="h" name="examples-of-debugging-using-the-gdb_board_script" href="#examples-of-debugging-using-the-gdb_board_script"><span></span></a>Examples of debugging using the gdb-${BOARD} script
                    </h3>
                    <p>
                        Below are three examples of using the board-specific gdb wrapper scripts to start up debugging sessions. The first two examples show connecting to a remote Chromebook. The first one automatically finds the
                        browser&lsquo;s running GPU process, attaches gdbserver to the running process, starts gdb on the desktop, and connects the local gdb to gdbserver. It also shows the user running the
                        <code class="code">bt</code> (backtrace) command after gdb comes up. The second example shows the user specifying the PID of a process on the Chromebook. Again the script attaches gdbserver to the process, starts gdb
                        on the desktop, and connects the two. The third example shows the user connecting to the main browser process in ChromeOS running in a VM on the user&rsquo;s desktop. For debugging the VM, you can use either
                        <code class="code">--remote=:vm:</code> or <code class="code">--remote=localhost:9222</code> (<code class="code">:vm:</code> gets translated into <code class="code">localhost:9222</code>).
                    </p>
                    <p>Example 1:</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cros_sdk gdb</span><span class="pun">-</span><span class="pln">lumpy </span><span class="pun">--</span><span class="pln">remote</span><span class="pun">=</span><span class="lit">123.45</span><span class="pun">.</span><span class="lit">67.809</span><span class="pln"> </span><span class="pun">--</span><span class="pln">attach</span><span class="pun">=</span><span class="pln">gpu</span><span class="pun">-</span><span class="pln">process

</span><span class="lit">14</span><span class="pun">:</span><span class="lit">50</span><span class="pun">:</span><span class="lit">07</span><span class="pun">:</span><span class="pln"> INFO</span><span class="pun">:</span><span class="pln"> run</span><span class="pun">:</span><span class="pln"> ping </span><span class="pun">-</span><span class="pln">c </span><span class="lit">1</span><span class="pln"> </span><span class="pun">-</span><span class="pln">w </span><span class="lit">20</span><span class="pln"> </span><span class="lit">123.45</span><span class="pun">.</span><span class="lit">67.809</span><span class="pln">
</span><span class="lit">14</span><span class="pun">:</span><span class="lit">50</span><span class="pun">:</span><span class="lit">09</span><span class="pun">:</span><span class="pln"> INFO</span><span class="pun">:</span><span class="pln"> run</span><span class="pun">:</span><span class="pln"> file </span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">lumpy</span><span class="pun">/</span><span class="pln">opt</span><span class="pun">/</span><span class="pln">google</span><span class="pun">/</span><span class="pln">chrome</span><span class="pun">/</span><span class="pln">chrome
</span><span class="lit">14</span><span class="pun">:</span><span class="lit">50</span><span class="pun">:</span><span class="lit">10</span><span class="pun">:</span><span class="pln"> INFO</span><span class="pun">:</span><span class="pln"> run</span><span class="pun">:</span><span class="pln"> x86_64</span><span class="pun">-</span><span class="pln">cros</span><span class="pun">-</span><span class="pln">linux</span><span class="pun">-</span><span class="pln">gnu</span><span class="pun">-</span><span class="pln">gdb </span><span class="pun">--</span><span class="pln">quiet </span><span class="str">&#39;--eval-command=set sysroot /build/lumpy&#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=set solib-absolute-prefix /build/lumpy&#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=set solib-search-path /build/lumpy&#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=set debug-file-directory /build/lumpy/usr/lib/debug&#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=set prompt (lumpy-gdb) &#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=file /build/lumpy/opt/google/chrome/chrome&#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=target remote localhost:38080&#39;</span><span class="pln">
</span><span class="typ">Reading</span><span class="pln"> symbols from </span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">lumpy</span><span class="pun">/</span><span class="pln">opt</span><span class="pun">/</span><span class="pln">google</span><span class="pun">/</span><span class="pln">chrome</span><span class="pun">/</span><span class="pln">chrome</span><span class="pun">...</span><span class="typ">Reading</span><span class="pln"> symbols from</span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">lumpy</span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="pln">lib</span><span class="pun">/</span><span class="pln">debug</span><span class="pun">/</span><span class="pln">opt</span><span class="pun">/</span><span class="pln">google</span><span class="pun">/</span><span class="pln">chrome</span><span class="pun">/</span><span class="pln">chrome</span><span class="pun">.</span><span class="pln">debug</span><span class="pun">...</span><span class="kwd">done</span><span class="pun">.</span><span class="pln">
</span><span class="pun">(</span><span class="pln">lumpy</span><span class="pun">-</span><span class="pln">gdb</span><span class="pun">)</span><span class="pln"> bt
</span><span class="com">#0  0x00007f301fad56ad in poll () at ../sysdeps/unix/syscall-template.S:81</span><span class="pln">
</span><span class="com">#1  0x00007f3020d5787c in g_main_context_poll (priority=2147483647, n_fds=3,   fds=0xdce10719840, timeout=-1, context=0xdce1070ddc0) at gmain.c:3584</span><span class="pln">
</span><span class="com">#2  g_main_context_iterate (context=context@entry=0xdce1070ddc0,block=block@entry=1, dispatch=dispatch@entry=1, self=&lt;optimized out&gt;)  at gmain.c:3285</span><span class="pln">
</span><span class="com">#3  0x00007f3020d5798c in g_main_context_iteration (context=0xdce1070ddc0may_block=1) at gmain.c:3351</span><span class="pln">
</span><span class="com">#4  0x00007f30226a4c1a in base::MessagePumpGlib::Run (this=0xdce10718580, delegate=&lt;optimized out&gt;) at ../../../../../chromeos-cache/distfiles/target/chrome-src-internal/src/base/message_loop/message_pump_glib.cc:309</span><span class="pln">
</span><span class="com">#5  0x00007f30226666ef in base::RunLoop::Run (this=this@entry=0x7fff72271af0) at ../../../../../chromeos-cache/distfiles/target/chrome-src-internal/src/base/run_loop.cc:55</span><span class="pln">
</span><span class="com">#6  0x00007f302264e165 in base::MessageLoop::Run (this=this@entry=0x7fff72271db0) at ../../../../../chromeos-cache/distfiles/target/chrome-src-internal/src/base/message_loop/message_loop.cc:307</span><span class="pln">
</span><span class="com">#7  0x00007f30266bc847 in content::GpuMain (parameters=...) at ../../../../../chromeos-cache/distfiles/target/chrome-src-internal/src/content/gpu/gpu_main.cc:365</span><span class="pln">
</span><span class="com">#8  0x00007f30225cedee in content::RunNamedProcessTypeMain (process_type=..., main_function_params=..., delegate=0x7fff72272380 at ../../../../../chromeos-cache/distfiles/target/chrome-src-internal/src/content/app/content_main_runner.cc:385</span><span class="pln">
</span><span class="com">#9  0x00007f30225cef3a in content::ContentMainRunnerImpl::Run (this=0xdce106fef50) at ../../../../../chromeos-cache/distfiles/target/chrome-src-internal/src/content/app/content_main_runner.cc:763</span><span class="pln">
</span><span class="com">#10 0x00007f30225cd551 in content::ContentMain (params=...) at ../../../../../chromeos-cache/distfiles/target/chrome-src-internal/src/content/app/content_main.cc:19</span><span class="pln">
</span><span class="com">#11 0x00007f3021fef02a in ChromeMain (argc=21, argv=0x7fff722724b8) at ../../../../../chromeos-cache/distfiles/target/chrome-src-internal/src/chrome/app/chrome_main.cc:66</span><span class="pln">
</span><span class="com">#12 0x00007f301fa0bf40 in __libc_start_main (main=0x7f3021fee760 &lt;main(int, char const**)&gt;, argc=21, argv=0x7fff722724b8, init=&lt;optimized out&gt;, fini=&lt;optimized out&gt;, rtld_fini=&lt;optimized out&gt;,stack_end=0x7fff722724a8) at libc-start.c:292</span><span class="pln">
</span><span class="com">#13 0x00007f3021feee95 in _start ()</span><span class="pln">
</span><span class="pun">(</span><span class="pln">lumpy</span><span class="pun">-</span><span class="pln">gdb</span><span class="pun">)</span><span class="pln">
</span></pre>
                    <p>Example 2:</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cros_sdk gdb</span><span class="pun">-</span><span class="pln">daisy </span><span class="pun">--</span><span class="pln">pid</span><span class="pun">=</span><span class="lit">626</span><span class="pln"> </span><span class="pun">--</span><span class="pln">remote</span><span class="pun">=</span><span class="lit">123.45</span><span class="pun">.</span><span class="lit">98.765</span><span class="pln">
</span><span class="lit">14</span><span class="pun">:</span><span class="lit">50</span><span class="pun">:</span><span class="lit">07</span><span class="pun">:</span><span class="pln"> INFO</span><span class="pun">:</span><span class="pln"> run</span><span class="pun">:</span><span class="pln"> ping </span><span class="pun">-</span><span class="pln">c </span><span class="lit">1</span><span class="pln"> </span><span class="pun">-</span><span class="pln">w </span><span class="lit">20</span><span class="pln"> </span><span class="lit">123.45</span><span class="pun">.</span><span class="lit">98.765</span><span class="pln">
</span><span class="lit">14</span><span class="pun">:</span><span class="lit">50</span><span class="pun">:</span><span class="lit">09</span><span class="pun">:</span><span class="pln"> INFO</span><span class="pun">:</span><span class="pln"> run</span><span class="pun">:</span><span class="pln"> file </span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">daisy</span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="pln">sbin</span><span class="pun">/</span><span class="pln">cryptohomed
</span><span class="lit">14</span><span class="pun">:</span><span class="lit">50</span><span class="pun">:</span><span class="lit">10</span><span class="pun">:</span><span class="pln"> INFO</span><span class="pun">:</span><span class="pln"> run</span><span class="pun">:</span><span class="pln"> armv7a</span><span class="pun">-</span><span class="pln">cros</span><span class="pun">-</span><span class="pln">linux</span><span class="pun">-</span><span class="pln">gnueabi</span><span class="pun">-</span><span class="pln">gdb </span><span class="pun">--</span><span class="pln">quiet </span><span class="str">&#39;--eval-command=set sysroot /build/daisy&#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=set solib-absolute-prefix /build/daisy&#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=set solib-search-path /build/daisy&#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=set debug-file-directory /build/daisy/usr/lib/debug&#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=set prompt (daisy-gdb) &#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=file /build/daisy/usr/sbin/cryptohomed&#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=target remote localhost:38080&#39;</span><span class="pln">
</span><span class="typ">Reading</span><span class="pln"> symbols from </span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">daisy</span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="pln">sbin</span><span class="pun">/</span><span class="pln">cryptohomed</span><span class="pun">...</span><span class="typ">Reading</span><span class="pln"> symbols from</span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">daisy</span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="pln">lib</span><span class="pun">/</span><span class="pln">debug</span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">cryptohomed</span><span class="pun">.</span><span class="pln">debug</span><span class="pun">...</span><span class="kwd">done</span><span class="pun">.</span><span class="pln">
</span><span class="pun">(</span><span class="pln">daisy</span><span class="pun">-</span><span class="pln">gdb</span><span class="pun">)</span><span class="pln">
</span></pre>
                    <p>Example 3:</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cros_sdk gdb</span><span class="pun">-</span><span class="pln">lumpy </span><span class="pun">--</span><span class="pln">remote</span><span class="pun">=:</span><span class="pln">vm</span><span class="pun">:</span><span class="pln"> </span><span class="pun">--</span><span class="pln">attach</span><span class="pun">=</span><span class="pln">browser
</span><span class="lit">15</span><span class="pun">:</span><span class="lit">18</span><span class="pun">:</span><span class="lit">28</span><span class="pun">:</span><span class="pln"> INFO</span><span class="pun">:</span><span class="pln"> run</span><span class="pun">:</span><span class="pln"> ping </span><span class="pun">-</span><span class="pln">c </span><span class="lit">1</span><span class="pln"> </span><span class="pun">-</span><span class="pln">w </span><span class="lit">20</span><span class="pln"> localhost
</span><span class="lit">15</span><span class="pun">:</span><span class="lit">18</span><span class="pun">:</span><span class="lit">31</span><span class="pun">:</span><span class="pln"> INFO</span><span class="pun">:</span><span class="pln"> run</span><span class="pun">:</span><span class="pln"> file </span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">lumpy</span><span class="pun">/</span><span class="pln">opt</span><span class="pun">/</span><span class="pln">google</span><span class="pun">/</span><span class="pln">chrome</span><span class="pun">/</span><span class="pln">chrome
</span><span class="lit">15</span><span class="pun">:</span><span class="lit">18</span><span class="pun">:</span><span class="lit">33</span><span class="pun">:</span><span class="pln"> INFO</span><span class="pun">:</span><span class="pln"> run</span><span class="pun">:</span><span class="pln"> x86_64</span><span class="pun">-</span><span class="pln">cros</span><span class="pun">-</span><span class="pln">linux</span><span class="pun">-</span><span class="pln">gnu</span><span class="pun">-</span><span class="pln">gdb </span><span class="pun">--</span><span class="pln">quiet </span><span class="str">&#39;--eval-command=setsysroot /build/lumpy&#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=set solib-absolute-prefix /build/lumpy&#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=set solib-search-path /build/lumpy&#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=set debug-file-directory /build/lumpy/usr/lib/debug&#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=set prompt (lumpy-gdb) &#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=file /build/lumpy/opt/google/chrome/chrome&#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=target remote localhost:48062&#39;</span><span class="pln">
</span><span class="typ">Reading</span><span class="pln"> symbols from </span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">lumpy</span><span class="pun">/</span><span class="pln">opt</span><span class="pun">/</span><span class="pln">google</span><span class="pun">/</span><span class="pln">chrome</span><span class="pun">/</span><span class="pln">chrome</span><span class="pun">...</span><span class="typ">Reading</span><span class="pln"> symbols from </span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">lumpy</span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="pln">lib</span><span class="pun">/</span><span class="pln">debug</span><span class="pun">/</span><span class="pln">opt</span><span class="pun">/</span><span class="pln">google</span><span class="pun">/</span><span class="pln">chrome</span><span class="pun">/</span><span class="pln">chrome</span><span class="pun">.</span><span class="pln">debug</span><span class="pun">...</span><span class="kwd">done</span><span class="pun">.</span><span class="pln">
</span><span class="kwd">done</span><span class="pun">.</span><span class="pln">
</span><span class="typ">Remote</span><span class="pln"> debugging using localhost</span><span class="pun">:</span><span class="lit">48062</span><span class="pln">
</span><span class="pun">...</span><span class="pln">
</span><span class="pun">(</span><span class="pln">lumpy</span><span class="pun">-</span><span class="pln">gdb</span><span class="pun">)</span><span class="pln">
</span></pre>
                    <p>If you find problems with the board-specific gdb scripts, please file a bug (<a href="https://crbug.com/new">crbug.com/new</a>) and add &lsquo;build-toolchain&rsquo; as one of the labels in the bug.</p>
                    <h2>
                        <a class="h" name="Building-Chrome-for-ThoriumOS" href="#Building-Chrome-for-ThoriumOS"><span></span></a>
                        <a class="h" name="building-chrome-for-chromiumos" href="#building-chrome-for-chromiumos"><span></span></a>Building Chrome for ThoriumOS
                    </h2>
                    <p>See <a href="simple_chrome_workflow.md">Simple Chrome Workflow</a>.</p>
                    <h2>
                        <a class="h" name="Troubleshooting" href="#Troubleshooting"><span></span></a><a class="h" name="troubleshooting" href="#troubleshooting"><span></span></a>Troubleshooting
                    </h2>
                    <h3>
                        <a class="h" name="I-lost-my-developer-tools-on-the-stateful-partition_can-I-get-them-back" href="#I-lost-my-developer-tools-on-the-stateful-partition_can-I-get-them-back"><span></span></a>
                        <a class="h" name="i-lost-my-developer-tools-on-the-stateful-partition_can-i-get-them-back" href="#i-lost-my-developer-tools-on-the-stateful-partition_can-i-get-them-back"><span></span></a>I lost my developer tools
                        on the stateful partition, can I get them back?
                    </h3>
                    <p>
                        This happens sometimes because the security system likes to wipe out the stateful partition and a lot of developer tools are in /usr/local/bin. You may be able restore some of them using the
                        <code class="code">dev-install</code> tool. See the
                        <a href="https://chromium.googlesource.com/chromiumos/platform2/+/HEAD/dev-install/README.md#supported-workflows-base-image"><code class="code">dev-install</code> docs</a> for more information about its &ldquo;Base
                        Image&rdquo; workflow.
                    </p>
                    <h3>
                        <a class="h" name="Disabling-Enterprise-Enrollment" href="#Disabling-Enterprise-Enrollment"><span></span></a>
                        <a class="h" name="disabling-enterprise-enrollment" href="#disabling-enterprise-enrollment"><span></span></a>Disabling Enterprise Enrollment
                    </h3>
                    <p>
                        Some devices may be configured with a policy that only allows logging in with enterprise credentials, which will prevent you from logging in with a non-enterprise Google account (e.g.,
                        <code class="code">foo@gmail.com</code>). To disable the enterprise enrollment setting:
                    </p>
                    <ul>
                        <li>
                            <p>Enable <a href="developer_mode.md">Developer Mode</a>.</p>
                        </li>
                        <li>
                            <p>Disable the enterprise enrollment check:</p>
                            <pre class="code"><span class="pun">(</span><span class="pln">device</span><span class="pun">)</span><span class="pln">
$ vpd </span><span class="pun">-</span><span class="pln">i RW_VPD </span><span class="pun">-</span><span class="pln">s check_enrollment</span><span class="pun">=</span><span class="lit">0</span><span class="pln">
$ dump_vpd_log </span><span class="pun">--</span><span class="pln">force
$ crossystem clear_tpm_owner_request</span><span class="pun">=</span><span class="lit">1</span><span class="pln">
$ reboot
</span></pre>
                        </li>
                    </ul>
                    <div class="note"><strong>NOTE:</strong> The enterprise policy can also prevent transitioning to <a href="developer_mode.md">Developer Mode</a>, in which case you won&#39;t be able to perform the above commands.</div>
                    <h2>
                        <a class="h" name="Running-Tests" href="#Running-Tests"><span></span></a><a class="h" name="running-tests" href="#running-tests"><span></span></a>Running Tests
                    </h2>
                    <p>
                        ThoriumOS integration (or &ldquo;functional&rdquo;) tests are written using the <a href="https://chromium.googlesource.com/chromiumos/platform/tast/">Tast</a> or
                        <a href="https://autotest.github.io/">Autotest</a> frameworks.
                    </p>
                    <h3>
                        <a class="h" name="Set-up-SSH-connection-between-chroot-and-DUT" href="#Set-up-SSH-connection-between-chroot-and-DUT"><span></span></a>
                        <a class="h" name="set-up-ssh-connection-between-chroot-and-dut" href="#set-up-ssh-connection-between-chroot-and-dut"><span></span></a>Set up SSH connection between chroot and DUT
                    </h3>
                    <p>
                        To run automated tests on your <a href="glossary.md#acronyms">DUT</a>, you first need to set up SSH connection between chroot on your workstation and the DUT. See
                        <a href="tips-and-tricks.md#How-to-SSH-to-DUT-without-a-password">this document</a> for how to set it up.
                    </p>
                    <h4>
                        <a class="h" name="For-Googlers" href="#For-Googlers"><span></span></a><a class="h" name="for-googlers" href="#for-googlers"><span></span></a>For Googlers
                    </h4>
                    <p>If you are a Google engineer using a corp workstation, you may be required some extra settings, depending on where your DUT is.</p>
                    <ul>
                        <li>DUT at office: Use <a href="https://goto.google.com/corp-ssh-helper-helper">corp-ssh-helper-helper</a>.</li>
                        <li>DUT at your home: See <a href="https://goto.google.com/arc-wfh">go/arc-wfh</a>.</li>
                        <li>DUT at lab: See <a href="https://goto.google.com/chromeos-lab-duts-ssh">go/chromeos-lab-duts-ssh</a>.</li>
                    </ul>
                    <h3>
                        <a class="h" name="Tast" href="#Tast"><span></span></a><a class="h" name="tast" href="#tast"><span></span></a>Tast
                    </h3>
                    <p>
                        <a href="https://chromium.googlesource.com/chromiumos/platform/tast/">Tast</a> is a Go-based integration testing framework with a focus on speed, ease-of-use, and maintainability. Existing Autotest-based tests that
                        run on the ChromeOS Commit Queue are being ported to Tast and decommissioned as of 2018 Q4. Please strongly consider using Tast when writing new integration tests (but be aware that not all functionality provided by
                        Autotest is available in Tast; for example, tests that use multiple devices simultaneously when running are not currently supported).
                    </p>
                    <p>Here are some starting points for learning more about Tast:</p>
                    <ul>
                        <li><a href="https://chromium.googlesource.com/chromiumos/platform/tast/+/HEAD/docs/quickstart.md">Tast Quickstart</a></li>
                        <li><a href="https://chromium.googlesource.com/chromiumos/platform/tast/+/HEAD/docs/running_tests.md">Tast: Running Tests</a></li>
                        <li><a href="https://chromium.googlesource.com/chromiumos/platform/tast/+/HEAD/docs/writing_tests.md">Tast: Writing Tests</a></li>
                        <li><a href="https://chromium.googlesource.com/chromiumos/platform/tast/+/HEAD/docs/overview.md">Tast Overview</a></li>
                    </ul>
                    <p>Please contact the public <a href="https://groups.google.com/a/chromium.org/forum/#!forum/tast-users">tast-users mailing list</a> if you have questions.</p>
                    <h3>
                        <a class="h" name="Autotest" href="#Autotest"><span></span></a><a class="h" name="autotest" href="#autotest"><span></span></a>Autotest
                    </h3>
                    <p>
                        <a href="https://autotest.github.io/">Autotest</a> is a Python-based integration testing framework; the codebase is also responsible for managing the
                        <a href="http://sites/chromeos/for-team-members/lab/lab-faq">ChromeOS lab</a> that is used for hardware testing. ThoriumOS-specific Autotest information is available in the
                        <a href="https://chromium.googlesource.com/chromiumos/third_party/autotest/+/HEAD/docs/user-doc.md">Autotest User Documentation</a>.
                    </p>
                    <p>Additional Autotest documentation:</p>
                    <ul>
                        <li><a href="https://chromium.googlesource.com/chromiumos/third_party/autotest/+/HEAD/docs/user-doc.md#Writing-and-developing-tests">Creating a new Autotest test</a></li>
                        <li><a href="https://dev.chromium.org/chromium-os/testing/running-smoke-suite-on-a-vm-image">Running Autotest Smoke Suite On a VM Image</a></li>
                        <li><a href="https://chromium.googlesource.com/chromiumos/third_party/autotest/+/HEAD/docs/user-doc.md#Q4_I-have-an-ebuild_what-tests-does-it-build">Seeing which Autotest tests are implemented by an ebuild</a></li>
                    </ul>
                    <h3>
                        <a class="h" name="Creating-a-normal-image-that-has-been-modified-for-test" href="#Creating-a-normal-image-that-has-been-modified-for-test"><span></span></a>
                        <a class="h" name="creating-a-normal-image-that-has-been-modified-for-test" href="#creating-a-normal-image-that-has-been-modified-for-test"><span></span></a>Creating a normal image that has been modified for test
                    </h3>
                    <p>
                        See <a href="https://chromium.googlesource.com/chromiumos/third_party/autotest/+/HEAD/docs/user-doc.md#W4_Create-and-run-a-test_enabled-image-on-your-device">Creating an image that has been modified for test</a> for
                        information about modifying a normal system image so that integration tests can be run on it.
                    </p>
                    <h3>
                        <a class="h" name="Creating-a-recovery-image-that-has-been-modified-for-test" href="#Creating-a-recovery-image-that-has-been-modified-for-test"><span></span></a>
                        <a class="h" name="creating-a-recovery-image-that-has-been-modified-for-test" href="#creating-a-recovery-image-that-has-been-modified-for-test"><span></span></a>Creating a recovery image that has been modified for
                        test
                    </h3>
                    <p>After building a test image using <code class="code">cros build-image test</code> as described above, you may wish to encapsulate it within a recovery image:</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cros_sdk </span><span class="pun">./</span><span class="pln">mod_image_for_recovery</span><span class="pun">.</span><span class="pln">sh \
    </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> \
    </span><span class="pun">--</span><span class="pln">nominimize_image \
    </span><span class="pun">--</span><span class="pln">image </span><span class="pun">~/</span><span class="pln">chromiumos</span><span class="pun">/</span><span class="pln">src</span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">images</span><span class="pun">/</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}/</span><span class="pln">latest</span><span class="pun">/</span><span class="pln">chromiumos_test_image</span><span class="pun">.</span><span class="pln">bin \
    </span><span class="pun">--</span><span class="pln">to </span><span class="pun">~/</span><span class="pln">chromiumos</span><span class="pun">/</span><span class="pln">src</span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">images</span><span class="pun">/</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}/</span><span class="pln">latest</span><span class="pun">/</span><span class="pln">recovery_test_image</span><span class="pun">.</span><span class="pln">bin
</span></pre>
                    <p>If desired, you may specify a custom kernel with <code class="code">--kernel_image ${RECOVERY_KERNEL}</code>.</p>
                    <p>You can write this recovery image out to the USB device like so:</p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cros flash usb</span><span class="pun">://</span><span class="pln"> </span><span class="pun">~/</span><span class="pln">chromiumos</span><span class="pun">/</span><span class="pln">src</span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">images</span><span class="pun">/</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}/</span><span class="pln">latest</span><span class="pun">/</span><span class="pln">recovery_test_image</span><span class="pun">.</span><span class="pln">bin
</span></pre>
                    <p>Note that there are some <strong>downsides</strong> to this approach which you should keep in mind.</p>
                    <ul>
                        <li>Your USB image will be a recovery mode/test image, but the ordinary image in your directory will be a non-test image.</li>
                        <li>If you use devserver, this will serve the non-test image not the test-image.</li>
                        <li>This means a machine installed with a test-enabled USB image will update to a non-test-enabled one.</li>
                        <li>
                            As the <code class="code">*-generic</code> boards set <code class="code">USE=tpm</code>, recovery images built for <code class="code">*-generic</code> don&#39;t work on devices with H1 chips (which requires
                            <code class="code">USE=tpm2</code>).
                        </li>
                    </ul>
                    <h2>
                        <a class="h" name="Additional-information" href="#Additional-information"><span></span></a><a class="h" name="additional-information" href="#additional-information"><span></span></a>Additional information
                    </h2>
                    <h3>
                        <a class="h" name="Entering-a-shell-in-the-chroot" href="#Entering-a-shell-in-the-chroot"><span></span></a>
                        <a class="h" name="entering-a-shell-in-the-chroot" href="#entering-a-shell-in-the-chroot"><span></span></a>Entering a shell in the chroot
                    </h3>
                    <p>
                        For commands which need executed in the SDK, we&#39;ve previously prefixed all them with <code class="code">cros_sdk</code> in this guide. However, you may find that getting a shell in the chroot is useful for
                        debugging or some other advanced workflow. You can do so by running <code class="code">cros_sdk</code> without any arguments:
                    </p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cros_sdk
</span></pre>
                    <p>
                        This command will probably prompt you for your password for the <code class="code">sudo</code> command (entering the chroot requires root privileges). Once the command finishes, that terminal is in the chroot and
                        you&#39;ll be in the <code class="code">~/chromiumos/src/scripts</code> directory, where most build commands live. In the chroot you can only see a subset of the filesystem on your machine. However, through some
                        trickery (bind mounts), you will have access to the whole <code class="code">src</code> directory from within the chroot – this is so that you can build the software within the chroot.
                    </p>
                    <p>
                        Note in particular that the <code class="code">src/scripts</code> directory is the same <code class="code">src/scripts</code> directory found within the ThoriumOS directory you were in before you entered the chroot,
                        even though it looks like a different location. That&#39;s because when you enter the chroot, the <code class="code">~/chromiumos</code> directory in the chroot is mounted such that it points to the main ThoriumOS
                        directory <code class="code">~/chromiumos</code> outside the chroot. That means that changes that you make to the source code outside of the chroot immediately take effect inside the chroot.
                    </p>
                    <p>Calling this will also install a chroot, if you don&#39;t have one yet, for example by not following the above.</p>
                    <p>While in the chroot you will see a special &ldquo;(cr)&rdquo; prompt to remind you that you are there:</p>
                    <pre
                        class="code"
                    ><span class="pun">(</span><span class="pln">cr</span><span class="pun">)</span><span class="pln"> </span><span class="pun">((...))</span><span class="pln"> johnnyrotten@flyingkite </span><span class="pun">~/</span><span class="pln">chromiumos</span><span class="pun">/</span><span class="pln">src</span><span class="pun">/</span><span class="pln">scripts $
</span></pre>
                    <p>
                        You generally cannot run programs on your filesystem from within the chroot. For example, if you are using eclipse as an IDE, or gedit to edit a text file, you will need to run those programs outside the chroot. As a
                        consolation, you can use vim. If you are desperate for Emacs, try typing <code class="code">sudo emerge emacs</code>. Of course this command will build Emacs from source so allow 5-10 minutes.
                    </p>
                    <p><strong>SIDE NOTES:</strong></p>
                    <ul>
                        <li>
                            If you need to share lots of files inside and outside chroot (for example, settings for your favorite editor / tools, or files downloaded by browser outside chroot, etc.), read
                            <a href="tips-and-tricks.md">Tips and Tricks</a>.
                        </li>
                        <li>
                            There is a file system loop because inside <code class="code">~/chromiumos</code> you will find the chroot again. Don&lsquo;t think about this for too long. If you try to use
                            <code class="code">du -s ~/chromiumos/chroot/home</code> you might get a message about a corrupted file system. This is nothing to worry about, and just means that your computer doesn&rsquo;t understand this loop
                            either. (If you <em>can</em> understand this loop, try <a href="https://www.google.com/search?q=the+fourth+dimension">something harder</a>.)
                        </li>
                    </ul>
                    <h3>
                        <a class="h" name="Updating-the-chroot" href="#Updating-the-chroot"><span></span></a><a class="h" name="updating-the-chroot" href="#updating-the-chroot"><span></span></a>Updating the chroot
                    </h3>
                    <p>
                        You should run <code class="code">update_chroot</code> after <code class="code">repo sync</code>. <code class="code">repo sync</code> only updates the source code, <code class="code">update_chroot</code> is required
                        to apply those changes to the chroot. <code class="code">update_chroot</code> can be run manually, alternatively it is run as part of <code class="code">cros build-packages</code>.
                    </p>
                    <pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
$ cros_sdk update_chroot
</span></pre>
                    <h3>
                        <a class="h" name="Documentation-on-this-site" href="#Documentation-on-this-site"><span></span></a><a class="h" name="documentation-on-this-site" href="#documentation-on-this-site"><span></span></a>Documentation on
                        this site
                    </h3>
                    <p>
                        You now understand the basics of building, running, modifying, and testing ThoriumOS, but you&#39;ve still got a lot to learn. Here are links to a few other pages on the chromium.org site that you are likely to find
                        helpful (somewhat ordered by relevance):
                    </p>
                    <ul>
                        <li>The <a href="tips-and-tricks.md">Tips And Tricks</a> page has a lot of useful information to help you optimize your workflow.</li>
                        <li>If you haven&#39;t read the page about the <a href="https://chromium.googlesource.com/chromiumos/chromite/+/HEAD/docs/devserver.md">devserver</a> already, read it now.</li>
                        <li>Learn about the ThoriumOS <a href="source_layout.md">directory structure</a>.</li>
                        <li><a href="https://dev.chromium.org/chromium-os/how-tos-and-troubleshooting/developer-faq">The ThoriumOS developer FAQ</a></li>
                        <li><a href="portage/ebuild_faq.md">ThoriumOS Portage Build FAQ</a> is useful for portage-specific questions.</li>
                        <li>
                            If you have questions about the <code class="code">--no-enable-rootfs-verification</code> option, you might find answers on this
                            <a href="https://groups.google.com/a/chromium.org/group/chromium-os-dev/browse_thread/thread/967e783e27dd3a9d/0fa20a1547de2c77?lnk=gst">thread on chromium-os-dev</a>.
                        </li>
                        <li>
                            <a href="https://dev.chromium.org/chromium-os/testing/running-smoke-suite-on-a-vm-image">Running Smoke Suite on a VM Image</a> has good information about how to get up and running with autotest tests and VMs.
                        </li>
                        <li><a href="https://dev.chromium.org/chromium-os/how-tos-and-troubleshooting/debugging-tips">Debugging Tips</a> contains information about how to debug the Chromium browser on your ThoriumOS device.</li>
                        <li><a href="work_on_branch.md">Working on a Branch</a> has tips for working on branches.</li>
                        <li><a href="https://dev.chromium.org/chromium-os/how-tos-and-troubleshooting/git-server-side-information">Git server-side information</a> talks about adding new git repositories.</li>
                        <li>The <a href="portage/package_upgrade_process.md">Portage Package Upgrade Process</a> documents how our Portage packages can be upgraded when they fall out of date with respect to upstream.</li>
                        <li>The <a href="sandboxing.md">ThoriumOS Sandboxing</a> page describes the mechanisms and tools used to sandbox (or otherwise restrict the privileges of) ThoriumOS system services.</li>
                        <li>
                            The <a href="https://dev.chromium.org/chromium-os/developer-guide/go-in-chromium-os">Go in ThoriumOS</a> page provides information on using <a href="https://golang.org">Go</a> in ThoriumOS, including
                            recommendations for project organization, importing and managing third party packages, and writing ebuilds.
                        </li>
                        <li>The <a href="security/selinux.md">SELinux</a> page provides information on SELinux in Chrome OS, including overview, writing policies, and troubleshooting.</li>
                        <li>
                            The <a href="testing/single-binary-ubsan.md">Running a single binary with UBSAN</a> page gives tips for using UBSAN (undefined behavior sanitizer) to find bugs in a binary. Instructions can also be used for ASAN
                            (address sanitizer) and TSAN (thread sanitizer).
                        </li>
                    </ul>
                    <h3>
                        <a class="h" name="External-documentation" href="#External-documentation"><span></span></a><a class="h" name="external-documentation" href="#external-documentation"><span></span></a>External documentation
                    </h3>
                    <p>Below are a few links to external sites that you might also find helpful (somewhat ordered by relevance):</p>
                    <ul>
                        <li><strong>Definitely</strong> look at the <a href="https://groups.google.com/a/chromium.org/group/chromium-os-dev">ThoriumOS dev group</a> to see what people are talking about.</li>
                        <li>Check out the <a href="https://crbug.com/">Chromium bug tracker</a> to report bugs, look for known issues, or look for things to fix.</li>
                        <li>Get an idea of what&#39;s actively happening by looking at the <a href="https://chromium-review.googlesource.com/">Chromium Gerrit</a> site. (Note that this is no longer the same site that Chromium uses)</li>
                        <li>Browse the source code on the <a href="https://chromium.googlesource.com/">ThoriumOS gitweb</a>.</li>
                        <li>Check the current status of the builds by looking at the <a href="https://ci.chromium.org/p/chromeos">ThoriumOS build waterfall</a>.</li>
                        <li>Check out the #chromium-os channel on <a href="https://web.libera.chat/">libera.chat</a> (some ThoriumOS developers hang out on this IRC channel).</li>
                        <li>
                            If you&#39;re learning git, check out <a href="https://eagain.net/articles/git-for-computer-scientists/">Git for Computer Scientists</a>,
                            <a href="http://www-cs-students.stanford.edu/~blynn/gitmagic/">Git Magic</a>, or the <a href="http://schacon.github.com/git/user-manual.html">Git Manual</a>.
                        </li>
                        <li>
                            Gentoo has several useful documentation resources
                            <ul>
                                <li><a href="https://devmanual.gentoo.org/">Gentoo Development Guide</a> is a useful resource for Portage, which is the underlying packaging system we use.</li>
                                <li><a href="https://wiki.gentoo.org/wiki/Embedded_Handbook">Gentoo Embedded Handbook</a></li>
                                <li><a href="https://wiki.gentoo.org/wiki/Embedded_Handbook">Gentoo Cross Development Guide</a></li>
                                <li><a href="https://wiki.gentoo.org/wiki/Crossdev">Gentoo Wiki on Cross-Compiling</a></li>
                                <li><a href="https://ci.chromium.org/p/chromeos">Gentoo Package Manager Specification</a></li>
                            </ul>
                        </li>
                        <li>The <a href="https://source.android.com/source/using-repo">repo user docs</a> might help you if you&#39;re curious about repo.</li>
                        <li>The <a href="https://groups.google.com/group/repo-discuss">repo-discuss group</a> is a good place to talk about repo.</li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- default customDocFooter -->
        <footer class="Site-footer">
            <div class="Footer">
                <span class="Footer-poweredBy">Powered by <a href="https://gerrit.googlesource.com/gitiles/">Gitiles</a></span>
                <div class="Footer-links"></div>
            </div>
        </footer>
    </body>
</html>
